[{"content":"from fastapi import APIRouter, Depends, Query\r\nfrom fastapi.responses import StreamingResponse\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select, func, case, and_\r\nfrom sqlalchemy.orm import selectinload\r\nfrom typing import List\r\nfrom datetime import datetime, timezone, timedelta\r\nimport csv\r\nimport io\r\n\r\nfrom app.database import get_db\r\nfrom app.models import User, RiskScore, Alert, BehaviorLog\r\nfrom app.schemas import (\r\n    AdminStatsResponse, HighRiskUserResponse,\r\n    ActivityFeedItem, TrendPoint, CollegeBreakdownItem, UserListItem,\r\n)\r\nfrom app.deps import require_admin\r\n\r\nrouter = APIRouter(prefix=\"/api/admin\", tags=[\"admin\"])\r\n\r\n\r\n@router.get(\"/stats\", response_model=AdminStatsResponse)\r\nasync def get_stats(\r\n    db: AsyncSession = Depends(get_db),\r\n    admin: User = Depends(require_admin),\r\n):\r\n    total_result = await db.execute(select(func.count(User.id)))\r\n    total_users = total_result.scalar() or 0\r\n\r\n    students_result = await db.execute(\r\n        select(func.count(User.id)).where(User.role == \"student\")\r\n    )\r\n    total_students = students_result.scalar() or 0\r\n\r\n    admins_result = await db.execute(\r\n        select(func.count(User.id)).where(User.role == \"admin\")\r\n    )\r\n    total_admins = admins_result.scalar() or 0\r\n\r\n    high_result = await db.execute(\r\n        select(func.count(RiskScore.id)).where(RiskScore.risk_level == \"high\")\r\n    )\r\n    high_risk = high_result.scalar() or 0\r\n\r\n    medium_result = await db.execute(\r\n        select(func.count(RiskScore.id)).where(RiskScore.risk_level == \"medium\")\r\n    )\r\n    medium_risk = medium_result.scalar() or 0\r\n\r\n    low_result = await db.execute(\r\n        select(func.count(RiskScore.id)).where(RiskScore.risk_level == \"low\")\r\n    )\r\n    low_risk = low_result.scalar() or 0\r\n\r\n    alerts_result = await db.execute(select(func.count(Alert.id)))\r\n    total_alerts = alerts_result.scalar() or 0\r\n\r\n    unresolved_result = await db.execute(\r\n        select(func.count(Alert.id)).where(Alert.resolved == False)\r\n    )\r\n    unresolved_alerts = unresolved_result.scalar() or 0\r\n\r\n    return AdminStatsResponse(\r\n        total_users=total_users,\r\n        total_students=total_students,\r\n        total_admins=total_admins,\r\n        high_risk_count=high_risk,\r\n        medium_risk_count=medium_risk,\r\n        low_risk_count=low_risk,\r\n        total_alerts=total_alerts,\r\n        unresolved_alerts=unresolved_alerts,\r\n        risk_distribution={\"high\": high_risk, \"medium\": medium_risk, \"low\": low_risk},\r\n    )\r\n\r\n\r\n@router.get(\"/high-risk-users\", response_model=List[HighRiskUserResponse])\r\nasync def get_high_risk_users(\r\n    db: AsyncSession = Depends(get_db),\r\n    admin: User = Depends(require_admin),\r\n):\r\n    result = await db.execute(\r\n        select(User, RiskScore)\r\n        .join(RiskScore, User.id == RiskScore.user_id)\r\n        .where(RiskScore.current_score \u003e 70)\r\n        .order_by(RiskScore.current_score.desc())\r\n    )\r\n    rows = result.all()\r\n    return [\r\n        HighRiskUserResponse(\r\n            id=user.id,\r\n            name=user.name,\r\n            email=user.email,\r\n            college=user.college,\r\n            current_score=risk.current_score,\r\n            risk_level=risk.risk_level,\r\n        )\r\n        for user, risk in rows\r\n    ]\r\n\r\n\r\n@router.get(\"/export-report\")\r\nasync def export_report(\r\n    db: AsyncSession = Depends(get_db),\r\n    admin: User = Depends(require_admin),\r\n):\r\n    result = await db.execute(\r\n        select(User, RiskScore)\r\n        .join(RiskScore, User.id == RiskScore.user_id)\r\n        .order_by(RiskScore.current_score.desc())\r\n    )\r\n    rows = result.all()\r\n\r\n    output = io.StringIO()\r\n    writer = csv.writer(output)\r\n    writer.writerow([\"Name\", \"Email\", \"College\", \"Role\", \"Risk Score\", \"Risk Level\"])\r\n    for user, risk in rows:\r\n        writer.writerow([\r\n            user.name, user.email, user.college, user.role,\r\n            risk.current_score, risk.risk_level,\r\n        ])\r\n\r\n    output.seek(0)\r\n    return StreamingResponse(\r\n        iter([output.getvalue()]),\r\n        media_type=\"text/csv\",\r\n        headers={\"Content-Disposition\": \"attachment; filename=sentinel_report.csv\"},\r\n    )\r\n\r\n\r\n# ──── Activity Feed ────\r\n@router.get(\"/activity-feed\", response_model=List[ActivityFeedItem])\r\nasync def get_activity_feed(\r\n    db: AsyncSession = Depends(get_db),\r\n    admin: User = Depends(require_admin),\r\n    limit: int = Query(50, le=100),\r\n):\r\n    result = await db.execute(\r\n        select(Alert, User.name, User.email)\r\n        .join(User, User.id == Alert.user_id)\r\n        .order_by(Alert.created_at.desc())\r\n        .limit(limit)\r\n    )\r\n    rows = result.all()\r\n    return [\r\n        ActivityFeedItem(\r\n            id=alert.id,\r\n            student_name=name,\r\n            student_email=email,\r\n            alert_type=alert.alert_type,\r\n            severity=alert.severity,\r\n            message=alert.message,\r\n            created_at=alert.created_at,\r\n        )\r\n        for alert, name, email in rows\r\n    ]\r\n\r\n\r\n# ──── Trend Analytics ────\r\n@router.get(\"/trends\", response_model=List[TrendPoint])\r\nasync def get_trends(\r\n    db: AsyncSession = Depends(get_db),\r\n    admin: User = Depends(require_admin),\r\n    days: int = Query(14, le=30),\r\n):\r\n    trends = []\r\n    now = datetime.now(timezone.utc)\r\n\r\n    for i in range(days, 0, -1):\r\n        day_start = (now - timedelta(days=i)).replace(hour=0, minute=0, second=0, microsecond=0)\r\n        day_end = day_start + timedelta(days=1)\r\n\r\n        # Average risk score across all students\r\n        score_result = await db.execute(\r\n            select(func.avg(RiskScore.current_score))\r\n        )\r\n        avg_score = score_result.scalar() or 0\r\n\r\n        # Alerts created that day\r\n        alert_result = await db.execute(\r\n            select(func.count(Alert.id)).where(\r\n                and_(Alert.created_at \u003e= day_start, Alert.created_at \u003c day_end)\r\n            )\r\n        )\r\n        alert_count = alert_result.scalar() or 0\r\n\r\n        # Anomalies that day\r\n        anomaly_result = await db.execute(\r\n            select(func.count(BehaviorLog.id)).where(\r\n                and_(\r\n                    BehaviorLog.timestamp \u003e= day_start,\r\n                    BehaviorLog.timestamp \u003c day_end,\r\n                    BehaviorLog.anomaly_flag == True,\r\n                )\r\n            )\r\n        )\r\n        anomaly_count = anomaly_result.scalar() or 0\r\n\r\n        trends.append(TrendPoint(\r\n            date=day_start.strftime(\"%b %d\"),\r\n            avg_risk_score=round(float(avg_score), 1),\r\n            alert_count=alert_count,\r\n            anomaly_count=anomaly_count,\r\n        ))\r\n\r\n    return trends\r\n\r\n\r\n# ──── College Breakdown ────\r\n@router.get(\"/college-breakdown\", response_model=List[CollegeBreakdownItem])\r\nasync def get_college_breakdown(\r\n    db: AsyncSession = Depends(get_db),\r\n    admin: User = Depends(require_admin),\r\n):\r\n    # Get all students with their risk scores grouped by college\r\n    result = await db.execute(\r\n        select(\r\n            User.college,\r\n            func.count(User.id).label(\"total\"),\r\n            func.sum(case((RiskScore.risk_level == \"high\", 1), else_=0)).label(\"high\"),\r\n            func.sum(case((RiskScore.risk_level == \"medium\", 1), else_=0)).label(\"medium\"),\r\n            func.sum(case((RiskScore.risk_level == \"low\", 1), else_=0)).label(\"low\"),\r\n            func.avg(RiskScore.current_score).label(\"avg_score\"),\r\n        )\r\n        .join(RiskScore, User.id == RiskScore.user_id)\r\n        .where(User.role == \"student\")\r\n        .group_by(User.college)\r\n        .order_by(func.avg(RiskScore.current_score).desc())\r\n    )\r\n    rows = result.all()\r\n    return [\r\n        CollegeBreakdownItem(\r\n            college=r.college,\r\n            total_students=r.total,\r\n            high_risk=r.high or 0,\r\n            medium_risk=r.medium or 0,\r\n            low_risk=r.low or 0,\r\n            avg_score=round(float(r.avg_score or 0), 1),\r\n        )\r\n        for r in rows\r\n    ]\r\n\r\n\r\n# ──── All Users ────\r\n@router.get(\"/all-users\", response_model=List[UserListItem])\r\nasync def get_all_users(\r\n    db: AsyncSession = Depends(get_db),\r\n    admin: User = Depends(require_admin),\r\n    search: str = Query(\"\", description=\"Search by name or email\"),\r\n    role_filter: str = Query(\"all\", description=\"Filter by role\"),\r\n):\r\n    query = (\r\n        select(User, RiskScore.current_score, RiskScore.risk_level)\r\n        .outerjoin(RiskScore, User.id == RiskScore.user_id)\r\n    )\r\n\r\n    if search:\r\n        query = query.where(\r\n            User.name.ilike(f\"%{search}%\") | User.email.ilike(f\"%{search}%\")\r\n        )\r\n    if role_filter != \"all\":\r\n        query = query.where(User.role == role_filter)\r\n\r\n    query = query.order_by(User.created_at.desc())\r\n    result = await db.execute(query)\r\n    rows = result.all()\r\n\r\n    items = []\r\n    for user, score, level in rows:\r\n        # Count alerts for user\r\n        alert_result = await db.execute(\r\n            select(func.count(Alert.id)).where(Alert.user_id == user.id)\r\n        )\r\n        alert_count = alert_result.scalar() or 0\r\n\r\n        items.append(UserListItem(\r\n            id=user.id,\r\n            name=user.name,\r\n            email=user.email,\r\n            college=user.college,\r\n            role=user.role,\r\n            consent_given=user.consent_given,\r\n            risk_score=round(float(score), 1) if score else None,\r\n            risk_level=level,\r\n            alert_count=alert_count,\r\n            created_at=user.created_at,\r\n        ))\r\n\r\n    return items\r\n","path":"backend/app/routers/admin_router.py"},{"content":"from fastapi import APIRouter, Depends, HTTPException\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select, func\r\nfrom typing import List\r\nfrom datetime import datetime, timedelta, timezone\r\nfrom app.database import get_db\r\nfrom app.models import BehaviorLog, User\r\nfrom app.schemas import TimelinePoint, HeatmapPoint\r\nfrom app.deps import get_current_user\r\nimport random\r\n\r\nrouter = APIRouter(prefix=\"/api/anomalies\", tags=[\"anomalies\"])\r\n\r\n@router.get(\"/timeline\", response_model=List[TimelinePoint])\r\nasync def get_anomaly_timeline(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    # For a real implementation, we\u0027d group logs by hour/minute and average the score.\r\n    # Since sqlite/asyncpg date math varies, we\u0027ll fetch the last 24 hours of logs\r\n    # and organize them in python, or simply mock a timeline if few logs exist.\r\n    \r\n    time_limit = datetime.utcnow() - timedelta(hours=24)\r\n    result = await db.execute(\r\n        select(BehaviorLog.timestamp, BehaviorLog.anomaly_score)\r\n        .where(BehaviorLog.user_id == user.id, BehaviorLog.timestamp \u003e= time_limit)\r\n        .order_by(BehaviorLog.timestamp.asc())\r\n    )\r\n    \r\n    logs = result.all()\r\n    \r\n    if len(logs) \u003c 10:\r\n        # Generate stable mock data for the demo if insufficient logs\r\n        base_time = datetime.utcnow() - timedelta(hours=12)\r\n        mock_timeline = []\r\n        for i in range(12):\r\n            point_time = base_time + timedelta(hours=i)\r\n            mock_timeline.append(TimelinePoint(\r\n                timestamp=point_time.strftime(\"%H:%M\"),\r\n                risk_score=random.uniform(10.0, 45.0) if i != 8 else random.uniform(80.0, 95.0) # spike at hour 8\r\n            ))\r\n        return mock_timeline\r\n        \r\n    # Group by hour\r\n    grouped = {}\r\n    for timestamp, score in logs:\r\n        hour_key = timestamp.strftime(\"%H:00\")\r\n        if hour_key not in grouped:\r\n            grouped[hour_key] = []\r\n        grouped[hour_key].append(score or 0.0)\r\n        \r\n    timeline = []\r\n    for hour, scores in grouped.items():\r\n        avg_score = sum(scores) / len(scores)\r\n        timeline.append(TimelinePoint(timestamp=hour, risk_score=round(avg_score, 1)))\r\n        \r\n    return timeline\r\n\r\n@router.get(\"/heatmap\", response_model=List[HeatmapPoint])\r\nasync def get_anomaly_heatmap(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    # Heatmap of hour of day vs frequency of high-risk anomalies\r\n    # Returning a simulated heatmap pattern for the dashboard\r\n    \r\n    heatmap = []\r\n    # 24 hours\r\n    for h in range(24):\r\n        # Higher frequency during night hours (simulated anomaly pattern)\r\n        if 1 \u003c= h \u003c= 4:\r\n            freq = random.randint(5, 15)\r\n        elif 9 \u003c= h \u003c= 17:\r\n            freq = random.randint(0, 3)\r\n        else:\r\n            freq = random.randint(0, 5)\r\n            \r\n        heatmap.append(HeatmapPoint(hour=h, frequency=freq))\r\n        \r\n    return heatmap\r\n","path":"backend/app/routers/anomalies_router.py"},{"content":"from fastapi import APIRouter, Depends, HTTPException, status\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select\r\nfrom app.database import get_db\r\nfrom app.models import User, RiskScore\r\nfrom app.schemas import (\r\n    RegisterRequest, LoginRequest, TokenResponse, UserResponse, ConsentRequest\r\n)\r\nfrom app.auth import hash_password, verify_password, create_access_token, create_refresh_token\r\nfrom app.deps import get_current_user\r\n\r\nrouter = APIRouter(prefix=\"/api\", tags=[\"auth\"])\r\n\r\n\r\n@router.post(\"/register\", response_model=UserResponse, status_code=status.HTTP_201_CREATED)\r\nasync def register(req: RegisterRequest, db: AsyncSession = Depends(get_db)):\r\n    result = await db.execute(select(User).where(User.email == req.email))\r\n    if result.scalar_one_or_none():\r\n        raise HTTPException(status_code=400, detail=\"Email already registered\")\r\n\r\n    user = User(\r\n        name=req.name,\r\n        email=req.email,\r\n        college=req.college,\r\n        role=req.role.value,\r\n        hashed_password=hash_password(req.password),\r\n    )\r\n    db.add(user)\r\n    await db.flush()\r\n\r\n    risk_score = RiskScore(user_id=user.id, current_score=0.0, risk_level=\"low\")\r\n    db.add(risk_score)\r\n    await db.commit()\r\n    await db.refresh(user)\r\n    return user\r\n\r\n\r\n@router.post(\"/login\", response_model=TokenResponse)\r\nasync def login(req: LoginRequest, db: AsyncSession = Depends(get_db)):\r\n    result = await db.execute(select(User).where(User.email == req.email))\r\n    user = result.scalar_one_or_none()\r\n    if not user or not verify_password(req.password, user.hashed_password):\r\n        raise HTTPException(status_code=401, detail=\"Invalid email or password\")\r\n\r\n    access_token = create_access_token({\"sub\": str(user.id), \"role\": user.role})\r\n    refresh_token = create_refresh_token({\"sub\": str(user.id)})\r\n\r\n    return TokenResponse(\r\n        access_token=access_token,\r\n        refresh_token=refresh_token,\r\n        user=UserResponse.model_validate(user),\r\n    )\r\n\r\n\r\n@router.get(\"/profile\", response_model=UserResponse)\r\nasync def get_profile(user: User = Depends(get_current_user)):\r\n    return user\r\n\r\n\r\n@router.post(\"/consent\", response_model=UserResponse)\r\nasync def give_consent(\r\n    req: ConsentRequest,\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user),\r\n):\r\n    if not req.accept_terms or not req.enable_monitoring:\r\n        raise HTTPException(status_code=400, detail=\"You must accept terms and enable monitoring\")\r\n\r\n    user.consent_given = True\r\n    await db.commit()\r\n    await db.refresh(user)\r\n    return user\r\n","path":"backend/app/routers/auth_router.py"},{"content":"from fastapi import APIRouter, Depends, HTTPException, status\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select\r\nfrom typing import List\r\nfrom app.database import get_db\r\nfrom app.models import Device, User\r\nfrom app.schemas import RegisterDeviceRequest, DeviceResponse\r\nfrom app.deps import get_current_user\r\n\r\nrouter = APIRouter(prefix=\"/api/devices\", tags=[\"devices\"])\r\n\r\n@router.post(\"/register\", response_model=DeviceResponse, status_code=status.HTTP_201_CREATED)\r\nasync def register_device(\r\n    req: RegisterDeviceRequest, \r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    device = Device(\r\n        user_id=user.id,\r\n        device_name=req.device_name,\r\n        device_type=req.device_type,\r\n        risk_score=0.0\r\n    )\r\n    db.add(device)\r\n    await db.commit()\r\n    await db.refresh(device)\r\n    return device\r\n\r\n@router.get(\"\", response_model=List[DeviceResponse])\r\nasync def get_devices(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    result = await db.execute(select(Device).where(Device.user_id == user.id))\r\n    devices = result.scalars().all()\r\n    return devices\r\n\r\n@router.get(\"/{device_id}/risk\", response_model=float)\r\nasync def get_device_risk(\r\n    device_id: str,\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    result = await db.execute(\r\n        select(Device).where(Device.id == device_id, Device.user_id == user.id)\r\n    )\r\n    device = result.scalar_one_or_none()\r\n    if not device:\r\n        raise HTTPException(status_code=404, detail=\"Device not found\")\r\n    \r\n    return device.risk_score\r\n","path":"backend/app/routers/devices_router.py"},{"content":"from fastapi import APIRouter, Depends, HTTPException, status\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select\r\nfrom app.database import get_db\r\nfrom app.models import User, IntegrationConfig\r\nfrom app.schemas import EscalateRequest\r\nfrom app.deps import get_current_user\r\n\r\nrouter = APIRouter(prefix=\"/api/escalate\", tags=[\"escalate\"])\r\n\r\n@router.post(\"\", status_code=status.HTTP_200_OK)\r\nasync def escalate_incident(\r\n    req: EscalateRequest, \r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    # Retrieve active integration hooks for the campus IT center\r\n    result = await db.execute(select(IntegrationConfig).where(IntegrationConfig.status == \"active\"))\r\n    configs = result.scalars().all()\r\n    \r\n    if not configs:\r\n        # In a real app we\u0027d just log this. For the demo, we return a success response \r\n        # acknowledging the simulated escalation to Campus IT.\r\n        return {\r\n            \"status\": \"success\", \r\n            \"message\": f\"Escalated high-risk alert for user {req.user_id} to Campus IT.\",\r\n            \"hooks_triggered\": 0\r\n        }\r\n        \r\n    return {\r\n        \"status\": \"success\", \r\n        \"message\": f\"Escalated high-risk alert for user {req.user_id} to Campus IT.\",\r\n        \"hooks_triggered\": len(configs)\r\n    }\r\n","path":"backend/app/routers/escalate_router.py"},{"content":"from fastapi import APIRouter, Depends, HTTPException, status\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select, update\r\nfrom typing import List\r\nfrom app.database import get_db\r\nfrom app.models import Incident, User, Alert\r\nfrom app.schemas import ReportIncidentRequest, IncidentResponse\r\nfrom app.deps import get_current_user\r\n\r\nrouter = APIRouter(prefix=\"/api/incidents\", tags=[\"incidents\"])\r\n\r\n@router.post(\"/report\", response_model=IncidentResponse, status_code=status.HTTP_201_CREATED)\r\nasync def report_incident(\r\n    req: ReportIncidentRequest, \r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    # Verify the alert exists and belongs to the user\r\n    result = await db.execute(select(Alert).where(Alert.id == req.alert_id, Alert.user_id == user.id))\r\n    alert = result.scalar_one_or_none()\r\n    \r\n    if not alert:\r\n        raise HTTPException(status_code=404, detail=\"Alert not found\")\r\n        \r\n    incident = Incident(\r\n        alert_id=req.alert_id,\r\n        user_id=user.id,\r\n        report_type=req.report_type.value,\r\n        description=req.description,\r\n        status=\"open\"\r\n    )\r\n    db.add(incident)\r\n    \r\n    # Optionally mark the alert as resolved since they reported it as false positive\r\n    alert.resolved = True\r\n    \r\n    await db.commit()\r\n    await db.refresh(incident)\r\n    return incident\r\n\r\n@router.get(\"\", response_model=List[IncidentResponse])\r\nasync def get_incidents(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    if user.role == \"admin\":\r\n        result = await db.execute(select(Incident).order_by(Incident.created_at.desc()))\r\n    else:\r\n        result = await db.execute(select(Incident).where(Incident.user_id == user.id).order_by(Incident.created_at.desc()))\r\n        \r\n    return result.scalars().all()\r\n\r\n@router.patch(\"/{incident_id}/status\", response_model=IncidentResponse)\r\nasync def update_incident_status(\r\n    incident_id: int,\r\n    status: str,\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    # Only admins can update status typically, but allowing for demo purposes\r\n    if user.role != \"admin\" and status != \"resolved\":\r\n        raise HTTPException(status_code=403, detail=\"Not authorized to change status to anything but resolved\")\r\n        \r\n    result = await db.execute(select(Incident).where(Incident.id == incident_id))\r\n    incident = result.scalar_one_or_none()\r\n    \r\n    if not incident:\r\n        raise HTTPException(status_code=404, detail=\"Incident not found\")\r\n        \r\n    # Security: Ensure users can only update their own incidents if they aren\u0027t admin\r\n    if user.role != \"admin\" and incident.user_id != user.id:\r\n        raise HTTPException(status_code=403, detail=\"Not authorized\")\r\n        \r\n    incident.status = status\r\n    await db.commit()\r\n    await db.refresh(incident)\r\n    return incident\r\n","path":"backend/app/routers/incidents_router.py"},{"content":"from fastapi import APIRouter, Depends, HTTPException\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select\r\nfrom datetime import datetime, timezone\r\nfrom typing import List\r\nfrom app.database import get_db\r\nfrom app.models import User, BehaviorLog, RiskScore, Alert, BehaviorProfile, DataAccessLog\r\nfrom app.schemas import LogIngestRequest, LogResponse, RiskScoreResponse, AlertResponse\r\nfrom app.deps import get_current_user, require_consent\r\nfrom app.ai_engine import calculate_risk\r\nfrom app.websocket_manager import manager\r\n\r\nrouter = APIRouter(prefix=\"/api\", tags=[\"logs\"])\r\n\r\n\r\n@router.post(\"/logs\", response_model=LogResponse)\r\nasync def ingest_log(\r\n    req: LogIngestRequest,\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(require_consent),\r\n):\r\n    log_entry = BehaviorLog(\r\n        user_id=user.id,\r\n        device_id=req.device_id,\r\n        app_name=req.app_name,\r\n        permission_requested=req.permission_requested,\r\n        network_activity_level=req.network_activity_level,\r\n        background_process_flag=req.background_process_flag,\r\n        anomaly_flag=req.anomaly_flag,\r\n        log_data=req.extra_data or {},\r\n    )\r\n    db.add(log_entry)\r\n    await db.flush()\r\n\r\n    # Recalculate risk score\r\n    result = await db.execute(\r\n        select(BehaviorLog)\r\n        .where(BehaviorLog.user_id == user.id)\r\n        .order_by(BehaviorLog.timestamp.desc())\r\n        .limit(50)\r\n    )\r\n    recent = result.scalars().all()\r\n    logs_data = [\r\n        {\r\n            \"permission_requested\": l.permission_requested,\r\n            \"network_activity_level\": l.network_activity_level,\r\n            \"background_process_flag\": l.background_process_flag,\r\n            \"anomaly_flag\": l.anomaly_flag,\r\n        }\r\n        for l in recent\r\n    ]\r\n\r\n    # Privacy Transparency: Log data access for AI calculation\r\n    db.add(DataAccessLog(\r\n        user_id=user.id, \r\n        data_type=\"Behavioral History\", \r\n        purpose=\"AI Risk Score Calculation and Deviation Check\"\r\n    ))\r\n\r\n    # Fetch User Baseline\r\n    bp_result = await db.execute(select(BehaviorProfile).where(BehaviorProfile.user_id == user.id))\r\n    profile = bp_result.scalar_one_or_none()\r\n    baseline = profile.baseline_metrics if profile else None\r\n\r\n    # Calculate Risk using personalized baseline logic\r\n    risk = calculate_risk(logs_data, baseline=baseline)\r\n\r\n    # Update risk score\r\n    rs_result = await db.execute(select(RiskScore).where(RiskScore.user_id == user.id))\r\n    risk_score = rs_result.scalar_one_or_none()\r\n    if risk_score:\r\n        risk_score.current_score = risk[\"score\"]\r\n        risk_score.risk_level = risk[\"level\"]\r\n        risk_score.last_updated = datetime.now(timezone.utc)\r\n    else:\r\n        risk_score = RiskScore(\r\n            user_id=user.id, current_score=risk[\"score\"], risk_level=risk[\"level\"]\r\n        )\r\n        db.add(risk_score)\r\n\r\n    # Alert if high risk\r\n    if risk[\"score\"] \u003e 70:\r\n        alert = Alert(\r\n            user_id=user.id,\r\n            alert_type=\"high_risk_behavior\",\r\n            severity=risk.get(\"severity\", \"high\"),\r\n            message=f\"Risk score {risk[\u0027score\u0027]}: suspicious activity from {req.app_name}\",\r\n            explanation_text=risk.get(\"explanation\", f\"High risk score detected from excessive permissions or background activity in {req.app_name}.\"),\r\n            recommendation=risk.get(\"recommendation\", \"Review the app\u0027s requested permissions and consider blocking or uninstalling it.\"),\r\n            confidence_score=0.95\r\n        )\r\n        db.add(alert)\r\n        await db.flush()\r\n\r\n        await manager.send_to_user(str(user.id), {\r\n            \"type\": \"alert\",\r\n            \"alert_id\": alert.id,\r\n            \"alert_type\": alert.alert_type,\r\n            \"severity\": alert.severity,\r\n            \"message\": alert.message,\r\n            \"recommendation\": alert.recommendation,\r\n            \"timestamp\": datetime.now(timezone.utc).isoformat(),\r\n            \"risk_score\": risk[\"score\"],\r\n        })\r\n\r\n    await db.commit()\r\n    await db.refresh(log_entry)\r\n    return log_entry\r\n\r\n\r\n@router.get(\"/risk-score\", response_model=RiskScoreResponse)\r\nasync def get_risk_score(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user),\r\n):\r\n    result = await db.execute(select(RiskScore).where(RiskScore.user_id == user.id))\r\n    risk_score = result.scalar_one_or_none()\r\n    if not risk_score:\r\n        return RiskScoreResponse(current_score=0.0, risk_level=\"low\", last_updated=None)\r\n    return risk_score\r\n\r\n\r\n@router.get(\"/alerts\", response_model=List[AlertResponse])\r\nasync def get_alerts(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user),\r\n):\r\n    result = await db.execute(\r\n        select(Alert)\r\n        .where(Alert.user_id == user.id)\r\n        .order_by(Alert.created_at.desc())\r\n        .limit(50)\r\n    )\r\n    return result.scalars().all()\r\n\r\n\r\n@router.get(\"/logs/recent\", response_model=List[LogResponse])\r\nasync def get_recent_logs(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(require_consent),\r\n):\r\n    result = await db.execute(\r\n        select(BehaviorLog)\r\n        .where(BehaviorLog.user_id == user.id)\r\n        .order_by(BehaviorLog.timestamp.desc())\r\n        .limit(30)\r\n    )\r\n    return result.scalars().all()\r\n","path":"backend/app/routers/logs_router.py"},{"content":"from fastapi import APIRouter, Depends, HTTPException\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select\r\nfrom typing import List\r\nfrom app.database import get_db\r\nfrom app.models import DataAccessLog, User, Alert\r\nfrom app.schemas import DataAccessLogResponse\r\nfrom app.deps import get_current_user\r\n\r\nrouter = APIRouter(prefix=\"/api/privacy\", tags=[\"privacy\"])\r\n\r\n@router.get(\"/data-access\", response_model=List[DataAccessLogResponse])\r\nasync def get_data_access_logs(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    # Retrieve the audit trail of what data the system accessed for this user\r\n    result = await db.execute(select(DataAccessLog).where(DataAccessLog.user_id == user.id).order_by(DataAccessLog.timestamp.desc()))\r\n    return result.scalars().all()\r\n\r\n@router.get(\"/explanation/{alert_id}\")\r\nasync def get_alert_explanation(\r\n    alert_id: int,\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    # Explainability Engine Endpoint: Explains an alert in natural language\r\n    result = await db.execute(select(Alert).where(Alert.id == alert_id, Alert.user_id == user.id))\r\n    alert = result.scalar_one_or_none()\r\n    \r\n    if not alert:\r\n        raise HTTPException(status_code=404, detail=\"Alert not found\")\r\n        \r\n    return {\r\n        \"alert_id\": alert.id,\r\n        \"explanation\": alert.explanation_text or \"No detailed explanation available for this alert.\",\r\n        \"recommendation\": alert.recommendation or \"Review the activity manually.\",\r\n        \"confidence_score\": alert.confidence_score\r\n    }\r\n","path":"backend/app/routers/privacy_router.py"},{"content":"from fastapi import APIRouter, Depends, HTTPException\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select\r\nfrom app.database import get_db\r\nfrom app.models import User, BehaviorProfile\r\nfrom app.schemas import BehaviorProfileResponse\r\nfrom app.deps import get_current_user\r\n\r\nrouter = APIRouter(prefix=\"/api/profile\", tags=[\"profile\"])\r\n\r\n@router.get(\"/baseline\", response_model=BehaviorProfileResponse)\r\nasync def get_baseline(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    result = await db.execute(select(BehaviorProfile).where(BehaviorProfile.user_id == user.id))\r\n    profile = result.scalar_one_or_none()\r\n    \r\n    if not profile:\r\n        # Return an empty/default profile if none exists yet\r\n        return {\"user_id\": user.id, \"baseline_metrics\": {}, \"last_updated\": user.created_at}\r\n        \r\n    return profile\r\n\r\n@router.get(\"/deviation\")\r\nasync def get_deviation(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    # This endpoint returns the user\u0027s current deviation from their baseline.\r\n    # In a real app we\u0027d calculate this on the fly or fetch from a recent cache.\r\n    result = await db.execute(select(BehaviorProfile).where(BehaviorProfile.user_id == user.id))\r\n    profile = result.scalar_one_or_none()\r\n    \r\n    if not profile or not profile.baseline_metrics:\r\n        return {\"deviation_score\": 0.0, \"status\": \"no_baseline\"}\r\n        \r\n    # Return a mocked deviation score for visualization\r\n    import random\r\n    score = random.uniform(0.0, 100.0)\r\n    return {\r\n        \"deviation_score\": round(score, 1), \r\n        \"status\": \"normal\" if score \u003c 70 else \"abnormal\"\r\n    }\r\n","path":"backend/app/routers/profiles_router.py"},{"content":"from fastapi import APIRouter, Depends, HTTPException\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select, func, case\r\nfrom app.database import get_db\r\nfrom app.models import User, Alert, BehaviorLog, RiskScore\r\nfrom app.schemas import (\r\n    BlockAppRequest, ResolveAlertRequest, AlertResponse,\r\n    WellbeingResponse, AppUsageItem, PermissionAuditResponse,\r\n    PermissionBreakdown, LeaderboardResponse, TrainingProgressResponse, TrainingModule,\r\n)\r\nfrom app.deps import get_current_user, require_consent\r\nimport random\r\n\r\nrouter = APIRouter(prefix=\"/api\", tags=[\"student\"])\r\n\r\n\r\n@router.post(\"/block-app\")\r\nasync def block_app(\r\n    req: BlockAppRequest,\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(require_consent),\r\n):\r\n    alert = Alert(\r\n        user_id=user.id,\r\n        alert_type=\"app_blocked\",\r\n        severity=\"medium\",\r\n        message=f\"App \u0027{req.app_name}\u0027 has been blocked by user\",\r\n        resolved=True,\r\n    )\r\n    db.add(alert)\r\n    await db.commit()\r\n    return {\"status\": \"success\", \"message\": f\"App \u0027{req.app_name}\u0027 blocked successfully\"}\r\n\r\n\r\n@router.post(\"/resolve-alert\", response_model=AlertResponse)\r\nasync def resolve_alert(\r\n    req: ResolveAlertRequest,\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user),\r\n):\r\n    result = await db.execute(\r\n        select(Alert).where(Alert.id == req.alert_id, Alert.user_id == user.id)\r\n    )\r\n    alert = result.scalar_one_or_none()\r\n    if not alert:\r\n        raise HTTPException(status_code=404, detail=\"Alert not found\")\r\n\r\n    alert.resolved = True\r\n    await db.commit()\r\n    await db.refresh(alert)\r\n    return alert\r\n\r\n\r\n# ──── Digital Wellbeing ────\r\n@router.get(\"/wellbeing\", response_model=WellbeingResponse)\r\nasync def get_wellbeing(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user),\r\n):\r\n    # Aggregate behaviour logs into wellbeing metrics\r\n    result = await db.execute(\r\n        select(\r\n            BehaviorLog.app_name,\r\n            func.count(BehaviorLog.id).label(\"sessions\"),\r\n            func.avg(BehaviorLog.network_activity_level).label(\"avg_net\"),\r\n        )\r\n        .where(BehaviorLog.user_id == user.id)\r\n        .group_by(BehaviorLog.app_name)\r\n        .order_by(func.count(BehaviorLog.id).desc())\r\n    )\r\n    rows = result.all()\r\n\r\n    total_sessions = sum(r.sessions for r in rows)\r\n    # Estimate minutes per session (simulated but derived from real data)\r\n    top_apps = [\r\n        AppUsageItem(\r\n            app_name=r.app_name,\r\n            usage_minutes=round(r.sessions * random.uniform(3, 12), 1),\r\n            sessions=r.sessions,\r\n        )\r\n        for r in rows[:8]\r\n    ]\r\n    total_minutes = sum(a.usage_minutes for a in top_apps)\r\n\r\n    # Focus score: lower anomaly ratio = higher focus\r\n    anomaly_result = await db.execute(\r\n        select(func.count(BehaviorLog.id)).where(\r\n            BehaviorLog.user_id == user.id, BehaviorLog.anomaly_flag == True\r\n        )\r\n    )\r\n    anomaly_count = anomaly_result.scalar() or 0\r\n    focus_score = max(20, 100 - int((anomaly_count / max(total_sessions, 1)) * 100))\r\n\r\n    # Daily trend from last 7 days (simulated from actual log counts)\r\n    daily_trend = []\r\n    for i in range(7):\r\n        day_label = f\"Day {7 - i}\"\r\n        daily_trend.append({\r\n            \"day\": day_label,\r\n            \"screen_time\": round(random.uniform(2, 6), 1),\r\n            \"focus\": max(30, focus_score + random.randint(-15, 10)),\r\n        })\r\n\r\n    return WellbeingResponse(\r\n        screen_time_hours=round(total_minutes / 60, 1),\r\n        focus_score=focus_score,\r\n        daily_sessions=total_sessions,\r\n        top_apps=top_apps,\r\n        daily_trend=daily_trend,\r\n    )\r\n\r\n\r\n# ──── Permission Audit ────\r\n@router.get(\"/permission-audit\", response_model=PermissionAuditResponse)\r\nasync def get_permission_audit(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user),\r\n):\r\n    result = await db.execute(\r\n        select(\r\n            BehaviorLog.permission_requested,\r\n            func.count(BehaviorLog.id).label(\"cnt\"),\r\n        )\r\n        .where(BehaviorLog.user_id == user.id, BehaviorLog.permission_requested != \"none\")\r\n        .group_by(BehaviorLog.permission_requested)\r\n        .order_by(func.count(BehaviorLog.id).desc())\r\n    )\r\n    rows = result.all()\r\n    total = sum(r.cnt for r in rows) or 1\r\n\r\n    breakdown = [\r\n        PermissionBreakdown(\r\n            permission=r.permission_requested,\r\n            count=r.cnt,\r\n            percentage=round((r.cnt / total) * 100, 1),\r\n        )\r\n        for r in rows\r\n    ]\r\n\r\n    # Risky apps = apps with high network + anomaly flags\r\n    risky_result = await db.execute(\r\n        select(BehaviorLog.app_name)\r\n        .where(\r\n            BehaviorLog.user_id == user.id,\r\n            BehaviorLog.anomaly_flag == True,\r\n            BehaviorLog.permission_requested != \"none\",\r\n        )\r\n        .distinct()\r\n    )\r\n    risky_apps = [r[0] for r in risky_result.all()]\r\n\r\n    return PermissionAuditResponse(\r\n        total_requests=total,\r\n        breakdown=breakdown,\r\n        risky_apps=risky_apps,\r\n    )\r\n\r\n\r\n# ──── Peer Leaderboard ────\r\n@router.get(\"/leaderboard\", response_model=LeaderboardResponse)\r\nasync def get_leaderboard(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user),\r\n):\r\n    # Get all student risk scores\r\n    result = await db.execute(\r\n        select(RiskScore.user_id, RiskScore.current_score)\r\n        .join(User, User.id == RiskScore.user_id)\r\n        .where(User.role == \"student\")\r\n        .order_by(RiskScore.current_score.asc())  # lower = better\r\n    )\r\n    all_scores = result.all()\r\n    total = len(all_scores)\r\n    scores_list = [s.current_score for s in all_scores]\r\n    campus_avg = sum(scores_list) / max(len(scores_list), 1)\r\n\r\n    # Find user rank (lower score = better rank)\r\n    user_score_result = await db.execute(\r\n        select(RiskScore.current_score).where(RiskScore.user_id == user.id)\r\n    )\r\n    user_score = user_score_result.scalar() or 50.0\r\n\r\n    rank = 1\r\n    for s in all_scores:\r\n        if s.user_id == user.id:\r\n            break\r\n        rank += 1\r\n\r\n    percentile = int(((total - rank) / max(total, 1)) * 100)\r\n\r\n    # Category breakdown (simulated from real log data)\r\n    user_anomaly_result = await db.execute(\r\n        select(func.count(BehaviorLog.id)).where(\r\n            BehaviorLog.user_id == user.id, BehaviorLog.anomaly_flag == True\r\n        )\r\n    )\r\n    user_anomalies = user_anomaly_result.scalar() or 0\r\n\r\n    user_categories = {\r\n        \"network\": max(10, 100 - int(user_score * 0.8) + random.randint(-5, 5)),\r\n        \"permissions\": max(10, 100 - int(user_anomalies * 2) + random.randint(-5, 5)),\r\n        \"apps\": max(10, 100 - int(user_score * 0.6) + random.randint(-5, 5)),\r\n        \"behavior\": max(10, 100 - int(user_score * 0.7) + random.randint(-5, 5)),\r\n    }\r\n    campus_categories = {\r\n        \"network\": max(20, int(100 - campus_avg * 0.8)),\r\n        \"permissions\": max(20, int(100 - campus_avg * 0.5)),\r\n        \"apps\": max(20, int(100 - campus_avg * 0.6)),\r\n        \"behavior\": max(20, int(100 - campus_avg * 0.7)),\r\n    }\r\n\r\n    return LeaderboardResponse(\r\n        rank=rank,\r\n        total_students=total,\r\n        percentile=percentile,\r\n        user_score=round(user_score, 1),\r\n        campus_average=round(campus_avg, 1),\r\n        categories=user_categories,\r\n        campus_categories=campus_categories,\r\n    )\r\n\r\n\r\n# ──── Training Progress ────\r\nTRAINING_MODULES = [\r\n    {\"id\": \"phishing\", \"title\": \"Phishing Detection\", \"description\": \"Learn to identify phishing emails, fake links, and social engineering attacks\", \"difficulty\": \"beginner\", \"duration_minutes\": 10},\r\n    {\"id\": \"passwords\", \"title\": \"Password Security\", \"description\": \"Best practices for creating and managing secure passwords\", \"difficulty\": \"beginner\", \"duration_minutes\": 8},\r\n    {\"id\": \"social_eng\", \"title\": \"Social Engineering\", \"description\": \"Understand manipulation tactics used by attackers\", \"difficulty\": \"intermediate\", \"duration_minutes\": 15},\r\n    {\"id\": \"wifi_safety\", \"title\": \"Public Wi-Fi Safety\", \"description\": \"Stay secure on public and shared networks\", \"difficulty\": \"beginner\", \"duration_minutes\": 8},\r\n    {\"id\": \"app_permissions\", \"title\": \"App Permissions\", \"description\": \"Understand what permissions apps request and why\", \"difficulty\": \"intermediate\", \"duration_minutes\": 12},\r\n    {\"id\": \"data_privacy\", \"title\": \"Data Privacy\", \"description\": \"Protect your personal data online and offline\", \"difficulty\": \"advanced\", \"duration_minutes\": 20},\r\n]\r\n\r\n@router.get(\"/training-progress\", response_model=TrainingProgressResponse)\r\nasync def get_training_progress(\r\n    user: User = Depends(get_current_user),\r\n):\r\n    # Simulate progress — in production this would be stored in DB\r\n    # Use deterministic seed from user id so it\u0027s consistent\r\n    seed = sum(ord(c) for c in user.id)\r\n    rng = random.Random(seed)\r\n\r\n    modules = []\r\n    completed = 0\r\n    total_score = 0\r\n    for m in TRAINING_MODULES:\r\n        is_completed = rng.random() \u003c 0.35\r\n        score = rng.randint(70, 100) if is_completed else None\r\n        if is_completed:\r\n            completed += 1\r\n            total_score += score\r\n        modules.append(TrainingModule(\r\n            id=m[\"id\"],\r\n            title=m[\"title\"],\r\n            description=m[\"description\"],\r\n            difficulty=m[\"difficulty\"],\r\n            duration_minutes=m[\"duration_minutes\"],\r\n            completed=is_completed,\r\n            score=score,\r\n        ))\r\n\r\n    return TrainingProgressResponse(\r\n        modules=modules,\r\n        completed_count=completed,\r\n        total_count=len(TRAINING_MODULES),\r\n        overall_score=total_score // max(completed, 1),\r\n    )\r\n","path":"backend/app/routers/student_router.py"},{"content":"","path":"backend/app/routers/__init__.py"},{"content":"import logging\r\nfrom typing import Optional, Dict, Any, List\r\n\r\nlogger = logging.getLogger(__name__)\r\n\r\n# Try to import scikit-learn; fall back to rule-based if unavailable\r\ntry:\r\n    import numpy as np\r\n    HAS_NUMPY = True\r\nexcept ImportError:\r\n    HAS_NUMPY = False\r\n\r\ntry:\r\n    from sklearn.ensemble import IsolationForest\r\n    HAS_SKLEARN = True\r\nexcept ImportError:\r\n    HAS_SKLEARN = False\r\n    logger.info(\"scikit-learn not available, using rule-based scoring only\")\r\n\r\n_model = None\r\n_is_fitted = False\r\n\r\n\r\ndef extract_features(logs: list[dict]) -\u003e list[list[float]]:\r\n    \"\"\"Extract features from a batch of behavior logs.\"\"\"\r\n    features = []\r\n    for log in logs:\r\n        features.append([\r\n            1.0 if log.get(\"permission_requested\", \"none\") != \"none\" else 0.0,\r\n            float(log.get(\"network_activity_level\", 0.0)),\r\n            1.0 if log.get(\"background_process_flag\", False) else 0.0,\r\n            1.0 if log.get(\"anomaly_flag\", False) else 0.0,\r\n        ])\r\n    return features\r\n\r\n\r\ndef compute_baseline(logs: list[dict]) -\u003e Dict[str, float]:\r\n    \"\"\"Compute an average baseline from historical logs for a user.\"\"\"\r\n    if not logs:\r\n        return {\"avg_permission_usage\": 0.0, \"avg_network_activity\": 0.0, \"avg_background_process_rate\": 0.0}\r\n\r\n    n = max(len(logs), 1)\r\n    perm_count = sum(1 for l in logs if l.get(\"permission_requested\", \"none\") != \"none\")\r\n    net_sum = sum(float(l.get(\"network_activity_level\", 0.0)) for l in logs)\r\n    bg_count = sum(1 for l in logs if l.get(\"background_process_flag\", False))\r\n\r\n    return {\r\n        \"avg_permission_usage\": perm_count / n,\r\n        \"avg_network_activity\": net_sum / n,\r\n        \"avg_background_process_rate\": bg_count / n\r\n    }\r\n\r\n\r\ndef calculate_risk_score_ml(logs: list[dict], baseline: Optional[Dict[str, float]] = None) -\u003e float:\r\n    \"\"\"Use Isolation Forest if available, adjusting via baseline deviation. Returns 0-100.\"\"\"\r\n    global _model, _is_fitted\r\n\r\n    if not HAS_SKLEARN or not HAS_NUMPY or len(logs) \u003c 5:\r\n        return calculate_risk_score_rules(logs, baseline)\r\n\r\n    import numpy as np\r\n    features = np.array(extract_features(logs))\r\n    if features.shape[0] == 0:\r\n        return 0.0\r\n\r\n    try:\r\n        if _model is None:\r\n            _model = IsolationForest(\r\n                n_estimators=100, contamination=0.15, random_state=42, n_jobs=-1\r\n            )\r\n\r\n        if not _is_fitted:\r\n            _model.fit(features)\r\n            _is_fitted = True\r\n\r\n        scores = _model.score_samples(features)\r\n        avg_score = float(np.mean(scores))\r\n        \r\n        # Base risk from Isolation Forest\r\n        risk = max(0, min(100, (0.5 - avg_score) * 100))\r\n        \r\n        # Adjust based on baseline deviation if available\r\n        if baseline:\r\n            # Simple Z-score like heuristic for demo purposes\r\n            recent_perm = sum(1 for l in logs if l.get(\"permission_requested\", \"none\") != \"none\") / len(logs)\r\n            recent_net = sum(float(l.get(\"network_activity_level\", 0.0)) for l in logs) / len(logs)\r\n            \r\n            perm_diff = max(0, recent_perm - baseline.get(\"avg_permission_usage\", 0.0))\r\n            net_diff = max(0, recent_net - baseline.get(\"avg_network_activity\", 0.0))\r\n            \r\n            # Add up to 20 points for deviation\r\n            deviation_penalty = (perm_diff * 10) + (net_diff / 10)\r\n            risk = min(100, risk + deviation_penalty)\r\n            \r\n        return round(risk, 1)\r\n    except Exception as e:\r\n        logger.warning(f\"ML scoring failed, falling back to rules: {e}\")\r\n        return calculate_risk_score_rules(logs, baseline)\r\n\r\n\r\ndef calculate_risk_score_rules(logs: list[dict], baseline: Optional[Dict[str, float]] = None) -\u003e float:\r\n    \"\"\"Rule-based risk scoring with optional baseline deviation penalty. Returns 0-100.\"\"\"\r\n    if not logs:\r\n        return 0.0\r\n\r\n    n = len(logs)\r\n\r\n    # Permission anomaly\r\n    perm_count = sum(1 for l in logs if l.get(\"permission_requested\", \"none\") != \"none\")\r\n    perm_score = min(100, (perm_count / max(n, 1)) * 100)\r\n\r\n    # Network anomaly\r\n    net_levels = [float(l.get(\"network_activity_level\", 0.0)) for l in logs]\r\n    net_avg = sum(net_levels) / len(net_levels) if net_levels else 0.0\r\n    net_score = min(100, net_avg)\r\n\r\n    # Background process anomaly\r\n    bg_count = sum(1 for l in logs if l.get(\"background_process_flag\", False))\r\n    bg_score = min(100, (bg_count / max(n, 1)) * 100)\r\n\r\n    # Suspicious domain / anomaly flag\r\n    anomaly_count = sum(1 for l in logs if l.get(\"anomaly_flag\", False))\r\n    domain_score = min(100, (anomaly_count / max(n, 1)) * 100)\r\n\r\n    # Weighted formula\r\n    risk = (\r\n        perm_score * 0.3 +\r\n        net_score * 0.3 +\r\n        bg_score * 0.2 +\r\n        domain_score * 0.2\r\n    )\r\n    \r\n    # Apply baseline penalty\r\n    if baseline:\r\n        recent_perm = perm_count / max(n, 1)\r\n        recent_net = net_avg\r\n        perm_diff = max(0, recent_perm - baseline.get(\"avg_permission_usage\", 0.0))\r\n        net_diff = max(0, recent_net - baseline.get(\"avg_network_activity\", 0.0))\r\n        deviation_penalty = (perm_diff * 10) + (net_diff / 5)\r\n        risk = min(100, risk + deviation_penalty)\r\n\r\n    return round(max(0, min(100, risk)), 1)\r\n\r\n\r\ndef get_risk_level(score: float) -\u003e str:\r\n    if score \u003c= 40:\r\n        return \"low\"\r\n    elif score \u003c= 70:\r\n        return \"medium\"\r\n    else:\r\n        return \"high\"\r\n\r\n\r\ndef generate_explanation(logs: list[dict], risk_score: float) -\u003e str:\r\n    \"\"\"Generate a natural language explanation for why the risk score is high.\"\"\"\r\n    if not logs:\r\n        return \"No recent activity logs available to explain.\"\r\n        \r\n    explanations = []\r\n    \r\n    n = len(logs)\r\n    perm_count = sum(1 for l in logs if l.get(\"permission_requested\", \"none\") != \"none\")\r\n    net_avg = sum(float(l.get(\"network_activity_level\", 0.0)) for l in logs) / n\r\n    bg_count = sum(1 for l in logs if l.get(\"background_process_flag\", False))\r\n    anomaly_count = sum(1 for l in logs if l.get(\"anomaly_flag\", False))\r\n    \r\n    if anomaly_count \u003e 0:\r\n        explanations.append(f\"Detected {anomaly_count} known suspicious activities or domains.\")\r\n    \r\n    if perm_count \u003e (n * 0.5):\r\n        explanations.append(\"Unusually high rate of sensitive permission requests.\")\r\n        \r\n    if net_avg \u003e 60:\r\n        explanations.append(f\"Heavy network utilization detected (avg {net_avg:.1f}%).\")\r\n        \r\n    if bg_count \u003e (n * 0.4):\r\n        explanations.append(\"Excessive background processes running stealthily.\")\r\n        \r\n    if not explanations:\r\n        if risk_score \u003e 70:\r\n            return \"Risk increased due to aggregate subtle deviations from baseline behavior.\"\r\n        return \"Activity appears normal.\"\r\n        \r\n    return \" \".join(explanations)\r\n\r\ndef generate_recommendation(severity: str) -\u003e str:\r\n    \"\"\"Generate actionable advice based on severity.\"\"\"\r\n    if severity == \"critical\":\r\n        return \"Immediate action required: Revoke network access for the compromised app, change passwords, and consider factory resetting the device if anomalous behavior persists.\"\r\n    elif severity == \"high\":\r\n        return \"Review the app\u0027s requested permissions immediately and consider uninstalling it. Run a malware scan.\"\r\n    else:\r\n        return \"Monitor the app\u0027s activity. Ensure it only has access to necessary permissions.\"\r\n\r\n\r\ndef calculate_risk(logs: list[dict], baseline: Optional[Dict[str, float]] = None) -\u003e dict:\r\n    \"\"\"Main entry point: calculate risk score, level, explanation, and recommendation.\"\"\"\r\n    try:\r\n        score = calculate_risk_score_ml(logs, baseline)\r\n    except Exception:\r\n        score = calculate_risk_score_rules(logs, baseline)\r\n\r\n    level = get_risk_level(score)\r\n    severity = \"critical\" if score \u003e= 85 else \"high\" if score \u003e 70 else level\r\n    \r\n    explanation = generate_explanation(logs, score)\r\n    recommendation = generate_recommendation(severity)\r\n    \r\n    return {\r\n        \"score\": score, \r\n        \"level\": level, \r\n        \"explanation\": explanation,\r\n        \"recommendation\": recommendation,\r\n        \"severity\": severity\r\n    }\r\n","path":"backend/app/ai_engine.py"},{"content":"from datetime import datetime, timedelta, timezone\r\nfrom passlib.context import CryptContext\r\nfrom jose import JWTError, jwt\r\nfrom app.config import get_settings\r\n\r\nsettings = get_settings()\r\npwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")\r\n\r\n\r\ndef hash_password(password: str) -\u003e str:\r\n    return pwd_context.hash(password)\r\n\r\n\r\ndef verify_password(plain: str, hashed: str) -\u003e bool:\r\n    return pwd_context.verify(plain, hashed)\r\n\r\n\r\ndef create_access_token(data: dict) -\u003e str:\r\n    to_encode = data.copy()\r\n    expire = datetime.now(timezone.utc) + timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)\r\n    to_encode.update({\"exp\": expire, \"type\": \"access\"})\r\n    return jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)\r\n\r\n\r\ndef create_refresh_token(data: dict) -\u003e str:\r\n    to_encode = data.copy()\r\n    expire = datetime.now(timezone.utc) + timedelta(days=settings.REFRESH_TOKEN_EXPIRE_DAYS)\r\n    to_encode.update({\"exp\": expire, \"type\": \"refresh\"})\r\n    return jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)\r\n\r\n\r\ndef decode_token(token: str) -\u003e dict | None:\r\n    try:\r\n        payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])\r\n        return payload\r\n    except JWTError:\r\n        return None\r\n","path":"backend/app/auth.py"},{"content":"from pydantic_settings import BaseSettings\r\nfrom functools import lru_cache\r\nimport os\r\n\r\n\r\nclass Settings(BaseSettings):\r\n    APP_NAME: str = \"SentinelAI\"\r\n    DEBUG: bool = False\r\n\r\n    # Database — defaults to SQLite for easy local dev\r\n    DATABASE_URL: str = \"sqlite+aiosqlite:///./sentinelai.db\"\r\n\r\n    # Redis\r\n    REDIS_URL: str = \"redis://localhost:6379/0\"\r\n    REDIS_ENABLED: bool = False\r\n\r\n    # JWT\r\n    SECRET_KEY: str = \"super-secret-change-in-production-abc123xyz\"\r\n    ALGORITHM: str = \"HS256\"\r\n    ACCESS_TOKEN_EXPIRE_MINUTES: int = 30\r\n    REFRESH_TOKEN_EXPIRE_DAYS: int = 7\r\n\r\n    # CORS\r\n    CORS_ORIGINS: str = \"http://localhost:3000,http://localhost:3001,http://localhost:80,http://localhost\"\r\n\r\n    # Simulator\r\n    SIMULATOR_ENABLED: bool = True\r\n    SIMULATOR_INTERVAL_SECONDS: int = 30\r\n\r\n    # Rate limiting\r\n    RATE_LIMIT: str = \"60/minute\"\r\n\r\n    class Config:\r\n        env_file = \".env\"\r\n        extra = \"ignore\"\r\n\r\n\r\n@lru_cache()\r\ndef get_settings() -\u003e Settings:\r\n    return Settings()\r\n","path":"backend/app/config.py"},{"content":"from sqlalchemy.ext.asyncio import create_async_engine, AsyncSession, async_sessionmaker\r\nfrom sqlalchemy.orm import DeclarativeBase\r\nfrom app.config import get_settings\r\n\r\nsettings = get_settings()\r\n\r\n# SQLite needs connect_args for async; PostgreSQL doesn\u0027t\r\nconnect_args = {}\r\nif settings.DATABASE_URL.startswith(\"sqlite\"):\r\n    connect_args = {\"check_same_thread\": False}\r\n\r\nengine = create_async_engine(\r\n    settings.DATABASE_URL,\r\n    echo=settings.DEBUG,\r\n    connect_args=connect_args,\r\n)\r\n\r\nasync_session = async_sessionmaker(engine, class_=AsyncSession, expire_on_commit=False)\r\n\r\n\r\nclass Base(DeclarativeBase):\r\n    pass\r\n\r\n\r\nasync def get_db():\r\n    async with async_session() as session:\r\n        try:\r\n            yield session\r\n        finally:\r\n            await session.close()\r\n\r\n\r\nasync def create_tables():\r\n    async with engine.begin() as conn:\r\n        await conn.run_sync(Base.metadata.create_all)\r\n","path":"backend/app/database.py"},{"content":"from fastapi import Depends, HTTPException, status\r\nfrom fastapi.security import HTTPBearer, HTTPAuthorizationCredentials\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select\r\nfrom app.database import get_db\r\nfrom app.auth import decode_token\r\nfrom app.models import User\r\nfrom typing import List\r\n\r\nsecurity = HTTPBearer()\r\n\r\nasync def get_current_user(\r\n    credentials: HTTPAuthorizationCredentials = Depends(security),\r\n    db: AsyncSession = Depends(get_db),\r\n) -\u003e User:\r\n    token = credentials.credentials\r\n    payload = decode_token(token)\r\n    if payload is None:\r\n        raise HTTPException(status_code=status.HTTP_401_UNAUTHORIZED, detail=\"Invalid or expired token\")\r\n\r\n    if payload.get(\"type\") != \"access\":\r\n        raise HTTPException(status_code=status.HTTP_401_UNAUTHORIZED, detail=\"Invalid token type\")\r\n\r\n    user_id = payload.get(\"sub\")\r\n    if user_id is None:\r\n        raise HTTPException(status_code=status.HTTP_401_UNAUTHORIZED, detail=\"Invalid token payload\")\r\n\r\n    result = await db.execute(select(User).where(User.id == user_id))\r\n    user = result.scalar_one_or_none()\r\n    if user is None:\r\n        raise HTTPException(status_code=status.HTTP_401_UNAUTHORIZED, detail=\"User not found\")\r\n\r\n    return user\r\n\r\ndef require_roles(allowed_roles: List[str]):\r\n    async def role_checker(user: User = Depends(get_current_user)) -\u003e User:\r\n        if user.role not in allowed_roles:\r\n            raise HTTPException(\r\n                status_code=status.HTTP_403_FORBIDDEN, \r\n                detail=f\"Operation not permitted. Requires one of: {\u0027, \u0027.join(allowed_roles)}\"\r\n            )\r\n        return user\r\n    return role_checker\r\n\r\nasync def require_admin(user: User = Depends(get_current_user)) -\u003e User:\r\n    if user.role != \"admin\":\r\n        raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail=\"Admin access required\")\r\n    return user\r\n\r\nasync def require_consent(user: User = Depends(get_current_user)) -\u003e User:\r\n    if not user.consent_given:\r\n        raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail=\"Consent required before accessing this resource\")\r\n    return user\r\n","path":"backend/app/deps.py"},{"content":"import asyncio\r\nimport logging\r\nimport traceback\r\nfrom contextlib import asynccontextmanager\r\nfrom fastapi import FastAPI, WebSocket, WebSocketDisconnect, Request\r\nfrom fastapi.responses import JSONResponse\r\nfrom fastapi.middleware.cors import CORSMiddleware\r\nfrom slowapi import Limiter, _rate_limit_exceeded_handler\r\nfrom slowapi.util import get_remote_address\r\nfrom slowapi.errors import RateLimitExceeded\r\n\r\nfrom app.config import get_settings\r\nfrom app.database import create_tables\r\nfrom app.websocket_manager import manager\r\nfrom app.routers import (\r\n    auth_router, logs_router, student_router, admin_router,\r\n    devices_router, profiles_router, incidents_router, privacy_router,\r\n    escalate_router, anomalies_router\r\n)\r\nsettings = get_settings()\r\nlogging.basicConfig(level=logging.INFO)\r\nlogger = logging.getLogger(__name__)\r\n\r\nlimiter = Limiter(key_func=get_remote_address, default_limits=[settings.RATE_LIMIT])\r\n\r\nsimulator_task = None\r\n\r\n\r\n@asynccontextmanager\r\nasync def lifespan(app: FastAPI):\r\n    global simulator_task\r\n    logger.info(\"SentinelAI starting up...\")\r\n    await create_tables()\r\n    logger.info(\"Database tables created\")\r\n\r\n    # Start device simulator\r\n    if settings.SIMULATOR_ENABLED:\r\n        from app.simulator import run_simulator\r\n        simulator_task = asyncio.create_task(\r\n            run_simulator(settings.SIMULATOR_INTERVAL_SECONDS)\r\n        )\r\n        logger.info(\"Device simulator started\")\r\n\r\n    yield\r\n\r\n    # Shutdown\r\n    if simulator_task:\r\n        simulator_task.cancel()\r\n        try:\r\n            await simulator_task\r\n        except asyncio.CancelledError:\r\n            pass\r\n    logger.info(\"SentinelAI shutdown complete\")\r\n\r\n\r\napp = FastAPI(\r\n    title=\"SentinelAI API\",\r\n    description=\"AI-Based Real-Time Behavioral Cybersecurity Platform\",\r\n    version=\"1.0.0\",\r\n    lifespan=lifespan,\r\n)\r\n\r\n# Rate limiting\r\napp.state.limiter = limiter\r\napp.add_exception_handler(RateLimitExceeded, _rate_limit_exceeded_handler)\r\n\r\n\r\n@app.exception_handler(Exception)\r\nasync def global_exception_handler(request: Request, exc: Exception):\r\n    logger.error(f\"Unhandled exception on {request.method} {request.url}: {exc}\")\r\n    logger.error(traceback.format_exc())\r\n    return JSONResponse(status_code=500, content={\"detail\": str(exc)})\r\n\r\n# CORS\r\napp.add_middleware(\r\n    CORSMiddleware,\r\n    allow_origins=settings.CORS_ORIGINS.split(\",\"),\r\n    allow_credentials=True,\r\n    allow_methods=[\"*\"],\r\n    allow_headers=[\"*\"],\r\n)\r\n\r\n# Mount routers\r\napp.include_router(auth_router.router)\r\napp.include_router(logs_router.router)\r\napp.include_router(student_router.router)\r\napp.include_router(admin_router.router)\r\napp.include_router(devices_router.router)\r\napp.include_router(profiles_router.router)\r\napp.include_router(incidents_router.router)\r\napp.include_router(privacy_router.router)\r\napp.include_router(escalate_router.router)\r\napp.include_router(anomalies_router.router)\r\n\r\n\r\n@app.get(\"/api/health\")\r\nasync def health():\r\n    return {\r\n        \"status\": \"healthy\",\r\n        \"app\": settings.APP_NAME,\r\n        \"websocket_connections\": manager.connected_count,\r\n    }\r\n\r\n\r\n@app.websocket(\"/ws/{user_id}\")\r\nasync def websocket_endpoint(websocket: WebSocket, user_id: str):\r\n    await manager.connect(websocket, user_id)\r\n    try:\r\n        while True:\r\n            data = await websocket.receive_text()\r\n            # Keep-alive / echo\r\n            if data == \"ping\":\r\n                await websocket.send_text(\"pong\")\r\n    except WebSocketDisconnect:\r\n        manager.disconnect(websocket, user_id)\r\n    except Exception:\r\n        manager.disconnect(websocket, user_id)\r\n","path":"backend/app/main.py"},{"content":"import uuid\r\nfrom datetime import datetime\r\nfrom sqlalchemy import (\r\n    Column, String, Boolean, Float, DateTime, ForeignKey, Text, Integer, JSON\r\n)\r\nfrom sqlalchemy.orm import relationship\r\nfrom app.database import Base\r\n\r\n\r\nclass User(Base):\r\n    __tablename__ = \"users\"\r\n\r\n    id = Column(String(36), primary_key=True, default=lambda: str(uuid.uuid4()))\r\n    name = Column(String(100), nullable=False)\r\n    email = Column(String(255), unique=True, nullable=False, index=True)\r\n    college = Column(String(255), nullable=False)\r\n    role = Column(String(20), default=\"student\", nullable=False)\r\n    hashed_password = Column(String(255), nullable=False)\r\n    consent_given = Column(Boolean, default=False)\r\n    created_at = Column(DateTime, default=datetime.utcnow)\r\n\r\n    risk_scores = relationship(\"RiskScore\", back_populates=\"user\", cascade=\"all, delete-orphan\")\r\n    alerts = relationship(\"Alert\", back_populates=\"user\", cascade=\"all, delete-orphan\")\r\n    behavior_logs = relationship(\"BehaviorLog\", back_populates=\"user\", cascade=\"all, delete-orphan\")\r\n    devices = relationship(\"Device\", back_populates=\"user\", cascade=\"all, delete-orphan\")\r\n    profile = relationship(\"BehaviorProfile\", back_populates=\"user\", uselist=False, cascade=\"all, delete-orphan\")\r\n    incidents = relationship(\"Incident\", back_populates=\"user\", cascade=\"all, delete-orphan\")\r\n    data_access_logs = relationship(\"DataAccessLog\", back_populates=\"user\", cascade=\"all, delete-orphan\")\r\n\r\n\r\nclass Device(Base):\r\n    __tablename__ = \"devices\"\r\n    id = Column(String(36), primary_key=True, default=lambda: str(uuid.uuid4()))\r\n    user_id = Column(String(36), ForeignKey(\"users.id\", ondelete=\"CASCADE\"), nullable=False, index=True)\r\n    device_name = Column(String(255), nullable=False)\r\n    device_type = Column(String(100), nullable=False)\r\n    last_active = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\r\n    risk_score = Column(Float, default=0.0)\r\n    \r\n    user = relationship(\"User\", back_populates=\"devices\")\r\n    behavior_logs = relationship(\"BehaviorLog\", back_populates=\"device\", cascade=\"all, delete-orphan\")\r\n\r\n\r\nclass BehaviorProfile(Base):\r\n    __tablename__ = \"behavior_profiles\"\r\n    user_id = Column(String(36), ForeignKey(\"users.id\", ondelete=\"CASCADE\"), primary_key=True)\r\n    baseline_metrics = Column(JSON, default={})\r\n    last_updated = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\r\n\r\n    user = relationship(\"User\", back_populates=\"profile\")\r\n\r\n\r\nclass RiskScore(Base):\r\n    __tablename__ = \"risk_scores\"\r\n\r\n    id = Column(Integer, primary_key=True, autoincrement=True)\r\n    user_id = Column(String(36), ForeignKey(\"users.id\", ondelete=\"CASCADE\"), nullable=False, index=True)\r\n    current_score = Column(Float, default=0.0)\r\n    risk_level = Column(String(20), default=\"low\")\r\n    last_updated = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\r\n\r\n    user = relationship(\"User\", back_populates=\"risk_scores\")\r\n\r\n\r\nclass Alert(Base):\r\n    __tablename__ = \"alerts\"\r\n\r\n    id = Column(Integer, primary_key=True, autoincrement=True)\r\n    user_id = Column(String(36), ForeignKey(\"users.id\", ondelete=\"CASCADE\"), nullable=False, index=True)\r\n    alert_type = Column(String(100), nullable=False)\r\n    severity = Column(String(20), nullable=False)\r\n    message = Column(Text, nullable=False)\r\n    explanation_text = Column(Text, nullable=True)\r\n    recommendation = Column(Text, nullable=True)\r\n    confidence_score = Column(Float, default=1.0)\r\n    created_at = Column(DateTime, default=datetime.utcnow)\r\n    resolved = Column(Boolean, default=False)\r\n\r\n    user = relationship(\"User\", back_populates=\"alerts\")\r\n    incidents = relationship(\"Incident\", back_populates=\"alert\", cascade=\"all, delete-orphan\")\r\n\r\n\r\nclass Incident(Base):\r\n    __tablename__ = \"incidents\"\r\n    id = Column(Integer, primary_key=True, autoincrement=True)\r\n    alert_id = Column(Integer, ForeignKey(\"alerts.id\", ondelete=\"CASCADE\"), nullable=False, index=True)\r\n    user_id = Column(String(36), ForeignKey(\"users.id\", ondelete=\"CASCADE\"), nullable=False, index=True)\r\n    report_type = Column(String(100), nullable=False) # e.g., \"false_positive\"\r\n    description = Column(Text, nullable=True)\r\n    status = Column(String(50), default=\"open\") # open, reviewed, resolved\r\n    created_at = Column(DateTime, default=datetime.utcnow)\r\n    \r\n    alert = relationship(\"Alert\", back_populates=\"incidents\")\r\n    user = relationship(\"User\", back_populates=\"incidents\")\r\n\r\n\r\nclass DataAccessLog(Base):\r\n    __tablename__ = \"data_access_logs\"\r\n    id = Column(Integer, primary_key=True, autoincrement=True)\r\n    user_id = Column(String(36), ForeignKey(\"users.id\", ondelete=\"CASCADE\"), nullable=False, index=True)\r\n    data_type = Column(String(100), nullable=False)\r\n    purpose = Column(String(255), nullable=False)\r\n    timestamp = Column(DateTime, default=datetime.utcnow)\r\n    \r\n    user = relationship(\"User\", back_populates=\"data_access_logs\")\r\n\r\n\r\nclass IntegrationConfig(Base):\r\n    __tablename__ = \"integration_configs\"\r\n    id = Column(Integer, primary_key=True, autoincrement=True)\r\n    integration_type = Column(String(100), nullable=False) # e.g. \"webhook\", \"email\"\r\n    endpoint = Column(String(255), nullable=False)\r\n    status = Column(String(50), default=\"active\") # active, inactive\r\n\r\n\r\nclass BehaviorLog(Base):\r\n    __tablename__ = \"behavior_logs\"\r\n\r\n    id = Column(Integer, primary_key=True, autoincrement=True)\r\n    user_id = Column(String(36), ForeignKey(\"users.id\", ondelete=\"CASCADE\"), nullable=False, index=True)\r\n    device_id = Column(String(36), ForeignKey(\"devices.id\", ondelete=\"CASCADE\"), nullable=True, index=True)\r\n    timestamp = Column(DateTime, default=datetime.utcnow)\r\n    app_name = Column(String(255))\r\n    permission_requested = Column(String(255))\r\n    network_activity_level = Column(Float, default=0.0)\r\n    background_process_flag = Column(Boolean, default=False)\r\n    anomaly_flag = Column(Boolean, default=False)\r\n    anomaly_type = Column(String(100), nullable=True)\r\n    severity = Column(String(20), nullable=True)\r\n    anomaly_score = Column(Float, nullable=True)\r\n    log_data = Column(JSON, default={})\r\n    \r\n    user = relationship(\"User\", back_populates=\"behavior_logs\")\r\n    device = relationship(\"Device\", back_populates=\"behavior_logs\")\r\n","path":"backend/app/models.py"},{"content":"from pydantic import BaseModel, EmailStr, Field\r\nfrom typing import Optional, List, Dict, Any\r\nfrom datetime import datetime\r\nfrom enum import Enum\r\n\r\n\r\n# ──── Enums ────\r\nclass RoleEnum(str, Enum):\r\n    student = \"student\"\r\n    parent = \"parent\"\r\n    admin = \"admin\"\r\n\r\nclass RiskLevelEnum(str, Enum):\r\n    low = \"low\"\r\n    medium = \"medium\"\r\n    high = \"high\"\r\n\r\nclass ReportTypeEnum(str, Enum):\r\n    false_positive = \"false_positive\"\r\n    other = \"other\"\r\n\r\n\r\n# ──── Auth Schemas ────\r\nclass RegisterRequest(BaseModel):\r\n    name: str = Field(..., min_length=2, max_length=100)\r\n    email: EmailStr\r\n    college: str = Field(..., min_length=2, max_length=255)\r\n    password: str = Field(..., min_length=6, max_length=128)\r\n    role: RoleEnum = RoleEnum.student\r\n\r\n\r\nclass LoginRequest(BaseModel):\r\n    email: EmailStr\r\n    password: str\r\n\r\n\r\nclass UserResponse(BaseModel):\r\n    id: str\r\n    name: str\r\n    email: str\r\n    college: str\r\n    role: str\r\n    consent_given: bool\r\n    created_at: datetime\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n\r\nclass TokenResponse(BaseModel):\r\n    access_token: str\r\n    refresh_token: str\r\n    token_type: str = \"bearer\"\r\n    user: UserResponse\r\n\r\n\r\n# ──── Consent ────\r\nclass ConsentRequest(BaseModel):\r\n    accept_terms: bool\r\n    enable_monitoring: bool\r\n\r\n\r\n# ──── Devices ────\r\nclass RegisterDeviceRequest(BaseModel):\r\n    device_name: str = Field(..., max_length=255)\r\n    device_type: str = Field(..., max_length=100)\r\n\r\nclass DeviceResponse(BaseModel):\r\n    id: str\r\n    user_id: str\r\n    device_name: str\r\n    device_type: str\r\n    last_active: datetime\r\n    risk_score: float\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n\r\n# ──── Behavior Profiles ────\r\nclass BehaviorProfileResponse(BaseModel):\r\n    user_id: str\r\n    baseline_metrics: Dict[str, Any]\r\n    last_updated: datetime\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n\r\n# ──── Behavior Logs ────\r\nclass LogIngestRequest(BaseModel):\r\n    app_name: str = Field(..., max_length=255)\r\n    device_id: Optional[str] = None\r\n    permission_requested: str = Field(default=\"none\", max_length=255)\r\n    network_activity_level: float = Field(default=0.0, ge=0.0, le=100.0)\r\n    background_process_flag: bool = False\r\n    anomaly_flag: bool = False\r\n    extra_data: Optional[dict] = None\r\n\r\n\r\nclass LogResponse(BaseModel):\r\n    id: int\r\n    user_id: str\r\n    device_id: Optional[str]\r\n    timestamp: datetime\r\n    app_name: str\r\n    permission_requested: Optional[str]\r\n    network_activity_level: float\r\n    background_process_flag: bool\r\n    anomaly_flag: bool\r\n    anomaly_type: Optional[str]\r\n    severity: Optional[str]\r\n    anomaly_score: Optional[float]\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n\r\n# ──── Risk Score ────\r\nclass RiskScoreResponse(BaseModel):\r\n    current_score: float\r\n    risk_level: str\r\n    last_updated: Optional[datetime]\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n\r\n# ──── Alerts ────\r\nclass AlertResponse(BaseModel):\r\n    id: int\r\n    user_id: str\r\n    alert_type: str\r\n    severity: str\r\n    message: str\r\n    explanation_text: Optional[str]\r\n    recommendation: Optional[str]\r\n    confidence_score: float\r\n    created_at: datetime\r\n    resolved: bool\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n\r\nclass ResolveAlertRequest(BaseModel):\r\n    alert_id: int\r\n\r\n\r\nclass BlockAppRequest(BaseModel):\r\n    app_name: str\r\n\r\n\r\n# ──── Incidents ────\r\nclass ReportIncidentRequest(BaseModel):\r\n    alert_id: int\r\n    report_type: ReportTypeEnum = ReportTypeEnum.false_positive\r\n    description: Optional[str] = None\r\n\r\nclass IncidentResponse(BaseModel):\r\n    id: int\r\n    alert_id: int\r\n    user_id: str\r\n    report_type: str\r\n    description: Optional[str]\r\n    status: str\r\n    created_at: datetime\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n\r\n# ──── Privacy (DataAccessLogs) ────\r\nclass DataAccessLogResponse(BaseModel):\r\n    id: int\r\n    user_id: str\r\n    data_type: str\r\n    purpose: str\r\n    timestamp: datetime\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n\r\n# ──── Admin ────\r\nclass AdminStatsResponse(BaseModel):\r\n    total_users: int\r\n    total_students: int\r\n    total_admins: int\r\n    high_risk_count: int\r\n    medium_risk_count: int\r\n    low_risk_count: int\r\n    total_alerts: int\r\n    unresolved_alerts: int\r\n    risk_distribution: dict\r\n\r\n\r\nclass HighRiskUserResponse(BaseModel):\r\n    id: str\r\n    name: str\r\n    email: str\r\n    college: str\r\n    current_score: float\r\n    risk_level: str\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n# ──── Integration ────\r\nclass EscalateRequest(BaseModel):\r\n    user_id: str\r\n    reason: str\r\n\r\n# ──── Analytics ────\r\nclass TimelinePoint(BaseModel):\r\n    timestamp: str\r\n    risk_score: float\r\n\r\nclass HeatmapPoint(BaseModel):\r\n    hour: int\r\n    frequency: int\r\n\r\n\r\n# ──── WebSocket ────\r\nclass WSAlertMessage(BaseModel):\r\n    type: str = \"alert\"\r\n    alert_id: int\r\n    alert_type: str\r\n    severity: str\r\n    message: str\r\n    recommendation: Optional[str]\r\n    timestamp: str\r\n\r\n\r\n# ──── Wellbeing ────\r\nclass AppUsageItem(BaseModel):\r\n    app_name: str\r\n    usage_minutes: float\r\n    sessions: int\r\n\r\nclass WellbeingResponse(BaseModel):\r\n    screen_time_hours: float\r\n    focus_score: int\r\n    daily_sessions: int\r\n    top_apps: list[AppUsageItem]\r\n    daily_trend: list[dict]\r\n\r\n\r\n# ──── Permission Audit ────\r\nclass PermissionBreakdown(BaseModel):\r\n    permission: str\r\n    count: int\r\n    percentage: float\r\n\r\nclass PermissionAuditResponse(BaseModel):\r\n    total_requests: int\r\n    breakdown: list[PermissionBreakdown]\r\n    risky_apps: list[str]\r\n\r\n\r\n# ──── Leaderboard ────\r\nclass LeaderboardResponse(BaseModel):\r\n    rank: int\r\n    total_students: int\r\n    percentile: int\r\n    user_score: float\r\n    campus_average: float\r\n    categories: dict  # { \"network\": x, \"permissions\": x, \"apps\": x, \"behavior\": x }\r\n    campus_categories: dict\r\n\r\n\r\n# ──── Training ────\r\nclass TrainingModule(BaseModel):\r\n    id: str\r\n    title: str\r\n    description: str\r\n    difficulty: str\r\n    duration_minutes: int\r\n    completed: bool\r\n    score: Optional[int] = None\r\n\r\nclass TrainingProgressResponse(BaseModel):\r\n    modules: list[TrainingModule]\r\n    completed_count: int\r\n    total_count: int\r\n    overall_score: int\r\n\r\n\r\n# ──── Admin: Activity Feed ────\r\nclass ActivityFeedItem(BaseModel):\r\n    id: int\r\n    student_name: str\r\n    student_email: str\r\n    alert_type: str\r\n    severity: str\r\n    message: str\r\n    created_at: datetime\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n\r\n# ──── Admin: Trends ────\r\nclass TrendPoint(BaseModel):\r\n    date: str\r\n    avg_risk_score: float\r\n    alert_count: int\r\n    anomaly_count: int\r\n\r\n\r\n# ──── Admin: College Breakdown ────\r\nclass CollegeBreakdownItem(BaseModel):\r\n    college: str\r\n    total_students: int\r\n    high_risk: int\r\n    medium_risk: int\r\n    low_risk: int\r\n    avg_score: float\r\n\r\n\r\n# ──── Admin: All Users ────\r\nclass UserListItem(BaseModel):\r\n    id: str\r\n    name: str\r\n    email: str\r\n    college: str\r\n    role: str\r\n    consent_given: bool\r\n    risk_score: Optional[float] = None\r\n    risk_level: Optional[str] = None\r\n    alert_count: int = 0\r\n    created_at: datetime\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n","path":"backend/app/schemas.py"},{"content":"\"\"\"Seed data script: creates demo admin + student users with sample data.\"\"\"\r\nimport asyncio\r\nfrom datetime import datetime, timezone, timedelta\r\nimport random\r\nfrom app.database import engine, async_session, Base\r\nfrom app.models import User, RiskScore, Alert, BehaviorLog\r\nfrom app.auth import hash_password\r\n\r\n\r\nasync def seed():\r\n    async with engine.begin() as conn:\r\n        await conn.run_sync(Base.metadata.create_all)\r\n\r\n    async with async_session() as db:\r\n        from sqlalchemy import select, func\r\n        count = await db.execute(select(func.count(User.id)))\r\n        if (count.scalar() or 0) \u003e 0:\r\n            print(\"Database already has data. Skipping seed.\")\r\n            return\r\n\r\n        # Create admin\r\n        admin = User(\r\n            name=\"Admin User\",\r\n            email=\"admin@sentinelai.com\",\r\n            college=\"SentinelAI HQ\",\r\n            role=\"admin\",\r\n            hashed_password=hash_password(\"admin123\"),\r\n            consent_given=True,\r\n        )\r\n        db.add(admin)\r\n\r\n        # Create demo students\r\n        students = []\r\n        for i in range(5):\r\n            student = User(\r\n                name=f\"Student {i+1}\",\r\n                email=f\"student{i+1}@university.edu\",\r\n                college=\"Demo University\",\r\n                role=\"student\",\r\n                hashed_password=hash_password(\"student123\"),\r\n                consent_given=True,\r\n            )\r\n            db.add(student)\r\n            students.append(student)\r\n\r\n        await db.flush()\r\n\r\n        apps = [\"WhatsApp\", \"Instagram\", \"Chrome\", \"TikTok\", \"YouTube\",\r\n                \"SuspiciousVPN\", \"UnknownAPK\", \"CryptoMiner\"]\r\n\r\n        for student in students:\r\n            score = round(random.uniform(10, 90), 1)\r\n            level = \"low\" if score \u003c= 40 else (\"medium\" if score \u003c= 70 else \"high\")\r\n            rs = RiskScore(user_id=student.id, current_score=score, risk_level=level)\r\n            db.add(rs)\r\n\r\n            for j in range(20):\r\n                is_anomaly = random.random() \u003c 0.25\r\n                log = BehaviorLog(\r\n                    user_id=student.id,\r\n                    timestamp=datetime.now(timezone.utc) - timedelta(hours=random.randint(0, 48)),\r\n                    app_name=random.choice(apps),\r\n                    permission_requested=random.choice([\"none\", \"camera\", \"location\", \"storage\"]),\r\n                    network_activity_level=round(random.uniform(50, 95) if is_anomaly else random.uniform(5, 35), 1),\r\n                    background_process_flag=is_anomaly,\r\n                    anomaly_flag=is_anomaly,\r\n                )\r\n                db.add(log)\r\n\r\n            if score \u003e 70:\r\n                for k in range(3):\r\n                    alert = Alert(\r\n                        user_id=student.id,\r\n                        alert_type=\"high_risk_behavior\",\r\n                        severity=random.choice([\"high\", \"critical\"]),\r\n                        message=\"Suspicious activity detected: elevated network usage and background processes\",\r\n                        created_at=datetime.now(timezone.utc) - timedelta(hours=random.randint(0, 24)),\r\n                        resolved=random.choice([True, False]),\r\n                    )\r\n                    db.add(alert)\r\n\r\n        db.add(RiskScore(user_id=admin.id, current_score=0.0, risk_level=\"low\"))\r\n\r\n        await db.commit()\r\n        print(\"Seed data created successfully!\")\r\n        print(\"  Admin: admin@sentinelai.com / admin123\")\r\n        print(\"  Students: student1@university.edu ... student5@university.edu / student123\")\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    asyncio.run(seed())\r\n","path":"backend/app/seed.py"},{"content":"import random\r\nimport asyncio\r\nimport logging\r\nfrom datetime import datetime, timezone\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom app.database import async_session\r\nfrom app.models import User, BehaviorLog, RiskScore, Alert, Device, BehaviorProfile, DataAccessLog\r\nfrom app.ai_engine import calculate_risk\r\nfrom app.websocket_manager import manager\r\nfrom sqlalchemy import select\r\n\r\nlogger = logging.getLogger(__name__)\r\n\r\nAPPS = [\r\n    \"WhatsApp\", \"Instagram\", \"Chrome\", \"TikTok\", \"Snapchat\",\r\n    \"YouTube\", \"Telegram\", \"Facebook\", \"Calculator\", \"Camera\",\r\n    \"Files\", \"Settings\", \"Maps\", \"Gmail\", \"Slack\",\r\n    \"SuspiciousVPN\", \"UnknownAPK\", \"CryptoMiner\", \"KeyLogger\",\r\n]\r\n\r\nPERMISSIONS = [\r\n    \"none\", \"camera\", \"microphone\", \"location\", \"contacts\",\r\n    \"storage\", \"sms\", \"phone\", \"accessibility\", \"overlay\",\r\n]\r\n\r\nSUSPICIOUS_APPS = {\"SuspiciousVPN\", \"UnknownAPK\", \"CryptoMiner\", \"KeyLogger\"}\r\n\r\n\r\ndef generate_log(anomaly_chance: float = 0.2) -\u003e dict:\r\n    is_anomaly = random.random() \u003c anomaly_chance\r\n    app = random.choice(list(SUSPICIOUS_APPS)) if is_anomaly else random.choice(APPS[:15])\r\n\r\n    return {\r\n        \"app_name\": app,\r\n        \"permission_requested\": random.choice(PERMISSIONS[1:]) if is_anomaly or random.random() \u003c 0.3 else \"none\",\r\n        \"network_activity_level\": round(random.uniform(60, 100), 1) if is_anomaly else round(random.uniform(0, 40), 1),\r\n        \"background_process_flag\": is_anomaly or random.random() \u003c 0.1,\r\n        \"anomaly_flag\": is_anomaly,\r\n    }\r\n\r\n\r\nasync def simulate_for_device(db: AsyncSession, user_id: str, device_id: str, anomaly_chance: float = 0.2):\r\n    log_data = generate_log(anomaly_chance)\r\n\r\n    log_entry = BehaviorLog(\r\n        user_id=user_id,\r\n        device_id=device_id,\r\n        app_name=log_data[\"app_name\"],\r\n        permission_requested=log_data[\"permission_requested\"],\r\n        network_activity_level=log_data[\"network_activity_level\"],\r\n        background_process_flag=log_data[\"background_process_flag\"],\r\n        anomaly_flag=log_data[\"anomaly_flag\"],\r\n        log_data=log_data,\r\n    )\r\n    db.add(log_entry)\r\n    await db.flush()\r\n\r\n    # Privacy Transparency: Log data access for simulator AI check\r\n    db.add(DataAccessLog(\r\n        user_id=user_id, \r\n        data_type=\"Device Telemetry\", \r\n        purpose=\"Automated Background Anomaly Detection\"\r\n    ))\r\n\r\n    # Fetch User Baseline\r\n    bp_result = await db.execute(select(BehaviorProfile).where(BehaviorProfile.user_id == user_id))\r\n    profile = bp_result.scalar_one_or_none()\r\n    baseline = profile.baseline_metrics if profile else None\r\n\r\n    # Get recent logs\r\n    result = await db.execute(\r\n        select(BehaviorLog)\r\n        .where(BehaviorLog.user_id == user_id)\r\n        .order_by(BehaviorLog.timestamp.desc())\r\n        .limit(50)\r\n    )\r\n    recent_logs = result.scalars().all()\r\n    logs_dicts = [\r\n        {\r\n            \"permission_requested\": l.permission_requested,\r\n            \"network_activity_level\": l.network_activity_level,\r\n            \"background_process_flag\": l.background_process_flag,\r\n            \"anomaly_flag\": l.anomaly_flag,\r\n        }\r\n        for l in recent_logs\r\n    ]\r\n\r\n    risk = calculate_risk(logs_dicts, baseline=baseline)\r\n    score = risk[\"score\"]\r\n    level = risk[\"level\"]\r\n    explanation = risk.get(\"explanation\", \"\")\r\n    recommendation = risk.get(\"recommendation\", \"\")\r\n    severity = risk.get(\"severity\", \"high\")\r\n\r\n    rs_result = await db.execute(\r\n        select(RiskScore).where(RiskScore.user_id == user_id)\r\n    )\r\n    risk_score = rs_result.scalar_one_or_none()\r\n    if risk_score:\r\n        risk_score.current_score = score\r\n        risk_score.risk_level = level\r\n        risk_score.last_updated = datetime.now(timezone.utc)\r\n    else:\r\n        risk_score = RiskScore(user_id=user_id, current_score=score, risk_level=level)\r\n        db.add(risk_score)\r\n\r\n    if score \u003e 70:\r\n        alert = Alert(\r\n            user_id=user_id,\r\n            alert_type=\"high_risk_behavior\",\r\n            severity=severity,\r\n            message=f\"Risk score {score}: suspicious activity from {log_data[\u0027app_name\u0027]}\",\r\n            explanation_text=explanation or f\"Anomalous app behavior in {log_data[\u0027app_name\u0027]}\",\r\n            recommendation=recommendation or \"Review device activity.\",\r\n            confidence_score=0.9\r\n        )\r\n        db.add(alert)\r\n        await db.flush()\r\n\r\n        await manager.send_to_user(str(user_id), {\r\n            \"type\": \"alert\",\r\n            \"alert_id\": alert.id,\r\n            \"alert_type\": alert.alert_type,\r\n            \"severity\": alert.severity,\r\n            \"message\": alert.message,\r\n            \"recommendation\": alert.recommendation,\r\n            \"timestamp\": datetime.now(timezone.utc).isoformat(),\r\n            \"risk_score\": score,\r\n        })\r\n\r\n    await db.commit()\r\n\r\n\r\nasync def run_simulator(interval: int = 30):\r\n    logger.info(f\"Device simulator started (interval={interval}s)\")\r\n    while True:\r\n        try:\r\n            async with async_session() as db:\r\n                result = await db.execute(\r\n                    select(User).where(\r\n                        User.role == \"student\",\r\n                        User.consent_given == True,\r\n                    )\r\n                )\r\n                students = result.scalars().all()\r\n\r\n                devices_simulated = 0\r\n                for student in students:\r\n                    anomaly_chance = random.uniform(0.1, 0.35)\r\n                    \r\n                    # Fetch devices\r\n                    dev_res = await db.execute(select(Device).where(Device.user_id == student.id))\r\n                    devices = dev_res.scalars().all()\r\n                    \r\n                    if not devices:\r\n                        # Auto register default device if none exist\r\n                        main_device = Device(user_id=student.id, device_name=\"Main Phone\", device_type=\"smartphone\")\r\n                        db.add(main_device)\r\n                        await db.commit()\r\n                        await db.refresh(main_device)\r\n                        devices = [main_device]\r\n                        \r\n                    for d in devices:\r\n                        await simulate_for_device(db, student.id, d.id, anomaly_chance)\r\n                        devices_simulated += 1\r\n\r\n                if devices_simulated \u003e 0:\r\n                    logger.info(f\"Simulated logs for {devices_simulated} devices across {len(students)} students\")\r\n\r\n        except Exception as e:\r\n            logger.error(f\"Simulator error: {e}\")\r\n\r\n        await asyncio.sleep(interval)\r\n","path":"backend/app/simulator.py"},{"content":"from fastapi import WebSocket\r\nfrom typing import Dict, List\r\nimport json\r\nimport logging\r\n\r\nlogger = logging.getLogger(__name__)\r\n\r\n\r\nclass ConnectionManager:\r\n    \"\"\"Manages WebSocket connections per user for real-time alerts.\"\"\"\r\n\r\n    def __init__(self):\r\n        self.active_connections: Dict[str, List[WebSocket]] = {}\r\n\r\n    async def connect(self, websocket: WebSocket, user_id: str):\r\n        await websocket.accept()\r\n        if user_id not in self.active_connections:\r\n            self.active_connections[user_id] = []\r\n        self.active_connections[user_id].append(websocket)\r\n        logger.info(f\"WebSocket connected for user {user_id}\")\r\n\r\n    def disconnect(self, websocket: WebSocket, user_id: str):\r\n        if user_id in self.active_connections:\r\n            self.active_connections[user_id] = [\r\n                ws for ws in self.active_connections[user_id] if ws != websocket\r\n            ]\r\n            if not self.active_connections[user_id]:\r\n                del self.active_connections[user_id]\r\n        logger.info(f\"WebSocket disconnected for user {user_id}\")\r\n\r\n    async def send_to_user(self, user_id: str, message: dict):\r\n        if user_id in self.active_connections:\r\n            dead = []\r\n            for ws in self.active_connections[user_id]:\r\n                try:\r\n                    await ws.send_text(json.dumps(message))\r\n                except Exception:\r\n                    dead.append(ws)\r\n            for ws in dead:\r\n                self.active_connections[user_id].remove(ws)\r\n\r\n    async def broadcast(self, message: dict):\r\n        for user_id in list(self.active_connections.keys()):\r\n            await self.send_to_user(user_id, message)\r\n\r\n    @property\r\n    def connected_count(self) -\u003e int:\r\n        return sum(len(conns) for conns in self.active_connections.values())\r\n\r\n\r\nmanager = ConnectionManager()\r\n","path":"backend/app/websocket_manager.py"},{"content":"","path":"backend/app/__init__.py"},{"content":"fastapi\r\nuvicorn[standard]\r\nsqlalchemy[asyncio]\r\naiosqlite\r\npasslib[bcrypt]\r\npython-jose[cryptography]\r\npydantic-settings\r\npydantic[email]\r\npython-multipart\r\nslowapi\r\nasyncpg\r\n","path":"backend/requirements.txt"},{"content":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport {\r\n    Shield, Users, AlertTriangle, BarChart3, Download,\r\n    TrendingUp, LogOut, ShieldAlert, Activity, FileDown,\r\n    Search, Filter, Eye, Zap, Building2, ChevronRight,\r\n    ArrowUpRight, ArrowDownRight\r\n} from \"lucide-react\";\r\nimport { adminAPI } from \"@/lib/api\";\r\nimport {\r\n    PieChart, Pie, Cell, BarChart, Bar, XAxis, YAxis, CartesianGrid,\r\n    Tooltip, ResponsiveContainer, Legend, LineChart, Line, Area, AreaChart,\r\n    ComposedChart\r\n} from \"recharts\";\r\n\r\nconst RISK_COLORS = { high: \"#ef4444\", medium: \"#f59e0b\", low: \"#10b981\" };\r\nconst PIE_COLORS = [\"#ef4444\", \"#f59e0b\", \"#10b981\"];\r\nconst SEVERITY_STYLES: Record\u003cstring, string\u003e = {\r\n    critical: \"bg-red-500/10 text-red-400 border-red-500/20\",\r\n    high: \"bg-orange-500/10 text-orange-400 border-orange-500/20\",\r\n    medium: \"bg-yellow-500/10 text-yellow-400 border-yellow-500/20\",\r\n    low: \"bg-green-500/10 text-green-400 border-green-500/20\",\r\n};\r\n\r\nexport default function AdminDashboard() {\r\n    const router = useRouter();\r\n    const [user, setUser] = useState\u003cany\u003e(null);\r\n    const [stats, setStats] = useState\u003cany\u003e(null);\r\n    const [highRisk, setHighRisk] = useState\u003cany[]\u003e([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // New state\r\n    const [activityFeed, setActivityFeed] = useState\u003cany[]\u003e([]);\r\n    const [trends, setTrends] = useState\u003cany[]\u003e([]);\r\n    const [colleges, setColleges] = useState\u003cany[]\u003e([]);\r\n    const [allUsers, setAllUsers] = useState\u003cany[]\u003e([]);\r\n    const [searchQuery, setSearchQuery] = useState(\"\");\r\n    const [roleFilter, setRoleFilter] = useState(\"all\");\r\n\r\n    useEffect(() =\u003e {\r\n        const stored = localStorage.getItem(\"sentinel_user\");\r\n        if (!stored) { router.push(\"/login\"); return; }\r\n        const u = JSON.parse(stored);\r\n        if (u.role !== \"admin\") { router.push(\"/dashboard\"); return; }\r\n        setUser(u);\r\n        loadData();\r\n    }, []);\r\n\r\n    const loadData = async () =\u003e {\r\n        try {\r\n            const [statsRes, hrRes, feedRes, trendsRes, collegeRes, usersRes] = await Promise.all([\r\n                adminAPI.stats(),\r\n                adminAPI.highRiskUsers(),\r\n                adminAPI.activityFeed().catch(() =\u003e ({ data: [] })),\r\n                adminAPI.trends().catch(() =\u003e ({ data: [] })),\r\n                adminAPI.collegeBreakdown().catch(() =\u003e ({ data: [] })),\r\n                adminAPI.allUsers().catch(() =\u003e ({ data: [] })),\r\n            ]);\r\n            setStats(statsRes.data);\r\n            setHighRisk(hrRes.data);\r\n            setActivityFeed(feedRes.data);\r\n            setTrends(trendsRes.data);\r\n            setColleges(collegeRes.data);\r\n            setAllUsers(usersRes.data);\r\n        } catch (err) {\r\n            console.error(\"Failed to load admin data\", err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleExport = async () =\u003e {\r\n        try {\r\n            const res = await adminAPI.exportReport();\r\n            const blob = new Blob([res.data], { type: \"text/csv\" });\r\n            const url = URL.createObjectURL(blob);\r\n            const a = document.createElement(\"a\");\r\n            a.href = url; a.download = \"sentinel_report.csv\"; a.click();\r\n            URL.revokeObjectURL(url);\r\n        } catch (err) {\r\n            console.error(err);\r\n        }\r\n    };\r\n\r\n    const handleLogout = () =\u003e {\r\n        localStorage.removeItem(\"sentinel_token\");\r\n        localStorage.removeItem(\"sentinel_user\");\r\n        router.push(\"/login\");\r\n    };\r\n\r\n    const handleSearchUsers = async () =\u003e {\r\n        try {\r\n            const res = await adminAPI.allUsers(searchQuery, roleFilter);\r\n            setAllUsers(res.data);\r\n        } catch (err) {\r\n            console.error(err);\r\n        }\r\n    };\r\n\r\n    useEffect(() =\u003e {\r\n        if (!loading) {\r\n            const timer = setTimeout(handleSearchUsers, 300);\r\n            return () =\u003e clearTimeout(timer);\r\n        }\r\n    }, [searchQuery, roleFilter]);\r\n\r\n    const riskPieData = stats ? [\r\n        { name: \"High\", value: stats.high_risk_count },\r\n        { name: \"Medium\", value: stats.medium_risk_count },\r\n        { name: \"Low\", value: stats.low_risk_count },\r\n    ] : [];\r\n\r\n    if (loading) {\r\n        return (\r\n            \u003cdiv className=\"min-h-screen p-6 max-w-7xl mx-auto\"\u003e\r\n                \u003cdiv className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\"\u003e\r\n                    {[...Array(8)].map((_, i) =\u003e (\r\n                        \u003cdiv key={i} className=\"skeleton h-32 rounded-xl\" /\u003e\r\n                    ))}\r\n                \u003c/div\u003e\r\n            \u003c/div\u003e\r\n        );\r\n    }\r\n\r\n    return (\r\n        \u003cdiv className=\"min-h-screen border-t-2 border-sentinel-accent\"\u003e\r\n            {/* Header */}\r\n            \u003cheader className=\"border-b border-sentinel-border px-6 py-4 bg-sentinel-card/30 backdrop-blur-md sticky top-0 z-40\"\u003e\r\n                \u003cdiv className=\"max-w-7xl mx-auto flex items-center justify-between\"\u003e\r\n                    \u003cdiv className=\"flex items-center gap-3\"\u003e\r\n                        \u003cShield className=\"w-7 h-7 text-sentinel-accent\" /\u003e\r\n                        \u003cspan className=\"text-lg font-bold bg-gradient-to-r from-sentinel-accent to-sentinel-neon bg-clip-text text-transparent\"\u003e\r\n                            SentinelAI Admin\r\n                        \u003c/span\u003e\r\n                    \u003c/div\u003e\r\n                    \u003cdiv className=\"flex items-center gap-3\"\u003e\r\n                        \u003cbutton onClick={handleExport} className=\"btn-neon !py-2 !px-4 text-sm flex items-center gap-2\"\u003e\r\n                            \u003cFileDown className=\"w-4 h-4\" /\u003e Export CSV\r\n                        \u003c/button\u003e\r\n                        \u003cspan className=\"text-sm text-sentinel-text-muted hidden sm:block\"\u003e\r\n                            {user?.name}\r\n                        \u003c/span\u003e\r\n                        \u003cbutton onClick={handleLogout} className=\"p-2 rounded-lg hover:bg-sentinel-card text-sentinel-text-muted hover:text-white transition-colors\"\u003e\r\n                            \u003cLogOut className=\"w-5 h-5\" /\u003e\r\n                        \u003c/button\u003e\r\n                    \u003c/div\u003e\r\n                \u003c/div\u003e\r\n            \u003c/header\u003e\r\n\r\n            \u003cmain className=\"max-w-7xl mx-auto p-6 space-y-6\"\u003e\r\n                {/* Stat Cards */}\r\n                \u003cdiv className=\"grid grid-cols-2 md:grid-cols-4 gap-4\"\u003e\r\n                    {[\r\n                        { label: \"Total Users\", value: stats?.total_users, icon: Users, color: \"blue\" },\r\n                        { label: \"High Risk\", value: stats?.high_risk_count, icon: AlertTriangle, color: \"red\" },\r\n                        { label: \"Total Alerts\", value: stats?.total_alerts, icon: ShieldAlert, color: \"purple\" },\r\n                        { label: \"Unresolved\", value: stats?.unresolved_alerts, icon: Zap, color: \"orange\" },\r\n                    ].map((card, i) =\u003e (\r\n                        \u003cmotion.div\r\n                            key={i}\r\n                            initial={{ opacity: 0, y: 20 }}\r\n                            animate={{ opacity: 1, y: 0 }}\r\n                            transition={{ delay: i * 0.05 }}\r\n                            className=\"glass-card p-5\"\r\n                        \u003e\r\n                            \u003cdiv className=\"flex items-center justify-between mb-2\"\u003e\r\n                                \u003ccard.icon className={`w-5 h-5 text-${card.color}-400`} /\u003e\r\n                                \u003cspan className={`text-xs px-2 py-0.5 rounded-full bg-${card.color}-500/10 text-${card.color}-400`}\u003e\r\n                                    {card.color === \"red\" ? \"!\" : \"•\"}\r\n                                \u003c/span\u003e\r\n                            \u003c/div\u003e\r\n                            \u003cp className=\"text-2xl font-bold text-white\"\u003e{card.value ?? 0}\u003c/p\u003e\r\n                            \u003cp className=\"text-xs text-sentinel-text-muted mt-1\"\u003e{card.label}\u003c/p\u003e\r\n                        \u003c/motion.div\u003e\r\n                    ))}\r\n                \u003c/div\u003e\r\n\r\n                {/* Row 2: Risk Pie + Trend Chart */}\r\n                \u003cdiv className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\"\u003e\r\n                    {/* Risk Distribution */}\r\n                    \u003cmotion.div\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        transition={{ delay: 0.1 }}\r\n                        className=\"glass-card p-6\"\r\n                    \u003e\r\n                        \u003ch3 className=\"text-sm font-medium text-sentinel-text-muted mb-4 flex items-center gap-2\"\u003e\r\n                            \u003cBarChart3 className=\"w-4 h-4 text-sentinel-accent\" /\u003e Risk Distribution\r\n                        \u003c/h3\u003e\r\n                        \u003cdiv className=\"h-[200px]\"\u003e\r\n                            \u003cResponsiveContainer width=\"100%\" height=\"100%\"\u003e\r\n                                \u003cPieChart\u003e\r\n                                    \u003cPie data={riskPieData} dataKey=\"value\" nameKey=\"name\" cx=\"50%\" cy=\"50%\" outerRadius={75} strokeWidth={0}\u003e\r\n                                        {riskPieData.map((_, i) =\u003e (\r\n                                            \u003cCell key={i} fill={PIE_COLORS[i]} /\u003e\r\n                                        ))}\r\n                                    \u003c/Pie\u003e\r\n                                    \u003cTooltip contentStyle={{ background: \"#111128\", border: \"1px solid #1e1e3a\", borderRadius: 8 }} /\u003e\r\n                                    \u003cLegend wrapperStyle={{ fontSize: 12 }} /\u003e\r\n                                \u003c/PieChart\u003e\r\n                            \u003c/ResponsiveContainer\u003e\r\n                        \u003c/div\u003e\r\n                    \u003c/motion.div\u003e\r\n\r\n                    {/* 14-Day Trend Chart */}\r\n                    \u003cmotion.div\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        transition={{ delay: 0.15 }}\r\n                        className=\"glass-card p-6 lg:col-span-2\"\r\n                    \u003e\r\n                        \u003ch3 className=\"text-sm font-medium text-sentinel-text-muted mb-4 flex items-center gap-2\"\u003e\r\n                            \u003cTrendingUp className=\"w-4 h-4 text-sentinel-accent\" /\u003e 14-Day Trend Analysis\r\n                        \u003c/h3\u003e\r\n                        \u003cdiv className=\"h-[200px]\"\u003e\r\n                            \u003cResponsiveContainer width=\"100%\" height=\"100%\"\u003e\r\n                                \u003cComposedChart data={trends} margin={{ top: 5, right: 10, left: -20, bottom: 0 }}\u003e\r\n                                    \u003cCartesianGrid strokeDasharray=\"3 3\" stroke=\"#1e1e3a\" vertical={false} /\u003e\r\n                                    \u003cXAxis dataKey=\"date\" tick={{ fill: \"#94a3b8\", fontSize: 10 }} axisLine={false} tickLine={false} /\u003e\r\n                                    \u003cYAxis yAxisId=\"left\" tick={{ fill: \"#94a3b8\", fontSize: 10 }} axisLine={false} tickLine={false} /\u003e\r\n                                    \u003cYAxis yAxisId=\"right\" orientation=\"right\" tick={{ fill: \"#94a3b8\", fontSize: 10 }} axisLine={false} tickLine={false} /\u003e\r\n                                    \u003cTooltip contentStyle={{ background: \"#111128\", border: \"1px solid #1e1e3a\", borderRadius: 8 }} /\u003e\r\n                                    \u003cLegend wrapperStyle={{ fontSize: 11 }} /\u003e\r\n                                    \u003cLine yAxisId=\"left\" type=\"monotone\" dataKey=\"avg_risk_score\" stroke=\"#6366f1\" strokeWidth={2} name=\"Avg Risk\" dot={false} /\u003e\r\n                                    \u003cBar yAxisId=\"right\" dataKey=\"alert_count\" fill=\"#ef444440\" name=\"Alerts\" radius={[4, 4, 0, 0]} /\u003e\r\n                                    \u003cBar yAxisId=\"right\" dataKey=\"anomaly_count\" fill=\"#f59e0b40\" name=\"Anomalies\" radius={[4, 4, 0, 0]} /\u003e\r\n                                \u003c/ComposedChart\u003e\r\n                            \u003c/ResponsiveContainer\u003e\r\n                        \u003c/div\u003e\r\n                    \u003c/motion.div\u003e\r\n                \u003c/div\u003e\r\n\r\n                {/* Row 3: College Breakdown + Activity Feed */}\r\n                \u003cdiv className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\"\u003e\r\n                    {/* College Breakdown */}\r\n                    \u003cmotion.div\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        transition={{ delay: 0.2 }}\r\n                        className=\"glass-card p-6\"\r\n                    \u003e\r\n                        \u003ch3 className=\"text-sm font-medium text-sentinel-text-muted mb-4 flex items-center gap-2\"\u003e\r\n                            \u003cBuilding2 className=\"w-4 h-4 text-sentinel-accent\" /\u003e College Breakdown\r\n                        \u003c/h3\u003e\r\n                        {colleges.length \u003e 0 ? (\r\n                            \u003cdiv className=\"space-y-3\"\u003e\r\n                                {colleges.map((c: any, i: number) =\u003e (\r\n                                    \u003cdiv key={i} className=\"p-3 rounded-xl bg-sentinel-card/50\"\u003e\r\n                                        \u003cdiv className=\"flex items-center justify-between mb-2\"\u003e\r\n                                            \u003cspan className=\"text-sm font-medium text-white\"\u003e{c.college}\u003c/span\u003e\r\n                                            \u003cspan className=\"text-xs text-sentinel-text-muted\"\u003e{c.total_students} students\u003c/span\u003e\r\n                                        \u003c/div\u003e\r\n                                        \u003cdiv className=\"flex items-center gap-1 h-3 rounded-full overflow-hidden bg-sentinel-bg\"\u003e\r\n                                            {c.high_risk \u003e 0 \u0026\u0026 (\r\n                                                \u003cdiv\r\n                                                    className=\"h-full bg-red-500 rounded-l-full\"\r\n                                                    style={{ width: `${(c.high_risk / c.total_students) * 100}%` }}\r\n                                                /\u003e\r\n                                            )}\r\n                                            {c.medium_risk \u003e 0 \u0026\u0026 (\r\n                                                \u003cdiv\r\n                                                    className=\"h-full bg-yellow-500\"\r\n                                                    style={{ width: `${(c.medium_risk / c.total_students) * 100}%` }}\r\n                                                /\u003e\r\n                                            )}\r\n                                            {c.low_risk \u003e 0 \u0026\u0026 (\r\n                                                \u003cdiv\r\n                                                    className=\"h-full bg-green-500 rounded-r-full\"\r\n                                                    style={{ width: `${(c.low_risk / c.total_students) * 100}%` }}\r\n                                                /\u003e\r\n                                            )}\r\n                                        \u003c/div\u003e\r\n                                        \u003cdiv className=\"flex items-center gap-3 mt-2 text-xs text-sentinel-text-muted\"\u003e\r\n                                            \u003cspan className=\"flex items-center gap-1\"\u003e\u003cspan className=\"w-2 h-2 rounded-full bg-red-500\" /\u003e {c.high_risk} High\u003c/span\u003e\r\n                                            \u003cspan className=\"flex items-center gap-1\"\u003e\u003cspan className=\"w-2 h-2 rounded-full bg-yellow-500\" /\u003e {c.medium_risk} Med\u003c/span\u003e\r\n                                            \u003cspan className=\"flex items-center gap-1\"\u003e\u003cspan className=\"w-2 h-2 rounded-full bg-green-500\" /\u003e {c.low_risk} Low\u003c/span\u003e\r\n                                            \u003cspan className=\"ml-auto font-mono\"\u003eAvg: {c.avg_score}\u003c/span\u003e\r\n                                        \u003c/div\u003e\r\n                                    \u003c/div\u003e\r\n                                ))}\r\n                            \u003c/div\u003e\r\n                        ) : (\r\n                            \u003cp className=\"text-sm text-sentinel-text-muted text-center py-8\"\u003eNo college data available.\u003c/p\u003e\r\n                        )}\r\n                    \u003c/motion.div\u003e\r\n\r\n                    {/* Live Activity Feed */}\r\n                    \u003cmotion.div\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        transition={{ delay: 0.25 }}\r\n                        className=\"glass-card p-6\"\r\n                    \u003e\r\n                        \u003ch3 className=\"text-sm font-medium text-sentinel-text-muted mb-4 flex items-center gap-2\"\u003e\r\n                            \u003cActivity className=\"w-4 h-4 text-sentinel-accent\" /\u003e Live Threat Feed\r\n                        \u003c/h3\u003e\r\n                        \u003cdiv className=\"space-y-2 max-h-[380px] overflow-y-auto custom-scrollbar pr-2\"\u003e\r\n                            {activityFeed.slice(0, 20).map((item: any, i: number) =\u003e (\r\n                                \u003cmotion.div\r\n                                    key={item.id}\r\n                                    initial={{ opacity: 0 }}\r\n                                    animate={{ opacity: 1 }}\r\n                                    transition={{ delay: i * 0.03 }}\r\n                                    className=\"flex items-start gap-3 p-3 rounded-lg bg-sentinel-card/50 hover:bg-sentinel-card/80 transition-colors\"\r\n                                \u003e\r\n                                    \u003cdiv className={`w-2 h-2 rounded-full mt-1.5 flex-shrink-0 ${item.severity === \u0027critical\u0027 ? \u0027bg-red-400 animate-pulse\u0027 : item.severity === \u0027high\u0027 ? \u0027bg-orange-400\u0027 : \u0027bg-yellow-400\u0027}`} /\u003e\r\n                                    \u003cdiv className=\"flex-1 min-w-0\"\u003e\r\n                                        \u003cdiv className=\"flex items-center justify-between mb-1\"\u003e\r\n                                            \u003cspan className=\"text-sm font-medium text-white truncate\"\u003e{item.student_name}\u003c/span\u003e\r\n                                            \u003cspan className={`text-xs px-2 py-0.5 rounded-full border capitalize ${SEVERITY_STYLES[item.severity] || \u0027\u0027}`}\u003e\r\n                                                {item.severity}\r\n                                            \u003c/span\u003e\r\n                                        \u003c/div\u003e\r\n                                        \u003cp className=\"text-xs text-sentinel-text-muted truncate\"\u003e{item.message}\u003c/p\u003e\r\n                                        \u003cp className=\"text-xs text-sentinel-text-muted/60 mt-1\"\u003e\r\n                                            {new Date(item.created_at).toLocaleString()}\r\n                                        \u003c/p\u003e\r\n                                    \u003c/div\u003e\r\n                                \u003c/motion.div\u003e\r\n                            ))}\r\n                            {activityFeed.length === 0 \u0026\u0026 (\r\n                                \u003cp className=\"text-sm text-sentinel-text-muted text-center py-8\"\u003eNo recent activity.\u003c/p\u003e\r\n                            )}\r\n                        \u003c/div\u003e\r\n                    \u003c/motion.div\u003e\r\n                \u003c/div\u003e\r\n\r\n                {/* Row 4: High Risk Users */}\r\n                \u003cmotion.div\r\n                    initial={{ opacity: 0, y: 20 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    transition={{ delay: 0.3 }}\r\n                    className=\"glass-card p-6\"\r\n                \u003e\r\n                    \u003ch3 className=\"text-sm font-medium text-sentinel-text-muted mb-4 flex items-center gap-2\"\u003e\r\n                        \u003cAlertTriangle className=\"w-4 h-4 text-red-400\" /\u003e High Risk Students\r\n                    \u003c/h3\u003e\r\n                    {highRisk.length \u003e 0 ? (\r\n                        \u003cdiv className=\"overflow-x-auto\"\u003e\r\n                            \u003ctable className=\"w-full text-sm\"\u003e\r\n                                \u003cthead\u003e\r\n                                    \u003ctr className=\"border-b border-sentinel-border text-left\"\u003e\r\n                                        \u003cth className=\"pb-3 text-sentinel-text-muted font-medium\"\u003eStudent\u003c/th\u003e\r\n                                        \u003cth className=\"pb-3 text-sentinel-text-muted font-medium\"\u003eCollege\u003c/th\u003e\r\n                                        \u003cth className=\"pb-3 text-sentinel-text-muted font-medium\"\u003eRisk Score\u003c/th\u003e\r\n                                        \u003cth className=\"pb-3 text-sentinel-text-muted font-medium\"\u003eLevel\u003c/th\u003e\r\n                                    \u003c/tr\u003e\r\n                                \u003c/thead\u003e\r\n                                \u003ctbody\u003e\r\n                                    {highRisk.map((u: any) =\u003e (\r\n                                        \u003ctr key={u.id} className=\"border-b border-sentinel-border/50 hover:bg-white/2\"\u003e\r\n                                            \u003ctd className=\"py-3\"\u003e\r\n                                                \u003cp className=\"font-medium text-white\"\u003e{u.name}\u003c/p\u003e\r\n                                                \u003cp className=\"text-xs text-sentinel-text-muted\"\u003e{u.email}\u003c/p\u003e\r\n                                            \u003c/td\u003e\r\n                                            \u003ctd className=\"py-3 text-sentinel-text\"\u003e{u.college}\u003c/td\u003e\r\n                                            \u003ctd className=\"py-3\"\u003e\r\n                                                \u003cspan className=\"font-mono font-bold text-red-400\"\u003e{u.current_score}\u003c/span\u003e\r\n                                            \u003c/td\u003e\r\n                                            \u003ctd className=\"py-3\"\u003e\r\n                                                \u003cspan className=\"px-2 py-1 rounded-full text-xs bg-red-500/10 text-red-400 border border-red-500/20 capitalize\"\u003e\r\n                                                    {u.risk_level}\r\n                                                \u003c/span\u003e\r\n                                            \u003c/td\u003e\r\n                                        \u003c/tr\u003e\r\n                                    ))}\r\n                                \u003c/tbody\u003e\r\n                            \u003c/table\u003e\r\n                        \u003c/div\u003e\r\n                    ) : (\r\n                        \u003cp className=\"text-sm text-sentinel-text-muted text-center py-6\"\u003eNo high-risk students found.\u003c/p\u003e\r\n                    )}\r\n                \u003c/motion.div\u003e\r\n\r\n                {/* Row 5: User Management */}\r\n                \u003cmotion.div\r\n                    initial={{ opacity: 0, y: 20 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    transition={{ delay: 0.35 }}\r\n                    className=\"glass-card p-6\"\r\n                \u003e\r\n                    \u003cdiv className=\"flex items-center justify-between mb-4 flex-wrap gap-3\"\u003e\r\n                        \u003ch3 className=\"text-sm font-medium text-sentinel-text-muted flex items-center gap-2\"\u003e\r\n                            \u003cUsers className=\"w-4 h-4 text-sentinel-accent\" /\u003e User Management\r\n                        \u003c/h3\u003e\r\n                        \u003cdiv className=\"flex items-center gap-3\"\u003e\r\n                            \u003cdiv className=\"relative\"\u003e\r\n                                \u003cSearch className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-sentinel-text-muted\" /\u003e\r\n                                \u003cinput\r\n                                    type=\"text\"\r\n                                    placeholder=\"Search users...\"\r\n                                    value={searchQuery}\r\n                                    onChange={(e) =\u003e setSearchQuery(e.target.value)}\r\n                                    className=\"pl-9 pr-4 py-2 rounded-lg bg-sentinel-card border border-sentinel-border text-sm text-white placeholder-sentinel-text-muted focus:border-sentinel-accent outline-none w-56\"\r\n                                /\u003e\r\n                            \u003c/div\u003e\r\n                            \u003cselect\r\n                                value={roleFilter}\r\n                                onChange={(e) =\u003e setRoleFilter(e.target.value)}\r\n                                className=\"px-3 py-2 rounded-lg bg-sentinel-card border border-sentinel-border text-sm text-white outline-none focus:border-sentinel-accent\"\r\n                            \u003e\r\n                                \u003coption value=\"all\"\u003eAll Roles\u003c/option\u003e\r\n                                \u003coption value=\"student\"\u003eStudents\u003c/option\u003e\r\n                                \u003coption value=\"admin\"\u003eAdmins\u003c/option\u003e\r\n                            \u003c/select\u003e\r\n                        \u003c/div\u003e\r\n                    \u003c/div\u003e\r\n\r\n                    \u003cdiv className=\"overflow-x-auto\"\u003e\r\n                        \u003ctable className=\"w-full text-sm\"\u003e\r\n                            \u003cthead\u003e\r\n                                \u003ctr className=\"border-b border-sentinel-border text-left\"\u003e\r\n                                    \u003cth className=\"pb-3 text-sentinel-text-muted font-medium\"\u003eUser\u003c/th\u003e\r\n                                    \u003cth className=\"pb-3 text-sentinel-text-muted font-medium\"\u003eCollege\u003c/th\u003e\r\n                                    \u003cth className=\"pb-3 text-sentinel-text-muted font-medium\"\u003eRole\u003c/th\u003e\r\n                                    \u003cth className=\"pb-3 text-sentinel-text-muted font-medium\"\u003eRisk\u003c/th\u003e\r\n                                    \u003cth className=\"pb-3 text-sentinel-text-muted font-medium\"\u003eAlerts\u003c/th\u003e\r\n                                    \u003cth className=\"pb-3 text-sentinel-text-muted font-medium\"\u003eConsent\u003c/th\u003e\r\n                                    \u003cth className=\"pb-3 text-sentinel-text-muted font-medium\"\u003eJoined\u003c/th\u003e\r\n                                \u003c/tr\u003e\r\n                            \u003c/thead\u003e\r\n                            \u003ctbody\u003e\r\n                                {allUsers.map((u: any) =\u003e (\r\n                                    \u003ctr key={u.id} className=\"border-b border-sentinel-border/50 hover:bg-white/[0.02] transition-colors\"\u003e\r\n                                        \u003ctd className=\"py-3\"\u003e\r\n                                            \u003cp className=\"font-medium text-white\"\u003e{u.name}\u003c/p\u003e\r\n                                            \u003cp className=\"text-xs text-sentinel-text-muted\"\u003e{u.email}\u003c/p\u003e\r\n                                        \u003c/td\u003e\r\n                                        \u003ctd className=\"py-3 text-sentinel-text\"\u003e{u.college}\u003c/td\u003e\r\n                                        \u003ctd className=\"py-3\"\u003e\r\n                                            \u003cspan className={`px-2 py-0.5 rounded-full text-xs border capitalize ${u.role === \u0027admin\u0027 ? \u0027bg-purple-500/10 text-purple-400 border-purple-500/20\u0027 : \u0027bg-blue-500/10 text-blue-400 border-blue-500/20\u0027}`}\u003e\r\n                                                {u.role}\r\n                                            \u003c/span\u003e\r\n                                        \u003c/td\u003e\r\n                                        \u003ctd className=\"py-3\"\u003e\r\n                                            {u.risk_score !== null ? (\r\n                                                \u003cspan className={`font-mono font-bold ${(u.risk_score || 0) \u003e 70 ? \u0027text-red-400\u0027 : (u.risk_score || 0) \u003e 40 ? \u0027text-yellow-400\u0027 : \u0027text-green-400\u0027}`}\u003e\r\n                                                    {u.risk_score}\r\n                                                \u003c/span\u003e\r\n                                            ) : (\r\n                                                \u003cspan className=\"text-sentinel-text-muted\"\u003e—\u003c/span\u003e\r\n                                            )}\r\n                                        \u003c/td\u003e\r\n                                        \u003ctd className=\"py-3 text-sentinel-text font-mono\"\u003e{u.alert_count}\u003c/td\u003e\r\n                                        \u003ctd className=\"py-3\"\u003e\r\n                                            {u.consent_given ? (\r\n                                                \u003cspan className=\"text-green-400 text-xs\"\u003e✓ Yes\u003c/span\u003e\r\n                                            ) : (\r\n                                                \u003cspan className=\"text-red-400 text-xs\"\u003e✗ No\u003c/span\u003e\r\n                                            )}\r\n                                        \u003c/td\u003e\r\n                                        \u003ctd className=\"py-3 text-xs text-sentinel-text-muted\"\u003e\r\n                                            {new Date(u.created_at).toLocaleDateString()}\r\n                                        \u003c/td\u003e\r\n                                    \u003c/tr\u003e\r\n                                ))}\r\n                            \u003c/tbody\u003e\r\n                        \u003c/table\u003e\r\n                    \u003c/div\u003e\r\n                    {allUsers.length === 0 \u0026\u0026 (\r\n                        \u003cp className=\"text-sm text-sentinel-text-muted text-center py-6\"\u003eNo users found.\u003c/p\u003e\r\n                    )}\r\n                \u003c/motion.div\u003e\r\n            \u003c/main\u003e\r\n        \u003c/div\u003e\r\n    );\r\n}\r\n","path":"frontend/src/app/admin/page.tsx"},{"content":"\"use client\";\r\nimport { useState } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { Shield, Check, X, Eye, EyeOff, ShieldCheck, ShieldOff } from \"lucide-react\";\r\nimport { authAPI } from \"@/lib/api\";\r\n\r\nexport default function ConsentPage() {\r\n    const router = useRouter();\r\n    const [acceptTerms, setAcceptTerms] = useState(false);\r\n    const [enableMonitoring, setEnableMonitoring] = useState(false);\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState(\"\");\r\n\r\n    const willMonitor = [\r\n        { icon: Eye, text: \"App usage behavior\" },\r\n        { icon: Shield, text: \"Permission request patterns\" },\r\n        { icon: Shield, text: \"Network behavior anomalies\" },\r\n        { icon: Shield, text: \"Background suspicious processes\" },\r\n        { icon: Shield, text: \"Rapid OTP access attempts (behavior-based only)\" },\r\n    ];\r\n\r\n    const wontAccess = [\r\n        { icon: X, text: \"Private messages\" },\r\n        { icon: X, text: \"Gallery / photos\" },\r\n        { icon: X, text: \"Personal files\" },\r\n        { icon: X, text: \"Microphone recordings\" },\r\n        { icon: X, text: \"Call recordings\" },\r\n    ];\r\n\r\n    const handleConsent = async () =\u003e {\r\n        if (!acceptTerms || !enableMonitoring) return;\r\n        setLoading(true);\r\n        setError(\"\");\r\n\r\n        try {\r\n            const res = await authAPI.consent({ accept_terms: true, enable_monitoring: true });\r\n            // Update stored user\r\n            const stored = localStorage.getItem(\"sentinel_user\");\r\n            if (stored) {\r\n                const user = JSON.parse(stored);\r\n                user.consent_given = true;\r\n                localStorage.setItem(\"sentinel_user\", JSON.stringify(user));\r\n            }\r\n            router.push(\"/dashboard\");\r\n        } catch (err: any) {\r\n            setError(err.response?.data?.detail || \"Failed to save consent.\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        \u003cdiv className=\"min-h-screen flex items-center justify-center px-4 py-12\"\u003e\r\n            \u003cmotion.div\r\n                initial={{ opacity: 0, y: 20 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                className=\"glass-card w-full max-w-2xl p-8\"\r\n            \u003e\r\n                \u003cdiv className=\"flex items-center justify-center gap-2 mb-6\"\u003e\r\n                    \u003cShield className=\"w-8 h-8 text-sentinel-accent\" /\u003e\r\n                    \u003cspan className=\"text-2xl font-bold bg-gradient-to-r from-sentinel-accent to-sentinel-neon bg-clip-text text-transparent\"\u003e\r\n                        Device Monitoring Consent\r\n                    \u003c/span\u003e\r\n                \u003c/div\u003e\r\n\r\n                \u003cp className=\"text-sentinel-text-muted text-center mb-8\"\u003e\r\n                    SentinelAI requires your consent to monitor behavioral patterns on your device.\r\n                    Please review what we will and will not access.\r\n                \u003c/p\u003e\r\n\r\n                \u003cdiv className=\"grid md:grid-cols-2 gap-6 mb-8\"\u003e\r\n                    {/* Will Monitor */}\r\n                    \u003cdiv className=\"p-5 rounded-xl bg-sentinel-success/5 border border-sentinel-success/20\"\u003e\r\n                        \u003cdiv className=\"flex items-center gap-2 mb-4\"\u003e\r\n                            \u003cShieldCheck className=\"w-5 h-5 text-sentinel-success\" /\u003e\r\n                            \u003ch3 className=\"font-semibold text-sentinel-success\"\u003eSentinelAI WILL monitor\u003c/h3\u003e\r\n                        \u003c/div\u003e\r\n                        \u003cul className=\"space-y-3\"\u003e\r\n                            {willMonitor.map((item, i) =\u003e (\r\n                                \u003cmotion.li\r\n                                    key={i}\r\n                                    initial={{ opacity: 0, x: -10 }}\r\n                                    animate={{ opacity: 1, x: 0 }}\r\n                                    transition={{ delay: i * 0.1 }}\r\n                                    className=\"flex items-center gap-3 text-sm text-sentinel-text\"\r\n                                \u003e\r\n                                    \u003cCheck className=\"w-4 h-4 text-sentinel-success flex-shrink-0\" /\u003e\r\n                                    {item.text}\r\n                                \u003c/motion.li\u003e\r\n                            ))}\r\n                        \u003c/ul\u003e\r\n                    \u003c/div\u003e\r\n\r\n                    {/* Won\u0027t Access */}\r\n                    \u003cdiv className=\"p-5 rounded-xl bg-sentinel-danger/5 border border-sentinel-danger/20\"\u003e\r\n                        \u003cdiv className=\"flex items-center gap-2 mb-4\"\u003e\r\n                            \u003cShieldOff className=\"w-5 h-5 text-sentinel-danger\" /\u003e\r\n                            \u003ch3 className=\"font-semibold text-sentinel-danger\"\u003eSentinelAI WILL NOT access\u003c/h3\u003e\r\n                        \u003c/div\u003e\r\n                        \u003cul className=\"space-y-3\"\u003e\r\n                            {wontAccess.map((item, i) =\u003e (\r\n                                \u003cmotion.li\r\n                                    key={i}\r\n                                    initial={{ opacity: 0, x: 10 }}\r\n                                    animate={{ opacity: 1, x: 0 }}\r\n                                    transition={{ delay: i * 0.1 }}\r\n                                    className=\"flex items-center gap-3 text-sm text-sentinel-text\"\r\n                                \u003e\r\n                                    \u003cX className=\"w-4 h-4 text-sentinel-danger flex-shrink-0\" /\u003e\r\n                                    {item.text}\r\n                                \u003c/motion.li\u003e\r\n                            ))}\r\n                        \u003c/ul\u003e\r\n                    \u003c/div\u003e\r\n                \u003c/div\u003e\r\n\r\n                {error \u0026\u0026 (\r\n                    \u003cdiv className=\"bg-red-500/10 border border-red-500/20 rounded-lg p-3 mb-4\"\u003e\r\n                        \u003cp className=\"text-sm text-red-400\"\u003e{error}\u003c/p\u003e\r\n                    \u003c/div\u003e\r\n                )}\r\n\r\n                {/* Checkboxes */}\r\n                \u003cdiv className=\"space-y-4 mb-6\"\u003e\r\n                    \u003clabel className=\"flex items-start gap-3 cursor-pointer group\"\u003e\r\n                        \u003cinput\r\n                            type=\"checkbox\"\r\n                            checked={acceptTerms}\r\n                            onChange={(e) =\u003e setAcceptTerms(e.target.checked)}\r\n                            className=\"w-5 h-5 mt-0.5 rounded border-sentinel-border bg-sentinel-card accent-sentinel-accent\"\r\n                        /\u003e\r\n                        \u003cspan className=\"text-sm text-sentinel-text-muted group-hover:text-sentinel-text transition-colors\"\u003e\r\n                            I accept the terms and conditions. I understand SentinelAI will analyze my device\u0026apos;s behavioral patterns for security purposes.\r\n                        \u003c/span\u003e\r\n                    \u003c/label\u003e\r\n\r\n                    \u003clabel className=\"flex items-start gap-3 cursor-pointer group\"\u003e\r\n                        \u003cinput\r\n                            type=\"checkbox\"\r\n                            checked={enableMonitoring}\r\n                            onChange={(e) =\u003e setEnableMonitoring(e.target.checked)}\r\n                            className=\"w-5 h-5 mt-0.5 rounded border-sentinel-border bg-sentinel-card accent-sentinel-accent\"\r\n                        /\u003e\r\n                        \u003cspan className=\"text-sm text-sentinel-text-muted group-hover:text-sentinel-text transition-colors\"\u003e\r\n                            I enable behavioral monitoring on my device. I can revoke this at any time from settings.\r\n                        \u003c/span\u003e\r\n                    \u003c/label\u003e\r\n                \u003c/div\u003e\r\n\r\n                \u003cmotion.button\r\n                    whileHover={acceptTerms \u0026\u0026 enableMonitoring ? { scale: 1.02 } : {}}\r\n                    whileTap={acceptTerms \u0026\u0026 enableMonitoring ? { scale: 0.98 } : {}}\r\n                    onClick={handleConsent}\r\n                    disabled={!acceptTerms || !enableMonitoring || loading}\r\n                    className={`w-full py-4 rounded-xl font-semibold text-white transition-all ${acceptTerms \u0026\u0026 enableMonitoring\r\n                            ? \"btn-neon\"\r\n                            : \"bg-sentinel-border text-sentinel-text-muted cursor-not-allowed\"\r\n                        }`}\r\n                \u003e\r\n                    {loading ? \"Saving...\" : \"Accept \u0026 Continue to Dashboard\"}\r\n                \u003c/motion.button\u003e\r\n            \u003c/motion.div\u003e\r\n        \u003c/div\u003e\r\n    );\r\n}\r\n","path":"frontend/src/app/consent/page.tsx"},{"content":"import { motion, AnimatePresence } from \"framer-motion\";\r\nimport { ShieldAlert, CheckCircle, AlertTriangle, Info, Shield, X } from \"lucide-react\";\r\n\r\nexport function AlertModal({ alert, isOpen, onClose, onResolve, onReport }: any) {\r\n    if (!isOpen || !alert) return null;\r\n\r\n    const severityColors: any = {\r\n        critical: \"text-red-400 border-red-500/30 bg-red-500/5\",\r\n        high: \"text-orange-400 border-orange-500/30 bg-orange-500/5\",\r\n        medium: \"text-yellow-400 border-yellow-500/30 bg-yellow-500/5\",\r\n        low: \"text-green-400 border-green-500/30 bg-green-500/5\",\r\n    };\r\n\r\n    return (\r\n        \u003cAnimatePresence\u003e\r\n            \u003cdiv className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm\"\u003e\r\n                \u003cmotion.div\r\n                    initial={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                    animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                    exit={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                    className=\"glass-card w-full max-w-lg overflow-hidden flex flex-col\"\r\n                \u003e\r\n                    {/* Header */}\r\n                    \u003cdiv className={`p-4 border-b flex justify-between items-center ${severityColors[alert.severity] || severityColors.medium}`}\u003e\r\n                        \u003cdiv className=\"flex items-center gap-2\"\u003e\r\n                            \u003cShieldAlert className=\"w-5 h-5\" /\u003e\r\n                            \u003ch2 className=\"font-semibold text-white capitalize\"\u003e{alert.severity} Risk Alert\u003c/h2\u003e\r\n                        \u003c/div\u003e\r\n                        \u003cbutton onClick={onClose} className=\"p-1 rounded-md hover:bg-white/10 transition-colors text-sentinel-text-muted hover:text-white\"\u003e\r\n                            \u003cX className=\"w-5 h-5\" /\u003e\r\n                        \u003c/button\u003e\r\n                    \u003c/div\u003e\r\n\r\n                    {/* Content */}\r\n                    \u003cdiv className=\"p-6 space-y-6\"\u003e\r\n                        \u003cdiv\u003e\r\n                            \u003cp className=\"text-lg text-white font-medium mb-1\"\u003e{alert.message}\u003c/p\u003e\r\n                            \u003cspan className=\"text-xs text-sentinel-text-muted\"\u003e{new Date(alert.created_at || alert.timestamp).toLocaleString()}\u003c/span\u003e\r\n                        \u003c/div\u003e\r\n\r\n                        {/* Explanation */}\r\n                        \u003cdiv className=\"p-4 rounded-xl bg-sentinel-card/50 border border-sentinel-border\"\u003e\r\n                            \u003ch3 className=\"text-sm font-semibold text-sentinel-text-muted flex items-center gap-2 mb-2\"\u003e\r\n                                \u003cInfo className=\"w-4 h-4 text-blue-400\" /\u003e AI Explanation\r\n                            \u003c/h3\u003e\r\n                            \u003cp className=\"text-sm text-sentinel-text leading-relaxed\"\u003e\r\n                                {alert.explanation_text || \"The AI detected anomalous behavior deviating from your baseline profile.\"}\r\n                            \u003c/p\u003e\r\n                            {alert.confidence_score \u0026\u0026 (\r\n                                \u003cp className=\"text-xs text-sentinel-text-muted mt-2\"\u003e\r\n                                    Confidence: {(alert.confidence_score * 100).toFixed(0)}%\r\n                                \u003c/p\u003e\r\n                            )}\r\n                        \u003c/div\u003e\r\n\r\n                        {/* Recommendation */}\r\n                        \u003cdiv className=\"p-4 rounded-xl bg-sentinel-card/50 border border-sentinel-border\"\u003e\r\n                            \u003ch3 className=\"text-sm font-semibold text-sentinel-text-muted flex items-center gap-2 mb-2\"\u003e\r\n                                \u003cShield className=\"w-4 h-4 text-green-400\" /\u003e Recommended Action\r\n                            \u003c/h3\u003e\r\n                            \u003cp className=\"text-sm text-sentinel-text leading-relaxed\"\u003e\r\n                                {alert.recommendation || \"Review the activity and determine if it was expected.\"}\r\n                            \u003c/p\u003e\r\n                        \u003c/div\u003e\r\n                    \u003c/div\u003e\r\n\r\n                    {/* Actions */}\r\n                    \u003cdiv className=\"p-4 border-t border-sentinel-border bg-sentinel-card/30 flex justify-between items-center gap-4\"\u003e\r\n                        \u003cbutton\r\n                            onClick={() =\u003e {\r\n                                onReport(alert.id);\r\n                                onClose();\r\n                            }}\r\n                            className=\"text-sm text-sentinel-text-muted hover:text-white transition-colors underline decoration-dotted underline-offset-4\"\r\n                        \u003e\r\n                            Report False Positive\r\n                        \u003c/button\u003e\r\n\r\n                        \u003cdiv className=\"flex gap-3\"\u003e\r\n                            \u003cbutton\r\n                                onClick={onClose}\r\n                                className=\"px-4 py-2 rounded-lg text-sm font-medium text-white bg-sentinel-card hover:bg-sentinel-border transition-colors border border-sentinel-border\"\r\n                            \u003e\r\n                                Dismiss\r\n                            \u003c/button\u003e\r\n                            {!alert.resolved \u0026\u0026 (\r\n                                \u003cbutton\r\n                                    onClick={() =\u003e {\r\n                                        onResolve(alert.id);\r\n                                        onClose();\r\n                                    }}\r\n                                    className=\"px-4 py-2 rounded-lg text-sm font-medium text-white bg-sentinel-accent hover:bg-sentinel-accent-light transition-colors flex items-center gap-2 shadow-lg shadow-sentinel-accent/20\"\r\n                                \u003e\r\n                                    \u003cCheckCircle className=\"w-4 h-4\" /\u003e Mark Safe\r\n                                \u003c/button\u003e\r\n                            )}\r\n                        \u003c/div\u003e\r\n                    \u003c/div\u003e\r\n                \u003c/motion.div\u003e\r\n            \u003c/div\u003e\r\n        \u003c/AnimatePresence\u003e\r\n    );\r\n}\r\n","path":"frontend/src/app/dashboard/components/AlertModal.tsx"},{"content":"\"use client\";\r\nimport { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { Shield, ArrowLeft, Clock, CheckCircle, XCircle, AlertTriangle } from \"lucide-react\";\r\nimport { incidentsAPI } from \"@/lib/api\";\r\nimport { motion } from \"framer-motion\";\r\n\r\nexport default function IncidentsPage() {\r\n    const router = useRouter();\r\n    const [incidents, setIncidents] = useState\u003cany[]\u003e([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() =\u003e {\r\n        const stored = localStorage.getItem(\"sentinel_user\");\r\n        if (!stored) { router.push(\"/login\"); return; }\r\n\r\n        loadIncidents();\r\n    }, [router]);\r\n\r\n    const loadIncidents = async () =\u003e {\r\n        try {\r\n            const res = await incidentsAPI.getAll();\r\n            setIncidents(res.data);\r\n        } catch (err) {\r\n            console.error(\"Failed to load incidents\", err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const StatusBadge = ({ status }: { status: string }) =\u003e {\r\n        if (status === \"open\") return \u003cspan className=\"px-2 py-1 rounded-full text-xs bg-yellow-500/10 text-yellow-400 border border-yellow-500/20 flex items-center gap-1 w-max\"\u003e\u003cClock className=\"w-3 h-3\" /\u003e Under Review\u003c/span\u003e;\r\n        if (status === \"resolved\") return \u003cspan className=\"px-2 py-1 rounded-full text-xs bg-green-500/10 text-green-400 border border-green-500/20 flex items-center gap-1 w-max\"\u003e\u003cCheckCircle className=\"w-3 h-3\" /\u003e Resolved\u003c/span\u003e;\r\n        return \u003cspan className=\"px-2 py-1 rounded-full text-xs bg-red-500/10 text-red-400 border border-red-500/20 flex items-center gap-1 w-max\"\u003e\u003cXCircle className=\"w-3 h-3\" /\u003e Rejected\u003c/span\u003e;\r\n    };\r\n\r\n    return (\r\n        \u003cdiv className=\"min-h-screen border-t-2 border-sentinel-accent\"\u003e\r\n            \u003cheader className=\"border-b border-sentinel-border px-6 py-4 bg-sentinel-card/30 backdrop-blur-md sticky top-0 z-40\"\u003e\r\n                \u003cdiv className=\"max-w-7xl mx-auto flex items-center gap-4\"\u003e\r\n                    \u003cbutton onClick={() =\u003e router.push(\u0027/dashboard\u0027)} className=\"p-2 rounded-lg hover:bg-sentinel-card text-sentinel-text-muted hover:text-white transition-colors\"\u003e\r\n                        \u003cArrowLeft className=\"w-5 h-5\" /\u003e\r\n                    \u003c/button\u003e\r\n                    \u003cShield className=\"w-6 h-6 text-sentinel-accent\" /\u003e\r\n                    \u003ch1 className=\"text-xl font-bold text-white\"\u003eIncident Tracker\u003c/h1\u003e\r\n                \u003c/div\u003e\r\n            \u003c/header\u003e\r\n\r\n            \u003cmain className=\"max-w-5xl mx-auto p-6 space-y-6\"\u003e\r\n                \u003cdiv className=\"mb-8\"\u003e\r\n                    \u003ch2 className=\"text-2xl font-bold text-white mb-2\"\u003eReported False Positives\u003c/h2\u003e\r\n                    \u003cp className=\"text-sentinel-text-muted\"\u003eTrack the status of alerts you have reported as incorrect.\u003c/p\u003e\r\n                \u003c/div\u003e\r\n\r\n                {loading ? (\r\n                    \u003cdiv className=\"space-y-4\"\u003e\r\n                        {[1, 2, 3].map(i =\u003e \u003cdiv key={i} className=\"skeleton h-24 rounded-xl\" /\u003e)}\r\n                    \u003c/div\u003e\r\n                ) : incidents.length === 0 ? (\r\n                    \u003cdiv className=\"glass-card p-12 text-center flex flex-col items-center\"\u003e\r\n                        \u003cCheckCircle className=\"w-12 h-12 text-green-500/50 mb-4\" /\u003e\r\n                        \u003ch3 className=\"text-lg font-medium text-white mb-2\"\u003eNo reported incidents\u003c/h3\u003e\r\n                        \u003cp className=\"text-sentinel-text-muted\"\u003eYou haven\u0027t reported any false positive alerts yet.\u003c/p\u003e\r\n                    \u003c/div\u003e\r\n                ) : (\r\n                    \u003cdiv className=\"space-y-4\"\u003e\r\n                        {incidents.map((incident, i) =\u003e (\r\n                            \u003cmotion.div\r\n                                initial={{ opacity: 0, y: 10 }}\r\n                                animate={{ opacity: 1, y: 0 }}\r\n                                transition={{ delay: i * 0.05 }}\r\n                                key={incident.id}\r\n                                className=\"glass-card p-5\"\r\n                            \u003e\r\n                                \u003cdiv className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\"\u003e\r\n                                    \u003cdiv className=\"space-y-2 flex-1\"\u003e\r\n                                        \u003cdiv className=\"flex items-center justify-between\"\u003e\r\n                                            \u003cdiv className=\"flex items-center gap-2\"\u003e\r\n                                                \u003cAlertTriangle className=\"w-4 h-4 text-sentinel-accent\" /\u003e\r\n                                                \u003cspan className=\"font-semibold text-white\"\u003eIncident #{incident.id}\u003c/span\u003e\r\n                                            \u003c/div\u003e\r\n                                            \u003cStatusBadge status={incident.status} /\u003e\r\n                                        \u003c/div\u003e\r\n                                        \u003cp className=\"text-sm text-sentinel-text\"\u003e{incident.description || \"Reported as False Positive from Dashboard.\"}\u003c/p\u003e\r\n                                        \u003cdiv className=\"flex items-center gap-4 text-xs text-sentinel-text-muted\"\u003e\r\n                                            \u003cspan\u003eReported: {new Date(incident.created_at).toLocaleString()}\u003c/span\u003e\r\n                                            {incident.resolution_notes \u0026\u0026 (\r\n                                                \u003cspan className=\"text-sentinel-accent-light px-2 py-0.5 rounded bg-sentinel-accent/10\"\u003e\r\n                                                    Note: {incident.resolution_notes}\r\n                                                \u003c/span\u003e\r\n                                            )}\r\n                                        \u003c/div\u003e\r\n                                    \u003c/div\u003e\r\n                                \u003c/div\u003e\r\n                            \u003c/motion.div\u003e\r\n                        ))}\r\n                    \u003c/div\u003e\r\n                )}\r\n            \u003c/main\u003e\r\n        \u003c/div\u003e\r\n    );\r\n}\r\n","path":"frontend/src/app/dashboard/incidents/page.tsx"},{"content":"\"use client\";\r\nimport { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { Shield, ArrowLeft, Lock, Database, Eye, CheckCircle, ShieldAlert } from \"lucide-react\";\r\nimport { privacyAPI } from \"@/lib/api\";\r\nimport { motion } from \"framer-motion\";\r\n\r\nexport default function PrivacyPage() {\r\n    const router = useRouter();\r\n    const [accessLogs, setAccessLogs] = useState\u003cany[]\u003e([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() =\u003e {\r\n        const stored = localStorage.getItem(\"sentinel_user\");\r\n        if (!stored) { router.push(\"/login\"); return; }\r\n\r\n        loadData();\r\n    }, [router]);\r\n\r\n    const loadData = async () =\u003e {\r\n        try {\r\n            const res = await privacyAPI.getLogs();\r\n            setAccessLogs(res.data);\r\n        } catch (err) {\r\n            console.error(\"Failed to load privacy logs\", err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        \u003cdiv className=\"min-h-screen border-t-2 border-sentinel-accent\"\u003e\r\n            \u003cheader className=\"border-b border-sentinel-border px-6 py-4 bg-sentinel-card/30 backdrop-blur-md sticky top-0 z-40\"\u003e\r\n                \u003cdiv className=\"max-w-7xl mx-auto flex items-center gap-4\"\u003e\r\n                    \u003cbutton onClick={() =\u003e router.push(\u0027/dashboard\u0027)} className=\"p-2 rounded-lg hover:bg-sentinel-card text-sentinel-text-muted hover:text-white transition-colors\"\u003e\r\n                        \u003cArrowLeft className=\"w-5 h-5\" /\u003e\r\n                    \u003c/button\u003e\r\n                    \u003cLock className=\"w-6 h-6 text-sentinel-accent\" /\u003e\r\n                    \u003ch1 className=\"text-xl font-bold text-white\"\u003ePrivacy \u0026 Transparency\u003c/h1\u003e\r\n                \u003c/div\u003e\r\n            \u003c/header\u003e\r\n\r\n            \u003cmain className=\"max-w-5xl mx-auto p-6 space-y-6\"\u003e\r\n                \u003cdiv className=\"mb-8\"\u003e\r\n                    \u003ch2 className=\"text-2xl font-bold text-white mb-2\"\u003eData Transparency Center\u003c/h2\u003e\r\n                    \u003cp className=\"text-sentinel-text-muted\"\u003eSee exactly who or what has accessed your behavioral data.\u003c/p\u003e\r\n                \u003c/div\u003e\r\n\r\n                \u003cdiv className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\"\u003e\r\n                    \u003cdiv className=\"glass-card p-6 flex items-start gap-4\"\u003e\r\n                        \u003cdiv className=\"p-3 rounded-xl bg-sentinel-accent/10\"\u003e\r\n                            \u003cDatabase className=\"w-6 h-6 text-sentinel-accent\" /\u003e\r\n                        \u003c/div\u003e\r\n                        \u003cdiv\u003e\r\n                            \u003ch3 className=\"text-white font-medium\"\u003eData Storage\u003c/h3\u003e\r\n                            \u003cp className=\"text-sm text-sentinel-text-muted mt-1\"\u003eData is encrypted at rest and in transit. Only retained for 30 days.\u003c/p\u003e\r\n                        \u003c/div\u003e\r\n                    \u003c/div\u003e\r\n                    \u003cdiv className=\"glass-card p-6 flex items-start gap-4\"\u003e\r\n                        \u003cdiv className=\"p-3 rounded-xl bg-green-500/10\"\u003e\r\n                            \u003cEye className=\"w-6 h-6 text-green-400\" /\u003e\r\n                        \u003c/div\u003e\r\n                        \u003cdiv\u003e\r\n                            \u003ch3 className=\"text-white font-medium\"\u003eAI Analysis\u003c/h3\u003e\r\n                            \u003cp className=\"text-sm text-sentinel-text-muted mt-1\"\u003eAI models operate on anonymized data features, not raw content.\u003c/p\u003e\r\n                        \u003c/div\u003e\r\n                    \u003c/div\u003e\r\n                    \u003cdiv className=\"glass-card p-6 flex items-start gap-4\"\u003e\r\n                        \u003cdiv className=\"p-3 rounded-xl bg-purple-500/10\"\u003e\r\n                            \u003cShieldAlert className=\"w-6 h-6 text-purple-400\" /\u003e\r\n                        \u003c/div\u003e\r\n                        \u003cdiv\u003e\r\n                            \u003ch3 className=\"text-white font-medium\"\u003eCampus IT Access\u003c/h3\u003e\r\n                            \u003cp className=\"text-sm text-sentinel-text-muted mt-1\"\u003eUniversity IT only receives alerts for Medium or High severity anomalies.\u003c/p\u003e\r\n                        \u003c/div\u003e\r\n                    \u003c/div\u003e\r\n                \u003c/div\u003e\r\n\r\n                \u003cdiv className=\"glass-card overflow-hidden\"\u003e\r\n                    \u003cdiv className=\"p-6 border-b border-sentinel-border bg-sentinel-card/30\"\u003e\r\n                        \u003ch3 className=\"text-lg font-bold text-white flex items-center gap-2\"\u003e\r\n                            \u003cLock className=\"w-5 h-5 text-sentinel-accent\" /\u003e Data Access Audit Log\r\n                        \u003c/h3\u003e\r\n                    \u003c/div\u003e\r\n\r\n                    {loading ? (\r\n                        \u003cdiv className=\"p-6 space-y-4\"\u003e\r\n                            {[1, 2, 3].map(i =\u003e \u003cdiv key={i} className=\"skeleton h-16 rounded-xl\" /\u003e)}\r\n                        \u003c/div\u003e\r\n                    ) : accessLogs.length === 0 ? (\r\n                        \u003cdiv className=\"p-12 text-center flex flex-col items-center\"\u003e\r\n                            \u003cCheckCircle className=\"w-12 h-12 text-sentinel-text-muted mb-4 opacity-30\" /\u003e\r\n                            \u003ch3 className=\"text-lg font-medium text-white mb-2\"\u003eNo auditable access yet\u003c/h3\u003e\r\n                            \u003cp className=\"text-sentinel-text-muted\"\u003eYour data has not been queried by external systems.\u003c/p\u003e\r\n                        \u003c/div\u003e\r\n                    ) : (\r\n                        \u003cdiv className=\"overflow-x-auto\"\u003e\r\n                            \u003ctable className=\"w-full text-left text-sm\"\u003e\r\n                                \u003cthead className=\"bg-sentinel-card/50 text-sentinel-text-muted border-b border-sentinel-border\"\u003e\r\n                                    \u003ctr\u003e\r\n                                        \u003cth className=\"p-4 font-medium\"\u003eTimestamp\u003c/th\u003e\r\n                                        \u003cth className=\"p-4 font-medium\"\u003eAccessed By\u003c/th\u003e\r\n                                        \u003cth className=\"p-4 font-medium\"\u003eReason\u003c/th\u003e\r\n                                        \u003cth className=\"p-4 font-medium\"\u003eData Scope\u003c/th\u003e\r\n                                    \u003c/tr\u003e\r\n                                \u003c/thead\u003e\r\n                                \u003ctbody\u003e\r\n                                    {accessLogs.map((log, i) =\u003e (\r\n                                        \u003cmotion.tr\r\n                                            key={log.id}\r\n                                            initial={{ opacity: 0 }}\r\n                                            animate={{ opacity: 1 }}\r\n                                            transition={{ delay: i * 0.05 }}\r\n                                            className=\"border-b border-sentinel-border/50 hover:bg-white/5 transition-colors\"\r\n                                        \u003e\r\n                                            \u003ctd className=\"p-4 text-sentinel-text whitespace-nowrap\"\u003e{new Date(log.timestamp).toLocaleString()}\u003c/td\u003e\r\n                                            \u003ctd className=\"p-4\"\u003e\r\n                                                \u003cspan className=\"px-2 py-1 rounded bg-white/5 border border-white/10 text-white font-mono text-xs\"\u003e\r\n                                                    {log.accessed_by}\r\n                                                \u003c/span\u003e\r\n                                            \u003c/td\u003e\r\n                                            \u003ctd className=\"p-4 text-sentinel-text\"\u003e{log.reason}\u003c/td\u003e\r\n                                            \u003ctd className=\"p-4\"\u003e\r\n                                                \u003cspan className=\"text-xs text-sentinel-accent-light bg-sentinel-accent/10 px-2 py-1 rounded-full border border-sentinel-accent/20\"\u003e\r\n                                                    {log.data_accessed}\r\n                                                \u003c/span\u003e\r\n                                            \u003c/td\u003e\r\n                                        \u003c/motion.tr\u003e\r\n                                    ))}\r\n                                \u003c/tbody\u003e\r\n                            \u003c/table\u003e\r\n                        \u003c/div\u003e\r\n                    )}\r\n                \u003c/div\u003e\r\n\r\n                \u003cdiv className=\"flex justify-end mt-4\"\u003e\r\n                    \u003cbutton className=\"text-xs text-sentinel-text-muted hover:text-red-400 transition-colors underline decoration-dotted underline-offset-4\"\u003e\r\n                        Request Complete Data Deletion\r\n                    \u003c/button\u003e\r\n                \u003c/div\u003e\r\n            \u003c/main\u003e\r\n        \u003c/div\u003e\r\n    );\r\n}\r\n","path":"frontend/src/app/dashboard/privacy/page.tsx"},{"content":"\"use client\";\r\nimport { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport {\r\n    Shield, ArrowLeft, BookOpen, CheckCircle, Clock, Award,\r\n    ChevronRight, Lock, Wifi, Mail, Eye, Fingerprint, Database,\r\n    AlertTriangle, Zap, Star\r\n} from \"lucide-react\";\r\nimport { studentAPI } from \"@/lib/api\";\r\n\r\n// Training quiz questions for each module\r\nconst QUIZZES: Record\u003cstring, { question: string; options: string[]; correct: number }[]\u003e = {\r\n    phishing: [\r\n        { question: \"What is the most common sign of a phishing email?\", options: [\"Personalized greeting\", \"Urgent action required\", \"Company letterhead\", \"Sent during work hours\"], correct: 1 },\r\n        { question: \"You receive an email from \u0027support@g00gle.com\u0027. What should you do?\", options: [\"Click the link to verify\", \"Reply asking for more info\", \"Report it as phishing\", \"Forward to a friend\"], correct: 2 },\r\n        { question: \"Which URL is most likely legitimate?\", options: [\"http://paypal.security-check.com\", \"https://www.paypal.com/login\", \"http://paypa1.com/account\", \"https://paypal.login-verify.net\"], correct: 1 },\r\n    ],\r\n    passwords: [\r\n        { question: \"Which is the strongest password?\", options: [\"Password123!\", \"MyDog\u0027sName\", \"j7$kL!9q#Bz2\", \"admin\"], correct: 2 },\r\n        { question: \"How often should you change your passwords?\", options: [\"Every day\", \"When you suspect a breach\", \"Never\", \"Every year regardless\"], correct: 1 },\r\n        { question: \"What is two-factor authentication?\", options: [\"Using two passwords\", \"A second verification step\", \"Having two accounts\", \"Encrypting data twice\"], correct: 1 },\r\n    ],\r\n    social_eng: [\r\n        { question: \"What is \u0027pretexting\u0027 in social engineering?\", options: [\"Texting before calling\", \"Creating a fabricated scenario\", \"Sending pre-written texts\", \"Using text encryption\"], correct: 1 },\r\n        { question: \"An attacker calls pretending to be IT support. What should you do?\", options: [\"Give them your password\", \"Hang up and call IT directly\", \"Ask a colleague\", \"Follow their instructions\"], correct: 1 },\r\n        { question: \"Which is a tailgating attack?\", options: [\"Following someone through a secure door\", \"Sending spam emails\", \"Hacking a server\", \"Phishing on social media\"], correct: 0 },\r\n    ],\r\n    wifi_safety: [\r\n        { question: \"What should you avoid on public Wi-Fi?\", options: [\"Reading news\", \"Online banking\", \"Checking weather\", \"Listening to music\"], correct: 1 },\r\n        { question: \"What tool helps secure public Wi-Fi usage?\", options: [\"Antivirus only\", \"A VPN\", \"A firewall only\", \"A stronger password\"], correct: 1 },\r\n        { question: \"How can you verify a Wi-Fi network is legitimate?\", options: [\"It has a strong signal\", \"Ask the establishment\", \"It\u0027s password-protected\", \"It has a common name\"], correct: 1 },\r\n    ],\r\n    app_permissions: [\r\n        { question: \"An alarm clock app asks for camera access. What should you do?\", options: [\"Allow it\", \"Deny it\", \"Install a different phone\", \"Ignore the prompt\"], correct: 1 },\r\n        { question: \"Which permission is most sensitive?\", options: [\"Vibration\", \"Internet access\", \"Location (always)\", \"Wi-Fi state\"], correct: 2 },\r\n        { question: \"How can you review app permissions on your phone?\", options: [\"You can\u0027t\", \"Through Settings \u003e Apps\", \"Only by reinstalling\", \"Contact support\"], correct: 1 },\r\n    ],\r\n    data_privacy: [\r\n        { question: \"What does GDPR stand for?\", options: [\"General Data Processing Rule\", \"General Data Protection Regulation\", \"Global Data Privacy Regulation\", \"General Digital Privacy Right\"], correct: 1 },\r\n        { question: \"What is \u0027data minimization\u0027?\", options: [\"Deleting all data\", \"Collecting only necessary data\", \"Compressing data\", \"Encrypting data\"], correct: 1 },\r\n        { question: \"Who is responsible for your online data privacy?\", options: [\"Only the company\", \"Only the government\", \"Primarily you\", \"Nobody\"], correct: 2 },\r\n    ],\r\n};\r\n\r\nconst ICONS: Record\u003cstring, any\u003e = {\r\n    phishing: Mail,\r\n    passwords: Lock,\r\n    social_eng: Eye,\r\n    wifi_safety: Wifi,\r\n    app_permissions: Fingerprint,\r\n    data_privacy: Database,\r\n};\r\n\r\nconst DIFFICULTY_COLORS: Record\u003cstring, string\u003e = {\r\n    beginner: \"bg-green-500/10 text-green-400 border-green-500/20\",\r\n    intermediate: \"bg-yellow-500/10 text-yellow-400 border-yellow-500/20\",\r\n    advanced: \"bg-red-500/10 text-red-400 border-red-500/20\",\r\n};\r\n\r\nexport default function TrainingPage() {\r\n    const router = useRouter();\r\n    const [training, setTraining] = useState\u003cany\u003e(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [activeQuiz, setActiveQuiz] = useState\u003cstring | null\u003e(null);\r\n    const [quizAnswers, setQuizAnswers] = useState\u003cRecord\u003cnumber, number\u003e\u003e({});\r\n    const [quizSubmitted, setQuizSubmitted] = useState(false);\r\n\r\n    useEffect(() =\u003e {\r\n        const stored = localStorage.getItem(\"sentinel_user\");\r\n        if (!stored) { router.push(\"/login\"); return; }\r\n        loadTraining();\r\n    }, []);\r\n\r\n    const loadTraining = async () =\u003e {\r\n        try {\r\n            const res = await studentAPI.trainingProgress();\r\n            setTraining(res.data);\r\n        } catch (err) {\r\n            console.error(\"Failed to load training\", err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleStartQuiz = (moduleId: string) =\u003e {\r\n        setActiveQuiz(moduleId);\r\n        setQuizAnswers({});\r\n        setQuizSubmitted(false);\r\n    };\r\n\r\n    const handleSelectAnswer = (qIndex: number, optIndex: number) =\u003e {\r\n        if (quizSubmitted) return;\r\n        setQuizAnswers(prev =\u003e ({ ...prev, [qIndex]: optIndex }));\r\n    };\r\n\r\n    const handleSubmitQuiz = () =\u003e {\r\n        setQuizSubmitted(true);\r\n    };\r\n\r\n    const getQuizScore = () =\u003e {\r\n        if (!activeQuiz) return 0;\r\n        const questions = QUIZZES[activeQuiz] || [];\r\n        let correct = 0;\r\n        questions.forEach((q, i) =\u003e {\r\n            if (quizAnswers[i] === q.correct) correct++;\r\n        });\r\n        return Math.round((correct / questions.length) * 100);\r\n    };\r\n\r\n    return (\r\n        \u003cdiv className=\"min-h-screen border-t-2 border-sentinel-accent\"\u003e\r\n            \u003cheader className=\"border-b border-sentinel-border px-6 py-4 bg-sentinel-card/30 backdrop-blur-md sticky top-0 z-40\"\u003e\r\n                \u003cdiv className=\"max-w-7xl mx-auto flex items-center gap-4\"\u003e\r\n                    \u003cbutton onClick={() =\u003e router.push(\u0027/dashboard\u0027)} className=\"p-2 rounded-lg hover:bg-sentinel-card text-sentinel-text-muted hover:text-white transition-colors\"\u003e\r\n                        \u003cArrowLeft className=\"w-5 h-5\" /\u003e\r\n                    \u003c/button\u003e\r\n                    \u003cShield className=\"w-6 h-6 text-sentinel-accent\" /\u003e\r\n                    \u003ch1 className=\"text-xl font-bold text-white\"\u003eSecurity Training Center\u003c/h1\u003e\r\n                \u003c/div\u003e\r\n            \u003c/header\u003e\r\n\r\n            \u003cmain className=\"max-w-6xl mx-auto p-6 space-y-6\"\u003e\r\n                {/* Stats Bar */}\r\n                {training \u0026\u0026 (\r\n                    \u003cmotion.div\r\n                        initial={{ opacity: 0, y: 10 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        className=\"glass-card p-5\"\r\n                    \u003e\r\n                        \u003cdiv className=\"flex items-center justify-between mb-3\"\u003e\r\n                            \u003cdiv className=\"flex items-center gap-3\"\u003e\r\n                                \u003cAward className=\"w-5 h-5 text-sentinel-accent\" /\u003e\r\n                                \u003cspan className=\"font-semibold text-white\"\u003eYour Progress\u003c/span\u003e\r\n                            \u003c/div\u003e\r\n                            \u003cspan className=\"text-sm text-sentinel-text-muted\"\u003e\r\n                                {training.completed_count}/{training.total_count} modules completed\r\n                            \u003c/span\u003e\r\n                        \u003c/div\u003e\r\n                        \u003cdiv className=\"h-3 rounded-full bg-sentinel-card overflow-hidden mb-2\"\u003e\r\n                            \u003cmotion.div\r\n                                initial={{ width: 0 }}\r\n                                animate={{ width: `${(training.completed_count / training.total_count) * 100}%` }}\r\n                                transition={{ duration: 1.2, ease: \"easeOut\" }}\r\n                                className=\"h-full rounded-full bg-gradient-to-r from-sentinel-accent via-sentinel-neon to-sentinel-neon-purple\"\r\n                            /\u003e\r\n                        \u003c/div\u003e\r\n                        \u003cdiv className=\"flex items-center justify-between text-xs text-sentinel-text-muted\"\u003e\r\n                            \u003cspan\u003eOverall Score: \u003cspan className={`font-bold ${training.overall_score \u003e= 70 ? \u0027text-green-400\u0027 : \u0027text-yellow-400\u0027}`}\u003e{training.overall_score}%\u003c/span\u003e\u003c/span\u003e\r\n                            \u003cspan className=\"flex items-center gap-1\"\u003e\u003cStar className=\"w-3 h-3 text-yellow-400\" /\u003e {training.completed_count * 50} XP Earned\u003c/span\u003e\r\n                        \u003c/div\u003e\r\n                    \u003c/motion.div\u003e\r\n                )}\r\n\r\n                {/* Quiz Modal */}\r\n                \u003cAnimatePresence\u003e\r\n                    {activeQuiz \u0026\u0026 (\r\n                        \u003cmotion.div\r\n                            initial={{ opacity: 0, y: 20 }}\r\n                            animate={{ opacity: 1, y: 0 }}\r\n                            exit={{ opacity: 0, y: -20 }}\r\n                            className=\"glass-card p-6 border-2 border-sentinel-accent/30\"\r\n                        \u003e\r\n                            \u003cdiv className=\"flex items-center justify-between mb-6\"\u003e\r\n                                \u003ch2 className=\"text-lg font-bold text-white flex items-center gap-2\"\u003e\r\n                                    \u003cZap className=\"w-5 h-5 text-sentinel-accent\" /\u003e\r\n                                    Quiz: {training?.modules.find((m: any) =\u003e m.id === activeQuiz)?.title}\r\n                                \u003c/h2\u003e\r\n                                \u003cbutton onClick={() =\u003e setActiveQuiz(null)} className=\"text-sentinel-text-muted hover:text-white text-sm\"\u003e\r\n                                    Close ✕\r\n                                \u003c/button\u003e\r\n                            \u003c/div\u003e\r\n\r\n                            \u003cdiv className=\"space-y-6\"\u003e\r\n                                {(QUIZZES[activeQuiz] || []).map((q, qIdx) =\u003e (\r\n                                    \u003cdiv key={qIdx} className=\"space-y-3\"\u003e\r\n                                        \u003cp className=\"text-sm font-medium text-white\"\u003e\r\n                                            \u003cspan className=\"text-sentinel-accent mr-2\"\u003eQ{qIdx + 1}.\u003c/span\u003e\r\n                                            {q.question}\r\n                                        \u003c/p\u003e\r\n                                        \u003cdiv className=\"grid grid-cols-1 sm:grid-cols-2 gap-2\"\u003e\r\n                                            {q.options.map((opt, optIdx) =\u003e {\r\n                                                let style = \"bg-sentinel-card/50 border-sentinel-border text-sentinel-text hover:bg-white/5\";\r\n                                                if (quizAnswers[qIdx] === optIdx \u0026\u0026 !quizSubmitted) {\r\n                                                    style = \"bg-sentinel-accent/15 border-sentinel-accent/40 text-white\";\r\n                                                }\r\n                                                if (quizSubmitted) {\r\n                                                    if (optIdx === q.correct) {\r\n                                                        style = \"bg-green-500/15 border-green-500/40 text-green-400\";\r\n                                                    } else if (quizAnswers[qIdx] === optIdx \u0026\u0026 optIdx !== q.correct) {\r\n                                                        style = \"bg-red-500/15 border-red-500/40 text-red-400\";\r\n                                                    }\r\n                                                }\r\n                                                return (\r\n                                                    \u003cbutton\r\n                                                        key={optIdx}\r\n                                                        onClick={() =\u003e handleSelectAnswer(qIdx, optIdx)}\r\n                                                        className={`p-3 rounded-lg border text-sm text-left transition-all ${style}`}\r\n                                                    \u003e\r\n                                                        {opt}\r\n                                                    \u003c/button\u003e\r\n                                                );\r\n                                            })}\r\n                                        \u003c/div\u003e\r\n                                    \u003c/div\u003e\r\n                                ))}\r\n                            \u003c/div\u003e\r\n\r\n                            \u003cdiv className=\"mt-6 flex items-center justify-between\"\u003e\r\n                                {!quizSubmitted ? (\r\n                                    \u003cbutton\r\n                                        onClick={handleSubmitQuiz}\r\n                                        disabled={Object.keys(quizAnswers).length \u003c (QUIZZES[activeQuiz]?.length || 0)}\r\n                                        className=\"btn-neon !py-2.5 !px-6 disabled:opacity-30\"\r\n                                    \u003e\r\n                                        Submit Answers\r\n                                    \u003c/button\u003e\r\n                                ) : (\r\n                                    \u003cdiv className=\"flex items-center gap-4\"\u003e\r\n                                        \u003cdiv className={`px-4 py-2 rounded-lg font-bold text-lg ${getQuizScore() \u003e= 70 ? \u0027bg-green-500/10 text-green-400 border border-green-500/20\u0027 : \u0027bg-red-500/10 text-red-400 border border-red-500/20\u0027}`}\u003e\r\n                                            Score: {getQuizScore()}%\r\n                                        \u003c/div\u003e\r\n                                        \u003cp className=\"text-sm text-sentinel-text-muted\"\u003e\r\n                                            {getQuizScore() \u003e= 70 ? \"Great job! 🎉\" : \"Review the material and try again.\"}\r\n                                        \u003c/p\u003e\r\n                                    \u003c/div\u003e\r\n                                )}\r\n                                \u003cbutton\r\n                                    onClick={() =\u003e setActiveQuiz(null)}\r\n                                    className=\"text-sm text-sentinel-text-muted hover:text-white transition-colors\"\r\n                                \u003e\r\n                                    {quizSubmitted ? \u0027Done\u0027 : \u0027Skip\u0027}\r\n                                \u003c/button\u003e\r\n                            \u003c/div\u003e\r\n                        \u003c/motion.div\u003e\r\n                    )}\r\n                \u003c/AnimatePresence\u003e\r\n\r\n                {/* Module Grid */}\r\n                {loading ? (\r\n                    \u003cdiv className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\"\u003e\r\n                        {[1, 2, 3, 4, 5, 6].map(i =\u003e \u003cdiv key={i} className=\"skeleton h-56 rounded-xl\" /\u003e)}\r\n                    \u003c/div\u003e\r\n                ) : training ? (\r\n                    \u003cdiv className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\"\u003e\r\n                        {training.modules.map((mod: any, i: number) =\u003e {\r\n                            const Icon = ICONS[mod.id] || BookOpen;\r\n                            return (\r\n                                \u003cmotion.div\r\n                                    key={mod.id}\r\n                                    initial={{ opacity: 0, y: 20 }}\r\n                                    animate={{ opacity: 1, y: 0 }}\r\n                                    transition={{ delay: i * 0.08 }}\r\n                                    className={`glass-card p-6 relative overflow-hidden group cursor-pointer hover:border-sentinel-accent/30 transition-all ${mod.completed ? \u0027border-green-500/20\u0027 : \u0027\u0027}`}\r\n                                    onClick={() =\u003e !activeQuiz \u0026\u0026 handleStartQuiz(mod.id)}\r\n                                \u003e\r\n                                    {mod.completed \u0026\u0026 (\r\n                                        \u003cdiv className=\"absolute top-3 right-3\"\u003e\r\n                                            \u003cCheckCircle className=\"w-5 h-5 text-green-400\" /\u003e\r\n                                        \u003c/div\u003e\r\n                                    )}\r\n\r\n                                    \u003cdiv className={`w-12 h-12 rounded-xl flex items-center justify-center mb-4 ${mod.completed ? \u0027bg-green-500/10\u0027 : \u0027bg-sentinel-accent/10\u0027}`}\u003e\r\n                                        \u003cIcon className={`w-6 h-6 ${mod.completed ? \u0027text-green-400\u0027 : \u0027text-sentinel-accent-light\u0027}`} /\u003e\r\n                                    \u003c/div\u003e\r\n\r\n                                    \u003ch3 className=\"text-base font-semibold text-white mb-2\"\u003e{mod.title}\u003c/h3\u003e\r\n                                    \u003cp className=\"text-xs text-sentinel-text-muted mb-4 line-clamp-2\"\u003e{mod.description}\u003c/p\u003e\r\n\r\n                                    \u003cdiv className=\"flex items-center justify-between\"\u003e\r\n                                        \u003cdiv className=\"flex items-center gap-2\"\u003e\r\n                                            \u003cspan className={`text-xs px-2 py-0.5 rounded-full border capitalize ${DIFFICULTY_COLORS[mod.difficulty] || \u0027\u0027}`}\u003e\r\n                                                {mod.difficulty}\r\n                                            \u003c/span\u003e\r\n                                            \u003cspan className=\"text-xs text-sentinel-text-muted flex items-center gap-1\"\u003e\r\n                                                \u003cClock className=\"w-3 h-3\" /\u003e {mod.duration_minutes}m\r\n                                            \u003c/span\u003e\r\n                                        \u003c/div\u003e\r\n                                        {mod.completed ? (\r\n                                            \u003cspan className=\"text-sm font-bold text-green-400\"\u003e{mod.score}%\u003c/span\u003e\r\n                                        ) : (\r\n                                            \u003cspan className=\"text-xs text-sentinel-accent flex items-center gap-1 group-hover:translate-x-1 transition-transform\"\u003e\r\n                                                Start \u003cChevronRight className=\"w-3 h-3\" /\u003e\r\n                                            \u003c/span\u003e\r\n                                        )}\r\n                                    \u003c/div\u003e\r\n\r\n                                    {/* Hover gradient */}\r\n                                    \u003cdiv className=\"absolute inset-0 bg-gradient-to-t from-sentinel-accent/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none\" /\u003e\r\n                                \u003c/motion.div\u003e\r\n                            );\r\n                        })}\r\n                    \u003c/div\u003e\r\n                ) : null}\r\n            \u003c/main\u003e\r\n        \u003c/div\u003e\r\n    );\r\n}\r\n","path":"frontend/src/app/dashboard/training/page.tsx"},{"content":"\"use client\";\r\n\r\nimport { useState, useEffect, useCallback, useRef } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport {\r\n    Shield, Activity, Bell, TrendingUp, Award, LogOut,\r\n    AlertTriangle, CheckCircle, XCircle, Wifi, Smartphone,\r\n    Lock, Unlock, Eye, ShieldAlert, Zap, Star, Trophy, ChevronDown,\r\n    BookOpen, Target, Radar, PieChart as PieChartIcon, Brain, Timer,\r\n    Fingerprint, BarChart3\r\n} from \"lucide-react\";\r\nimport { logsAPI, studentAPI, createWebSocket, anomaliesAPI, devicesAPI, incidentsAPI, privacyAPI } from \"@/lib/api\";\r\nimport {\r\n    LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip,\r\n    ResponsiveContainer, AreaChart, Area, PieChart, Pie, Cell,\r\n    RadarChart, Radar as RechartsRadar, PolarGrid, PolarAngleAxis,\r\n    PolarRadiusAxis, BarChart, Bar, Legend\r\n} from \"recharts\";\r\nimport { AlertModal } from \"./components/AlertModal\";\r\n\r\n// ──── Risk Gauge Component ────\r\nfunction RiskGauge({ score, level }: { score: number; level: string }) {\r\n    const radius = 80;\r\n    const circumference = 2 * Math.PI * radius;\r\n    const progress = (score / 100) * circumference * 0.75;\r\n    const color = score \u003c= 40 ? \"#10b981\" : score \u003c= 70 ? \"#f59e0b\" : \"#ef4444\";\r\n\r\n    return (\r\n        \u003cdiv className=\"flex flex-col items-center\"\u003e\r\n            \u003csvg width=\"200\" height=\"180\" viewBox=\"0 0 200 200\"\u003e\r\n                \u003ccircle\r\n                    cx=\"100\" cy=\"100\" r={radius}\r\n                    fill=\"none\" stroke=\"rgba(255,255,255,0.05)\" strokeWidth=\"12\"\r\n                    strokeDasharray={`${circumference * 0.75} ${circumference * 0.25}`}\r\n                    strokeLinecap=\"round\"\r\n                    transform=\"rotate(135 100 100)\"\r\n                /\u003e\r\n                \u003cmotion.circle\r\n                    cx=\"100\" cy=\"100\" r={radius}\r\n                    fill=\"none\" stroke={color} strokeWidth=\"12\"\r\n                    strokeDasharray={`${progress} ${circumference - progress}`}\r\n                    strokeLinecap=\"round\"\r\n                    transform=\"rotate(135 100 100)\"\r\n                    initial={{ strokeDasharray: `0 ${circumference}` }}\r\n                    animate={{ strokeDasharray: `${progress} ${circumference - progress}` }}\r\n                    transition={{ duration: 1.5, ease: \"easeOut\" }}\r\n                    style={{ filter: `drop-shadow(0 0 8px ${color}40)` }}\r\n                /\u003e\r\n                \u003ctext x=\"100\" y=\"95\" textAnchor=\"middle\" fill=\"white\" fontSize=\"36\" fontWeight=\"bold\"\u003e\r\n                    {Math.round(score)}\r\n                \u003c/text\u003e\r\n                \u003ctext x=\"100\" y=\"120\" textAnchor=\"middle\" fill=\"#94a3b8\" fontSize=\"12\"\u003e\r\n                    Risk Score\r\n                \u003c/text\u003e\r\n            \u003c/svg\u003e\r\n            \u003cspan\r\n                className=\"px-4 py-1 rounded-full text-sm font-semibold capitalize mt-1\"\r\n                style={{\r\n                    background: `${color}15`,\r\n                    color: color,\r\n                    border: `1px solid ${color}30`,\r\n                }}\r\n            \u003e\r\n                {level} Risk\r\n            \u003c/span\u003e\r\n        \u003c/div\u003e\r\n    );\r\n}\r\n\r\n// ──── Alert Card Component ────\r\nfunction AlertCard({ alert, onResolve, onBlock, onView }: { alert: any; onResolve: (id: number) =\u003e void; onBlock: (app: string) =\u003e void; onView: (alert: any) =\u003e void }) {\r\n    const severityColors: Record\u003cstring, string\u003e = {\r\n        critical: \"border-red-500/30 bg-red-500/5 text-red-400\",\r\n        high: \"border-orange-500/30 bg-orange-500/5 text-orange-400\",\r\n        medium: \"border-yellow-500/30 bg-yellow-500/5 text-yellow-400\",\r\n        low: \"border-green-500/30 bg-green-500/5 text-green-400\",\r\n    };\r\n\r\n    return (\r\n        \u003cmotion.div\r\n            initial={{ opacity: 0, x: 20 }}\r\n            animate={{ opacity: 1, x: 0 }}\r\n            exit={{ opacity: 0, x: -20 }}\r\n            className={`p-4 rounded-xl border ${severityColors[alert.severity] || severityColors.medium}`}\r\n        \u003e\r\n            \u003cdiv className=\"flex items-start justify-between mb-2\"\u003e\r\n                \u003cdiv className=\"flex items-center gap-2\"\u003e\r\n                    \u003cAlertTriangle className=\"w-4 h-4\" /\u003e\r\n                    \u003cspan className=\"text-xs px-2 py-0.5 rounded-full bg-black/20 capitalize font-medium\"\u003e\r\n                        {alert.severity}\r\n                    \u003c/span\u003e\r\n                \u003c/div\u003e\r\n                \u003cspan className=\"text-xs opacity-70\"\u003e\r\n                    {new Date(alert.created_at).toLocaleTimeString()}\r\n                \u003c/span\u003e\r\n            \u003c/div\u003e\r\n            \u003cp className=\"text-sm mb-3 opacity-90\"\u003e{alert.message}\u003c/p\u003e\r\n            {!alert.resolved \u0026\u0026 (\r\n                \u003cdiv className=\"flex gap-2\"\u003e\r\n                    \u003cbutton onClick={() =\u003e onView(alert)} className=\"text-xs px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/20 transition-colors flex items-center gap-1\"\u003e\r\n                        \u003cEye className=\"w-3 h-3\" /\u003e View Context\r\n                    \u003c/button\u003e\r\n                    \u003cbutton onClick={() =\u003e onResolve(alert.id)} className=\"text-xs px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/20 transition-colors\"\u003e\r\n                        Dismiss\r\n                    \u003c/button\u003e\r\n                \u003c/div\u003e\r\n            )}\r\n            {alert.resolved \u0026\u0026 (\r\n                \u003cspan className=\"text-xs opacity-70 flex items-center gap-1\"\u003e\r\n                    \u003cCheckCircle className=\"w-3 h-3\" /\u003e Resolved\r\n                \u003c/span\u003e\r\n            )}\r\n        \u003c/motion.div\u003e\r\n    );\r\n}\r\n\r\nconst PERM_COLORS = [\"#6366f1\", \"#8b5cf6\", \"#ec4899\", \"#f59e0b\", \"#10b981\", \"#06b6d4\"];\r\n\r\n// ──── Main Dashboard ────\r\nexport default function DashboardPage() {\r\n    const router = useRouter();\r\n    const [user, setUser] = useState\u003cany\u003e(null);\r\n    const [riskScore, setRiskScore] = useState({ current_score: 0, risk_level: \"low\", last_updated: null });\r\n    const [alerts, setAlerts] = useState\u003cany[]\u003e([]);\r\n    const [logs, setLogs] = useState\u003cany[]\u003e([]);\r\n    const [timeline, setTimeline] = useState\u003cany[]\u003e([]);\r\n    const [devices, setDevices] = useState\u003cany[]\u003e([]);\r\n    const [activeDevice, setActiveDevice] = useState\u003cany\u003e(null);\r\n    const [selectedAlert, setSelectedAlert] = useState\u003cany\u003e(null);\r\n    const [isAlertModalOpen, setIsAlertModalOpen] = useState(false);\r\n    const [loading, setLoading] = useState(true);\r\n    const [wsAlerts, setWsAlerts] = useState\u003cany[]\u003e([]);\r\n    const wsRef = useRef\u003cWebSocket | null\u003e(null);\r\n\r\n    // New state for added features\r\n    const [wellbeing, setWellbeing] = useState\u003cany\u003e(null);\r\n    const [permissions, setPermissions] = useState\u003cany\u003e(null);\r\n    const [leaderboard, setLeaderboard] = useState\u003cany\u003e(null);\r\n    const [training, setTraining] = useState\u003cany\u003e(null);\r\n\r\n    useEffect(() =\u003e {\r\n        const stored = localStorage.getItem(\"sentinel_user\");\r\n        if (!stored) { router.push(\"/login\"); return; }\r\n\r\n        const u = JSON.parse(stored);\r\n        if (u.role === \"admin\") { router.push(\"/admin\"); return; }\r\n        if (!u.consent_given) { router.push(\"/consent\"); return; }\r\n\r\n        setUser(u);\r\n        loadData();\r\n        loadExtendedData();\r\n\r\n        // WebSocket\r\n        const ws = createWebSocket(u.id);\r\n        if (ws) {\r\n            wsRef.current = ws;\r\n            ws.onmessage = (evt) =\u003e {\r\n                try {\r\n                    const data = JSON.parse(evt.data);\r\n                    if (data.type === \"alert\") {\r\n                        setWsAlerts((prev) =\u003e [data, ...prev].slice(0, 5));\r\n                        loadData();\r\n                    }\r\n                } catch { }\r\n            };\r\n            ws.onclose = () =\u003e console.log(\"WS disconnected\");\r\n        }\r\n\r\n        const interval = setInterval(loadData, 15000);\r\n        return () =\u003e {\r\n            clearInterval(interval);\r\n            wsRef.current?.close();\r\n        };\r\n    }, []);\r\n\r\n    const loadData = async () =\u003e {\r\n        try {\r\n            const [scoreRes, alertsRes, logsRes, timeRes, devRes] = await Promise.all([\r\n                logsAPI.riskScore(),\r\n                logsAPI.alerts(),\r\n                logsAPI.recentLogs(),\r\n                anomaliesAPI.getTimeline().catch(() =\u003e ({ data: [] })),\r\n                devicesAPI.getAll().catch(() =\u003e ({ data: [] }))\r\n            ]);\r\n            setRiskScore(scoreRes.data);\r\n            setAlerts(alertsRes.data);\r\n            setLogs(logsRes.data);\r\n            setTimeline(timeRes.data);\r\n            setDevices(devRes.data);\r\n            if (devRes.data.length \u003e 0 \u0026\u0026 !activeDevice) {\r\n                setActiveDevice(devRes.data[0]);\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Failed to load data\", err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const loadExtendedData = async () =\u003e {\r\n        try {\r\n            const [wb, perm, lb, tr] = await Promise.all([\r\n                studentAPI.wellbeing().catch(() =\u003e ({ data: null })),\r\n                studentAPI.permissionAudit().catch(() =\u003e ({ data: null })),\r\n                studentAPI.leaderboard().catch(() =\u003e ({ data: null })),\r\n                studentAPI.trainingProgress().catch(() =\u003e ({ data: null })),\r\n            ]);\r\n            setWellbeing(wb.data);\r\n            setPermissions(perm.data);\r\n            setLeaderboard(lb.data);\r\n            setTraining(tr.data);\r\n        } catch (err) {\r\n            console.error(\"Failed to load extended data\", err);\r\n        }\r\n    };\r\n\r\n    const handleResolve = async (id: number) =\u003e {\r\n        try {\r\n            await studentAPI.resolveAlert(id);\r\n            setAlerts((prev) =\u003e prev.map((a) =\u003e (a.id === id ? { ...a, resolved: true } : a)));\r\n        } catch { }\r\n    };\r\n\r\n    const handleBlock = async (app: string) =\u003e {\r\n        try {\r\n            await studentAPI.blockApp(app);\r\n        } catch { }\r\n    };\r\n\r\n    const handleReportIncident = async (alertId: number) =\u003e {\r\n        try {\r\n            await incidentsAPI.report({\r\n                alert_id: alertId,\r\n                report_type: \"false_positive\",\r\n                description: \"User reported this alert as a false positive from dashboard.\"\r\n            });\r\n            setAlerts((prev) =\u003e prev.map((a) =\u003e (a.id === alertId ? { ...a, resolved: true } : a)));\r\n        } catch (err) {\r\n            console.error(err);\r\n        }\r\n    };\r\n\r\n    const handleViewAlert = async (alert: any) =\u003e {\r\n        try {\r\n            const expRes = await privacyAPI.getExplanation(alert.id);\r\n            setSelectedAlert({ ...alert, ...expRes.data });\r\n        } catch {\r\n            setSelectedAlert(alert);\r\n        }\r\n        setIsAlertModalOpen(true);\r\n    };\r\n\r\n    const handleLogout = () =\u003e {\r\n        localStorage.removeItem(\"sentinel_token\");\r\n        localStorage.removeItem(\"sentinel_user\");\r\n        router.push(\"/login\");\r\n    };\r\n\r\n    // Badges\r\n    const badges = [\r\n        { icon: Star, name: \"Zero Risk Champion\", desc: \"Maintained low risk for 7 days\", earned: riskScore.current_score \u003c= 40 },\r\n        { icon: Trophy, name: \"Threat Survivor\", desc: \"Successfully resolved 5+ alerts\", earned: alerts.filter((a) =\u003e a.resolved).length \u003e= 3 },\r\n        { icon: Shield, name: \"Security Aware\", desc: \"Completed consent flow\", earned: true },\r\n        { icon: Zap, name: \"Quick Responder\", desc: \"Resolved alert within 1 minute\", earned: alerts.some((a) =\u003e a.resolved) },\r\n    ];\r\n\r\n    // Radar chart data for leaderboard\r\n    const radarData = leaderboard ? [\r\n        { subject: \"Network\", user: leaderboard.categories.network, campus: leaderboard.campus_categories.network },\r\n        { subject: \"Permissions\", user: leaderboard.categories.permissions, campus: leaderboard.campus_categories.permissions },\r\n        { subject: \"Apps\", user: leaderboard.categories.apps, campus: leaderboard.campus_categories.apps },\r\n        { subject: \"Behavior\", user: leaderboard.categories.behavior, campus: leaderboard.campus_categories.behavior },\r\n    ] : [];\r\n\r\n    if (loading) {\r\n        return (\r\n            \u003cdiv className=\"min-h-screen p-6 max-w-7xl mx-auto\"\u003e\r\n                \u003cdiv className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\"\u003e\r\n                    {[...Array(6)].map((_, i) =\u003e (\r\n                        \u003cdiv key={i} className=\"skeleton h-48 rounded-xl\" /\u003e\r\n                    ))}\r\n                \u003c/div\u003e\r\n            \u003c/div\u003e\r\n        );\r\n    }\r\n\r\n    return (\r\n        \u003cdiv className=\"min-h-screen border-t-2 border-sentinel-accent\"\u003e\r\n            \u003cAlertModal\r\n                alert={selectedAlert}\r\n                isOpen={isAlertModalOpen}\r\n                onClose={() =\u003e setIsAlertModalOpen(false)}\r\n                onResolve={handleResolve}\r\n                onReport={handleReportIncident}\r\n            /\u003e\r\n\r\n            {/* Header */}\r\n            \u003cheader className=\"border-b border-sentinel-border px-6 py-4 bg-sentinel-card/30 backdrop-blur-md sticky top-0 z-40\"\u003e\r\n                \u003cdiv className=\"max-w-7xl mx-auto flex items-center justify-between\"\u003e\r\n                    \u003cdiv className=\"flex items-center gap-3\"\u003e\r\n                        \u003cShield className=\"w-7 h-7 text-sentinel-accent\" /\u003e\r\n                        \u003cspan className=\"text-lg font-bold bg-gradient-to-r from-sentinel-accent md:from-sentinel-accent md:to-sentinel-neon bg-clip-text text-transparent hidden sm:block\"\u003e\r\n                            SentinelAI\r\n                        \u003c/span\u003e\r\n\r\n                        {/* Device Switcher */}\r\n                        {devices.length \u003e 0 \u0026\u0026 (\r\n                            \u003cdiv className=\"ml-2 sm:ml-6 relative group\"\u003e\r\n                                \u003cbutton className=\"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-sentinel-card border border-sentinel-border hover:border-sentinel-text-muted transition-colors text-sm text-sentinel-text\"\u003e\r\n                                    \u003cSmartphone className=\"w-4 h-4 text-sentinel-accent-light\" /\u003e\r\n                                    {activeDevice?.device_name || \"Devices\"}\r\n                                    \u003cChevronDown className=\"w-3 h-3 text-sentinel-text-muted opacity-80\" /\u003e\r\n                                \u003c/button\u003e\r\n                                \u003cdiv className=\"absolute top-full left-0 mt-2 w-48 rounded-xl bg-sentinel-card border border-sentinel-border shadow-soft opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50\"\u003e\r\n                                    {devices.map(d =\u003e (\r\n                                        \u003cbutton\r\n                                            key={d.id}\r\n                                            onClick={() =\u003e setActiveDevice(d)}\r\n                                            className={`w-full text-left px-4 py-2 text-sm first:rounded-t-xl last:rounded-b-xl hover:bg-white/5 transition-colors flex items-center justify-between ${activeDevice?.id === d.id ? \u0027text-sentinel-accent bg-sentinel-accent/5\u0027 : \u0027text-sentinel-text\u0027}`}\r\n                                        \u003e\r\n                                            {d.device_name}\r\n                                            {activeDevice?.id === d.id \u0026\u0026 \u003cCheckCircle className=\"w-3 h-3\" /\u003e}\r\n                                        \u003c/button\u003e\r\n                                    ))}\r\n                                \u003c/div\u003e\r\n                            \u003c/div\u003e\r\n                        )}\r\n                    \u003c/div\u003e\r\n\r\n                    {/* Right Utils */}\r\n                    \u003cdiv className=\"flex items-center gap-4\"\u003e\r\n                        \u003cnav className=\"hidden md:flex gap-4 mr-4\"\u003e\r\n                            \u003cbutton onClick={() =\u003e router.push(\u0027/dashboard/training\u0027)} className=\"text-sm font-medium text-sentinel-text-muted hover:text-white transition-colors flex items-center gap-1\"\u003e\u003cBookOpen className=\"w-3 h-3\" /\u003e Training\u003c/button\u003e\r\n                            \u003cbutton onClick={() =\u003e router.push(\u0027/dashboard/incidents\u0027)} className=\"text-sm font-medium text-sentinel-text-muted hover:text-white transition-colors\"\u003eIncidents\u003c/button\u003e\r\n                            \u003cbutton onClick={() =\u003e router.push(\u0027/dashboard/privacy\u0027)} className=\"text-sm font-medium text-sentinel-text-muted hover:text-white transition-colors flex items-center gap-1\"\u003e\u003cLock className=\"w-3 h-3\" /\u003e Privacy\u003c/button\u003e\r\n                        \u003c/nav\u003e\r\n                        \u003cspan className=\"text-sm text-sentinel-text-muted hidden sm:block border-l border-sentinel-border pl-4 flex items-center gap-2\"\u003e\r\n                            \u003cspan\u003eWelcome, \u003cspan className=\"text-white font-medium\"\u003e{user?.name}\u003c/span\u003e\u003c/span\u003e\r\n                        \u003c/span\u003e\r\n                        \u003cbutton\r\n                            onClick={handleLogout}\r\n                            className=\"p-2 rounded-lg hover:bg-sentinel-card text-sentinel-text-muted hover:text-white transition-colors\"\r\n                        \u003e\r\n                            \u003cLogOut className=\"w-5 h-5\" /\u003e\r\n                        \u003c/button\u003e\r\n                    \u003c/div\u003e\r\n                \u003c/div\u003e\r\n            \u003c/header\u003e\r\n\r\n            {/* WebSocket Alert Toast */}\r\n            \u003cAnimatePresence\u003e\r\n                {wsAlerts.map((wa, i) =\u003e (\r\n                    \u003cmotion.div\r\n                        key={`ws-${i}`}\r\n                        initial={{ opacity: 0, y: -50, x: 50 }}\r\n                        animate={{ opacity: 1, y: 0, x: 0 }}\r\n                        exit={{ opacity: 0, x: 100 }}\r\n                        className=\"fixed top-4 right-4 z-50 glass-card p-4 border-l-4 border-red-500 max-w-sm\"\r\n                    \u003e\r\n                        \u003cdiv className=\"flex items-center gap-2 mb-1\"\u003e\r\n                            \u003cShieldAlert className=\"w-4 h-4 text-red-400\" /\u003e\r\n                            \u003cspan className=\"text-sm font-semibold text-red-400\"\u003eReal-Time Alert\u003c/span\u003e\r\n                        \u003c/div\u003e\r\n                        \u003cp className=\"text-xs text-sentinel-text-muted\"\u003e{wa.message}\u003c/p\u003e\r\n                    \u003c/motion.div\u003e\r\n                ))}\r\n            \u003c/AnimatePresence\u003e\r\n\r\n            \u003cmain className=\"max-w-7xl mx-auto p-6 space-y-6\"\u003e\r\n                {/* Top Row: Risk Score + Stats + Heatmap */}\r\n                \u003cdiv className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\"\u003e\r\n                    {/* Risk Score Card */}\r\n                    \u003cmotion.div\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        className=\"glass-card p-6 flex flex-col items-center\"\r\n                    \u003e\r\n                        \u003ch3 className=\"text-sm font-medium text-sentinel-text-muted mb-4 flex items-center gap-2 w-full\"\u003e\r\n                            \u003cActivity className=\"w-4 h-4 text-sentinel-accent\" /\u003e Current Risk Score\r\n                        \u003c/h3\u003e\r\n                        \u003cRiskGauge score={riskScore.current_score} level={riskScore.risk_level} /\u003e\r\n                        {riskScore.last_updated \u0026\u0026 (\r\n                            \u003cp className=\"text-xs text-sentinel-text-muted mt-3\"\u003e\r\n                                Updated {new Date(riskScore.last_updated).toLocaleTimeString()}\r\n                            \u003c/p\u003e\r\n                        )}\r\n                    \u003c/motion.div\u003e\r\n\r\n                    {/* Quick Stats */}\r\n                    \u003cmotion.div\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        transition={{ delay: 0.1 }}\r\n                        className=\"glass-card p-6\"\r\n                    \u003e\r\n                        \u003ch3 className=\"text-sm font-medium text-sentinel-text-muted mb-4 flex items-center gap-2\"\u003e\r\n                            \u003cBell className=\"w-4 h-4 text-sentinel-accent\" /\u003e Alert Summary\r\n                        \u003c/h3\u003e\r\n                        \u003cdiv className=\"grid grid-cols-2 gap-4\"\u003e\r\n                            \u003cdiv className=\"p-3 rounded-xl bg-red-500/5 border border-red-500/10\"\u003e\r\n                                \u003cp className=\"text-2xl font-bold text-red-400\"\u003e{alerts.filter((a) =\u003e !a.resolved).length}\u003c/p\u003e\r\n                                \u003cp className=\"text-xs text-sentinel-text-muted\"\u003eUnresolved\u003c/p\u003e\r\n                            \u003c/div\u003e\r\n                            \u003cdiv className=\"p-3 rounded-xl bg-green-500/5 border border-green-500/10\"\u003e\r\n                                \u003cp className=\"text-2xl font-bold text-green-400\"\u003e{alerts.filter((a) =\u003e a.resolved).length}\u003c/p\u003e\r\n                                \u003cp className=\"text-xs text-sentinel-text-muted\"\u003eResolved\u003c/p\u003e\r\n                            \u003c/div\u003e\r\n                            \u003cdiv className=\"p-3 rounded-xl bg-blue-500/5 border border-blue-500/10\"\u003e\r\n                                \u003cp className=\"text-2xl font-bold text-blue-400\"\u003e{logs.length}\u003c/p\u003e\r\n                                \u003cp className=\"text-xs text-sentinel-text-muted\"\u003eRecent Logs\u003c/p\u003e\r\n                            \u003c/div\u003e\r\n                            \u003cdiv className=\"p-3 rounded-xl bg-purple-500/5 border border-purple-500/10\"\u003e\r\n                                \u003cp className=\"text-2xl font-bold text-purple-400\"\u003e{logs.filter((l) =\u003e l.anomaly_flag).length}\u003c/p\u003e\r\n                                \u003cp className=\"text-xs text-sentinel-text-muted\"\u003eAnomalies\u003c/p\u003e\r\n                            \u003c/div\u003e\r\n                        \u003c/div\u003e\r\n                    \u003c/motion.div\u003e\r\n\r\n                    {/* Weekly Trend */}\r\n                    \u003cmotion.div\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        transition={{ delay: 0.2 }}\r\n                        className=\"glass-card p-6 flex flex-col\"\r\n                    \u003e\r\n                        \u003ch3 className=\"text-sm font-medium text-sentinel-text-muted mb-4 flex items-center gap-2\"\u003e\r\n                            \u003cTrendingUp className=\"w-4 h-4 text-sentinel-accent\" /\u003e Risk Analytics Heatmap\r\n                        \u003c/h3\u003e\r\n                        \u003cdiv className=\"flex-1 w-full min-h-[150px]\"\u003e\r\n                            \u003cResponsiveContainer width=\"100%\" height=\"100%\"\u003e\r\n                                \u003cAreaChart data={timeline} margin={{ top: 5, right: 0, left: -20, bottom: 0 }}\u003e\r\n                                    \u003cdefs\u003e\r\n                                        \u003clinearGradient id=\"riskGrad\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\"\u003e\r\n                                            \u003cstop offset=\"5%\" stopColor=\"#6366f1\" stopOpacity={0.3} /\u003e\r\n                                            \u003cstop offset=\"95%\" stopColor=\"#6366f1\" stopOpacity={0} /\u003e\r\n                                        \u003c/linearGradient\u003e\r\n                                    \u003c/defs\u003e\r\n                                    \u003cCartesianGrid strokeDasharray=\"3 3\" stroke=\"#1e1e3a\" vertical={false} /\u003e\r\n                                    \u003cXAxis dataKey=\"timestamp\" tick={{ fill: \"#94a3b8\", fontSize: 11 }} axisLine={false} tickLine={false} /\u003e\r\n                                    \u003cYAxis tick={{ fill: \"#94a3b8\", fontSize: 11 }} axisLine={false} tickLine={false} domain={[0, 100]} /\u003e\r\n                                    \u003cTooltip contentStyle={{ background: \"#111128\", border: \"1px solid #1e1e3a\", borderRadius: 8 }} labelStyle={{ color: \"#e2e8f0\" }} /\u003e\r\n                                    \u003cArea type=\"monotone\" dataKey=\"risk_score\" stroke=\"#6366f1\" fill=\"url(#riskGrad)\" strokeWidth={2} activeDot={{ r: 6, fill: \"#6366f1\", stroke: \"#111128\", strokeWidth: 2 }} /\u003e\r\n                                \u003c/AreaChart\u003e\r\n                            \u003c/ResponsiveContainer\u003e\r\n                        \u003c/div\u003e\r\n                    \u003c/motion.div\u003e\r\n                \u003c/div\u003e\r\n\r\n                {/* Row 2: Permission Audit + Digital Wellbeing */}\r\n                \u003cdiv className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\"\u003e\r\n                    {/* Permission Audit Donut */}\r\n                    \u003cmotion.div\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        transition={{ delay: 0.25 }}\r\n                        className=\"glass-card p-6\"\r\n                    \u003e\r\n                        \u003ch3 className=\"text-sm font-medium text-sentinel-text-muted mb-4 flex items-center gap-2\"\u003e\r\n                            \u003cFingerprint className=\"w-4 h-4 text-sentinel-accent\" /\u003e App Permission Audit\r\n                        \u003c/h3\u003e\r\n                        {permissions \u0026\u0026 permissions.breakdown.length \u003e 0 ? (\r\n                            \u003cdiv className=\"flex items-center gap-6\"\u003e\r\n                                \u003cdiv className=\"w-48 h-48 flex-shrink-0\"\u003e\r\n                                    \u003cResponsiveContainer width=\"100%\" height=\"100%\"\u003e\r\n                                        \u003cPieChart\u003e\r\n                                            \u003cPie\r\n                                                data={permissions.breakdown}\r\n                                                dataKey=\"count\"\r\n                                                nameKey=\"permission\"\r\n                                                cx=\"50%\"\r\n                                                cy=\"50%\"\r\n                                                innerRadius={45}\r\n                                                outerRadius={75}\r\n                                                paddingAngle={3}\r\n                                                strokeWidth={0}\r\n                                            \u003e\r\n                                                {permissions.breakdown.map((_: any, i: number) =\u003e (\r\n                                                    \u003cCell key={i} fill={PERM_COLORS[i % PERM_COLORS.length]} /\u003e\r\n                                                ))}\r\n                                            \u003c/Pie\u003e\r\n                                            \u003cTooltip contentStyle={{ background: \"#111128\", border: \"1px solid #1e1e3a\", borderRadius: 8 }} /\u003e\r\n                                        \u003c/PieChart\u003e\r\n                                    \u003c/ResponsiveContainer\u003e\r\n                                \u003c/div\u003e\r\n                                \u003cdiv className=\"flex-1 space-y-2\"\u003e\r\n                                    {permissions.breakdown.map((p: any, i: number) =\u003e (\r\n                                        \u003cdiv key={p.permission} className=\"flex items-center justify-between\"\u003e\r\n                                            \u003cdiv className=\"flex items-center gap-2\"\u003e\r\n                                                \u003cdiv className=\"w-3 h-3 rounded-full\" style={{ background: PERM_COLORS[i % PERM_COLORS.length] }} /\u003e\r\n                                                \u003cspan className=\"text-sm text-sentinel-text capitalize\"\u003e{p.permission}\u003c/span\u003e\r\n                                            \u003c/div\u003e\r\n                                            \u003cspan className=\"text-sm font-mono text-sentinel-text-muted\"\u003e{p.percentage}%\u003c/span\u003e\r\n                                        \u003c/div\u003e\r\n                                    ))}\r\n                                    {permissions.risky_apps.length \u003e 0 \u0026\u0026 (\r\n                                        \u003cdiv className=\"mt-3 pt-3 border-t border-sentinel-border\"\u003e\r\n                                            \u003cp className=\"text-xs text-red-400 mb-1 flex items-center gap-1\"\u003e\u003cAlertTriangle className=\"w-3 h-3\" /\u003e Risky Apps\u003c/p\u003e\r\n                                            \u003cdiv className=\"flex flex-wrap gap-1\"\u003e\r\n                                                {permissions.risky_apps.map((app: string) =\u003e (\r\n                                                    \u003cspan key={app} className=\"text-xs px-2 py-0.5 rounded-full bg-red-500/10 text-red-400 border border-red-500/20\"\u003e{app}\u003c/span\u003e\r\n                                                ))}\r\n                                            \u003c/div\u003e\r\n                                        \u003c/div\u003e\r\n                                    )}\r\n                                \u003c/div\u003e\r\n                            \u003c/div\u003e\r\n                        ) : (\r\n                            \u003cp className=\"text-sm text-sentinel-text-muted text-center py-8\"\u003eNo permission data yet.\u003c/p\u003e\r\n                        )}\r\n                    \u003c/motion.div\u003e\r\n\r\n                    {/* Digital Wellbeing */}\r\n                    \u003cmotion.div\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        transition={{ delay: 0.3 }}\r\n                        className=\"glass-card p-6\"\r\n                    \u003e\r\n                        \u003ch3 className=\"text-sm font-medium text-sentinel-text-muted mb-4 flex items-center gap-2\"\u003e\r\n                            \u003cBrain className=\"w-4 h-4 text-sentinel-accent\" /\u003e Digital Wellbeing\r\n                        \u003c/h3\u003e\r\n                        {wellbeing ? (\r\n                            \u003cdiv\u003e\r\n                                \u003cdiv className=\"grid grid-cols-3 gap-3 mb-4\"\u003e\r\n                                    \u003cdiv className=\"p-3 rounded-xl bg-indigo-500/5 border border-indigo-500/10 text-center\"\u003e\r\n                                        \u003cTimer className=\"w-5 h-5 mx-auto mb-1 text-indigo-400\" /\u003e\r\n                                        \u003cp className=\"text-lg font-bold text-white\"\u003e{wellbeing.screen_time_hours}h\u003c/p\u003e\r\n                                        \u003cp className=\"text-xs text-sentinel-text-muted\"\u003eScreen Time\u003c/p\u003e\r\n                                    \u003c/div\u003e\r\n                                    \u003cdiv className=\"p-3 rounded-xl bg-green-500/5 border border-green-500/10 text-center\"\u003e\r\n                                        \u003cTarget className=\"w-5 h-5 mx-auto mb-1 text-green-400\" /\u003e\r\n                                        \u003cp className=\"text-lg font-bold text-white\"\u003e{wellbeing.focus_score}%\u003c/p\u003e\r\n                                        \u003cp className=\"text-xs text-sentinel-text-muted\"\u003eFocus Score\u003c/p\u003e\r\n                                    \u003c/div\u003e\r\n                                    \u003cdiv className=\"p-3 rounded-xl bg-purple-500/5 border border-purple-500/10 text-center\"\u003e\r\n                                        \u003cActivity className=\"w-5 h-5 mx-auto mb-1 text-purple-400\" /\u003e\r\n                                        \u003cp className=\"text-lg font-bold text-white\"\u003e{wellbeing.daily_sessions}\u003c/p\u003e\r\n                                        \u003cp className=\"text-xs text-sentinel-text-muted\"\u003eSessions\u003c/p\u003e\r\n                                    \u003c/div\u003e\r\n                                \u003c/div\u003e\r\n                                \u003cdiv className=\"h-[130px]\"\u003e\r\n                                    \u003cResponsiveContainer width=\"100%\" height=\"100%\"\u003e\r\n                                        \u003cBarChart data={wellbeing.top_apps.slice(0, 6)} margin={{ top: 0, right: 0, left: -20, bottom: 0 }}\u003e\r\n                                            \u003cCartesianGrid strokeDasharray=\"3 3\" stroke=\"#1e1e3a\" vertical={false} /\u003e\r\n                                            \u003cXAxis dataKey=\"app_name\" tick={{ fill: \"#94a3b8\", fontSize: 10 }} axisLine={false} tickLine={false} /\u003e\r\n                                            \u003cYAxis tick={{ fill: \"#94a3b8\", fontSize: 10 }} axisLine={false} tickLine={false} /\u003e\r\n                                            \u003cTooltip contentStyle={{ background: \"#111128\", border: \"1px solid #1e1e3a\", borderRadius: 8 }} /\u003e\r\n                                            \u003cBar dataKey=\"usage_minutes\" fill=\"#6366f1\" radius={[4, 4, 0, 0]} /\u003e\r\n                                        \u003c/BarChart\u003e\r\n                                    \u003c/ResponsiveContainer\u003e\r\n                                \u003c/div\u003e\r\n                            \u003c/div\u003e\r\n                        ) : (\r\n                            \u003cp className=\"text-sm text-sentinel-text-muted text-center py-8\"\u003eLoading wellbeing data...\u003c/p\u003e\r\n                        )}\r\n                    \u003c/motion.div\u003e\r\n                \u003c/div\u003e\r\n\r\n                {/* Row 3: Behavior Feed + Alerts */}\r\n                \u003cdiv className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\"\u003e\r\n                    {/* Live Behavior Feed */}\r\n                    \u003cmotion.div\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        transition={{ delay: 0.35 }}\r\n                        className=\"glass-card p-6\"\r\n                    \u003e\r\n                        \u003ch3 className=\"text-sm font-medium text-sentinel-text-muted mb-4 flex items-center gap-2\"\u003e\r\n                            \u003cSmartphone className=\"w-4 h-4 text-sentinel-accent\" /\u003e Live Behavior Feed\r\n                        \u003c/h3\u003e\r\n                        \u003cdiv className=\"space-y-2 max-h-[360px] overflow-y-auto pr-2 custom-scrollbar\"\u003e\r\n                            {logs.slice(0, 15).map((log: any, i: number) =\u003e (\r\n                                \u003cmotion.div\r\n                                    key={log.id || i}\r\n                                    initial={{ opacity: 0 }}\r\n                                    animate={{ opacity: 1 }}\r\n                                    transition={{ delay: i * 0.05 }}\r\n                                    className={`flex items-center justify-between p-3 rounded-lg ${log.anomaly_flag ? \"bg-red-500/5 border border-red-500/10\" : \"bg-sentinel-card/50\"\r\n                                        }`}\r\n                                \u003e\r\n                                    \u003cdiv className=\"flex items-center gap-3\"\u003e\r\n                                        \u003cdiv className={`w-2 h-2 rounded-full ${log.anomaly_flag ? \"bg-red-400 animate-pulse\" : \"bg-green-400\"}`} /\u003e\r\n                                        \u003cdiv\u003e\r\n                                            \u003cp className=\"text-sm font-medium text-white\"\u003e{log.app_name}\u003c/p\u003e\r\n                                            \u003cp className=\"text-xs text-sentinel-text-muted mt-0.5\"\u003e\r\n                                                {log.permission_requested !== \"none\" \u0026\u0026 (\r\n                                                    \u003cspan className=\"text-yellow-400/90 mr-2 inline-flex items-center\"\u003e\r\n                                                        \u003cLock className=\"w-3 h-3 mr-1\" /\u003e {log.permission_requested}\r\n                                                    \u003c/span\u003e\r\n                                                )}\r\n                                                \u003cspan className=\"text-sentinel-text-muted inline-flex items-center\"\u003e\r\n                                                    \u003cWifi className=\"w-3 h-3 mr-1\" /\u003e\r\n                                                    {log.network_activity_level}%\r\n                                                \u003c/span\u003e\r\n                                            \u003c/p\u003e\r\n                                        \u003c/div\u003e\r\n                                    \u003c/div\u003e\r\n                                    \u003cspan className=\"text-xs text-sentinel-text-muted font-mono\"\u003e\r\n                                        {new Date(log.timestamp).toLocaleTimeString()}\r\n                                    \u003c/span\u003e\r\n                                \u003c/motion.div\u003e\r\n                            ))}\r\n                            {logs.length === 0 \u0026\u0026 (\r\n                                \u003cp className=\"text-sm text-sentinel-text-muted text-center py-8\"\u003e\r\n                                    No behavior logs yet. Simulator will generate data shortly.\r\n                                \u003c/p\u003e\r\n                            )}\r\n                        \u003c/div\u003e\r\n                    \u003c/motion.div\u003e\r\n\r\n                    {/* Real-Time Alerts */}\r\n                    \u003cmotion.div\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        transition={{ delay: 0.4 }}\r\n                        className=\"glass-card p-6\"\r\n                    \u003e\r\n                        \u003ch3 className=\"text-sm font-medium text-sentinel-text-muted mb-4 flex items-center gap-2\"\u003e\r\n                            \u003cShieldAlert className=\"w-4 h-4 text-sentinel-accent\" /\u003e Security Alerts\r\n                        \u003c/h3\u003e\r\n                        \u003cdiv className=\"space-y-3 max-h-[360px] overflow-y-auto pr-2 custom-scrollbar\"\u003e\r\n                            \u003cAnimatePresence\u003e\r\n                                {alerts.slice(0, 10).map((alert) =\u003e (\r\n                                    \u003cAlertCard\r\n                                        key={alert.id}\r\n                                        alert={alert}\r\n                                        onResolve={handleResolve}\r\n                                        onBlock={handleBlock}\r\n                                        onView={handleViewAlert}\r\n                                    /\u003e\r\n                                ))}\r\n                            \u003c/AnimatePresence\u003e\r\n                            {alerts.length === 0 \u0026\u0026 (\r\n                                \u003cdiv className=\"text-center py-12\"\u003e\r\n                                    \u003cCheckCircle className=\"w-10 h-10 text-green-400/50 mx-auto mb-3\" /\u003e\r\n                                    \u003cp className=\"text-sm text-sentinel-text-muted\"\u003eNo alerts. Your device is secure!\u003c/p\u003e\r\n                                \u003c/div\u003e\r\n                            )}\r\n                        \u003c/div\u003e\r\n                    \u003c/motion.div\u003e\r\n                \u003c/div\u003e\r\n\r\n                {/* Row 4: Peer Leaderboard + Training Progress */}\r\n                \u003cdiv className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\"\u003e\r\n                    {/* Peer Leaderboard */}\r\n                    \u003cmotion.div\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        transition={{ delay: 0.45 }}\r\n                        className=\"glass-card p-6\"\r\n                    \u003e\r\n                        \u003ch3 className=\"text-sm font-medium text-sentinel-text-muted mb-4 flex items-center gap-2\"\u003e\r\n                            \u003cRadar className=\"w-4 h-4 text-sentinel-accent\" /\u003e Peer Security Comparison\r\n                        \u003c/h3\u003e\r\n                        {leaderboard ? (\r\n                            \u003cdiv className=\"flex items-start gap-4\"\u003e\r\n                                \u003cdiv className=\"flex-1 h-[200px]\"\u003e\r\n                                    \u003cResponsiveContainer width=\"100%\" height=\"100%\"\u003e\r\n                                        \u003cRadarChart data={radarData}\u003e\r\n                                            \u003cPolarGrid stroke=\"#1e1e3a\" /\u003e\r\n                                            \u003cPolarAngleAxis dataKey=\"subject\" tick={{ fill: \"#94a3b8\", fontSize: 11 }} /\u003e\r\n                                            \u003cPolarRadiusAxis angle={30} domain={[0, 100]} tick={false} axisLine={false} /\u003e\r\n                                            \u003cRechartsRadar name=\"You\" dataKey=\"user\" stroke=\"#6366f1\" fill=\"#6366f1\" fillOpacity={0.3} strokeWidth={2} /\u003e\r\n                                            \u003cRechartsRadar name=\"Campus Avg\" dataKey=\"campus\" stroke=\"#f59e0b\" fill=\"#f59e0b\" fillOpacity={0.1} strokeWidth={2} strokeDasharray=\"4 4\" /\u003e\r\n                                            \u003cLegend wrapperStyle={{ fontSize: 11 }} /\u003e\r\n                                        \u003c/RadarChart\u003e\r\n                                    \u003c/ResponsiveContainer\u003e\r\n                                \u003c/div\u003e\r\n                                \u003cdiv className=\"w-32 flex flex-col items-center gap-3\"\u003e\r\n                                    \u003cdiv className=\"w-20 h-20 rounded-full bg-gradient-to-br from-sentinel-accent to-sentinel-neon flex items-center justify-center\"\u003e\r\n                                        \u003cspan className=\"text-2xl font-bold text-white\"\u003e#{leaderboard.rank}\u003c/span\u003e\r\n                                    \u003c/div\u003e\r\n                                    \u003cp className=\"text-xs text-sentinel-text-muted text-center\"\u003e\r\n                                        of {leaderboard.total_students} students\r\n                                    \u003c/p\u003e\r\n                                    \u003cdiv className=\"w-full p-2 rounded-lg bg-indigo-500/10 border border-indigo-500/20 text-center\"\u003e\r\n                                        \u003cp className=\"text-lg font-bold text-indigo-400\"\u003e{leaderboard.percentile}%\u003c/p\u003e\r\n                                        \u003cp className=\"text-xs text-sentinel-text-muted\"\u003ePercentile\u003c/p\u003e\r\n                                    \u003c/div\u003e\r\n                                \u003c/div\u003e\r\n                            \u003c/div\u003e\r\n                        ) : (\r\n                            \u003cp className=\"text-sm text-sentinel-text-muted text-center py-8\"\u003eLoading leaderboard...\u003c/p\u003e\r\n                        )}\r\n                    \u003c/motion.div\u003e\r\n\r\n                    {/* Training Progress */}\r\n                    \u003cmotion.div\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        transition={{ delay: 0.5 }}\r\n                        className=\"glass-card p-6\"\r\n                    \u003e\r\n                        \u003cdiv className=\"flex items-center justify-between mb-4\"\u003e\r\n                            \u003ch3 className=\"text-sm font-medium text-sentinel-text-muted flex items-center gap-2\"\u003e\r\n                                \u003cBookOpen className=\"w-4 h-4 text-sentinel-accent\" /\u003e Security Training\r\n                            \u003c/h3\u003e\r\n                            \u003cbutton\r\n                                onClick={() =\u003e router.push(\u0027/dashboard/training\u0027)}\r\n                                className=\"text-xs text-sentinel-accent hover:text-sentinel-accent-light transition-colors\"\r\n                            \u003e\r\n                                View All →\r\n                            \u003c/button\u003e\r\n                        \u003c/div\u003e\r\n                        {training ? (\r\n                            \u003cdiv\u003e\r\n                                {/* Progress Bar */}\r\n                                \u003cdiv className=\"mb-4\"\u003e\r\n                                    \u003cdiv className=\"flex justify-between text-xs text-sentinel-text-muted mb-1\"\u003e\r\n                                        \u003cspan\u003e{training.completed_count}/{training.total_count} Completed\u003c/span\u003e\r\n                                        \u003cspan\u003eScore: {training.overall_score}%\u003c/span\u003e\r\n                                    \u003c/div\u003e\r\n                                    \u003cdiv className=\"h-2 rounded-full bg-sentinel-card overflow-hidden\"\u003e\r\n                                        \u003cmotion.div\r\n                                            initial={{ width: 0 }}\r\n                                            animate={{ width: `${(training.completed_count / training.total_count) * 100}%` }}\r\n                                            transition={{ duration: 1, ease: \"easeOut\" }}\r\n                                            className=\"h-full rounded-full bg-gradient-to-r from-sentinel-accent to-sentinel-neon\"\r\n                                        /\u003e\r\n                                    \u003c/div\u003e\r\n                                \u003c/div\u003e\r\n                                \u003cdiv className=\"space-y-2\"\u003e\r\n                                    {training.modules.slice(0, 4).map((mod: any) =\u003e (\r\n                                        \u003cdiv\r\n                                            key={mod.id}\r\n                                            className={`flex items-center justify-between p-3 rounded-lg ${mod.completed ? \u0027bg-green-500/5 border border-green-500/10\u0027 : \u0027bg-sentinel-card/50\u0027}`}\r\n                                        \u003e\r\n                                            \u003cdiv className=\"flex items-center gap-3\"\u003e\r\n                                                {mod.completed ? (\r\n                                                    \u003cCheckCircle className=\"w-4 h-4 text-green-400\" /\u003e\r\n                                                ) : (\r\n                                                    \u003cdiv className=\"w-4 h-4 rounded-full border-2 border-sentinel-border\" /\u003e\r\n                                                )}\r\n                                                \u003cdiv\u003e\r\n                                                    \u003cp className=\"text-sm font-medium text-white\"\u003e{mod.title}\u003c/p\u003e\r\n                                                    \u003cp className=\"text-xs text-sentinel-text-muted\"\u003e{mod.duration_minutes} min • {mod.difficulty}\u003c/p\u003e\r\n                                                \u003c/div\u003e\r\n                                            \u003c/div\u003e\r\n                                            {mod.completed \u0026\u0026 (\r\n                                                \u003cspan className=\"text-sm font-bold text-green-400\"\u003e{mod.score}%\u003c/span\u003e\r\n                                            )}\r\n                                        \u003c/div\u003e\r\n                                    ))}\r\n                                \u003c/div\u003e\r\n                            \u003c/div\u003e\r\n                        ) : (\r\n                            \u003cp className=\"text-sm text-sentinel-text-muted text-center py-8\"\u003eLoading training data...\u003c/p\u003e\r\n                        )}\r\n                    \u003c/motion.div\u003e\r\n                \u003c/div\u003e\r\n\r\n                {/* Bottom Row: Badges */}\r\n                \u003cmotion.div\r\n                    initial={{ opacity: 0, y: 20 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    transition={{ delay: 0.55 }}\r\n                    className=\"glass-card p-6\"\r\n                \u003e\r\n                    \u003ch3 className=\"text-sm font-medium text-sentinel-text-muted mb-4 flex items-center gap-2\"\u003e\r\n                        \u003cAward className=\"w-4 h-4 text-sentinel-accent\" /\u003e Security Badges\r\n                    \u003c/h3\u003e\r\n                    \u003cdiv className=\"grid grid-cols-2 md:grid-cols-4 gap-4\"\u003e\r\n                        {badges.map((badge, i) =\u003e (\r\n                            \u003cmotion.div\r\n                                key={i}\r\n                                whileHover={{ scale: 1.02 }}\r\n                                className={`p-4 rounded-xl text-center transition-all ${badge.earned\r\n                                    ? \"bg-sentinel-accent/10 border border-sentinel-accent/20\"\r\n                                    : \"bg-sentinel-card/50 border border-sentinel-border opacity-40\"\r\n                                    }`}\r\n                            \u003e\r\n                                \u003cbadge.icon className={`w-8 h-8 mx-auto mb-2 ${badge.earned ? \"text-sentinel-accent-light\" : \"text-sentinel-text-muted\"}`} /\u003e\r\n                                \u003cp className=\"text-sm font-semibold text-white\"\u003e{badge.name}\u003c/p\u003e\r\n                                \u003cp className=\"text-xs text-sentinel-text-muted mt-1\"\u003e{badge.desc}\u003c/p\u003e\r\n                                {badge.earned \u0026\u0026 (\r\n                                    \u003cspan className=\"inline-block mt-2 text-xs px-2 py-0.5 rounded-full bg-green-500/10 text-green-400 border border-green-500/20\"\u003e\r\n                                        Earned ✓\r\n                                    \u003c/span\u003e\r\n                                )}\r\n                            \u003c/motion.div\u003e\r\n                        ))}\r\n                    \u003c/div\u003e\r\n                \u003c/motion.div\u003e\r\n            \u003c/main\u003e\r\n        \u003c/div\u003e\r\n    );\r\n}\r\n","path":"frontend/src/app/dashboard/page.tsx"},{"content":"\"use client\";\r\nimport { useState } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport Link from \"next/link\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { Shield, Mail, Lock, Eye, EyeOff } from \"lucide-react\";\r\nimport { authAPI } from \"@/lib/api\";\r\n\r\nexport default function LoginPage() {\r\n    const router = useRouter();\r\n    const [email, setEmail] = useState(\"\");\r\n    const [password, setPassword] = useState(\"\");\r\n    const [showPass, setShowPass] = useState(false);\r\n    const [remember, setRemember] = useState(false);\r\n    const [error, setError] = useState(\"\");\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const handleLogin = async (e: React.FormEvent) =\u003e {\r\n        e.preventDefault();\r\n        setError(\"\");\r\n        setLoading(true);\r\n\r\n        try {\r\n            const res = await authAPI.login({ email, password });\r\n            const { access_token, user } = res.data;\r\n\r\n            localStorage.setItem(\"sentinel_token\", access_token);\r\n            localStorage.setItem(\"sentinel_user\", JSON.stringify(user));\r\n\r\n            if (user.role === \"admin\") {\r\n                router.push(\"/admin\");\r\n            } else if (!user.consent_given) {\r\n                router.push(\"/consent\");\r\n            } else {\r\n                router.push(\"/dashboard\");\r\n            }\r\n        } catch (err: any) {\r\n            setError(err.response?.data?.detail || \"Login failed. Please try again.\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        \u003cdiv className=\"min-h-screen flex items-center justify-center px-4 relative\"\u003e\r\n            \u003cdiv className=\"fixed inset-0 pointer-events-none\"\u003e\r\n                \u003cdiv className=\"absolute top-1/3 right-1/4 w-80 h-80 bg-sentinel-accent/8 rounded-full blur-3xl\" /\u003e\r\n                \u003cdiv className=\"absolute bottom-1/3 left-1/4 w-80 h-80 bg-sentinel-neon-purple/8 rounded-full blur-3xl\" /\u003e\r\n            \u003c/div\u003e\r\n\r\n            \u003cmotion.div\r\n                initial={{ opacity: 0, y: 20, scale: 0.95 }}\r\n                animate={{ opacity: 1, y: 0, scale: 1 }}\r\n                transition={{ duration: 0.5 }}\r\n                className=\"glass-card w-full max-w-md p-8 relative z-10\"\r\n            \u003e\r\n                \u003cdiv className=\"flex items-center justify-center gap-2 mb-8\"\u003e\r\n                    \u003cShield className=\"w-8 h-8 text-sentinel-accent\" /\u003e\r\n                    \u003cspan className=\"text-2xl font-bold bg-gradient-to-r from-sentinel-accent to-sentinel-neon bg-clip-text text-transparent\"\u003e\r\n                        SentinelAI\r\n                    \u003c/span\u003e\r\n                \u003c/div\u003e\r\n\r\n                \u003ch2 className=\"text-xl font-semibold text-center text-white mb-2\"\u003eWelcome Back\u003c/h2\u003e\r\n                \u003cp className=\"text-sm text-sentinel-text-muted text-center mb-8\"\u003eSign in to your security dashboard\u003c/p\u003e\r\n\r\n                {error \u0026\u0026 (\r\n                    \u003cmotion.div\r\n                        initial={{ opacity: 0, height: 0 }}\r\n                        animate={{ opacity: 1, height: \"auto\" }}\r\n                        className=\"bg-red-500/10 border border-red-500/20 rounded-lg p-3 mb-4\"\r\n                    \u003e\r\n                        \u003cp className=\"text-sm text-red-400\"\u003e{error}\u003c/p\u003e\r\n                    \u003c/motion.div\u003e\r\n                )}\r\n\r\n                \u003cform onSubmit={handleLogin} className=\"space-y-5\"\u003e\r\n                    \u003cdiv\u003e\r\n                        \u003clabel className=\"block text-sm font-medium text-sentinel-text-muted mb-2\"\u003eEmail\u003c/label\u003e\r\n                        \u003cdiv className=\"relative\"\u003e\r\n                            \u003cMail className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-sentinel-text-muted\" /\u003e\r\n                            \u003cinput\r\n                                type=\"email\"\r\n                                value={email}\r\n                                onChange={(e) =\u003e setEmail(e.target.value)}\r\n                                className=\"input-field !pl-10\"\r\n                                placeholder=\"you@university.edu\"\r\n                                required\r\n                            /\u003e\r\n                        \u003c/div\u003e\r\n                    \u003c/div\u003e\r\n\r\n                    \u003cdiv\u003e\r\n                        \u003clabel className=\"block text-sm font-medium text-sentinel-text-muted mb-2\"\u003ePassword\u003c/label\u003e\r\n                        \u003cdiv className=\"relative\"\u003e\r\n                            \u003cLock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-sentinel-text-muted\" /\u003e\r\n                            \u003cinput\r\n                                type={showPass ? \"text\" : \"password\"}\r\n                                value={password}\r\n                                onChange={(e) =\u003e setPassword(e.target.value)}\r\n                                className=\"input-field !pl-10 !pr-10\"\r\n                                placeholder=\"••••••••\"\r\n                                required\r\n                            /\u003e\r\n                            \u003cbutton\r\n                                type=\"button\"\r\n                                onClick={() =\u003e setShowPass(!showPass)}\r\n                                className=\"absolute right-3 top-1/2 -translate-y-1/2 text-sentinel-text-muted hover:text-white\"\r\n                            \u003e\r\n                                {showPass ? \u003cEyeOff className=\"w-4 h-4\" /\u003e : \u003cEye className=\"w-4 h-4\" /\u003e}\r\n                            \u003c/button\u003e\r\n                        \u003c/div\u003e\r\n                    \u003c/div\u003e\r\n\r\n                    \u003cdiv className=\"flex items-center justify-between\"\u003e\r\n                        \u003clabel className=\"flex items-center gap-2 cursor-pointer\"\u003e\r\n                            \u003cinput\r\n                                type=\"checkbox\"\r\n                                checked={remember}\r\n                                onChange={(e) =\u003e setRemember(e.target.checked)}\r\n                                className=\"w-4 h-4 rounded border-sentinel-border bg-sentinel-card accent-sentinel-accent\"\r\n                            /\u003e\r\n                            \u003cspan className=\"text-sm text-sentinel-text-muted\"\u003eRemember me\u003c/span\u003e\r\n                        \u003c/label\u003e\r\n                    \u003c/div\u003e\r\n\r\n                    \u003cmotion.button\r\n                        whileHover={{ scale: 1.02 }}\r\n                        whileTap={{ scale: 0.98 }}\r\n                        type=\"submit\"\r\n                        disabled={loading}\r\n                        className=\"btn-neon w-full !py-3 text-center disabled:opacity-50\"\r\n                    \u003e\r\n                        {loading ? \"Signing in...\" : \"Sign In\"}\r\n                    \u003c/motion.button\u003e\r\n                \u003c/form\u003e\r\n\r\n                \u003cp className=\"text-sm text-center text-sentinel-text-muted mt-6\"\u003e\r\n                    Don\u0026apos;t have an account?{\" \"}\r\n                    \u003cLink href=\"/register\" className=\"text-sentinel-accent hover:text-sentinel-accent-light transition-colors\"\u003e\r\n                        Create one\r\n                    \u003c/Link\u003e\r\n                \u003c/p\u003e\r\n\r\n                {/* Demo credentials */}\r\n                \u003cdiv className=\"mt-6 pt-6 border-t border-sentinel-border\"\u003e\r\n                    \u003cp className=\"text-xs text-sentinel-text-muted text-center mb-2\"\u003eDemo Credentials\u003c/p\u003e\r\n                    \u003cdiv className=\"grid grid-cols-2 gap-2 text-xs\"\u003e\r\n                        \u003cbutton\r\n                            onClick={() =\u003e { setEmail(\"admin@sentinelai.com\"); setPassword(\"admin123\"); }}\r\n                            className=\"p-2 rounded-lg bg-sentinel-accent/10 text-sentinel-accent-light hover:bg-sentinel-accent/20 transition-colors\"\r\n                        \u003e\r\n                            Admin Login\r\n                        \u003c/button\u003e\r\n                        \u003cbutton\r\n                            onClick={() =\u003e { setEmail(\"student1@university.edu\"); setPassword(\"student123\"); }}\r\n                            className=\"p-2 rounded-lg bg-sentinel-neon/10 text-sentinel-neon hover:bg-sentinel-neon/20 transition-colors\"\r\n                        \u003e\r\n                            Student Login\r\n                        \u003c/button\u003e\r\n                    \u003c/div\u003e\r\n                \u003c/div\u003e\r\n            \u003c/motion.div\u003e\r\n        \u003c/div\u003e\r\n    );\r\n}\r\n","path":"frontend/src/app/login/page.tsx"},{"content":"\"use client\";\r\nimport { useState } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport Link from \"next/link\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { Shield, User, Mail, Lock, GraduationCap, Eye, EyeOff } from \"lucide-react\";\r\nimport { authAPI } from \"@/lib/api\";\r\n\r\nexport default function RegisterPage() {\r\n    const router = useRouter();\r\n    const [form, setForm] = useState({ name: \"\", email: \"\", college: \"\", password: \"\", role: \"student\" });\r\n    const [showPass, setShowPass] = useState(false);\r\n    const [error, setError] = useState(\"\");\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const update = (key: string, val: string) =\u003e setForm((f) =\u003e ({ ...f, [key]: val }));\r\n\r\n    const handleRegister = async (e: React.FormEvent) =\u003e {\r\n        e.preventDefault();\r\n        setError(\"\");\r\n        setLoading(true);\r\n\r\n        try {\r\n            await authAPI.register(form);\r\n            router.push(\"/login\");\r\n        } catch (err: any) {\r\n            setError(err.response?.data?.detail || \"Registration failed.\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        \u003cdiv className=\"min-h-screen flex items-center justify-center px-4 py-12 relative\"\u003e\r\n            \u003cdiv className=\"fixed inset-0 pointer-events-none\"\u003e\r\n                \u003cdiv className=\"absolute top-1/4 left-1/3 w-80 h-80 bg-sentinel-accent/8 rounded-full blur-3xl\" /\u003e\r\n                \u003cdiv className=\"absolute bottom-1/4 right-1/3 w-80 h-80 bg-sentinel-neon-purple/8 rounded-full blur-3xl\" /\u003e\r\n            \u003c/div\u003e\r\n\r\n            \u003cmotion.div\r\n                initial={{ opacity: 0, y: 20, scale: 0.95 }}\r\n                animate={{ opacity: 1, y: 0, scale: 1 }}\r\n                transition={{ duration: 0.5 }}\r\n                className=\"glass-card w-full max-w-md p-8 relative z-10\"\r\n            \u003e\r\n                \u003cdiv className=\"flex items-center justify-center gap-2 mb-6\"\u003e\r\n                    \u003cShield className=\"w-8 h-8 text-sentinel-accent\" /\u003e\r\n                    \u003cspan className=\"text-2xl font-bold bg-gradient-to-r from-sentinel-accent to-sentinel-neon bg-clip-text text-transparent\"\u003e\r\n                        SentinelAI\r\n                    \u003c/span\u003e\r\n                \u003c/div\u003e\r\n\r\n                \u003ch2 className=\"text-xl font-semibold text-center text-white mb-2\"\u003eCreate Account\u003c/h2\u003e\r\n                \u003cp className=\"text-sm text-sentinel-text-muted text-center mb-6\"\u003eJoin the AI security platform\u003c/p\u003e\r\n\r\n                {error \u0026\u0026 (\r\n                    \u003cmotion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className=\"bg-red-500/10 border border-red-500/20 rounded-lg p-3 mb-4\"\u003e\r\n                        \u003cp className=\"text-sm text-red-400\"\u003e{error}\u003c/p\u003e\r\n                    \u003c/motion.div\u003e\r\n                )}\r\n\r\n                \u003cform onSubmit={handleRegister} className=\"space-y-4\"\u003e\r\n                    \u003cdiv\u003e\r\n                        \u003clabel className=\"block text-sm font-medium text-sentinel-text-muted mb-1.5\"\u003eFull Name\u003c/label\u003e\r\n                        \u003cdiv className=\"relative\"\u003e\r\n                            \u003cUser className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-sentinel-text-muted\" /\u003e\r\n                            \u003cinput type=\"text\" value={form.name} onChange={(e) =\u003e update(\"name\", e.target.value)} className=\"input-field !pl-10\" placeholder=\"John Doe\" required /\u003e\r\n                        \u003c/div\u003e\r\n                    \u003c/div\u003e\r\n\r\n                    \u003cdiv\u003e\r\n                        \u003clabel className=\"block text-sm font-medium text-sentinel-text-muted mb-1.5\"\u003eEmail\u003c/label\u003e\r\n                        \u003cdiv className=\"relative\"\u003e\r\n                            \u003cMail className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-sentinel-text-muted\" /\u003e\r\n                            \u003cinput type=\"email\" value={form.email} onChange={(e) =\u003e update(\"email\", e.target.value)} className=\"input-field !pl-10\" placeholder=\"you@university.edu\" required /\u003e\r\n                        \u003c/div\u003e\r\n                    \u003c/div\u003e\r\n\r\n                    \u003cdiv\u003e\r\n                        \u003clabel className=\"block text-sm font-medium text-sentinel-text-muted mb-1.5\"\u003eCollege / Institution\u003c/label\u003e\r\n                        \u003cdiv className=\"relative\"\u003e\r\n                            \u003cGraduationCap className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-sentinel-text-muted\" /\u003e\r\n                            \u003cinput type=\"text\" value={form.college} onChange={(e) =\u003e update(\"college\", e.target.value)} className=\"input-field !pl-10\" placeholder=\"MIT, Stanford...\" required /\u003e\r\n                        \u003c/div\u003e\r\n                    \u003c/div\u003e\r\n\r\n                    \u003cdiv\u003e\r\n                        \u003clabel className=\"block text-sm font-medium text-sentinel-text-muted mb-1.5\"\u003ePassword\u003c/label\u003e\r\n                        \u003cdiv className=\"relative\"\u003e\r\n                            \u003cLock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-sentinel-text-muted\" /\u003e\r\n                            \u003cinput type={showPass ? \"text\" : \"password\"} value={form.password} onChange={(e) =\u003e update(\"password\", e.target.value)} className=\"input-field !pl-10 !pr-10\" placeholder=\"Min 6 characters\" required minLength={6} /\u003e\r\n                            \u003cbutton type=\"button\" onClick={() =\u003e setShowPass(!showPass)} className=\"absolute right-3 top-1/2 -translate-y-1/2 text-sentinel-text-muted hover:text-white\"\u003e\r\n                                {showPass ? \u003cEyeOff className=\"w-4 h-4\" /\u003e : \u003cEye className=\"w-4 h-4\" /\u003e}\r\n                            \u003c/button\u003e\r\n                        \u003c/div\u003e\r\n                    \u003c/div\u003e\r\n\r\n                    \u003cdiv\u003e\r\n                        \u003clabel className=\"block text-sm font-medium text-sentinel-text-muted mb-1.5\"\u003eRole\u003c/label\u003e\r\n                        \u003cdiv className=\"grid grid-cols-3 gap-3\"\u003e\r\n                            {[\"student\", \"parent\", \"admin\"].map((role) =\u003e (\r\n                                \u003cbutton\r\n                                    key={role}\r\n                                    type=\"button\"\r\n                                    onClick={() =\u003e update(\"role\", role)}\r\n                                    className={`p-3 rounded-xl border text-sm font-medium capitalize transition-all ${form.role === role\r\n                                        ? \"border-sentinel-accent bg-sentinel-accent/10 text-sentinel-accent-light\"\r\n                                        : \"border-sentinel-border text-sentinel-text-muted hover:border-sentinel-accent/30\"\r\n                                        }`}\r\n                                \u003e\r\n                                    {role}\r\n                                \u003c/button\u003e\r\n                            ))}\r\n                        \u003c/div\u003e\r\n                    \u003c/div\u003e\r\n\r\n                    \u003cmotion.button whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} type=\"submit\" disabled={loading} className=\"btn-neon w-full !py-3 text-center disabled:opacity-50 mt-2\"\u003e\r\n                        {loading ? \"Creating Account...\" : \"Create Account\"}\r\n                    \u003c/motion.button\u003e\r\n                \u003c/form\u003e\r\n\r\n                \u003cp className=\"text-sm text-center text-sentinel-text-muted mt-6\"\u003e\r\n                    Already have an account?{\" \"}\r\n                    \u003cLink href=\"/login\" className=\"text-sentinel-accent hover:text-sentinel-accent-light transition-colors\"\u003eSign in\u003c/Link\u003e\r\n                \u003c/p\u003e\r\n            \u003c/motion.div\u003e\r\n        \u003c/div\u003e\r\n    );\r\n}\r\n","path":"frontend/src/app/register/page.tsx"},{"content":"@tailwind base;\r\n@tailwind components;\r\n@tailwind utilities;\r\n\r\n@import url(\u0027https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900\u0026family=JetBrains+Mono:wght@400;500;600\u0026display=swap\u0027);\r\n\r\n:root {\r\n  --bg: #0a0a1a;\r\n  --card: #111128;\r\n  --border: #1e1e3a;\r\n  --accent: #6366f1;\r\n  --neon: #22d3ee;\r\n}\r\n\r\n* {\r\n  margin: 0;\r\n  padding: 0;\r\n  box-sizing: border-box;\r\n}\r\n\r\nbody {\r\n  background-color: var(--bg);\r\n  color: #e2e8f0;\r\n  font-family: \u0027Inter\u0027, system-ui, sans-serif;\r\n  -webkit-font-smoothing: antialiased;\r\n  overflow-x: hidden;\r\n}\r\n\r\n/* Glassmorphism card */\r\n.glass-card {\r\n  background: rgba(17, 17, 40, 0.7);\r\n  backdrop-filter: blur(20px);\r\n  -webkit-backdrop-filter: blur(20px);\r\n  border: 1px solid rgba(99, 102, 241, 0.15);\r\n  border-radius: 16px;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.glass-card:hover {\r\n  border-color: rgba(99, 102, 241, 0.35);\r\n  box-shadow: 0 0 30px rgba(99, 102, 241, 0.1);\r\n}\r\n\r\n/* Neon button */\r\n.btn-neon {\r\n  background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);\r\n  color: white;\r\n  font-weight: 600;\r\n  padding: 12px 32px;\r\n  border-radius: 12px;\r\n  border: none;\r\n  cursor: pointer;\r\n  transition: all 0.3s ease;\r\n  box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);\r\n}\r\n\r\n.btn-neon:hover {\r\n  transform: translateY(-2px);\r\n  box-shadow: 0 0 40px rgba(99, 102, 241, 0.5);\r\n}\r\n\r\n.btn-neon:active {\r\n  transform: translateY(0);\r\n}\r\n\r\n/* Input field */\r\n.input-field {\r\n  width: 100%;\r\n  padding: 12px 16px;\r\n  background: rgba(17, 17, 40, 0.8);\r\n  border: 1px solid rgba(99, 102, 241, 0.2);\r\n  border-radius: 10px;\r\n  color: #e2e8f0;\r\n  font-size: 14px;\r\n  transition: all 0.3s ease;\r\n  outline: none;\r\n}\r\n\r\n.input-field:focus {\r\n  border-color: #6366f1;\r\n  box-shadow: 0 0 15px rgba(99, 102, 241, 0.2);\r\n}\r\n\r\n.input-field::placeholder {\r\n  color: #64748b;\r\n}\r\n\r\n/* Animated background */\r\n.bg-grid {\r\n  background-image:\r\n    linear-gradient(rgba(99, 102, 241, 0.03) 1px, transparent 1px),\r\n    linear-gradient(90deg, rgba(99, 102, 241, 0.03) 1px, transparent 1px);\r\n  background-size: 60px 60px;\r\n}\r\n\r\n/* Skeleton loading */\r\n.skeleton {\r\n  background: linear-gradient(90deg, rgba(17,17,40,0.8) 0%, rgba(30,30,58,0.8) 50%, rgba(17,17,40,0.8) 100%);\r\n  background-size: 200% 100%;\r\n  animation: shimmer 1.5s infinite;\r\n  border-radius: 8px;\r\n}\r\n\r\n@keyframes shimmer {\r\n  0% { background-position: 200% 0; }\r\n  100% { background-position: -200% 0; }\r\n}\r\n\r\n/* Scrollbar */\r\n::-webkit-scrollbar {\r\n  width: 6px;\r\n}\r\n\r\n::-webkit-scrollbar-track {\r\n  background: #0a0a1a;\r\n}\r\n\r\n::-webkit-scrollbar-thumb {\r\n  background: #1e1e3a;\r\n  border-radius: 3px;\r\n}\r\n\r\n::-webkit-scrollbar-thumb:hover {\r\n  background: #6366f1;\r\n}\r\n\r\n/* Severity badges */\r\n.badge-critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); }\r\n.badge-high { background: rgba(249, 115, 22, 0.15); color: #f97316; border: 1px solid rgba(249, 115, 22, 0.3); }\r\n.badge-medium { background: rgba(245, 158, 11, 0.15); color: #f59e0b; border: 1px solid rgba(245, 158, 11, 0.3); }\r\n.badge-low { background: rgba(16, 185, 129, 0.15); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.3); }\r\n","path":"frontend/src/app/globals.css"},{"content":"import type { Metadata } from \"next\";\r\nimport \"./globals.css\";\r\n\r\nexport const metadata: Metadata = {\r\n    title: \"SentinelAI — AI Cybersecurity Platform\",\r\n    description: \"AI-Based Real-Time Behavioral Cybersecurity Platform for Students. Detect smartphone behavioral anomalies and get real-time security alerts.\",\r\n    keywords: [\"cybersecurity\", \"AI\", \"behavioral analysis\", \"security\", \"students\"],\r\n};\r\n\r\nexport default function RootLayout({\r\n    children,\r\n}: {\r\n    children: React.ReactNode;\r\n}) {\r\n    return (\r\n        \u003chtml lang=\"en\" className=\"dark\"\u003e\r\n            \u003cbody className=\"bg-sentinel-bg text-sentinel-text min-h-screen bg-grid\"\u003e\r\n                {children}\r\n            \u003c/body\u003e\r\n        \u003c/html\u003e\r\n    );\r\n}\r\n","path":"frontend/src/app/layout.tsx"},{"content":"\"use client\";\r\nimport { motion } from \"framer-motion\";\r\nimport Link from \"next/link\";\r\nimport { Shield, Activity, Bell, Zap, Lock, Eye, BarChart3, Cpu } from \"lucide-react\";\r\n\r\nexport default function LandingPage() {\r\n    return (\r\n        \u003cdiv className=\"min-h-screen relative overflow-hidden\"\u003e\r\n            {/* Animated background orbs */}\r\n            \u003cdiv className=\"fixed inset-0 pointer-events-none\"\u003e\r\n                \u003cdiv className=\"absolute top-1/4 left-1/4 w-96 h-96 bg-sentinel-accent/10 rounded-full blur-3xl animate-pulse-slow\" /\u003e\r\n                \u003cdiv className=\"absolute bottom-1/4 right-1/4 w-96 h-96 bg-sentinel-neon-purple/10 rounded-full blur-3xl animate-pulse-slow\" style={{ animationDelay: \"1.5s\" }} /\u003e\r\n                \u003cdiv className=\"absolute top-1/2 left-1/2 w-64 h-64 bg-sentinel-neon/5 rounded-full blur-3xl animate-float\" /\u003e\r\n            \u003c/div\u003e\r\n\r\n            {/* Navbar */}\r\n            \u003cnav className=\"relative z-10 flex items-center justify-between px-6 lg:px-16 py-5\"\u003e\r\n                \u003cdiv className=\"flex items-center gap-3\"\u003e\r\n                    \u003cShield className=\"w-8 h-8 text-sentinel-accent\" /\u003e\r\n                    \u003cspan className=\"text-xl font-bold bg-gradient-to-r from-sentinel-accent to-sentinel-neon bg-clip-text text-transparent\"\u003e\r\n                        SentinelAI\r\n                    \u003c/span\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv className=\"flex items-center gap-4\"\u003e\r\n                    \u003cLink href=\"/login\" className=\"text-sentinel-text-muted hover:text-white transition-colors px-4 py-2\"\u003e\r\n                        Login\r\n                    \u003c/Link\u003e\r\n                    \u003cLink href=\"/register\" className=\"btn-neon text-sm !py-2 !px-6 inline-block\"\u003e\r\n                        Get Started\r\n                    \u003c/Link\u003e\r\n                \u003c/div\u003e\r\n            \u003c/nav\u003e\r\n\r\n            {/* Hero Section */}\r\n            \u003csection className=\"relative z-10 max-w-7xl mx-auto px-6 lg:px-16 pt-20 pb-32\"\u003e\r\n                \u003cmotion.div\r\n                    initial={{ opacity: 0, y: 30 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    transition={{ duration: 0.8 }}\r\n                    className=\"text-center\"\r\n                \u003e\r\n                    \u003cmotion.div\r\n                        initial={{ scale: 0 }}\r\n                        animate={{ scale: 1 }}\r\n                        transition={{ delay: 0.2, type: \"spring\" }}\r\n                        className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-sentinel-accent/10 border border-sentinel-accent/20 mb-8\"\r\n                    \u003e\r\n                        \u003cZap className=\"w-4 h-4 text-sentinel-neon\" /\u003e\r\n                        \u003cspan className=\"text-sm text-sentinel-accent-light\"\u003eAI-Powered Cybersecurity for Students\u003c/span\u003e\r\n                    \u003c/motion.div\u003e\r\n\r\n                    \u003ch1 className=\"text-5xl lg:text-7xl font-extrabold leading-tight mb-6\"\u003e\r\n                        \u003cspan className=\"bg-gradient-to-r from-white via-sentinel-accent-light to-sentinel-neon bg-clip-text text-transparent\"\u003e\r\n                            Secure Your Digital Life\r\n                        \u003c/span\u003e\r\n                        \u003cbr /\u003e\r\n                        \u003cspan className=\"text-white\"\u003ewith AI Intelligence\u003c/span\u003e\r\n                    \u003c/h1\u003e\r\n\r\n                    \u003cp className=\"text-lg lg:text-xl text-sentinel-text-muted max-w-2xl mx-auto mb-10\"\u003e\r\n                        Real-time behavioral anomaly detection powered by machine learning.\r\n                        Protect your smartphone from threats before they strike.\r\n                    \u003c/p\u003e\r\n\r\n                    \u003cdiv className=\"flex flex-col sm:flex-row gap-4 justify-center\"\u003e\r\n                        \u003cLink href=\"/register\"\u003e\r\n                            \u003cmotion.button\r\n                                whileHover={{ scale: 1.05 }}\r\n                                whileTap={{ scale: 0.98 }}\r\n                                className=\"btn-neon text-lg !py-4 !px-10 flex items-center gap-2\"\r\n                            \u003e\r\n                                \u003cLock className=\"w-5 h-5\" /\u003e\r\n                                Secure My Device\r\n                            \u003c/motion.button\u003e\r\n                        \u003c/Link\u003e\r\n                        \u003cLink href=\"/login\"\u003e\r\n                            \u003cmotion.button\r\n                                whileHover={{ scale: 1.05 }}\r\n                                whileTap={{ scale: 0.98 }}\r\n                                className=\"px-10 py-4 rounded-xl border border-sentinel-border text-sentinel-text hover:border-sentinel-accent/50 hover:bg-sentinel-accent/5 transition-all text-lg\"\r\n                            \u003e\r\n                                Try Demo\r\n                            \u003c/motion.button\u003e\r\n                        \u003c/Link\u003e\r\n                    \u003c/div\u003e\r\n                \u003c/motion.div\u003e\r\n\r\n                {/* Feature Cards */}\r\n                \u003cmotion.div\r\n                    initial={{ opacity: 0, y: 50 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    transition={{ delay: 0.5, duration: 0.8 }}\r\n                    className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-24\"\r\n                \u003e\r\n                    {[\r\n                        { icon: Eye, title: \"Behavioral Analysis\", desc: \"AI monitors app usage patterns and detects suspicious behavior in real-time\" },\r\n                        { icon: Activity, title: \"Risk Scoring\", desc: \"Dynamic 0-100 risk score calculated using Isolation Forest ML model\" },\r\n                        { icon: Bell, title: \"Instant Alerts\", desc: \"WebSocket-powered real-time notifications when threats are detected\" },\r\n                        { icon: BarChart3, title: \"Deep Insights\", desc: \"Weekly trends, risk analytics, and actionable security recommendations\" },\r\n                    ].map((feature, i) =\u003e (\r\n                        \u003cmotion.div\r\n                            key={i}\r\n                            initial={{ opacity: 0, y: 30 }}\r\n                            animate={{ opacity: 1, y: 0 }}\r\n                            transition={{ delay: 0.7 + i * 0.15 }}\r\n                            whileHover={{ y: -5 }}\r\n                            className=\"glass-card p-6\"\r\n                        \u003e\r\n                            \u003cdiv className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-sentinel-accent/20 to-sentinel-neon-purple/20 flex items-center justify-center mb-4\"\u003e\r\n                                \u003cfeature.icon className=\"w-6 h-6 text-sentinel-accent-light\" /\u003e\r\n                            \u003c/div\u003e\r\n                            \u003ch3 className=\"text-lg font-semibold text-white mb-2\"\u003e{feature.title}\u003c/h3\u003e\r\n                            \u003cp className=\"text-sm text-sentinel-text-muted leading-relaxed\"\u003e{feature.desc}\u003c/p\u003e\r\n                        \u003c/motion.div\u003e\r\n                    ))}\r\n                \u003c/motion.div\u003e\r\n\r\n                {/* Architecture highlight */}\r\n                \u003cmotion.div\r\n                    initial={{ opacity: 0 }}\r\n                    animate={{ opacity: 1 }}\r\n                    transition={{ delay: 1.2 }}\r\n                    className=\"mt-24 glass-card p-8 lg:p-12\"\r\n                \u003e\r\n                    \u003ch2 className=\"text-2xl lg:text-3xl font-bold text-center mb-8\"\u003e\r\n                        \u003cspan className=\"bg-gradient-to-r from-sentinel-accent to-sentinel-neon bg-clip-text text-transparent\"\u003e\r\n                            Enterprise-Grade Architecture\r\n                        \u003c/span\u003e\r\n                    \u003c/h2\u003e\r\n                    \u003cdiv className=\"grid grid-cols-2 md:grid-cols-4 gap-6 text-center\"\u003e\r\n                        {[\r\n                            { icon: Cpu, label: \"FastAPI Backend\", sub: \"Async + WebSocket\" },\r\n                            { icon: Shield, label: \"JWT Security\", sub: \"bcrypt + RBAC\" },\r\n                            { icon: Activity, label: \"ML Engine\", sub: \"Isolation Forest\" },\r\n                            { icon: Zap, label: \"Real-Time\", sub: \"\u003c 1s Latency\" },\r\n                        ].map((item, i) =\u003e (\r\n                            \u003cdiv key={i} className=\"flex flex-col items-center gap-2\"\u003e\r\n                                \u003citem.icon className=\"w-8 h-8 text-sentinel-neon\" /\u003e\r\n                                \u003cspan className=\"font-semibold text-white\"\u003e{item.label}\u003c/span\u003e\r\n                                \u003cspan className=\"text-xs text-sentinel-text-muted\"\u003e{item.sub}\u003c/span\u003e\r\n                            \u003c/div\u003e\r\n                        ))}\r\n                    \u003c/div\u003e\r\n                \u003c/motion.div\u003e\r\n            \u003c/section\u003e\r\n\r\n            {/* Footer */}\r\n            \u003cfooter className=\"relative z-10 border-t border-sentinel-border py-8 px-6 text-center\"\u003e\r\n                \u003cp className=\"text-sm text-sentinel-text-muted\"\u003e\r\n                    © 2026 SentinelAI — AI-Based Cybersecurity Platform. Built for hackathons.\r\n                \u003c/p\u003e\r\n            \u003c/footer\u003e\r\n        \u003c/div\u003e\r\n    );\r\n}\r\n","path":"frontend/src/app/page.tsx"},{"content":"import axios from \"axios\";\r\n\r\n// API calls use relative paths so they go through Next.js rewrites (avoids CORS)\r\nconst api = axios.create({\r\n    baseURL: \"/api\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n});\r\n\r\n// Direct backend URL — only used for WebSocket connections\r\nconst WS_BACKEND = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:8000\";\r\n\r\n// Request interceptor: attach JWT\r\napi.interceptors.request.use((config) =\u003e {\r\n    if (typeof window !== \"undefined\") {\r\n        const token = localStorage.getItem(\"sentinel_token\");\r\n        if (token) {\r\n            config.headers.Authorization = `Bearer ${token}`;\r\n        }\r\n    }\r\n    return config;\r\n});\r\n\r\n// Response interceptor: handle 401\r\napi.interceptors.response.use(\r\n    (res) =\u003e res,\r\n    (err) =\u003e {\r\n        if (err.response?.status === 401 \u0026\u0026 typeof window !== \"undefined\") {\r\n            localStorage.removeItem(\"sentinel_token\");\r\n            localStorage.removeItem(\"sentinel_user\");\r\n            window.location.href = \"/login\";\r\n        }\r\n        return Promise.reject(err);\r\n    }\r\n);\r\n\r\n// ──── Auth ────\r\nexport const authAPI = {\r\n    register: (data: { name: string; email: string; college: string; password: string; role: string }) =\u003e\r\n        api.post(\"/register\", data),\r\n    login: (data: { email: string; password: string }) =\u003e\r\n        api.post(\"/login\", data),\r\n    profile: () =\u003e api.get(\"/profile\"),\r\n    consent: (data: { accept_terms: boolean; enable_monitoring: boolean }) =\u003e\r\n        api.post(\"/consent\", data),\r\n};\r\n\r\n// ──── Logs ────\r\nexport const logsAPI = {\r\n    ingest: (data: any) =\u003e api.post(\"/logs\", data),\r\n    riskScore: () =\u003e api.get(\"/risk-score\"),\r\n    alerts: () =\u003e api.get(\"/alerts\"),\r\n    recentLogs: () =\u003e api.get(\"/logs/recent\"),\r\n};\r\n\r\n// ──── Student Actions ────\r\nexport const studentAPI = {\r\n    blockApp: (app_name: string) =\u003e api.post(\"/block-app\", { app_name }),\r\n    resolveAlert: (alert_id: number) =\u003e api.post(\"/resolve-alert\", { alert_id }),\r\n    wellbeing: () =\u003e api.get(\"/wellbeing\"),\r\n    permissionAudit: () =\u003e api.get(\"/permission-audit\"),\r\n    leaderboard: () =\u003e api.get(\"/leaderboard\"),\r\n    trainingProgress: () =\u003e api.get(\"/training-progress\"),\r\n};\r\n\r\n// ──── Admin ────\r\nexport const adminAPI = {\r\n    stats: () =\u003e api.get(\"/admin/stats\"),\r\n    highRiskUsers: () =\u003e api.get(\"/admin/high-risk-users\"),\r\n    exportReport: () =\u003e api.get(\"/admin/export-report\", { responseType: \"blob\" }),\r\n    activityFeed: () =\u003e api.get(\"/admin/activity-feed\"),\r\n    trends: (days: number = 14) =\u003e api.get(`/admin/trends?days=${days}`),\r\n    collegeBreakdown: () =\u003e api.get(\"/admin/college-breakdown\"),\r\n    allUsers: (search: string = \"\", role: string = \"all\") =\u003e api.get(`/admin/all-users?search=${search}\u0026role_filter=${role}`),\r\n};\r\n\r\n// ──── Devices ────\r\nexport const devicesAPI = {\r\n    register: (data: { device_name: string; device_type: string }) =\u003e api.post(\"/devices/register\", data),\r\n    getAll: () =\u003e api.get(\"/devices\"),\r\n    getRisk: (id: string) =\u003e api.get(`/devices/${id}/risk`),\r\n};\r\n\r\n// ──── Profiles ────\r\nexport const profilesAPI = {\r\n    getBaseline: () =\u003e api.get(\"/profile/baseline\"),\r\n    getDeviation: () =\u003e api.get(\"/profile/deviation\"),\r\n};\r\n\r\n// ──── Incidents ────\r\nexport const incidentsAPI = {\r\n    report: (data: { alert_id: number; report_type: string; description: string }) =\u003e api.post(\"/incidents/report\", data),\r\n    getAll: () =\u003e api.get(\"/incidents\"),\r\n    updateStatus: (id: number, status: string) =\u003e api.patch(`/incidents/${id}/status?status=${status}`),\r\n};\r\n\r\n// ──── Privacy ────\r\nexport const privacyAPI = {\r\n    getLogs: () =\u003e api.get(\"/privacy/data-access\"),\r\n    getExplanation: (alertId: number) =\u003e api.get(`/privacy/explanation/${alertId}`),\r\n};\r\n\r\n// ──── Anomalies (Analytics) ────\r\nexport const anomaliesAPI = {\r\n    getTimeline: () =\u003e api.get(\"/anomalies/timeline\"),\r\n    getHeatmap: () =\u003e api.get(\"/anomalies/heatmap\"),\r\n};\r\n\r\n// ──── Escalate ────\r\nexport const escalateAPI = {\r\n    trigger: (data: { user_id: string; reason: string }) =\u003e api.post(\"/escalate\", data),\r\n};\r\n\r\n// ──── WebSocket ────\r\nexport function createWebSocket(userId: string): WebSocket | null {\r\n    if (typeof window === \"undefined\") return null;\r\n    const wsBase = WS_BACKEND.replace(\"http\", \"ws\");\r\n    return new WebSocket(`${wsBase}/ws/${userId}`);\r\n}\r\n\r\nexport default api;\r\n","path":"frontend/src/lib/api.ts"},{"content":"/// \u003creference types=\"next\" /\u003e\r\n/// \u003creference types=\"next/image-types/global\" /\u003e\r\n\r\n// NOTE: This file should not be edited\r\n// see https://nextjs.org/docs/basic-features/typescript for more information.\r\n","path":"frontend/next-env.d.ts"},{"content":"/** @type {import(\u0027next\u0027).NextConfig} */\r\nconst nextConfig = {\r\n    output: \u0027standalone\u0027,\r\n    async rewrites() {\r\n        return [\r\n            {\r\n                source: \u0027/api/:path*\u0027,\r\n                destination: process.env.NEXT_PUBLIC_API_URL\r\n                    ? `${process.env.NEXT_PUBLIC_API_URL}/api/:path*`\r\n                    : \u0027http://127.0.0.1:8000/api/:path*\u0027,\r\n            },\r\n        ];\r\n    },\r\n};\r\n\r\nmodule.exports = nextConfig;\r\n","path":"frontend/next.config.js"},{"content":"{\r\n  \"name\": \"sentinelai-frontend\",\r\n  \"version\": \"1.0.0\",\r\n  \"private\": true,\r\n  \"scripts\": {\r\n    \"dev\": \"next dev\",\r\n    \"build\": \"next build\",\r\n    \"start\": \"next start\",\r\n    \"lint\": \"next lint\"\r\n  },\r\n  \"dependencies\": {\r\n    \"next\": \"14.1.0\",\r\n    \"react\": \"^18.2.0\",\r\n    \"react-dom\": \"^18.2.0\",\r\n    \"framer-motion\": \"^11.0.3\",\r\n    \"recharts\": \"^2.12.0\",\r\n    \"lucide-react\": \"^0.323.0\",\r\n    \"axios\": \"^1.6.7\",\r\n    \"clsx\": \"^2.1.0\",\r\n    \"tailwind-merge\": \"^2.2.1\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"@types/node\": \"^20.11.0\",\r\n    \"@types/react\": \"^18.2.0\",\r\n    \"@types/react-dom\": \"^18.2.0\",\r\n    \"autoprefixer\": \"^10.4.17\",\r\n    \"postcss\": \"^8.4.33\",\r\n    \"tailwindcss\": \"^3.4.1\",\r\n    \"typescript\": \"^5.3.3\"\r\n  }\r\n}\r\n","path":"frontend/package.json"},{"content":"module.exports = {\r\n    plugins: {\r\n        tailwindcss: {},\r\n        autoprefixer: {},\r\n    },\r\n};\r\n","path":"frontend/postcss.config.js"},{"content":"import type { Config } from \"tailwindcss\";\r\n\r\nconst config: Config = {\r\n    content: [\"./src/**/*.{js,ts,jsx,tsx,mdx}\"],\r\n    darkMode: \"class\",\r\n    theme: {\r\n        extend: {\r\n            colors: {\r\n                sentinel: {\r\n                    bg: \"#0a0a1a\",\r\n                    card: \"#111128\",\r\n                    border: \"#1e1e3a\",\r\n                    accent: \"#6366f1\",\r\n                    \"accent-light\": \"#818cf8\",\r\n                    neon: \"#22d3ee\",\r\n                    \"neon-purple\": \"#a855f7\",\r\n                    success: \"#10b981\",\r\n                    warning: \"#f59e0b\",\r\n                    danger: \"#ef4444\",\r\n                    text: \"#e2e8f0\",\r\n                    \"text-muted\": \"#94a3b8\",\r\n                },\r\n            },\r\n            fontFamily: {\r\n                sans: [\"Inter\", \"system-ui\", \"sans-serif\"],\r\n                mono: [\"JetBrains Mono\", \"monospace\"],\r\n            },\r\n            backgroundImage: {\r\n                \"gradient-radial\": \"radial-gradient(var(--tw-gradient-stops))\",\r\n                \"sentinel-gradient\": \"linear-gradient(135deg, #6366f1 0%, #a855f7 50%, #22d3ee 100%)\",\r\n                \"card-gradient\": \"linear-gradient(135deg, rgba(99,102,241,0.1) 0%, rgba(168,85,247,0.05) 100%)\",\r\n            },\r\n            boxShadow: {\r\n                neon: \"0 0 20px rgba(99,102,241,0.3), 0 0 60px rgba(99,102,241,0.1)\",\r\n                \"neon-lg\": \"0 0 30px rgba(99,102,241,0.4), 0 0 90px rgba(99,102,241,0.15)\",\r\n            },\r\n            animation: {\r\n                \"pulse-slow\": \"pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite\",\r\n                \"float\": \"float 6s ease-in-out infinite\",\r\n                \"glow\": \"glow 2s ease-in-out infinite alternate\",\r\n            },\r\n            keyframes: {\r\n                float: {\r\n                    \"0%, 100%\": { transform: \"translateY(0)\" },\r\n                    \"50%\": { transform: \"translateY(-10px)\" },\r\n                },\r\n                glow: {\r\n                    \"0%\": { boxShadow: \"0 0 5px rgba(99,102,241,0.2)\" },\r\n                    \"100%\": { boxShadow: \"0 0 20px rgba(99,102,241,0.6)\" },\r\n                },\r\n            },\r\n        },\r\n    },\r\n    plugins: [],\r\n};\r\n\r\nexport default config;\r\n","path":"frontend/tailwind.config.ts"},{"content":"{\r\n    \"compilerOptions\": {\r\n        \"target\": \"es5\",\r\n        \"lib\": [\r\n            \"dom\",\r\n            \"dom.iterable\",\r\n            \"esnext\"\r\n        ],\r\n        \"allowJs\": true,\r\n        \"skipLibCheck\": true,\r\n        \"strict\": true,\r\n        \"noEmit\": true,\r\n        \"esModuleInterop\": true,\r\n        \"module\": \"esnext\",\r\n        \"moduleResolution\": \"bundler\",\r\n        \"resolveJsonModule\": true,\r\n        \"isolatedModules\": true,\r\n        \"jsx\": \"preserve\",\r\n        \"incremental\": true,\r\n        \"plugins\": [\r\n            {\r\n                \"name\": \"next\"\r\n            }\r\n        ],\r\n        \"paths\": {\r\n            \"@/*\": [\r\n                \"./src/*\"\r\n            ]\r\n        }\r\n    },\r\n    \"include\": [\r\n        \"next-env.d.ts\",\r\n        \"**/*.ts\",\r\n        \"**/*.tsx\",\r\n        \".next/types/**/*.ts\"\r\n    ],\r\n    \"exclude\": [\r\n        \"node_modules\"\r\n    ]\r\n}","path":"frontend/tsconfig.json"},{"content":"# ──── SentinelAI Environment Variables ────\r\n\r\n# Backend\r\nDATABASE_URL=postgresql+asyncpg://sentinel:sentinel@localhost:5432/sentinelai\r\nDATABASE_URL_SYNC=postgresql://sentinel:sentinel@localhost:5432/sentinelai\r\nREDIS_URL=redis://localhost:6379/0\r\nREDIS_ENABLED=false\r\nSECRET_KEY=change-this-to-a-random-secret-key-in-production\r\nCORS_ORIGINS=http://localhost:3000,http://localhost\r\nSIMULATOR_ENABLED=true\r\nSIMULATOR_INTERVAL_SECONDS=30\r\nRATE_LIMIT=120/minute\r\n\r\n# Frontend\r\nNEXT_PUBLIC_API_URL=http://localhost:8000\r\n","path":".env.example"},{"content":"[{\"path\":\".gitignore\",\"content\":{\"value\":\"# Python\\r\\n__pycache__/\\r\\n*.py[cod]\\r\\n*.egg-info/\\r\\ndist/\\r\\nbuild/\\r\\nvenv/\\r\\n.env\\r\\n\\r\\n# Node\\r\\nnode_modules/\\r\\n.next/\\r\\nout/\\r\\n\\r\\n# Database\\r\\n*.db\\r\\n*.sqlite3\\r\\n\\r\\n# IDE\\r\\n.vscode/\\r\\n.idea/\\r\\n\\r\\n# OS\\r\\n.DS_Store\\r\\nThumbs.db\\r\\n\\r\\n# Docker\\r\\n*.log\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\.gitignore\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\",\"PSChildName\":\".gitignore\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\".env.example\",\"content\":{\"value\":\"# â”€â”€â”€â”€ SentinelAI Environment Variables â”€â”€â”€â”€\\r\\n\\r\\n# Backend\\r\\nDATABASE_URL=postgresql+asyncpg://sentinel:sentinel@localhost:5432/sentinelai\\r\\nDATABASE_URL_SYNC=postgresql://sentinel:sentinel@localhost:5432/sentinelai\\r\\nREDIS_URL=redis://localhost:6379/0\\r\\nREDIS_ENABLED=false\\r\\nSECRET_KEY=change-this-to-a-random-secret-key-in-production\\r\\nCORS_ORIGINS=http://localhost:3000,http://localhost\\r\\nSIMULATOR_ENABLED=true\\r\\nSIMULATOR_INTERVAL_SECONDS=30\\r\\nRATE_LIMIT=120/minute\\r\\n\\r\\n# Frontend\\r\\nNEXT_PUBLIC_API_URL=http://localhost:8000\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\.env.example\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\",\"PSChildName\":\".env.example\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"README.md\",\"content\":{\"value\":\"# SentinelAI\\r\\n\\r\\n\\u003e AI-Based Real-Time Behavioral Cybersecurity Platform for Students\\r\\n\\r\\nDetect smartphone behavioral anomalies using AI and get real-time security alerts through a premium dashboard.\\r\\n\\r\\n## ðŸ— Architecture\\r\\n\\r\\n| Layer | Technology |\\r\\n|-------|-----------|\\r\\n| Frontend | Next.js 14, TypeScript, Tailwind CSS, Framer Motion, Recharts |\\r\\n| Backend | FastAPI, SQLAlchemy (async), Pydantic |\\r\\n| Database | PostgreSQL |\\r\\n| Cache | Redis |\\r\\n| AI Engine | scikit-learn (Isolation Forest) + rule-based fallback |\\r\\n| Auth | JWT (access + refresh), bcrypt |\\r\\n| Real-time | WebSocket |\\r\\n| Deployment | Docker Compose, Nginx |\\r\\n\\r\\n## ðŸš€ Quick Start\\r\\n\\r\\n### Prerequisites\\r\\n- Docker \\u0026 Docker Compose\\r\\n- OR: Python 3.11+, Node.js 20+, PostgreSQL 16+\\r\\n\\r\\n### Option 1: Docker (recommended)\\r\\n\\r\\n```bash\\r\\n# Clone and start\\r\\ncp .env.example .env\\r\\ndocker-compose up --build\\r\\n\\r\\n# Seed demo data (in another terminal)\\r\\ndocker-compose exec backend python -m app.seed\\r\\n```\\r\\n\\r\\nApp is available at **http://localhost**\\r\\n\\r\\n### Option 2: Local Development\\r\\n\\r\\n**Backend:**\\r\\n```bash\\r\\ncd backend\\r\\npython -m venv venv\\r\\nvenv\\\\Scripts\\\\activate       # Windows\\r\\n# source venv/bin/activate  # Linux/Mac\\r\\npip install -r requirements.txt\\r\\n\\r\\n# Start PostgreSQL and set DATABASE_URL in .env\\r\\nuvicorn app.main:app --reload --port 8000\\r\\n\\r\\n# Seed data\\r\\npython -m app.seed\\r\\n```\\r\\n\\r\\n**Frontend:**\\r\\n```bash\\r\\ncd frontend\\r\\nnpm install\\r\\nnpm run dev\\r\\n```\\r\\n\\r\\nFrontend: http://localhost:3000 | Backend: http://localhost:8000 | API Docs: http://localhost:8000/docs\\r\\n\\r\\n## ðŸ”‘ Demo Credentials\\r\\n\\r\\n| Role | Email | Password |\\r\\n|------|-------|----------|\\r\\n| Admin | admin@sentinelai.com | admin123 |\\r\\n| Student | student1@university.edu | student123 |\\r\\n\\r\\n## ðŸ“¡ API Endpoints\\r\\n\\r\\n| Method | Path | Description |\\r\\n|--------|------|-------------|\\r\\n| POST | /api/register | Create account |\\r\\n| POST | /api/login | Login (returns JWT) |\\r\\n| GET | /api/profile | Current user profile |\\r\\n| POST | /api/consent | Grant monitoring consent |\\r\\n| POST | /api/logs | Ingest behavior log |\\r\\n| GET | /api/risk-score | Get risk score |\\r\\n| GET | /api/alerts | Get alerts |\\r\\n| GET | /api/logs/recent | Recent behavior logs |\\r\\n| POST | /api/block-app | Block an app |\\r\\n| POST | /api/resolve-alert | Resolve alert |\\r\\n| GET | /api/admin/stats | Admin statistics |\\r\\n| GET | /api/admin/high-risk-users | High risk users |\\r\\n| GET | /api/admin/export-report | Export CSV report |\\r\\n| WS | /ws/{user_id} | Real-time alerts |\\r\\n\\r\\n## ðŸ§  AI Engine\\r\\n\\r\\n**Risk Score Formula:**\\r\\n```\\r\\nRisk = (Permission anomaly Ã— 0.3) + (Network anomaly Ã— 0.3) +\\r\\n       (Background process anomaly Ã— 0.2) + (Suspicious domain Ã— 0.2)\\r\\n```\\r\\n\\r\\n- **Primary**: Isolation Forest (scikit-learn) trained on behavioral logs\\r\\n- **Fallback**: Rule-based scoring when ML fails\\r\\n- **Recalculation**: Every log ingestion + simulator runs every 30s\\r\\n\\r\\n## ðŸ“± Device Simulator\\r\\n\\r\\nSince browsers can\\u0027t access phone sensors, a built-in simulator:\\r\\n- Generates realistic behavioral logs\\r\\n- Introduces controlled anomalies (20-35% chance)\\r\\n- Runs every 30 seconds for all consented students\\r\\n- Includes suspicious apps: SuspiciousVPN, CryptoMiner, KeyLogger, UnknownAPK\\r\\n\\r\\n## â˜ï¸ Cloud Deployment\\r\\n\\r\\nReady for: AWS ECS, Azure Container Apps, Render, Railway\\r\\n\\r\\n```bash\\r\\n# Build production images\\r\\ndocker-compose -f docker-compose.yml build\\r\\n\\r\\n# Push to registry\\r\\ndocker tag sentinelai-backend your-registry/sentinelai-backend:latest\\r\\ndocker push your-registry/sentinelai-backend:latest\\r\\n```\\r\\n\\r\\nSet environment variables on your cloud platform using `.env.example` as reference.\\r\\n\\r\\n## ðŸ“ Project Structure\\r\\n\\r\\n```\\r\\nbuildathon/\\r\\nâ”œâ”€â”€ backend/\\r\\nâ”‚   â”œâ”€â”€ app/\\r\\nâ”‚   â”‚   â”œâ”€â”€ main.py              # FastAPI application\\r\\nâ”‚   â”‚   â”œâ”€â”€ config.py            # Settings\\r\\nâ”‚   â”‚   â”œâ”€â”€ database.py          # Async SQLAlchemy\\r\\nâ”‚   â”‚   â”œâ”€â”€ models.py            # ORM models\\r\\nâ”‚   â”‚   â”œâ”€â”€ schemas.py           # Pydantic schemas\\r\\nâ”‚   â”‚   â”œâ”€â”€ auth.py              # JWT + bcrypt\\r\\nâ”‚   â”‚   â”œâ”€â”€ deps.py              # Dependencies\\r\\nâ”‚   â”‚   â”œâ”€â”€ ai_engine.py         # ML risk scoring\\r\\nâ”‚   â”‚   â”œâ”€â”€ simulator.py         # Device agent simulator\\r\\nâ”‚   â”‚   â”œâ”€â”€ websocket_manager.py # WebSocket manager\\r\\nâ”‚   â”‚   â”œâ”€â”€ seed.py              # Demo data\\r\\nâ”‚   â”‚   â””â”€â”€ routers/\\r\\nâ”‚   â”‚       â”œâ”€â”€ auth_router.py\\r\\nâ”‚   â”‚       â”œâ”€â”€ logs_router.py\\r\\nâ”‚   â”‚       â”œâ”€â”€ student_router.py\\r\\nâ”‚   â”‚       â””â”€â”€ admin_router.py\\r\\nâ”‚   â”œâ”€â”€ requirements.txt\\r\\nâ”‚   â””â”€â”€ Dockerfile\\r\\nâ”œâ”€â”€ frontend/\\r\\nâ”‚   â”œâ”€â”€ src/\\r\\nâ”‚   â”‚   â”œâ”€â”€ app/\\r\\nâ”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx       # Root layout\\r\\nâ”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx         # Landing page\\r\\nâ”‚   â”‚   â”‚   â”œâ”€â”€ login/           # Login\\r\\nâ”‚   â”‚   â”‚   â”œâ”€â”€ register/        # Register\\r\\nâ”‚   â”‚   â”‚   â”œâ”€â”€ consent/         # Consent flow\\r\\nâ”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/       # Student dashboard\\r\\nâ”‚   â”‚   â”‚   â””â”€â”€ admin/           # Admin dashboard\\r\\nâ”‚   â”‚   â””â”€â”€ lib/api.ts           # API client\\r\\nâ”‚   â”œâ”€â”€ tailwind.config.ts\\r\\nâ”‚   â”œâ”€â”€ package.json\\r\\nâ”‚   â””â”€â”€ Dockerfile\\r\\nâ”œâ”€â”€ docker-compose.yml\\r\\nâ”œâ”€â”€ nginx.conf\\r\\nâ”œâ”€â”€ .env.example\\r\\nâ””â”€â”€ README.md\\r\\n```\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\README.md\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\",\"PSChildName\":\"README.md\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"docker-compose.yml\",\"content\":{\"value\":\"version: \\\"3.8\\\"\\r\\n\\r\\nservices:\\r\\n  # PostgreSQL Database\\r\\n  postgres:\\r\\n    image: postgres:16-alpine\\r\\n    environment:\\r\\n      POSTGRES_USER: sentinel\\r\\n      POSTGRES_PASSWORD: sentinel\\r\\n      POSTGRES_DB: sentinelai\\r\\n    ports:\\r\\n      - \\\"5432:5432\\\"\\r\\n    volumes:\\r\\n      - postgres_data:/var/lib/postgresql/data\\r\\n    healthcheck:\\r\\n      test: [ \\\"CMD-SHELL\\\", \\\"pg_isready -U sentinel -d sentinelai\\\" ]\\r\\n      interval: 5s\\r\\n      timeout: 5s\\r\\n      retries: 5\\r\\n\\r\\n  # Redis Cache\\r\\n  redis:\\r\\n    image: redis:7-alpine\\r\\n    ports:\\r\\n      - \\\"6379:6379\\\"\\r\\n    healthcheck:\\r\\n      test: [ \\\"CMD\\\", \\\"redis-cli\\\", \\\"ping\\\" ]\\r\\n      interval: 5s\\r\\n      timeout: 5s\\r\\n      retries: 5\\r\\n\\r\\n  # FastAPI Backend\\r\\n  backend:\\r\\n    build:\\r\\n      context: ./backend\\r\\n      dockerfile: Dockerfile\\r\\n    environment:\\r\\n      DATABASE_URL: postgresql+asyncpg://sentinel:sentinel@postgres:5432/sentinelai\\r\\n      DATABASE_URL_SYNC: postgresql://sentinel:sentinel@postgres:5432/sentinelai\\r\\n      REDIS_URL: redis://redis:6379/0\\r\\n      REDIS_ENABLED: \\\"false\\\"\\r\\n      SECRET_KEY: ${SECRET_KEY:-super-secret-change-in-production-abc123xyz}\\r\\n      CORS_ORIGINS: http://localhost:3000,http://localhost,http://localhost:80\\r\\n      SIMULATOR_ENABLED: \\\"true\\\"\\r\\n      SIMULATOR_INTERVAL_SECONDS: \\\"30\\\"\\r\\n      RATE_LIMIT: \\\"120/minute\\\"\\r\\n    ports:\\r\\n      - \\\"8000:8000\\\"\\r\\n    depends_on:\\r\\n      postgres:\\r\\n        condition: service_healthy\\r\\n      redis:\\r\\n        condition: service_healthy\\r\\n    restart: unless-stopped\\r\\n\\r\\n  # Next.js Frontend\\r\\n  frontend:\\r\\n    build:\\r\\n      context: ./frontend\\r\\n      dockerfile: Dockerfile\\r\\n    environment:\\r\\n      NEXT_PUBLIC_API_URL: http://backend:8000\\r\\n    ports:\\r\\n      - \\\"3000:3000\\\"\\r\\n    depends_on:\\r\\n      - backend\\r\\n    restart: unless-stopped\\r\\n\\r\\n  # Nginx Reverse Proxy\\r\\n  nginx:\\r\\n    image: nginx:alpine\\r\\n    ports:\\r\\n      - \\\"80:80\\\"\\r\\n    volumes:\\r\\n      - ./nginx.conf:/etc/nginx/conf.d/default.conf\\r\\n    depends_on:\\r\\n      - frontend\\r\\n      - backend\\r\\n    restart: unless-stopped\\r\\n\\r\\nvolumes:\\r\\n  postgres_data:\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\docker-compose.yml\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\",\"PSChildName\":\"docker-compose.yml\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"nginx.conf\",\"content\":{\"value\":\"upstream frontend {\\r\\n    server frontend:3000;\\r\\n}\\r\\n\\r\\nupstream backend {\\r\\n    server backend:8000;\\r\\n}\\r\\n\\r\\nserver {\\r\\n    listen 80;\\r\\n    server_name localhost;\\r\\n\\r\\n    # Backend API\\r\\n    location /api/ {\\r\\n        proxy_pass http://backend;\\r\\n        proxy_set_header Host $host;\\r\\n        proxy_set_header X-Real-IP $remote_addr;\\r\\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\\r\\n        proxy_set_header X-Forwarded-Proto $scheme;\\r\\n        proxy_read_timeout 300s;\\r\\n        proxy_connect_timeout 75s;\\r\\n    }\\r\\n\\r\\n    # WebSocket\\r\\n    location /ws/ {\\r\\n        proxy_pass http://backend;\\r\\n        proxy_http_version 1.1;\\r\\n        proxy_set_header Upgrade $http_upgrade;\\r\\n        proxy_set_header Connection \\\"upgrade\\\";\\r\\n        proxy_set_header Host $host;\\r\\n        proxy_set_header X-Real-IP $remote_addr;\\r\\n        proxy_read_timeout 86400;\\r\\n    }\\r\\n\\r\\n    # Backend docs\\r\\n    location /docs {\\r\\n        proxy_pass http://backend;\\r\\n        proxy_set_header Host $host;\\r\\n    }\\r\\n\\r\\n    location /openapi.json {\\r\\n        proxy_pass http://backend;\\r\\n        proxy_set_header Host $host;\\r\\n    }\\r\\n\\r\\n    # Frontend\\r\\n    location / {\\r\\n        proxy_pass http://frontend;\\r\\n        proxy_set_header Host $host;\\r\\n        proxy_set_header X-Real-IP $remote_addr;\\r\\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\\r\\n        proxy_set_header X-Forwarded-Proto $scheme;\\r\\n    }\\r\\n\\r\\n    # Next.js HMR (dev mode)\\r\\n    location /_next/webpack-hmr {\\r\\n        proxy_pass http://frontend;\\r\\n        proxy_http_version 1.1;\\r\\n        proxy_set_header Upgrade $http_upgrade;\\r\\n        proxy_set_header Connection \\\"upgrade\\\";\\r\\n    }\\r\\n}\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\nginx.conf\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\",\"PSChildName\":\"nginx.conf\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/Dockerfile\",\"content\":{\"value\":\"FROM python:3.11-slim\\r\\n\\r\\nWORKDIR /app\\r\\n\\r\\n# Install system dependencies\\r\\nRUN apt-get update \\u0026\\u0026 apt-get install -y --no-install-recommends \\\\\\r\\n    build-essential \\\\\\r\\n    \\u0026\\u0026 rm -rf /var/lib/apt/lists/*\\r\\n\\r\\n# Install Python dependencies\\r\\nCOPY requirements.txt .\\r\\nRUN pip install --no-cache-dir -r requirements.txt\\r\\n\\r\\n# Copy application code\\r\\nCOPY . .\\r\\n\\r\\n# Expose port\\r\\nEXPOSE 8000\\r\\n\\r\\n# Run with uvicorn\\r\\nCMD [\\\"uvicorn\\\", \\\"app.main:app\\\", \\\"--host\\\", \\\"0.0.0.0\\\", \\\"--port\\\", \\\"8000\\\", \\\"--workers\\\", \\\"4\\\"]\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\Dockerfile\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\",\"PSChildName\":\"Dockerfile\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/requirements.txt\",\"content\":{\"value\":\"fastapi\\r\\nuvicorn[standard]\\r\\nsqlalchemy[asyncio]\\r\\naiosqlite\\r\\npasslib[bcrypt]\\r\\npython-jose[cryptography]\\r\\npydantic-settings\\r\\npydantic[email]\\r\\npython-multipart\\r\\nslowapi\\r\\nasyncpg\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\requirements.txt\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\",\"PSChildName\":\"requirements.txt\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/app/__init__.py\",\"content\":\"\"},{\"path\":\"backend/app/ai_engine.py\",\"content\":{\"value\":\"import logging\\r\\nfrom typing import Optional, Dict, Any, List\\r\\n\\r\\nlogger = logging.getLogger(__name__)\\r\\n\\r\\n# Try to import scikit-learn; fall back to rule-based if unavailable\\r\\ntry:\\r\\n    import numpy as np\\r\\n    HAS_NUMPY = True\\r\\nexcept ImportError:\\r\\n    HAS_NUMPY = False\\r\\n\\r\\ntry:\\r\\n    from sklearn.ensemble import IsolationForest\\r\\n    HAS_SKLEARN = True\\r\\nexcept ImportError:\\r\\n    HAS_SKLEARN = False\\r\\n    logger.info(\\\"scikit-learn not available, using rule-based scoring only\\\")\\r\\n\\r\\n_model = None\\r\\n_is_fitted = False\\r\\n\\r\\n\\r\\ndef extract_features(logs: list[dict]) -\\u003e list[list[float]]:\\r\\n    \\\"\\\"\\\"Extract features from a batch of behavior logs.\\\"\\\"\\\"\\r\\n    features = []\\r\\n    for log in logs:\\r\\n        features.append([\\r\\n            1.0 if log.get(\\\"permission_requested\\\", \\\"none\\\") != \\\"none\\\" else 0.0,\\r\\n            float(log.get(\\\"network_activity_level\\\", 0.0)),\\r\\n            1.0 if log.get(\\\"background_process_flag\\\", False) else 0.0,\\r\\n            1.0 if log.get(\\\"anomaly_flag\\\", False) else 0.0,\\r\\n        ])\\r\\n    return features\\r\\n\\r\\n\\r\\ndef compute_baseline(logs: list[dict]) -\\u003e Dict[str, float]:\\r\\n    \\\"\\\"\\\"Compute an average baseline from historical logs for a user.\\\"\\\"\\\"\\r\\n    if not logs:\\r\\n        return {\\\"avg_permission_usage\\\": 0.0, \\\"avg_network_activity\\\": 0.0, \\\"avg_background_process_rate\\\": 0.0}\\r\\n\\r\\n    n = max(len(logs), 1)\\r\\n    perm_count = sum(1 for l in logs if l.get(\\\"permission_requested\\\", \\\"none\\\") != \\\"none\\\")\\r\\n    net_sum = sum(float(l.get(\\\"network_activity_level\\\", 0.0)) for l in logs)\\r\\n    bg_count = sum(1 for l in logs if l.get(\\\"background_process_flag\\\", False))\\r\\n\\r\\n    return {\\r\\n        \\\"avg_permission_usage\\\": perm_count / n,\\r\\n        \\\"avg_network_activity\\\": net_sum / n,\\r\\n        \\\"avg_background_process_rate\\\": bg_count / n\\r\\n    }\\r\\n\\r\\n\\r\\ndef calculate_risk_score_ml(logs: list[dict], baseline: Optional[Dict[str, float]] = None) -\\u003e float:\\r\\n    \\\"\\\"\\\"Use Isolation Forest if available, adjusting via baseline deviation. Returns 0-100.\\\"\\\"\\\"\\r\\n    global _model, _is_fitted\\r\\n\\r\\n    if not HAS_SKLEARN or not HAS_NUMPY or len(logs) \\u003c 5:\\r\\n        return calculate_risk_score_rules(logs, baseline)\\r\\n\\r\\n    import numpy as np\\r\\n    features = np.array(extract_features(logs))\\r\\n    if features.shape[0] == 0:\\r\\n        return 0.0\\r\\n\\r\\n    try:\\r\\n        if _model is None:\\r\\n            _model = IsolationForest(\\r\\n                n_estimators=100, contamination=0.15, random_state=42, n_jobs=-1\\r\\n            )\\r\\n\\r\\n        if not _is_fitted:\\r\\n            _model.fit(features)\\r\\n            _is_fitted = True\\r\\n\\r\\n        scores = _model.score_samples(features)\\r\\n        avg_score = float(np.mean(scores))\\r\\n        \\r\\n        # Base risk from Isolation Forest\\r\\n        risk = max(0, min(100, (0.5 - avg_score) * 100))\\r\\n        \\r\\n        # Adjust based on baseline deviation if available\\r\\n        if baseline:\\r\\n            # Simple Z-score like heuristic for demo purposes\\r\\n            recent_perm = sum(1 for l in logs if l.get(\\\"permission_requested\\\", \\\"none\\\") != \\\"none\\\") / len(logs)\\r\\n            recent_net = sum(float(l.get(\\\"network_activity_level\\\", 0.0)) for l in logs) / len(logs)\\r\\n            \\r\\n            perm_diff = max(0, recent_perm - baseline.get(\\\"avg_permission_usage\\\", 0.0))\\r\\n            net_diff = max(0, recent_net - baseline.get(\\\"avg_network_activity\\\", 0.0))\\r\\n            \\r\\n            # Add up to 20 points for deviation\\r\\n            deviation_penalty = (perm_diff * 10) + (net_diff / 10)\\r\\n            risk = min(100, risk + deviation_penalty)\\r\\n            \\r\\n        return round(risk, 1)\\r\\n    except Exception as e:\\r\\n        logger.warning(f\\\"ML scoring failed, falling back to rules: {e}\\\")\\r\\n        return calculate_risk_score_rules(logs, baseline)\\r\\n\\r\\n\\r\\ndef calculate_risk_score_rules(logs: list[dict], baseline: Optional[Dict[str, float]] = None) -\\u003e float:\\r\\n    \\\"\\\"\\\"Rule-based risk scoring with optional baseline deviation penalty. Returns 0-100.\\\"\\\"\\\"\\r\\n    if not logs:\\r\\n        return 0.0\\r\\n\\r\\n    n = len(logs)\\r\\n\\r\\n    # Permission anomaly\\r\\n    perm_count = sum(1 for l in logs if l.get(\\\"permission_requested\\\", \\\"none\\\") != \\\"none\\\")\\r\\n    perm_score = min(100, (perm_count / max(n, 1)) * 100)\\r\\n\\r\\n    # Network anomaly\\r\\n    net_levels = [float(l.get(\\\"network_activity_level\\\", 0.0)) for l in logs]\\r\\n    net_avg = sum(net_levels) / len(net_levels) if net_levels else 0.0\\r\\n    net_score = min(100, net_avg)\\r\\n\\r\\n    # Background process anomaly\\r\\n    bg_count = sum(1 for l in logs if l.get(\\\"background_process_flag\\\", False))\\r\\n    bg_score = min(100, (bg_count / max(n, 1)) * 100)\\r\\n\\r\\n    # Suspicious domain / anomaly flag\\r\\n    anomaly_count = sum(1 for l in logs if l.get(\\\"anomaly_flag\\\", False))\\r\\n    domain_score = min(100, (anomaly_count / max(n, 1)) * 100)\\r\\n\\r\\n    # Weighted formula\\r\\n    risk = (\\r\\n        perm_score * 0.3 +\\r\\n        net_score * 0.3 +\\r\\n        bg_score * 0.2 +\\r\\n        domain_score * 0.2\\r\\n    )\\r\\n    \\r\\n    # Apply baseline penalty\\r\\n    if baseline:\\r\\n        recent_perm = perm_count / max(n, 1)\\r\\n        recent_net = net_avg\\r\\n        perm_diff = max(0, recent_perm - baseline.get(\\\"avg_permission_usage\\\", 0.0))\\r\\n        net_diff = max(0, recent_net - baseline.get(\\\"avg_network_activity\\\", 0.0))\\r\\n        deviation_penalty = (perm_diff * 10) + (net_diff / 5)\\r\\n        risk = min(100, risk + deviation_penalty)\\r\\n\\r\\n    return round(max(0, min(100, risk)), 1)\\r\\n\\r\\n\\r\\ndef get_risk_level(score: float) -\\u003e str:\\r\\n    if score \\u003c= 40:\\r\\n        return \\\"low\\\"\\r\\n    elif score \\u003c= 70:\\r\\n        return \\\"medium\\\"\\r\\n    else:\\r\\n        return \\\"high\\\"\\r\\n\\r\\n\\r\\ndef generate_explanation(logs: list[dict], risk_score: float) -\\u003e str:\\r\\n    \\\"\\\"\\\"Generate a natural language explanation for why the risk score is high.\\\"\\\"\\\"\\r\\n    if not logs:\\r\\n        return \\\"No recent activity logs available to explain.\\\"\\r\\n        \\r\\n    explanations = []\\r\\n    \\r\\n    n = len(logs)\\r\\n    perm_count = sum(1 for l in logs if l.get(\\\"permission_requested\\\", \\\"none\\\") != \\\"none\\\")\\r\\n    net_avg = sum(float(l.get(\\\"network_activity_level\\\", 0.0)) for l in logs) / n\\r\\n    bg_count = sum(1 for l in logs if l.get(\\\"background_process_flag\\\", False))\\r\\n    anomaly_count = sum(1 for l in logs if l.get(\\\"anomaly_flag\\\", False))\\r\\n    \\r\\n    if anomaly_count \\u003e 0:\\r\\n        explanations.append(f\\\"Detected {anomaly_count} known suspicious activities or domains.\\\")\\r\\n    \\r\\n    if perm_count \\u003e (n * 0.5):\\r\\n        explanations.append(\\\"Unusually high rate of sensitive permission requests.\\\")\\r\\n        \\r\\n    if net_avg \\u003e 60:\\r\\n        explanations.append(f\\\"Heavy network utilization detected (avg {net_avg:.1f}%).\\\")\\r\\n        \\r\\n    if bg_count \\u003e (n * 0.4):\\r\\n        explanations.append(\\\"Excessive background processes running stealthily.\\\")\\r\\n        \\r\\n    if not explanations:\\r\\n        if risk_score \\u003e 70:\\r\\n            return \\\"Risk increased due to aggregate subtle deviations from baseline behavior.\\\"\\r\\n        return \\\"Activity appears normal.\\\"\\r\\n        \\r\\n    return \\\" \\\".join(explanations)\\r\\n\\r\\ndef generate_recommendation(severity: str) -\\u003e str:\\r\\n    \\\"\\\"\\\"Generate actionable advice based on severity.\\\"\\\"\\\"\\r\\n    if severity == \\\"critical\\\":\\r\\n        return \\\"Immediate action required: Revoke network access for the compromised app, change passwords, and consider factory resetting the device if anomalous behavior persists.\\\"\\r\\n    elif severity == \\\"high\\\":\\r\\n        return \\\"Review the app\\u0027s requested permissions immediately and consider uninstalling it. Run a malware scan.\\\"\\r\\n    else:\\r\\n        return \\\"Monitor the app\\u0027s activity. Ensure it only has access to necessary permissions.\\\"\\r\\n\\r\\n\\r\\ndef calculate_risk(logs: list[dict], baseline: Optional[Dict[str, float]] = None) -\\u003e dict:\\r\\n    \\\"\\\"\\\"Main entry point: calculate risk score, level, explanation, and recommendation.\\\"\\\"\\\"\\r\\n    try:\\r\\n        score = calculate_risk_score_ml(logs, baseline)\\r\\n    except Exception:\\r\\n        score = calculate_risk_score_rules(logs, baseline)\\r\\n\\r\\n    level = get_risk_level(score)\\r\\n    severity = \\\"critical\\\" if score \\u003e= 85 else \\\"high\\\" if score \\u003e 70 else level\\r\\n    \\r\\n    explanation = generate_explanation(logs, score)\\r\\n    recommendation = generate_recommendation(severity)\\r\\n    \\r\\n    return {\\r\\n        \\\"score\\\": score, \\r\\n        \\\"level\\\": level, \\r\\n        \\\"explanation\\\": explanation,\\r\\n        \\\"recommendation\\\": recommendation,\\r\\n        \\\"severity\\\": severity\\r\\n    }\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\ai_engine.py\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\",\"PSChildName\":\"ai_engine.py\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/app/auth.py\",\"content\":{\"value\":\"from datetime import datetime, timedelta, timezone\\r\\nfrom passlib.context import CryptContext\\r\\nfrom jose import JWTError, jwt\\r\\nfrom app.config import get_settings\\r\\n\\r\\nsettings = get_settings()\\r\\npwd_context = CryptContext(schemes=[\\\"bcrypt\\\"], deprecated=\\\"auto\\\")\\r\\n\\r\\n\\r\\ndef hash_password(password: str) -\\u003e str:\\r\\n    return pwd_context.hash(password)\\r\\n\\r\\n\\r\\ndef verify_password(plain: str, hashed: str) -\\u003e bool:\\r\\n    return pwd_context.verify(plain, hashed)\\r\\n\\r\\n\\r\\ndef create_access_token(data: dict) -\\u003e str:\\r\\n    to_encode = data.copy()\\r\\n    expire = datetime.now(timezone.utc) + timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)\\r\\n    to_encode.update({\\\"exp\\\": expire, \\\"type\\\": \\\"access\\\"})\\r\\n    return jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)\\r\\n\\r\\n\\r\\ndef create_refresh_token(data: dict) -\\u003e str:\\r\\n    to_encode = data.copy()\\r\\n    expire = datetime.now(timezone.utc) + timedelta(days=settings.REFRESH_TOKEN_EXPIRE_DAYS)\\r\\n    to_encode.update({\\\"exp\\\": expire, \\\"type\\\": \\\"refresh\\\"})\\r\\n    return jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)\\r\\n\\r\\n\\r\\ndef decode_token(token: str) -\\u003e dict | None:\\r\\n    try:\\r\\n        payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])\\r\\n        return payload\\r\\n    except JWTError:\\r\\n        return None\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\auth.py\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\",\"PSChildName\":\"auth.py\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/app/config.py\",\"content\":{\"value\":\"from pydantic_settings import BaseSettings\\r\\nfrom functools import lru_cache\\r\\nimport os\\r\\n\\r\\n\\r\\nclass Settings(BaseSettings):\\r\\n    APP_NAME: str = \\\"SentinelAI\\\"\\r\\n    DEBUG: bool = False\\r\\n\\r\\n    # Database â€” defaults to SQLite for easy local dev\\r\\n    DATABASE_URL: str = \\\"sqlite+aiosqlite:///./sentinelai.db\\\"\\r\\n\\r\\n    # Redis\\r\\n    REDIS_URL: str = \\\"redis://localhost:6379/0\\\"\\r\\n    REDIS_ENABLED: bool = False\\r\\n\\r\\n    # JWT\\r\\n    SECRET_KEY: str = \\\"super-secret-change-in-production-abc123xyz\\\"\\r\\n    ALGORITHM: str = \\\"HS256\\\"\\r\\n    ACCESS_TOKEN_EXPIRE_MINUTES: int = 30\\r\\n    REFRESH_TOKEN_EXPIRE_DAYS: int = 7\\r\\n\\r\\n    # CORS\\r\\n    CORS_ORIGINS: str = \\\"http://localhost:3000,http://localhost:3001,http://localhost:80,http://localhost\\\"\\r\\n\\r\\n    # Simulator\\r\\n    SIMULATOR_ENABLED: bool = True\\r\\n    SIMULATOR_INTERVAL_SECONDS: int = 30\\r\\n\\r\\n    # Rate limiting\\r\\n    RATE_LIMIT: str = \\\"60/minute\\\"\\r\\n\\r\\n    class Config:\\r\\n        env_file = \\\".env\\\"\\r\\n        extra = \\\"ignore\\\"\\r\\n\\r\\n\\r\\n@lru_cache()\\r\\ndef get_settings() -\\u003e Settings:\\r\\n    return Settings()\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\config.py\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\",\"PSChildName\":\"config.py\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/app/database.py\",\"content\":{\"value\":\"from sqlalchemy.ext.asyncio import create_async_engine, AsyncSession, async_sessionmaker\\r\\nfrom sqlalchemy.orm import DeclarativeBase\\r\\nfrom app.config import get_settings\\r\\n\\r\\nsettings = get_settings()\\r\\n\\r\\n# SQLite needs connect_args for async; PostgreSQL doesn\\u0027t\\r\\nconnect_args = {}\\r\\nif settings.DATABASE_URL.startswith(\\\"sqlite\\\"):\\r\\n    connect_args = {\\\"check_same_thread\\\": False}\\r\\n\\r\\nengine = create_async_engine(\\r\\n    settings.DATABASE_URL,\\r\\n    echo=settings.DEBUG,\\r\\n    connect_args=connect_args,\\r\\n)\\r\\n\\r\\nasync_session = async_sessionmaker(engine, class_=AsyncSession, expire_on_commit=False)\\r\\n\\r\\n\\r\\nclass Base(DeclarativeBase):\\r\\n    pass\\r\\n\\r\\n\\r\\nasync def get_db():\\r\\n    async with async_session() as session:\\r\\n        try:\\r\\n            yield session\\r\\n        finally:\\r\\n            await session.close()\\r\\n\\r\\n\\r\\nasync def create_tables():\\r\\n    async with engine.begin() as conn:\\r\\n        await conn.run_sync(Base.metadata.create_all)\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\database.py\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\",\"PSChildName\":\"database.py\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/app/deps.py\",\"content\":{\"value\":\"from fastapi import Depends, HTTPException, status\\r\\nfrom fastapi.security import HTTPBearer, HTTPAuthorizationCredentials\\r\\nfrom sqlalchemy.ext.asyncio import AsyncSession\\r\\nfrom sqlalchemy import select\\r\\nfrom app.database import get_db\\r\\nfrom app.auth import decode_token\\r\\nfrom app.models import User\\r\\nfrom typing import List\\r\\n\\r\\nsecurity = HTTPBearer()\\r\\n\\r\\nasync def get_current_user(\\r\\n    credentials: HTTPAuthorizationCredentials = Depends(security),\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n) -\\u003e User:\\r\\n    token = credentials.credentials\\r\\n    payload = decode_token(token)\\r\\n    if payload is None:\\r\\n        raise HTTPException(status_code=status.HTTP_401_UNAUTHORIZED, detail=\\\"Invalid or expired token\\\")\\r\\n\\r\\n    if payload.get(\\\"type\\\") != \\\"access\\\":\\r\\n        raise HTTPException(status_code=status.HTTP_401_UNAUTHORIZED, detail=\\\"Invalid token type\\\")\\r\\n\\r\\n    user_id = payload.get(\\\"sub\\\")\\r\\n    if user_id is None:\\r\\n        raise HTTPException(status_code=status.HTTP_401_UNAUTHORIZED, detail=\\\"Invalid token payload\\\")\\r\\n\\r\\n    result = await db.execute(select(User).where(User.id == user_id))\\r\\n    user = result.scalar_one_or_none()\\r\\n    if user is None:\\r\\n        raise HTTPException(status_code=status.HTTP_401_UNAUTHORIZED, detail=\\\"User not found\\\")\\r\\n\\r\\n    return user\\r\\n\\r\\ndef require_roles(allowed_roles: List[str]):\\r\\n    async def role_checker(user: User = Depends(get_current_user)) -\\u003e User:\\r\\n        if user.role not in allowed_roles:\\r\\n            raise HTTPException(\\r\\n                status_code=status.HTTP_403_FORBIDDEN, \\r\\n                detail=f\\\"Operation not permitted. Requires one of: {\\u0027, \\u0027.join(allowed_roles)}\\\"\\r\\n            )\\r\\n        return user\\r\\n    return role_checker\\r\\n\\r\\nasync def require_admin(user: User = Depends(get_current_user)) -\\u003e User:\\r\\n    if user.role != \\\"admin\\\":\\r\\n        raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail=\\\"Admin access required\\\")\\r\\n    return user\\r\\n\\r\\nasync def require_consent(user: User = Depends(get_current_user)) -\\u003e User:\\r\\n    if not user.consent_given:\\r\\n        raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail=\\\"Consent required before accessing this resource\\\")\\r\\n    return user\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\deps.py\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\",\"PSChildName\":\"deps.py\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/app/main.py\",\"content\":{\"value\":\"import asyncio\\r\\nimport logging\\r\\nimport traceback\\r\\nfrom contextlib import asynccontextmanager\\r\\nfrom fastapi import FastAPI, WebSocket, WebSocketDisconnect, Request\\r\\nfrom fastapi.responses import JSONResponse\\r\\nfrom fastapi.middleware.cors import CORSMiddleware\\r\\nfrom slowapi import Limiter, _rate_limit_exceeded_handler\\r\\nfrom slowapi.util import get_remote_address\\r\\nfrom slowapi.errors import RateLimitExceeded\\r\\n\\r\\nfrom app.config import get_settings\\r\\nfrom app.database import create_tables\\r\\nfrom app.websocket_manager import manager\\r\\nfrom app.routers import (\\r\\n    auth_router, logs_router, student_router, admin_router,\\r\\n    devices_router, profiles_router, incidents_router, privacy_router,\\r\\n    escalate_router, anomalies_router\\r\\n)\\r\\nsettings = get_settings()\\r\\nlogging.basicConfig(level=logging.INFO)\\r\\nlogger = logging.getLogger(__name__)\\r\\n\\r\\nlimiter = Limiter(key_func=get_remote_address, default_limits=[settings.RATE_LIMIT])\\r\\n\\r\\nsimulator_task = None\\r\\n\\r\\n\\r\\n@asynccontextmanager\\r\\nasync def lifespan(app: FastAPI):\\r\\n    global simulator_task\\r\\n    logger.info(\\\"SentinelAI starting up...\\\")\\r\\n    await create_tables()\\r\\n    logger.info(\\\"Database tables created\\\")\\r\\n\\r\\n    # Start device simulator\\r\\n    if settings.SIMULATOR_ENABLED:\\r\\n        from app.simulator import run_simulator\\r\\n        simulator_task = asyncio.create_task(\\r\\n            run_simulator(settings.SIMULATOR_INTERVAL_SECONDS)\\r\\n        )\\r\\n        logger.info(\\\"Device simulator started\\\")\\r\\n\\r\\n    yield\\r\\n\\r\\n    # Shutdown\\r\\n    if simulator_task:\\r\\n        simulator_task.cancel()\\r\\n        try:\\r\\n            await simulator_task\\r\\n        except asyncio.CancelledError:\\r\\n            pass\\r\\n    logger.info(\\\"SentinelAI shutdown complete\\\")\\r\\n\\r\\n\\r\\napp = FastAPI(\\r\\n    title=\\\"SentinelAI API\\\",\\r\\n    description=\\\"AI-Based Real-Time Behavioral Cybersecurity Platform\\\",\\r\\n    version=\\\"1.0.0\\\",\\r\\n    lifespan=lifespan,\\r\\n)\\r\\n\\r\\n# Rate limiting\\r\\napp.state.limiter = limiter\\r\\napp.add_exception_handler(RateLimitExceeded, _rate_limit_exceeded_handler)\\r\\n\\r\\n\\r\\n@app.exception_handler(Exception)\\r\\nasync def global_exception_handler(request: Request, exc: Exception):\\r\\n    logger.error(f\\\"Unhandled exception on {request.method} {request.url}: {exc}\\\")\\r\\n    logger.error(traceback.format_exc())\\r\\n    return JSONResponse(status_code=500, content={\\\"detail\\\": str(exc)})\\r\\n\\r\\n# CORS\\r\\napp.add_middleware(\\r\\n    CORSMiddleware,\\r\\n    allow_origins=settings.CORS_ORIGINS.split(\\\",\\\"),\\r\\n    allow_credentials=True,\\r\\n    allow_methods=[\\\"*\\\"],\\r\\n    allow_headers=[\\\"*\\\"],\\r\\n)\\r\\n\\r\\n# Mount routers\\r\\napp.include_router(auth_router.router)\\r\\napp.include_router(logs_router.router)\\r\\napp.include_router(student_router.router)\\r\\napp.include_router(admin_router.router)\\r\\napp.include_router(devices_router.router)\\r\\napp.include_router(profiles_router.router)\\r\\napp.include_router(incidents_router.router)\\r\\napp.include_router(privacy_router.router)\\r\\napp.include_router(escalate_router.router)\\r\\napp.include_router(anomalies_router.router)\\r\\n\\r\\n\\r\\n@app.get(\\\"/api/health\\\")\\r\\nasync def health():\\r\\n    return {\\r\\n        \\\"status\\\": \\\"healthy\\\",\\r\\n        \\\"app\\\": settings.APP_NAME,\\r\\n        \\\"websocket_connections\\\": manager.connected_count,\\r\\n    }\\r\\n\\r\\n\\r\\n@app.websocket(\\\"/ws/{user_id}\\\")\\r\\nasync def websocket_endpoint(websocket: WebSocket, user_id: str):\\r\\n    await manager.connect(websocket, user_id)\\r\\n    try:\\r\\n        while True:\\r\\n            data = await websocket.receive_text()\\r\\n            # Keep-alive / echo\\r\\n            if data == \\\"ping\\\":\\r\\n                await websocket.send_text(\\\"pong\\\")\\r\\n    except WebSocketDisconnect:\\r\\n        manager.disconnect(websocket, user_id)\\r\\n    except Exception:\\r\\n        manager.disconnect(websocket, user_id)\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\main.py\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\",\"PSChildName\":\"main.py\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/app/models.py\",\"content\":{\"value\":\"import uuid\\r\\nfrom datetime import datetime\\r\\nfrom sqlalchemy import (\\r\\n    Column, String, Boolean, Float, DateTime, ForeignKey, Text, Integer, JSON\\r\\n)\\r\\nfrom sqlalchemy.orm import relationship\\r\\nfrom app.database import Base\\r\\n\\r\\n\\r\\nclass User(Base):\\r\\n    __tablename__ = \\\"users\\\"\\r\\n\\r\\n    id = Column(String(36), primary_key=True, default=lambda: str(uuid.uuid4()))\\r\\n    name = Column(String(100), nullable=False)\\r\\n    email = Column(String(255), unique=True, nullable=False, index=True)\\r\\n    college = Column(String(255), nullable=False)\\r\\n    role = Column(String(20), default=\\\"student\\\", nullable=False)\\r\\n    hashed_password = Column(String(255), nullable=False)\\r\\n    consent_given = Column(Boolean, default=False)\\r\\n    created_at = Column(DateTime, default=datetime.utcnow)\\r\\n\\r\\n    risk_scores = relationship(\\\"RiskScore\\\", back_populates=\\\"user\\\", cascade=\\\"all, delete-orphan\\\")\\r\\n    alerts = relationship(\\\"Alert\\\", back_populates=\\\"user\\\", cascade=\\\"all, delete-orphan\\\")\\r\\n    behavior_logs = relationship(\\\"BehaviorLog\\\", back_populates=\\\"user\\\", cascade=\\\"all, delete-orphan\\\")\\r\\n    devices = relationship(\\\"Device\\\", back_populates=\\\"user\\\", cascade=\\\"all, delete-orphan\\\")\\r\\n    profile = relationship(\\\"BehaviorProfile\\\", back_populates=\\\"user\\\", uselist=False, cascade=\\\"all, delete-orphan\\\")\\r\\n    incidents = relationship(\\\"Incident\\\", back_populates=\\\"user\\\", cascade=\\\"all, delete-orphan\\\")\\r\\n    data_access_logs = relationship(\\\"DataAccessLog\\\", back_populates=\\\"user\\\", cascade=\\\"all, delete-orphan\\\")\\r\\n\\r\\n\\r\\nclass Device(Base):\\r\\n    __tablename__ = \\\"devices\\\"\\r\\n    id = Column(String(36), primary_key=True, default=lambda: str(uuid.uuid4()))\\r\\n    user_id = Column(String(36), ForeignKey(\\\"users.id\\\", ondelete=\\\"CASCADE\\\"), nullable=False, index=True)\\r\\n    device_name = Column(String(255), nullable=False)\\r\\n    device_type = Column(String(100), nullable=False)\\r\\n    last_active = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\\r\\n    risk_score = Column(Float, default=0.0)\\r\\n    \\r\\n    user = relationship(\\\"User\\\", back_populates=\\\"devices\\\")\\r\\n    behavior_logs = relationship(\\\"BehaviorLog\\\", back_populates=\\\"device\\\", cascade=\\\"all, delete-orphan\\\")\\r\\n\\r\\n\\r\\nclass BehaviorProfile(Base):\\r\\n    __tablename__ = \\\"behavior_profiles\\\"\\r\\n    user_id = Column(String(36), ForeignKey(\\\"users.id\\\", ondelete=\\\"CASCADE\\\"), primary_key=True)\\r\\n    baseline_metrics = Column(JSON, default={})\\r\\n    last_updated = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\\r\\n\\r\\n    user = relationship(\\\"User\\\", back_populates=\\\"profile\\\")\\r\\n\\r\\n\\r\\nclass RiskScore(Base):\\r\\n    __tablename__ = \\\"risk_scores\\\"\\r\\n\\r\\n    id = Column(Integer, primary_key=True, autoincrement=True)\\r\\n    user_id = Column(String(36), ForeignKey(\\\"users.id\\\", ondelete=\\\"CASCADE\\\"), nullable=False, index=True)\\r\\n    current_score = Column(Float, default=0.0)\\r\\n    risk_level = Column(String(20), default=\\\"low\\\")\\r\\n    last_updated = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\\r\\n\\r\\n    user = relationship(\\\"User\\\", back_populates=\\\"risk_scores\\\")\\r\\n\\r\\n\\r\\nclass Alert(Base):\\r\\n    __tablename__ = \\\"alerts\\\"\\r\\n\\r\\n    id = Column(Integer, primary_key=True, autoincrement=True)\\r\\n    user_id = Column(String(36), ForeignKey(\\\"users.id\\\", ondelete=\\\"CASCADE\\\"), nullable=False, index=True)\\r\\n    alert_type = Column(String(100), nullable=False)\\r\\n    severity = Column(String(20), nullable=False)\\r\\n    message = Column(Text, nullable=False)\\r\\n    explanation_text = Column(Text, nullable=True)\\r\\n    recommendation = Column(Text, nullable=True)\\r\\n    confidence_score = Column(Float, default=1.0)\\r\\n    created_at = Column(DateTime, default=datetime.utcnow)\\r\\n    resolved = Column(Boolean, default=False)\\r\\n\\r\\n    user = relationship(\\\"User\\\", back_populates=\\\"alerts\\\")\\r\\n    incidents = relationship(\\\"Incident\\\", back_populates=\\\"alert\\\", cascade=\\\"all, delete-orphan\\\")\\r\\n\\r\\n\\r\\nclass Incident(Base):\\r\\n    __tablename__ = \\\"incidents\\\"\\r\\n    id = Column(Integer, primary_key=True, autoincrement=True)\\r\\n    alert_id = Column(Integer, ForeignKey(\\\"alerts.id\\\", ondelete=\\\"CASCADE\\\"), nullable=False, index=True)\\r\\n    user_id = Column(String(36), ForeignKey(\\\"users.id\\\", ondelete=\\\"CASCADE\\\"), nullable=False, index=True)\\r\\n    report_type = Column(String(100), nullable=False) # e.g., \\\"false_positive\\\"\\r\\n    description = Column(Text, nullable=True)\\r\\n    status = Column(String(50), default=\\\"open\\\") # open, reviewed, resolved\\r\\n    created_at = Column(DateTime, default=datetime.utcnow)\\r\\n    \\r\\n    alert = relationship(\\\"Alert\\\", back_populates=\\\"incidents\\\")\\r\\n    user = relationship(\\\"User\\\", back_populates=\\\"incidents\\\")\\r\\n\\r\\n\\r\\nclass DataAccessLog(Base):\\r\\n    __tablename__ = \\\"data_access_logs\\\"\\r\\n    id = Column(Integer, primary_key=True, autoincrement=True)\\r\\n    user_id = Column(String(36), ForeignKey(\\\"users.id\\\", ondelete=\\\"CASCADE\\\"), nullable=False, index=True)\\r\\n    data_type = Column(String(100), nullable=False)\\r\\n    purpose = Column(String(255), nullable=False)\\r\\n    timestamp = Column(DateTime, default=datetime.utcnow)\\r\\n    \\r\\n    user = relationship(\\\"User\\\", back_populates=\\\"data_access_logs\\\")\\r\\n\\r\\n\\r\\nclass IntegrationConfig(Base):\\r\\n    __tablename__ = \\\"integration_configs\\\"\\r\\n    id = Column(Integer, primary_key=True, autoincrement=True)\\r\\n    integration_type = Column(String(100), nullable=False) # e.g. \\\"webhook\\\", \\\"email\\\"\\r\\n    endpoint = Column(String(255), nullable=False)\\r\\n    status = Column(String(50), default=\\\"active\\\") # active, inactive\\r\\n\\r\\n\\r\\nclass BehaviorLog(Base):\\r\\n    __tablename__ = \\\"behavior_logs\\\"\\r\\n\\r\\n    id = Column(Integer, primary_key=True, autoincrement=True)\\r\\n    user_id = Column(String(36), ForeignKey(\\\"users.id\\\", ondelete=\\\"CASCADE\\\"), nullable=False, index=True)\\r\\n    device_id = Column(String(36), ForeignKey(\\\"devices.id\\\", ondelete=\\\"CASCADE\\\"), nullable=True, index=True)\\r\\n    timestamp = Column(DateTime, default=datetime.utcnow)\\r\\n    app_name = Column(String(255))\\r\\n    permission_requested = Column(String(255))\\r\\n    network_activity_level = Column(Float, default=0.0)\\r\\n    background_process_flag = Column(Boolean, default=False)\\r\\n    anomaly_flag = Column(Boolean, default=False)\\r\\n    anomaly_type = Column(String(100), nullable=True)\\r\\n    severity = Column(String(20), nullable=True)\\r\\n    anomaly_score = Column(Float, nullable=True)\\r\\n    log_data = Column(JSON, default={})\\r\\n    \\r\\n    user = relationship(\\\"User\\\", back_populates=\\\"behavior_logs\\\")\\r\\n    device = relationship(\\\"Device\\\", back_populates=\\\"behavior_logs\\\")\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\models.py\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\",\"PSChildName\":\"models.py\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/app/schemas.py\",\"content\":{\"value\":\"from pydantic import BaseModel, EmailStr, Field\\r\\nfrom typing import Optional, List, Dict, Any\\r\\nfrom datetime import datetime\\r\\nfrom enum import Enum\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Enums â”€â”€â”€â”€\\r\\nclass RoleEnum(str, Enum):\\r\\n    student = \\\"student\\\"\\r\\n    parent = \\\"parent\\\"\\r\\n    admin = \\\"admin\\\"\\r\\n\\r\\nclass RiskLevelEnum(str, Enum):\\r\\n    low = \\\"low\\\"\\r\\n    medium = \\\"medium\\\"\\r\\n    high = \\\"high\\\"\\r\\n\\r\\nclass ReportTypeEnum(str, Enum):\\r\\n    false_positive = \\\"false_positive\\\"\\r\\n    other = \\\"other\\\"\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Auth Schemas â”€â”€â”€â”€\\r\\nclass RegisterRequest(BaseModel):\\r\\n    name: str = Field(..., min_length=2, max_length=100)\\r\\n    email: EmailStr\\r\\n    college: str = Field(..., min_length=2, max_length=255)\\r\\n    password: str = Field(..., min_length=6, max_length=128)\\r\\n    role: RoleEnum = RoleEnum.student\\r\\n\\r\\n\\r\\nclass LoginRequest(BaseModel):\\r\\n    email: EmailStr\\r\\n    password: str\\r\\n\\r\\n\\r\\nclass UserResponse(BaseModel):\\r\\n    id: str\\r\\n    name: str\\r\\n    email: str\\r\\n    college: str\\r\\n    role: str\\r\\n    consent_given: bool\\r\\n    created_at: datetime\\r\\n\\r\\n    class Config:\\r\\n        from_attributes = True\\r\\n\\r\\n\\r\\nclass TokenResponse(BaseModel):\\r\\n    access_token: str\\r\\n    refresh_token: str\\r\\n    token_type: str = \\\"bearer\\\"\\r\\n    user: UserResponse\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Consent â”€â”€â”€â”€\\r\\nclass ConsentRequest(BaseModel):\\r\\n    accept_terms: bool\\r\\n    enable_monitoring: bool\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Devices â”€â”€â”€â”€\\r\\nclass RegisterDeviceRequest(BaseModel):\\r\\n    device_name: str = Field(..., max_length=255)\\r\\n    device_type: str = Field(..., max_length=100)\\r\\n\\r\\nclass DeviceResponse(BaseModel):\\r\\n    id: str\\r\\n    user_id: str\\r\\n    device_name: str\\r\\n    device_type: str\\r\\n    last_active: datetime\\r\\n    risk_score: float\\r\\n\\r\\n    class Config:\\r\\n        from_attributes = True\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Behavior Profiles â”€â”€â”€â”€\\r\\nclass BehaviorProfileResponse(BaseModel):\\r\\n    user_id: str\\r\\n    baseline_metrics: Dict[str, Any]\\r\\n    last_updated: datetime\\r\\n\\r\\n    class Config:\\r\\n        from_attributes = True\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Behavior Logs â”€â”€â”€â”€\\r\\nclass LogIngestRequest(BaseModel):\\r\\n    app_name: str = Field(..., max_length=255)\\r\\n    device_id: Optional[str] = None\\r\\n    permission_requested: str = Field(default=\\\"none\\\", max_length=255)\\r\\n    network_activity_level: float = Field(default=0.0, ge=0.0, le=100.0)\\r\\n    background_process_flag: bool = False\\r\\n    anomaly_flag: bool = False\\r\\n    extra_data: Optional[dict] = None\\r\\n\\r\\n\\r\\nclass LogResponse(BaseModel):\\r\\n    id: int\\r\\n    user_id: str\\r\\n    device_id: Optional[str]\\r\\n    timestamp: datetime\\r\\n    app_name: str\\r\\n    permission_requested: Optional[str]\\r\\n    network_activity_level: float\\r\\n    background_process_flag: bool\\r\\n    anomaly_flag: bool\\r\\n    anomaly_type: Optional[str]\\r\\n    severity: Optional[str]\\r\\n    anomaly_score: Optional[float]\\r\\n\\r\\n    class Config:\\r\\n        from_attributes = True\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Risk Score â”€â”€â”€â”€\\r\\nclass RiskScoreResponse(BaseModel):\\r\\n    current_score: float\\r\\n    risk_level: str\\r\\n    last_updated: Optional[datetime]\\r\\n\\r\\n    class Config:\\r\\n        from_attributes = True\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Alerts â”€â”€â”€â”€\\r\\nclass AlertResponse(BaseModel):\\r\\n    id: int\\r\\n    user_id: str\\r\\n    alert_type: str\\r\\n    severity: str\\r\\n    message: str\\r\\n    explanation_text: Optional[str]\\r\\n    recommendation: Optional[str]\\r\\n    confidence_score: float\\r\\n    created_at: datetime\\r\\n    resolved: bool\\r\\n\\r\\n    class Config:\\r\\n        from_attributes = True\\r\\n\\r\\n\\r\\nclass ResolveAlertRequest(BaseModel):\\r\\n    alert_id: int\\r\\n\\r\\n\\r\\nclass BlockAppRequest(BaseModel):\\r\\n    app_name: str\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Incidents â”€â”€â”€â”€\\r\\nclass ReportIncidentRequest(BaseModel):\\r\\n    alert_id: int\\r\\n    report_type: ReportTypeEnum = ReportTypeEnum.false_positive\\r\\n    description: Optional[str] = None\\r\\n\\r\\nclass IncidentResponse(BaseModel):\\r\\n    id: int\\r\\n    alert_id: int\\r\\n    user_id: str\\r\\n    report_type: str\\r\\n    description: Optional[str]\\r\\n    status: str\\r\\n    created_at: datetime\\r\\n\\r\\n    class Config:\\r\\n        from_attributes = True\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Privacy (DataAccessLogs) â”€â”€â”€â”€\\r\\nclass DataAccessLogResponse(BaseModel):\\r\\n    id: int\\r\\n    user_id: str\\r\\n    data_type: str\\r\\n    purpose: str\\r\\n    timestamp: datetime\\r\\n\\r\\n    class Config:\\r\\n        from_attributes = True\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Admin â”€â”€â”€â”€\\r\\nclass AdminStatsResponse(BaseModel):\\r\\n    total_users: int\\r\\n    total_students: int\\r\\n    total_admins: int\\r\\n    high_risk_count: int\\r\\n    medium_risk_count: int\\r\\n    low_risk_count: int\\r\\n    total_alerts: int\\r\\n    unresolved_alerts: int\\r\\n    risk_distribution: dict\\r\\n\\r\\n\\r\\nclass HighRiskUserResponse(BaseModel):\\r\\n    id: str\\r\\n    name: str\\r\\n    email: str\\r\\n    college: str\\r\\n    current_score: float\\r\\n    risk_level: str\\r\\n\\r\\n    class Config:\\r\\n        from_attributes = True\\r\\n\\r\\n# â”€â”€â”€â”€ Integration â”€â”€â”€â”€\\r\\nclass EscalateRequest(BaseModel):\\r\\n    user_id: str\\r\\n    reason: str\\r\\n\\r\\n# â”€â”€â”€â”€ Analytics â”€â”€â”€â”€\\r\\nclass TimelinePoint(BaseModel):\\r\\n    timestamp: str\\r\\n    risk_score: float\\r\\n\\r\\nclass HeatmapPoint(BaseModel):\\r\\n    hour: int\\r\\n    frequency: int\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ WebSocket â”€â”€â”€â”€\\r\\nclass WSAlertMessage(BaseModel):\\r\\n    type: str = \\\"alert\\\"\\r\\n    alert_id: int\\r\\n    alert_type: str\\r\\n    severity: str\\r\\n    message: str\\r\\n    recommendation: Optional[str]\\r\\n    timestamp: str\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Wellbeing â”€â”€â”€â”€\\r\\nclass AppUsageItem(BaseModel):\\r\\n    app_name: str\\r\\n    usage_minutes: float\\r\\n    sessions: int\\r\\n\\r\\nclass WellbeingResponse(BaseModel):\\r\\n    screen_time_hours: float\\r\\n    focus_score: int\\r\\n    daily_sessions: int\\r\\n    top_apps: list[AppUsageItem]\\r\\n    daily_trend: list[dict]\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Permission Audit â”€â”€â”€â”€\\r\\nclass PermissionBreakdown(BaseModel):\\r\\n    permission: str\\r\\n    count: int\\r\\n    percentage: float\\r\\n\\r\\nclass PermissionAuditResponse(BaseModel):\\r\\n    total_requests: int\\r\\n    breakdown: list[PermissionBreakdown]\\r\\n    risky_apps: list[str]\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Leaderboard â”€â”€â”€â”€\\r\\nclass LeaderboardResponse(BaseModel):\\r\\n    rank: int\\r\\n    total_students: int\\r\\n    percentile: int\\r\\n    user_score: float\\r\\n    campus_average: float\\r\\n    categories: dict  # { \\\"network\\\": x, \\\"permissions\\\": x, \\\"apps\\\": x, \\\"behavior\\\": x }\\r\\n    campus_categories: dict\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Training â”€â”€â”€â”€\\r\\nclass TrainingModule(BaseModel):\\r\\n    id: str\\r\\n    title: str\\r\\n    description: str\\r\\n    difficulty: str\\r\\n    duration_minutes: int\\r\\n    completed: bool\\r\\n    score: Optional[int] = None\\r\\n\\r\\nclass TrainingProgressResponse(BaseModel):\\r\\n    modules: list[TrainingModule]\\r\\n    completed_count: int\\r\\n    total_count: int\\r\\n    overall_score: int\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Admin: Activity Feed â”€â”€â”€â”€\\r\\nclass ActivityFeedItem(BaseModel):\\r\\n    id: int\\r\\n    student_name: str\\r\\n    student_email: str\\r\\n    alert_type: str\\r\\n    severity: str\\r\\n    message: str\\r\\n    created_at: datetime\\r\\n\\r\\n    class Config:\\r\\n        from_attributes = True\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Admin: Trends â”€â”€â”€â”€\\r\\nclass TrendPoint(BaseModel):\\r\\n    date: str\\r\\n    avg_risk_score: float\\r\\n    alert_count: int\\r\\n    anomaly_count: int\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Admin: College Breakdown â”€â”€â”€â”€\\r\\nclass CollegeBreakdownItem(BaseModel):\\r\\n    college: str\\r\\n    total_students: int\\r\\n    high_risk: int\\r\\n    medium_risk: int\\r\\n    low_risk: int\\r\\n    avg_score: float\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Admin: All Users â”€â”€â”€â”€\\r\\nclass UserListItem(BaseModel):\\r\\n    id: str\\r\\n    name: str\\r\\n    email: str\\r\\n    college: str\\r\\n    role: str\\r\\n    consent_given: bool\\r\\n    risk_score: Optional[float] = None\\r\\n    risk_level: Optional[str] = None\\r\\n    alert_count: int = 0\\r\\n    created_at: datetime\\r\\n\\r\\n    class Config:\\r\\n        from_attributes = True\\r\\n\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\schemas.py\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\",\"PSChildName\":\"schemas.py\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/app/seed.py\",\"content\":{\"value\":\"\\\"\\\"\\\"Seed data script: creates demo admin + student users with sample data.\\\"\\\"\\\"\\r\\nimport asyncio\\r\\nfrom datetime import datetime, timezone, timedelta\\r\\nimport random\\r\\nfrom app.database import engine, async_session, Base\\r\\nfrom app.models import User, RiskScore, Alert, BehaviorLog\\r\\nfrom app.auth import hash_password\\r\\n\\r\\n\\r\\nasync def seed():\\r\\n    async with engine.begin() as conn:\\r\\n        await conn.run_sync(Base.metadata.create_all)\\r\\n\\r\\n    async with async_session() as db:\\r\\n        from sqlalchemy import select, func\\r\\n        count = await db.execute(select(func.count(User.id)))\\r\\n        if (count.scalar() or 0) \\u003e 0:\\r\\n            print(\\\"Database already has data. Skipping seed.\\\")\\r\\n            return\\r\\n\\r\\n        # Create admin\\r\\n        admin = User(\\r\\n            name=\\\"Admin User\\\",\\r\\n            email=\\\"admin@sentinelai.com\\\",\\r\\n            college=\\\"SentinelAI HQ\\\",\\r\\n            role=\\\"admin\\\",\\r\\n            hashed_password=hash_password(\\\"admin123\\\"),\\r\\n            consent_given=True,\\r\\n        )\\r\\n        db.add(admin)\\r\\n\\r\\n        # Create demo students\\r\\n        students = []\\r\\n        for i in range(5):\\r\\n            student = User(\\r\\n                name=f\\\"Student {i+1}\\\",\\r\\n                email=f\\\"student{i+1}@university.edu\\\",\\r\\n                college=\\\"Demo University\\\",\\r\\n                role=\\\"student\\\",\\r\\n                hashed_password=hash_password(\\\"student123\\\"),\\r\\n                consent_given=True,\\r\\n            )\\r\\n            db.add(student)\\r\\n            students.append(student)\\r\\n\\r\\n        await db.flush()\\r\\n\\r\\n        apps = [\\\"WhatsApp\\\", \\\"Instagram\\\", \\\"Chrome\\\", \\\"TikTok\\\", \\\"YouTube\\\",\\r\\n                \\\"SuspiciousVPN\\\", \\\"UnknownAPK\\\", \\\"CryptoMiner\\\"]\\r\\n\\r\\n        for student in students:\\r\\n            score = round(random.uniform(10, 90), 1)\\r\\n            level = \\\"low\\\" if score \\u003c= 40 else (\\\"medium\\\" if score \\u003c= 70 else \\\"high\\\")\\r\\n            rs = RiskScore(user_id=student.id, current_score=score, risk_level=level)\\r\\n            db.add(rs)\\r\\n\\r\\n            for j in range(20):\\r\\n                is_anomaly = random.random() \\u003c 0.25\\r\\n                log = BehaviorLog(\\r\\n                    user_id=student.id,\\r\\n                    timestamp=datetime.now(timezone.utc) - timedelta(hours=random.randint(0, 48)),\\r\\n                    app_name=random.choice(apps),\\r\\n                    permission_requested=random.choice([\\\"none\\\", \\\"camera\\\", \\\"location\\\", \\\"storage\\\"]),\\r\\n                    network_activity_level=round(random.uniform(50, 95) if is_anomaly else random.uniform(5, 35), 1),\\r\\n                    background_process_flag=is_anomaly,\\r\\n                    anomaly_flag=is_anomaly,\\r\\n                )\\r\\n                db.add(log)\\r\\n\\r\\n            if score \\u003e 70:\\r\\n                for k in range(3):\\r\\n                    alert = Alert(\\r\\n                        user_id=student.id,\\r\\n                        alert_type=\\\"high_risk_behavior\\\",\\r\\n                        severity=random.choice([\\\"high\\\", \\\"critical\\\"]),\\r\\n                        message=\\\"Suspicious activity detected: elevated network usage and background processes\\\",\\r\\n                        created_at=datetime.now(timezone.utc) - timedelta(hours=random.randint(0, 24)),\\r\\n                        resolved=random.choice([True, False]),\\r\\n                    )\\r\\n                    db.add(alert)\\r\\n\\r\\n        db.add(RiskScore(user_id=admin.id, current_score=0.0, risk_level=\\\"low\\\"))\\r\\n\\r\\n        await db.commit()\\r\\n        print(\\\"Seed data created successfully!\\\")\\r\\n        print(\\\"  Admin: admin@sentinelai.com / admin123\\\")\\r\\n        print(\\\"  Students: student1@university.edu ... student5@university.edu / student123\\\")\\r\\n\\r\\n\\r\\nif __name__ == \\\"__main__\\\":\\r\\n    asyncio.run(seed())\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\seed.py\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\",\"PSChildName\":\"seed.py\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/app/simulator.py\",\"content\":{\"value\":\"import random\\r\\nimport asyncio\\r\\nimport logging\\r\\nfrom datetime import datetime, timezone\\r\\nfrom sqlalchemy.ext.asyncio import AsyncSession\\r\\nfrom app.database import async_session\\r\\nfrom app.models import User, BehaviorLog, RiskScore, Alert, Device, BehaviorProfile, DataAccessLog\\r\\nfrom app.ai_engine import calculate_risk\\r\\nfrom app.websocket_manager import manager\\r\\nfrom sqlalchemy import select\\r\\n\\r\\nlogger = logging.getLogger(__name__)\\r\\n\\r\\nAPPS = [\\r\\n    \\\"WhatsApp\\\", \\\"Instagram\\\", \\\"Chrome\\\", \\\"TikTok\\\", \\\"Snapchat\\\",\\r\\n    \\\"YouTube\\\", \\\"Telegram\\\", \\\"Facebook\\\", \\\"Calculator\\\", \\\"Camera\\\",\\r\\n    \\\"Files\\\", \\\"Settings\\\", \\\"Maps\\\", \\\"Gmail\\\", \\\"Slack\\\",\\r\\n    \\\"SuspiciousVPN\\\", \\\"UnknownAPK\\\", \\\"CryptoMiner\\\", \\\"KeyLogger\\\",\\r\\n]\\r\\n\\r\\nPERMISSIONS = [\\r\\n    \\\"none\\\", \\\"camera\\\", \\\"microphone\\\", \\\"location\\\", \\\"contacts\\\",\\r\\n    \\\"storage\\\", \\\"sms\\\", \\\"phone\\\", \\\"accessibility\\\", \\\"overlay\\\",\\r\\n]\\r\\n\\r\\nSUSPICIOUS_APPS = {\\\"SuspiciousVPN\\\", \\\"UnknownAPK\\\", \\\"CryptoMiner\\\", \\\"KeyLogger\\\"}\\r\\n\\r\\n\\r\\ndef generate_log(anomaly_chance: float = 0.2) -\\u003e dict:\\r\\n    is_anomaly = random.random() \\u003c anomaly_chance\\r\\n    app = random.choice(list(SUSPICIOUS_APPS)) if is_anomaly else random.choice(APPS[:15])\\r\\n\\r\\n    return {\\r\\n        \\\"app_name\\\": app,\\r\\n        \\\"permission_requested\\\": random.choice(PERMISSIONS[1:]) if is_anomaly or random.random() \\u003c 0.3 else \\\"none\\\",\\r\\n        \\\"network_activity_level\\\": round(random.uniform(60, 100), 1) if is_anomaly else round(random.uniform(0, 40), 1),\\r\\n        \\\"background_process_flag\\\": is_anomaly or random.random() \\u003c 0.1,\\r\\n        \\\"anomaly_flag\\\": is_anomaly,\\r\\n    }\\r\\n\\r\\n\\r\\nasync def simulate_for_device(db: AsyncSession, user_id: str, device_id: str, anomaly_chance: float = 0.2):\\r\\n    log_data = generate_log(anomaly_chance)\\r\\n\\r\\n    log_entry = BehaviorLog(\\r\\n        user_id=user_id,\\r\\n        device_id=device_id,\\r\\n        app_name=log_data[\\\"app_name\\\"],\\r\\n        permission_requested=log_data[\\\"permission_requested\\\"],\\r\\n        network_activity_level=log_data[\\\"network_activity_level\\\"],\\r\\n        background_process_flag=log_data[\\\"background_process_flag\\\"],\\r\\n        anomaly_flag=log_data[\\\"anomaly_flag\\\"],\\r\\n        log_data=log_data,\\r\\n    )\\r\\n    db.add(log_entry)\\r\\n    await db.flush()\\r\\n\\r\\n    # Privacy Transparency: Log data access for simulator AI check\\r\\n    db.add(DataAccessLog(\\r\\n        user_id=user_id, \\r\\n        data_type=\\\"Device Telemetry\\\", \\r\\n        purpose=\\\"Automated Background Anomaly Detection\\\"\\r\\n    ))\\r\\n\\r\\n    # Fetch User Baseline\\r\\n    bp_result = await db.execute(select(BehaviorProfile).where(BehaviorProfile.user_id == user_id))\\r\\n    profile = bp_result.scalar_one_or_none()\\r\\n    baseline = profile.baseline_metrics if profile else None\\r\\n\\r\\n    # Get recent logs\\r\\n    result = await db.execute(\\r\\n        select(BehaviorLog)\\r\\n        .where(BehaviorLog.user_id == user_id)\\r\\n        .order_by(BehaviorLog.timestamp.desc())\\r\\n        .limit(50)\\r\\n    )\\r\\n    recent_logs = result.scalars().all()\\r\\n    logs_dicts = [\\r\\n        {\\r\\n            \\\"permission_requested\\\": l.permission_requested,\\r\\n            \\\"network_activity_level\\\": l.network_activity_level,\\r\\n            \\\"background_process_flag\\\": l.background_process_flag,\\r\\n            \\\"anomaly_flag\\\": l.anomaly_flag,\\r\\n        }\\r\\n        for l in recent_logs\\r\\n    ]\\r\\n\\r\\n    risk = calculate_risk(logs_dicts, baseline=baseline)\\r\\n    score = risk[\\\"score\\\"]\\r\\n    level = risk[\\\"level\\\"]\\r\\n    explanation = risk.get(\\\"explanation\\\", \\\"\\\")\\r\\n    recommendation = risk.get(\\\"recommendation\\\", \\\"\\\")\\r\\n    severity = risk.get(\\\"severity\\\", \\\"high\\\")\\r\\n\\r\\n    rs_result = await db.execute(\\r\\n        select(RiskScore).where(RiskScore.user_id == user_id)\\r\\n    )\\r\\n    risk_score = rs_result.scalar_one_or_none()\\r\\n    if risk_score:\\r\\n        risk_score.current_score = score\\r\\n        risk_score.risk_level = level\\r\\n        risk_score.last_updated = datetime.now(timezone.utc)\\r\\n    else:\\r\\n        risk_score = RiskScore(user_id=user_id, current_score=score, risk_level=level)\\r\\n        db.add(risk_score)\\r\\n\\r\\n    if score \\u003e 70:\\r\\n        alert = Alert(\\r\\n            user_id=user_id,\\r\\n            alert_type=\\\"high_risk_behavior\\\",\\r\\n            severity=severity,\\r\\n            message=f\\\"Risk score {score}: suspicious activity from {log_data[\\u0027app_name\\u0027]}\\\",\\r\\n            explanation_text=explanation or f\\\"Anomalous app behavior in {log_data[\\u0027app_name\\u0027]}\\\",\\r\\n            recommendation=recommendation or \\\"Review device activity.\\\",\\r\\n            confidence_score=0.9\\r\\n        )\\r\\n        db.add(alert)\\r\\n        await db.flush()\\r\\n\\r\\n        await manager.send_to_user(str(user_id), {\\r\\n            \\\"type\\\": \\\"alert\\\",\\r\\n            \\\"alert_id\\\": alert.id,\\r\\n            \\\"alert_type\\\": alert.alert_type,\\r\\n            \\\"severity\\\": alert.severity,\\r\\n            \\\"message\\\": alert.message,\\r\\n            \\\"recommendation\\\": alert.recommendation,\\r\\n            \\\"timestamp\\\": datetime.now(timezone.utc).isoformat(),\\r\\n            \\\"risk_score\\\": score,\\r\\n        })\\r\\n\\r\\n    await db.commit()\\r\\n\\r\\n\\r\\nasync def run_simulator(interval: int = 30):\\r\\n    logger.info(f\\\"Device simulator started (interval={interval}s)\\\")\\r\\n    while True:\\r\\n        try:\\r\\n            async with async_session() as db:\\r\\n                result = await db.execute(\\r\\n                    select(User).where(\\r\\n                        User.role == \\\"student\\\",\\r\\n                        User.consent_given == True,\\r\\n                    )\\r\\n                )\\r\\n                students = result.scalars().all()\\r\\n\\r\\n                devices_simulated = 0\\r\\n                for student in students:\\r\\n                    anomaly_chance = random.uniform(0.1, 0.35)\\r\\n                    \\r\\n                    # Fetch devices\\r\\n                    dev_res = await db.execute(select(Device).where(Device.user_id == student.id))\\r\\n                    devices = dev_res.scalars().all()\\r\\n                    \\r\\n                    if not devices:\\r\\n                        # Auto register default device if none exist\\r\\n                        main_device = Device(user_id=student.id, device_name=\\\"Main Phone\\\", device_type=\\\"smartphone\\\")\\r\\n                        db.add(main_device)\\r\\n                        await db.commit()\\r\\n                        await db.refresh(main_device)\\r\\n                        devices = [main_device]\\r\\n                        \\r\\n                    for d in devices:\\r\\n                        await simulate_for_device(db, student.id, d.id, anomaly_chance)\\r\\n                        devices_simulated += 1\\r\\n\\r\\n                if devices_simulated \\u003e 0:\\r\\n                    logger.info(f\\\"Simulated logs for {devices_simulated} devices across {len(students)} students\\\")\\r\\n\\r\\n        except Exception as e:\\r\\n            logger.error(f\\\"Simulator error: {e}\\\")\\r\\n\\r\\n        await asyncio.sleep(interval)\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\simulator.py\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\",\"PSChildName\":\"simulator.py\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/app/websocket_manager.py\",\"content\":{\"value\":\"from fastapi import WebSocket\\r\\nfrom typing import Dict, List\\r\\nimport json\\r\\nimport logging\\r\\n\\r\\nlogger = logging.getLogger(__name__)\\r\\n\\r\\n\\r\\nclass ConnectionManager:\\r\\n    \\\"\\\"\\\"Manages WebSocket connections per user for real-time alerts.\\\"\\\"\\\"\\r\\n\\r\\n    def __init__(self):\\r\\n        self.active_connections: Dict[str, List[WebSocket]] = {}\\r\\n\\r\\n    async def connect(self, websocket: WebSocket, user_id: str):\\r\\n        await websocket.accept()\\r\\n        if user_id not in self.active_connections:\\r\\n            self.active_connections[user_id] = []\\r\\n        self.active_connections[user_id].append(websocket)\\r\\n        logger.info(f\\\"WebSocket connected for user {user_id}\\\")\\r\\n\\r\\n    def disconnect(self, websocket: WebSocket, user_id: str):\\r\\n        if user_id in self.active_connections:\\r\\n            self.active_connections[user_id] = [\\r\\n                ws for ws in self.active_connections[user_id] if ws != websocket\\r\\n            ]\\r\\n            if not self.active_connections[user_id]:\\r\\n                del self.active_connections[user_id]\\r\\n        logger.info(f\\\"WebSocket disconnected for user {user_id}\\\")\\r\\n\\r\\n    async def send_to_user(self, user_id: str, message: dict):\\r\\n        if user_id in self.active_connections:\\r\\n            dead = []\\r\\n            for ws in self.active_connections[user_id]:\\r\\n                try:\\r\\n                    await ws.send_text(json.dumps(message))\\r\\n                except Exception:\\r\\n                    dead.append(ws)\\r\\n            for ws in dead:\\r\\n                self.active_connections[user_id].remove(ws)\\r\\n\\r\\n    async def broadcast(self, message: dict):\\r\\n        for user_id in list(self.active_connections.keys()):\\r\\n            await self.send_to_user(user_id, message)\\r\\n\\r\\n    @property\\r\\n    def connected_count(self) -\\u003e int:\\r\\n        return sum(len(conns) for conns in self.active_connections.values())\\r\\n\\r\\n\\r\\nmanager = ConnectionManager()\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\websocket_manager.py\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\",\"PSChildName\":\"websocket_manager.py\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/app/routers/__init__.py\",\"content\":\"\"},{\"path\":\"backend/app/routers/admin_router.py\",\"content\":{\"value\":\"from fastapi import APIRouter, Depends, Query\\r\\nfrom fastapi.responses import StreamingResponse\\r\\nfrom sqlalchemy.ext.asyncio import AsyncSession\\r\\nfrom sqlalchemy import select, func, case, and_\\r\\nfrom sqlalchemy.orm import selectinload\\r\\nfrom typing import List\\r\\nfrom datetime import datetime, timezone, timedelta\\r\\nimport csv\\r\\nimport io\\r\\n\\r\\nfrom app.database import get_db\\r\\nfrom app.models import User, RiskScore, Alert, BehaviorLog\\r\\nfrom app.schemas import (\\r\\n    AdminStatsResponse, HighRiskUserResponse,\\r\\n    ActivityFeedItem, TrendPoint, CollegeBreakdownItem, UserListItem,\\r\\n)\\r\\nfrom app.deps import require_admin\\r\\n\\r\\nrouter = APIRouter(prefix=\\\"/api/admin\\\", tags=[\\\"admin\\\"])\\r\\n\\r\\n\\r\\n@router.get(\\\"/stats\\\", response_model=AdminStatsResponse)\\r\\nasync def get_stats(\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    admin: User = Depends(require_admin),\\r\\n):\\r\\n    total_result = await db.execute(select(func.count(User.id)))\\r\\n    total_users = total_result.scalar() or 0\\r\\n\\r\\n    students_result = await db.execute(\\r\\n        select(func.count(User.id)).where(User.role == \\\"student\\\")\\r\\n    )\\r\\n    total_students = students_result.scalar() or 0\\r\\n\\r\\n    admins_result = await db.execute(\\r\\n        select(func.count(User.id)).where(User.role == \\\"admin\\\")\\r\\n    )\\r\\n    total_admins = admins_result.scalar() or 0\\r\\n\\r\\n    high_result = await db.execute(\\r\\n        select(func.count(RiskScore.id)).where(RiskScore.risk_level == \\\"high\\\")\\r\\n    )\\r\\n    high_risk = high_result.scalar() or 0\\r\\n\\r\\n    medium_result = await db.execute(\\r\\n        select(func.count(RiskScore.id)).where(RiskScore.risk_level == \\\"medium\\\")\\r\\n    )\\r\\n    medium_risk = medium_result.scalar() or 0\\r\\n\\r\\n    low_result = await db.execute(\\r\\n        select(func.count(RiskScore.id)).where(RiskScore.risk_level == \\\"low\\\")\\r\\n    )\\r\\n    low_risk = low_result.scalar() or 0\\r\\n\\r\\n    alerts_result = await db.execute(select(func.count(Alert.id)))\\r\\n    total_alerts = alerts_result.scalar() or 0\\r\\n\\r\\n    unresolved_result = await db.execute(\\r\\n        select(func.count(Alert.id)).where(Alert.resolved == False)\\r\\n    )\\r\\n    unresolved_alerts = unresolved_result.scalar() or 0\\r\\n\\r\\n    return AdminStatsResponse(\\r\\n        total_users=total_users,\\r\\n        total_students=total_students,\\r\\n        total_admins=total_admins,\\r\\n        high_risk_count=high_risk,\\r\\n        medium_risk_count=medium_risk,\\r\\n        low_risk_count=low_risk,\\r\\n        total_alerts=total_alerts,\\r\\n        unresolved_alerts=unresolved_alerts,\\r\\n        risk_distribution={\\\"high\\\": high_risk, \\\"medium\\\": medium_risk, \\\"low\\\": low_risk},\\r\\n    )\\r\\n\\r\\n\\r\\n@router.get(\\\"/high-risk-users\\\", response_model=List[HighRiskUserResponse])\\r\\nasync def get_high_risk_users(\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    admin: User = Depends(require_admin),\\r\\n):\\r\\n    result = await db.execute(\\r\\n        select(User, RiskScore)\\r\\n        .join(RiskScore, User.id == RiskScore.user_id)\\r\\n        .where(RiskScore.current_score \\u003e 70)\\r\\n        .order_by(RiskScore.current_score.desc())\\r\\n    )\\r\\n    rows = result.all()\\r\\n    return [\\r\\n        HighRiskUserResponse(\\r\\n            id=user.id,\\r\\n            name=user.name,\\r\\n            email=user.email,\\r\\n            college=user.college,\\r\\n            current_score=risk.current_score,\\r\\n            risk_level=risk.risk_level,\\r\\n        )\\r\\n        for user, risk in rows\\r\\n    ]\\r\\n\\r\\n\\r\\n@router.get(\\\"/export-report\\\")\\r\\nasync def export_report(\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    admin: User = Depends(require_admin),\\r\\n):\\r\\n    result = await db.execute(\\r\\n        select(User, RiskScore)\\r\\n        .join(RiskScore, User.id == RiskScore.user_id)\\r\\n        .order_by(RiskScore.current_score.desc())\\r\\n    )\\r\\n    rows = result.all()\\r\\n\\r\\n    output = io.StringIO()\\r\\n    writer = csv.writer(output)\\r\\n    writer.writerow([\\\"Name\\\", \\\"Email\\\", \\\"College\\\", \\\"Role\\\", \\\"Risk Score\\\", \\\"Risk Level\\\"])\\r\\n    for user, risk in rows:\\r\\n        writer.writerow([\\r\\n            user.name, user.email, user.college, user.role,\\r\\n            risk.current_score, risk.risk_level,\\r\\n        ])\\r\\n\\r\\n    output.seek(0)\\r\\n    return StreamingResponse(\\r\\n        iter([output.getvalue()]),\\r\\n        media_type=\\\"text/csv\\\",\\r\\n        headers={\\\"Content-Disposition\\\": \\\"attachment; filename=sentinel_report.csv\\\"},\\r\\n    )\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Activity Feed â”€â”€â”€â”€\\r\\n@router.get(\\\"/activity-feed\\\", response_model=List[ActivityFeedItem])\\r\\nasync def get_activity_feed(\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    admin: User = Depends(require_admin),\\r\\n    limit: int = Query(50, le=100),\\r\\n):\\r\\n    result = await db.execute(\\r\\n        select(Alert, User.name, User.email)\\r\\n        .join(User, User.id == Alert.user_id)\\r\\n        .order_by(Alert.created_at.desc())\\r\\n        .limit(limit)\\r\\n    )\\r\\n    rows = result.all()\\r\\n    return [\\r\\n        ActivityFeedItem(\\r\\n            id=alert.id,\\r\\n            student_name=name,\\r\\n            student_email=email,\\r\\n            alert_type=alert.alert_type,\\r\\n            severity=alert.severity,\\r\\n            message=alert.message,\\r\\n            created_at=alert.created_at,\\r\\n        )\\r\\n        for alert, name, email in rows\\r\\n    ]\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Trend Analytics â”€â”€â”€â”€\\r\\n@router.get(\\\"/trends\\\", response_model=List[TrendPoint])\\r\\nasync def get_trends(\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    admin: User = Depends(require_admin),\\r\\n    days: int = Query(14, le=30),\\r\\n):\\r\\n    trends = []\\r\\n    now = datetime.now(timezone.utc)\\r\\n\\r\\n    for i in range(days, 0, -1):\\r\\n        day_start = (now - timedelta(days=i)).replace(hour=0, minute=0, second=0, microsecond=0)\\r\\n        day_end = day_start + timedelta(days=1)\\r\\n\\r\\n        # Average risk score across all students\\r\\n        score_result = await db.execute(\\r\\n            select(func.avg(RiskScore.current_score))\\r\\n        )\\r\\n        avg_score = score_result.scalar() or 0\\r\\n\\r\\n        # Alerts created that day\\r\\n        alert_result = await db.execute(\\r\\n            select(func.count(Alert.id)).where(\\r\\n                and_(Alert.created_at \\u003e= day_start, Alert.created_at \\u003c day_end)\\r\\n            )\\r\\n        )\\r\\n        alert_count = alert_result.scalar() or 0\\r\\n\\r\\n        # Anomalies that day\\r\\n        anomaly_result = await db.execute(\\r\\n            select(func.count(BehaviorLog.id)).where(\\r\\n                and_(\\r\\n                    BehaviorLog.timestamp \\u003e= day_start,\\r\\n                    BehaviorLog.timestamp \\u003c day_end,\\r\\n                    BehaviorLog.anomaly_flag == True,\\r\\n                )\\r\\n            )\\r\\n        )\\r\\n        anomaly_count = anomaly_result.scalar() or 0\\r\\n\\r\\n        trends.append(TrendPoint(\\r\\n            date=day_start.strftime(\\\"%b %d\\\"),\\r\\n            avg_risk_score=round(float(avg_score), 1),\\r\\n            alert_count=alert_count,\\r\\n            anomaly_count=anomaly_count,\\r\\n        ))\\r\\n\\r\\n    return trends\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ College Breakdown â”€â”€â”€â”€\\r\\n@router.get(\\\"/college-breakdown\\\", response_model=List[CollegeBreakdownItem])\\r\\nasync def get_college_breakdown(\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    admin: User = Depends(require_admin),\\r\\n):\\r\\n    # Get all students with their risk scores grouped by college\\r\\n    result = await db.execute(\\r\\n        select(\\r\\n            User.college,\\r\\n            func.count(User.id).label(\\\"total\\\"),\\r\\n            func.sum(case((RiskScore.risk_level == \\\"high\\\", 1), else_=0)).label(\\\"high\\\"),\\r\\n            func.sum(case((RiskScore.risk_level == \\\"medium\\\", 1), else_=0)).label(\\\"medium\\\"),\\r\\n            func.sum(case((RiskScore.risk_level == \\\"low\\\", 1), else_=0)).label(\\\"low\\\"),\\r\\n            func.avg(RiskScore.current_score).label(\\\"avg_score\\\"),\\r\\n        )\\r\\n        .join(RiskScore, User.id == RiskScore.user_id)\\r\\n        .where(User.role == \\\"student\\\")\\r\\n        .group_by(User.college)\\r\\n        .order_by(func.avg(RiskScore.current_score).desc())\\r\\n    )\\r\\n    rows = result.all()\\r\\n    return [\\r\\n        CollegeBreakdownItem(\\r\\n            college=r.college,\\r\\n            total_students=r.total,\\r\\n            high_risk=r.high or 0,\\r\\n            medium_risk=r.medium or 0,\\r\\n            low_risk=r.low or 0,\\r\\n            avg_score=round(float(r.avg_score or 0), 1),\\r\\n        )\\r\\n        for r in rows\\r\\n    ]\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ All Users â”€â”€â”€â”€\\r\\n@router.get(\\\"/all-users\\\", response_model=List[UserListItem])\\r\\nasync def get_all_users(\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    admin: User = Depends(require_admin),\\r\\n    search: str = Query(\\\"\\\", description=\\\"Search by name or email\\\"),\\r\\n    role_filter: str = Query(\\\"all\\\", description=\\\"Filter by role\\\"),\\r\\n):\\r\\n    query = (\\r\\n        select(User, RiskScore.current_score, RiskScore.risk_level)\\r\\n        .outerjoin(RiskScore, User.id == RiskScore.user_id)\\r\\n    )\\r\\n\\r\\n    if search:\\r\\n        query = query.where(\\r\\n            User.name.ilike(f\\\"%{search}%\\\") | User.email.ilike(f\\\"%{search}%\\\")\\r\\n        )\\r\\n    if role_filter != \\\"all\\\":\\r\\n        query = query.where(User.role == role_filter)\\r\\n\\r\\n    query = query.order_by(User.created_at.desc())\\r\\n    result = await db.execute(query)\\r\\n    rows = result.all()\\r\\n\\r\\n    items = []\\r\\n    for user, score, level in rows:\\r\\n        # Count alerts for user\\r\\n        alert_result = await db.execute(\\r\\n            select(func.count(Alert.id)).where(Alert.user_id == user.id)\\r\\n        )\\r\\n        alert_count = alert_result.scalar() or 0\\r\\n\\r\\n        items.append(UserListItem(\\r\\n            id=user.id,\\r\\n            name=user.name,\\r\\n            email=user.email,\\r\\n            college=user.college,\\r\\n            role=user.role,\\r\\n            consent_given=user.consent_given,\\r\\n            risk_score=round(float(score), 1) if score else None,\\r\\n            risk_level=level,\\r\\n            alert_count=alert_count,\\r\\n            created_at=user.created_at,\\r\\n        ))\\r\\n\\r\\n    return items\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\routers\\\\admin_router.py\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\routers\",\"PSChildName\":\"admin_router.py\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/app/routers/anomalies_router.py\",\"content\":{\"value\":\"from fastapi import APIRouter, Depends, HTTPException\\r\\nfrom sqlalchemy.ext.asyncio import AsyncSession\\r\\nfrom sqlalchemy import select, func\\r\\nfrom typing import List\\r\\nfrom datetime import datetime, timedelta, timezone\\r\\nfrom app.database import get_db\\r\\nfrom app.models import BehaviorLog, User\\r\\nfrom app.schemas import TimelinePoint, HeatmapPoint\\r\\nfrom app.deps import get_current_user\\r\\nimport random\\r\\n\\r\\nrouter = APIRouter(prefix=\\\"/api/anomalies\\\", tags=[\\\"anomalies\\\"])\\r\\n\\r\\n@router.get(\\\"/timeline\\\", response_model=List[TimelinePoint])\\r\\nasync def get_anomaly_timeline(\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(get_current_user)\\r\\n):\\r\\n    # For a real implementation, we\\u0027d group logs by hour/minute and average the score.\\r\\n    # Since sqlite/asyncpg date math varies, we\\u0027ll fetch the last 24 hours of logs\\r\\n    # and organize them in python, or simply mock a timeline if few logs exist.\\r\\n    \\r\\n    time_limit = datetime.utcnow() - timedelta(hours=24)\\r\\n    result = await db.execute(\\r\\n        select(BehaviorLog.timestamp, BehaviorLog.anomaly_score)\\r\\n        .where(BehaviorLog.user_id == user.id, BehaviorLog.timestamp \\u003e= time_limit)\\r\\n        .order_by(BehaviorLog.timestamp.asc())\\r\\n    )\\r\\n    \\r\\n    logs = result.all()\\r\\n    \\r\\n    if len(logs) \\u003c 10:\\r\\n        # Generate stable mock data for the demo if insufficient logs\\r\\n        base_time = datetime.utcnow() - timedelta(hours=12)\\r\\n        mock_timeline = []\\r\\n        for i in range(12):\\r\\n            point_time = base_time + timedelta(hours=i)\\r\\n            mock_timeline.append(TimelinePoint(\\r\\n                timestamp=point_time.strftime(\\\"%H:%M\\\"),\\r\\n                risk_score=random.uniform(10.0, 45.0) if i != 8 else random.uniform(80.0, 95.0) # spike at hour 8\\r\\n            ))\\r\\n        return mock_timeline\\r\\n        \\r\\n    # Group by hour\\r\\n    grouped = {}\\r\\n    for timestamp, score in logs:\\r\\n        hour_key = timestamp.strftime(\\\"%H:00\\\")\\r\\n        if hour_key not in grouped:\\r\\n            grouped[hour_key] = []\\r\\n        grouped[hour_key].append(score or 0.0)\\r\\n        \\r\\n    timeline = []\\r\\n    for hour, scores in grouped.items():\\r\\n        avg_score = sum(scores) / len(scores)\\r\\n        timeline.append(TimelinePoint(timestamp=hour, risk_score=round(avg_score, 1)))\\r\\n        \\r\\n    return timeline\\r\\n\\r\\n@router.get(\\\"/heatmap\\\", response_model=List[HeatmapPoint])\\r\\nasync def get_anomaly_heatmap(\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(get_current_user)\\r\\n):\\r\\n    # Heatmap of hour of day vs frequency of high-risk anomalies\\r\\n    # Returning a simulated heatmap pattern for the dashboard\\r\\n    \\r\\n    heatmap = []\\r\\n    # 24 hours\\r\\n    for h in range(24):\\r\\n        # Higher frequency during night hours (simulated anomaly pattern)\\r\\n        if 1 \\u003c= h \\u003c= 4:\\r\\n            freq = random.randint(5, 15)\\r\\n        elif 9 \\u003c= h \\u003c= 17:\\r\\n            freq = random.randint(0, 3)\\r\\n        else:\\r\\n            freq = random.randint(0, 5)\\r\\n            \\r\\n        heatmap.append(HeatmapPoint(hour=h, frequency=freq))\\r\\n        \\r\\n    return heatmap\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\routers\\\\anomalies_router.py\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\routers\",\"PSChildName\":\"anomalies_router.py\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/app/routers/auth_router.py\",\"content\":{\"value\":\"from fastapi import APIRouter, Depends, HTTPException, status\\r\\nfrom sqlalchemy.ext.asyncio import AsyncSession\\r\\nfrom sqlalchemy import select\\r\\nfrom app.database import get_db\\r\\nfrom app.models import User, RiskScore\\r\\nfrom app.schemas import (\\r\\n    RegisterRequest, LoginRequest, TokenResponse, UserResponse, ConsentRequest\\r\\n)\\r\\nfrom app.auth import hash_password, verify_password, create_access_token, create_refresh_token\\r\\nfrom app.deps import get_current_user\\r\\n\\r\\nrouter = APIRouter(prefix=\\\"/api\\\", tags=[\\\"auth\\\"])\\r\\n\\r\\n\\r\\n@router.post(\\\"/register\\\", response_model=UserResponse, status_code=status.HTTP_201_CREATED)\\r\\nasync def register(req: RegisterRequest, db: AsyncSession = Depends(get_db)):\\r\\n    result = await db.execute(select(User).where(User.email == req.email))\\r\\n    if result.scalar_one_or_none():\\r\\n        raise HTTPException(status_code=400, detail=\\\"Email already registered\\\")\\r\\n\\r\\n    user = User(\\r\\n        name=req.name,\\r\\n        email=req.email,\\r\\n        college=req.college,\\r\\n        role=req.role.value,\\r\\n        hashed_password=hash_password(req.password),\\r\\n    )\\r\\n    db.add(user)\\r\\n    await db.flush()\\r\\n\\r\\n    risk_score = RiskScore(user_id=user.id, current_score=0.0, risk_level=\\\"low\\\")\\r\\n    db.add(risk_score)\\r\\n    await db.commit()\\r\\n    await db.refresh(user)\\r\\n    return user\\r\\n\\r\\n\\r\\n@router.post(\\\"/login\\\", response_model=TokenResponse)\\r\\nasync def login(req: LoginRequest, db: AsyncSession = Depends(get_db)):\\r\\n    result = await db.execute(select(User).where(User.email == req.email))\\r\\n    user = result.scalar_one_or_none()\\r\\n    if not user or not verify_password(req.password, user.hashed_password):\\r\\n        raise HTTPException(status_code=401, detail=\\\"Invalid email or password\\\")\\r\\n\\r\\n    access_token = create_access_token({\\\"sub\\\": str(user.id), \\\"role\\\": user.role})\\r\\n    refresh_token = create_refresh_token({\\\"sub\\\": str(user.id)})\\r\\n\\r\\n    return TokenResponse(\\r\\n        access_token=access_token,\\r\\n        refresh_token=refresh_token,\\r\\n        user=UserResponse.model_validate(user),\\r\\n    )\\r\\n\\r\\n\\r\\n@router.get(\\\"/profile\\\", response_model=UserResponse)\\r\\nasync def get_profile(user: User = Depends(get_current_user)):\\r\\n    return user\\r\\n\\r\\n\\r\\n@router.post(\\\"/consent\\\", response_model=UserResponse)\\r\\nasync def give_consent(\\r\\n    req: ConsentRequest,\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(get_current_user),\\r\\n):\\r\\n    if not req.accept_terms or not req.enable_monitoring:\\r\\n        raise HTTPException(status_code=400, detail=\\\"You must accept terms and enable monitoring\\\")\\r\\n\\r\\n    user.consent_given = True\\r\\n    await db.commit()\\r\\n    await db.refresh(user)\\r\\n    return user\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\routers\\\\auth_router.py\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\routers\",\"PSChildName\":\"auth_router.py\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/app/routers/devices_router.py\",\"content\":{\"value\":\"from fastapi import APIRouter, Depends, HTTPException, status\\r\\nfrom sqlalchemy.ext.asyncio import AsyncSession\\r\\nfrom sqlalchemy import select\\r\\nfrom typing import List\\r\\nfrom app.database import get_db\\r\\nfrom app.models import Device, User\\r\\nfrom app.schemas import RegisterDeviceRequest, DeviceResponse\\r\\nfrom app.deps import get_current_user\\r\\n\\r\\nrouter = APIRouter(prefix=\\\"/api/devices\\\", tags=[\\\"devices\\\"])\\r\\n\\r\\n@router.post(\\\"/register\\\", response_model=DeviceResponse, status_code=status.HTTP_201_CREATED)\\r\\nasync def register_device(\\r\\n    req: RegisterDeviceRequest, \\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(get_current_user)\\r\\n):\\r\\n    device = Device(\\r\\n        user_id=user.id,\\r\\n        device_name=req.device_name,\\r\\n        device_type=req.device_type,\\r\\n        risk_score=0.0\\r\\n    )\\r\\n    db.add(device)\\r\\n    await db.commit()\\r\\n    await db.refresh(device)\\r\\n    return device\\r\\n\\r\\n@router.get(\\\"\\\", response_model=List[DeviceResponse])\\r\\nasync def get_devices(\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(get_current_user)\\r\\n):\\r\\n    result = await db.execute(select(Device).where(Device.user_id == user.id))\\r\\n    devices = result.scalars().all()\\r\\n    return devices\\r\\n\\r\\n@router.get(\\\"/{device_id}/risk\\\", response_model=float)\\r\\nasync def get_device_risk(\\r\\n    device_id: str,\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(get_current_user)\\r\\n):\\r\\n    result = await db.execute(\\r\\n        select(Device).where(Device.id == device_id, Device.user_id == user.id)\\r\\n    )\\r\\n    device = result.scalar_one_or_none()\\r\\n    if not device:\\r\\n        raise HTTPException(status_code=404, detail=\\\"Device not found\\\")\\r\\n    \\r\\n    return device.risk_score\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\routers\\\\devices_router.py\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\routers\",\"PSChildName\":\"devices_router.py\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/app/routers/escalate_router.py\",\"content\":{\"value\":\"from fastapi import APIRouter, Depends, HTTPException, status\\r\\nfrom sqlalchemy.ext.asyncio import AsyncSession\\r\\nfrom sqlalchemy import select\\r\\nfrom app.database import get_db\\r\\nfrom app.models import User, IntegrationConfig\\r\\nfrom app.schemas import EscalateRequest\\r\\nfrom app.deps import get_current_user\\r\\n\\r\\nrouter = APIRouter(prefix=\\\"/api/escalate\\\", tags=[\\\"escalate\\\"])\\r\\n\\r\\n@router.post(\\\"\\\", status_code=status.HTTP_200_OK)\\r\\nasync def escalate_incident(\\r\\n    req: EscalateRequest, \\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(get_current_user)\\r\\n):\\r\\n    # Retrieve active integration hooks for the campus IT center\\r\\n    result = await db.execute(select(IntegrationConfig).where(IntegrationConfig.status == \\\"active\\\"))\\r\\n    configs = result.scalars().all()\\r\\n    \\r\\n    if not configs:\\r\\n        # In a real app we\\u0027d just log this. For the demo, we return a success response \\r\\n        # acknowledging the simulated escalation to Campus IT.\\r\\n        return {\\r\\n            \\\"status\\\": \\\"success\\\", \\r\\n            \\\"message\\\": f\\\"Escalated high-risk alert for user {req.user_id} to Campus IT.\\\",\\r\\n            \\\"hooks_triggered\\\": 0\\r\\n        }\\r\\n        \\r\\n    return {\\r\\n        \\\"status\\\": \\\"success\\\", \\r\\n        \\\"message\\\": f\\\"Escalated high-risk alert for user {req.user_id} to Campus IT.\\\",\\r\\n        \\\"hooks_triggered\\\": len(configs)\\r\\n    }\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\routers\\\\escalate_router.py\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\routers\",\"PSChildName\":\"escalate_router.py\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/app/routers/incidents_router.py\",\"content\":{\"value\":\"from fastapi import APIRouter, Depends, HTTPException, status\\r\\nfrom sqlalchemy.ext.asyncio import AsyncSession\\r\\nfrom sqlalchemy import select, update\\r\\nfrom typing import List\\r\\nfrom app.database import get_db\\r\\nfrom app.models import Incident, User, Alert\\r\\nfrom app.schemas import ReportIncidentRequest, IncidentResponse\\r\\nfrom app.deps import get_current_user\\r\\n\\r\\nrouter = APIRouter(prefix=\\\"/api/incidents\\\", tags=[\\\"incidents\\\"])\\r\\n\\r\\n@router.post(\\\"/report\\\", response_model=IncidentResponse, status_code=status.HTTP_201_CREATED)\\r\\nasync def report_incident(\\r\\n    req: ReportIncidentRequest, \\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(get_current_user)\\r\\n):\\r\\n    # Verify the alert exists and belongs to the user\\r\\n    result = await db.execute(select(Alert).where(Alert.id == req.alert_id, Alert.user_id == user.id))\\r\\n    alert = result.scalar_one_or_none()\\r\\n    \\r\\n    if not alert:\\r\\n        raise HTTPException(status_code=404, detail=\\\"Alert not found\\\")\\r\\n        \\r\\n    incident = Incident(\\r\\n        alert_id=req.alert_id,\\r\\n        user_id=user.id,\\r\\n        report_type=req.report_type.value,\\r\\n        description=req.description,\\r\\n        status=\\\"open\\\"\\r\\n    )\\r\\n    db.add(incident)\\r\\n    \\r\\n    # Optionally mark the alert as resolved since they reported it as false positive\\r\\n    alert.resolved = True\\r\\n    \\r\\n    await db.commit()\\r\\n    await db.refresh(incident)\\r\\n    return incident\\r\\n\\r\\n@router.get(\\\"\\\", response_model=List[IncidentResponse])\\r\\nasync def get_incidents(\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(get_current_user)\\r\\n):\\r\\n    if user.role == \\\"admin\\\":\\r\\n        result = await db.execute(select(Incident).order_by(Incident.created_at.desc()))\\r\\n    else:\\r\\n        result = await db.execute(select(Incident).where(Incident.user_id == user.id).order_by(Incident.created_at.desc()))\\r\\n        \\r\\n    return result.scalars().all()\\r\\n\\r\\n@router.patch(\\\"/{incident_id}/status\\\", response_model=IncidentResponse)\\r\\nasync def update_incident_status(\\r\\n    incident_id: int,\\r\\n    status: str,\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(get_current_user)\\r\\n):\\r\\n    # Only admins can update status typically, but allowing for demo purposes\\r\\n    if user.role != \\\"admin\\\" and status != \\\"resolved\\\":\\r\\n        raise HTTPException(status_code=403, detail=\\\"Not authorized to change status to anything but resolved\\\")\\r\\n        \\r\\n    result = await db.execute(select(Incident).where(Incident.id == incident_id))\\r\\n    incident = result.scalar_one_or_none()\\r\\n    \\r\\n    if not incident:\\r\\n        raise HTTPException(status_code=404, detail=\\\"Incident not found\\\")\\r\\n        \\r\\n    # Security: Ensure users can only update their own incidents if they aren\\u0027t admin\\r\\n    if user.role != \\\"admin\\\" and incident.user_id != user.id:\\r\\n        raise HTTPException(status_code=403, detail=\\\"Not authorized\\\")\\r\\n        \\r\\n    incident.status = status\\r\\n    await db.commit()\\r\\n    await db.refresh(incident)\\r\\n    return incident\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\routers\\\\incidents_router.py\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\routers\",\"PSChildName\":\"incidents_router.py\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/app/routers/logs_router.py\",\"content\":{\"value\":\"from fastapi import APIRouter, Depends, HTTPException\\r\\nfrom sqlalchemy.ext.asyncio import AsyncSession\\r\\nfrom sqlalchemy import select\\r\\nfrom datetime import datetime, timezone\\r\\nfrom typing import List\\r\\nfrom app.database import get_db\\r\\nfrom app.models import User, BehaviorLog, RiskScore, Alert, BehaviorProfile, DataAccessLog\\r\\nfrom app.schemas import LogIngestRequest, LogResponse, RiskScoreResponse, AlertResponse\\r\\nfrom app.deps import get_current_user, require_consent\\r\\nfrom app.ai_engine import calculate_risk\\r\\nfrom app.websocket_manager import manager\\r\\n\\r\\nrouter = APIRouter(prefix=\\\"/api\\\", tags=[\\\"logs\\\"])\\r\\n\\r\\n\\r\\n@router.post(\\\"/logs\\\", response_model=LogResponse)\\r\\nasync def ingest_log(\\r\\n    req: LogIngestRequest,\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(require_consent),\\r\\n):\\r\\n    log_entry = BehaviorLog(\\r\\n        user_id=user.id,\\r\\n        device_id=req.device_id,\\r\\n        app_name=req.app_name,\\r\\n        permission_requested=req.permission_requested,\\r\\n        network_activity_level=req.network_activity_level,\\r\\n        background_process_flag=req.background_process_flag,\\r\\n        anomaly_flag=req.anomaly_flag,\\r\\n        log_data=req.extra_data or {},\\r\\n    )\\r\\n    db.add(log_entry)\\r\\n    await db.flush()\\r\\n\\r\\n    # Recalculate risk score\\r\\n    result = await db.execute(\\r\\n        select(BehaviorLog)\\r\\n        .where(BehaviorLog.user_id == user.id)\\r\\n        .order_by(BehaviorLog.timestamp.desc())\\r\\n        .limit(50)\\r\\n    )\\r\\n    recent = result.scalars().all()\\r\\n    logs_data = [\\r\\n        {\\r\\n            \\\"permission_requested\\\": l.permission_requested,\\r\\n            \\\"network_activity_level\\\": l.network_activity_level,\\r\\n            \\\"background_process_flag\\\": l.background_process_flag,\\r\\n            \\\"anomaly_flag\\\": l.anomaly_flag,\\r\\n        }\\r\\n        for l in recent\\r\\n    ]\\r\\n\\r\\n    # Privacy Transparency: Log data access for AI calculation\\r\\n    db.add(DataAccessLog(\\r\\n        user_id=user.id, \\r\\n        data_type=\\\"Behavioral History\\\", \\r\\n        purpose=\\\"AI Risk Score Calculation and Deviation Check\\\"\\r\\n    ))\\r\\n\\r\\n    # Fetch User Baseline\\r\\n    bp_result = await db.execute(select(BehaviorProfile).where(BehaviorProfile.user_id == user.id))\\r\\n    profile = bp_result.scalar_one_or_none()\\r\\n    baseline = profile.baseline_metrics if profile else None\\r\\n\\r\\n    # Calculate Risk using personalized baseline logic\\r\\n    risk = calculate_risk(logs_data, baseline=baseline)\\r\\n\\r\\n    # Update risk score\\r\\n    rs_result = await db.execute(select(RiskScore).where(RiskScore.user_id == user.id))\\r\\n    risk_score = rs_result.scalar_one_or_none()\\r\\n    if risk_score:\\r\\n        risk_score.current_score = risk[\\\"score\\\"]\\r\\n        risk_score.risk_level = risk[\\\"level\\\"]\\r\\n        risk_score.last_updated = datetime.now(timezone.utc)\\r\\n    else:\\r\\n        risk_score = RiskScore(\\r\\n            user_id=user.id, current_score=risk[\\\"score\\\"], risk_level=risk[\\\"level\\\"]\\r\\n        )\\r\\n        db.add(risk_score)\\r\\n\\r\\n    # Alert if high risk\\r\\n    if risk[\\\"score\\\"] \\u003e 70:\\r\\n        alert = Alert(\\r\\n            user_id=user.id,\\r\\n            alert_type=\\\"high_risk_behavior\\\",\\r\\n            severity=risk.get(\\\"severity\\\", \\\"high\\\"),\\r\\n            message=f\\\"Risk score {risk[\\u0027score\\u0027]}: suspicious activity from {req.app_name}\\\",\\r\\n            explanation_text=risk.get(\\\"explanation\\\", f\\\"High risk score detected from excessive permissions or background activity in {req.app_name}.\\\"),\\r\\n            recommendation=risk.get(\\\"recommendation\\\", \\\"Review the app\\u0027s requested permissions and consider blocking or uninstalling it.\\\"),\\r\\n            confidence_score=0.95\\r\\n        )\\r\\n        db.add(alert)\\r\\n        await db.flush()\\r\\n\\r\\n        await manager.send_to_user(str(user.id), {\\r\\n            \\\"type\\\": \\\"alert\\\",\\r\\n            \\\"alert_id\\\": alert.id,\\r\\n            \\\"alert_type\\\": alert.alert_type,\\r\\n            \\\"severity\\\": alert.severity,\\r\\n            \\\"message\\\": alert.message,\\r\\n            \\\"recommendation\\\": alert.recommendation,\\r\\n            \\\"timestamp\\\": datetime.now(timezone.utc).isoformat(),\\r\\n            \\\"risk_score\\\": risk[\\\"score\\\"],\\r\\n        })\\r\\n\\r\\n    await db.commit()\\r\\n    await db.refresh(log_entry)\\r\\n    return log_entry\\r\\n\\r\\n\\r\\n@router.get(\\\"/risk-score\\\", response_model=RiskScoreResponse)\\r\\nasync def get_risk_score(\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(get_current_user),\\r\\n):\\r\\n    result = await db.execute(select(RiskScore).where(RiskScore.user_id == user.id))\\r\\n    risk_score = result.scalar_one_or_none()\\r\\n    if not risk_score:\\r\\n        return RiskScoreResponse(current_score=0.0, risk_level=\\\"low\\\", last_updated=None)\\r\\n    return risk_score\\r\\n\\r\\n\\r\\n@router.get(\\\"/alerts\\\", response_model=List[AlertResponse])\\r\\nasync def get_alerts(\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(get_current_user),\\r\\n):\\r\\n    result = await db.execute(\\r\\n        select(Alert)\\r\\n        .where(Alert.user_id == user.id)\\r\\n        .order_by(Alert.created_at.desc())\\r\\n        .limit(50)\\r\\n    )\\r\\n    return result.scalars().all()\\r\\n\\r\\n\\r\\n@router.get(\\\"/logs/recent\\\", response_model=List[LogResponse])\\r\\nasync def get_recent_logs(\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(require_consent),\\r\\n):\\r\\n    result = await db.execute(\\r\\n        select(BehaviorLog)\\r\\n        .where(BehaviorLog.user_id == user.id)\\r\\n        .order_by(BehaviorLog.timestamp.desc())\\r\\n        .limit(30)\\r\\n    )\\r\\n    return result.scalars().all()\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\routers\\\\logs_router.py\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\routers\",\"PSChildName\":\"logs_router.py\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/app/routers/privacy_router.py\",\"content\":{\"value\":\"from fastapi import APIRouter, Depends, HTTPException\\r\\nfrom sqlalchemy.ext.asyncio import AsyncSession\\r\\nfrom sqlalchemy import select\\r\\nfrom typing import List\\r\\nfrom app.database import get_db\\r\\nfrom app.models import DataAccessLog, User, Alert\\r\\nfrom app.schemas import DataAccessLogResponse\\r\\nfrom app.deps import get_current_user\\r\\n\\r\\nrouter = APIRouter(prefix=\\\"/api/privacy\\\", tags=[\\\"privacy\\\"])\\r\\n\\r\\n@router.get(\\\"/data-access\\\", response_model=List[DataAccessLogResponse])\\r\\nasync def get_data_access_logs(\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(get_current_user)\\r\\n):\\r\\n    # Retrieve the audit trail of what data the system accessed for this user\\r\\n    result = await db.execute(select(DataAccessLog).where(DataAccessLog.user_id == user.id).order_by(DataAccessLog.timestamp.desc()))\\r\\n    return result.scalars().all()\\r\\n\\r\\n@router.get(\\\"/explanation/{alert_id}\\\")\\r\\nasync def get_alert_explanation(\\r\\n    alert_id: int,\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(get_current_user)\\r\\n):\\r\\n    # Explainability Engine Endpoint: Explains an alert in natural language\\r\\n    result = await db.execute(select(Alert).where(Alert.id == alert_id, Alert.user_id == user.id))\\r\\n    alert = result.scalar_one_or_none()\\r\\n    \\r\\n    if not alert:\\r\\n        raise HTTPException(status_code=404, detail=\\\"Alert not found\\\")\\r\\n        \\r\\n    return {\\r\\n        \\\"alert_id\\\": alert.id,\\r\\n        \\\"explanation\\\": alert.explanation_text or \\\"No detailed explanation available for this alert.\\\",\\r\\n        \\\"recommendation\\\": alert.recommendation or \\\"Review the activity manually.\\\",\\r\\n        \\\"confidence_score\\\": alert.confidence_score\\r\\n    }\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\routers\\\\privacy_router.py\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\routers\",\"PSChildName\":\"privacy_router.py\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/app/routers/profiles_router.py\",\"content\":{\"value\":\"from fastapi import APIRouter, Depends, HTTPException\\r\\nfrom sqlalchemy.ext.asyncio import AsyncSession\\r\\nfrom sqlalchemy import select\\r\\nfrom app.database import get_db\\r\\nfrom app.models import User, BehaviorProfile\\r\\nfrom app.schemas import BehaviorProfileResponse\\r\\nfrom app.deps import get_current_user\\r\\n\\r\\nrouter = APIRouter(prefix=\\\"/api/profile\\\", tags=[\\\"profile\\\"])\\r\\n\\r\\n@router.get(\\\"/baseline\\\", response_model=BehaviorProfileResponse)\\r\\nasync def get_baseline(\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(get_current_user)\\r\\n):\\r\\n    result = await db.execute(select(BehaviorProfile).where(BehaviorProfile.user_id == user.id))\\r\\n    profile = result.scalar_one_or_none()\\r\\n    \\r\\n    if not profile:\\r\\n        # Return an empty/default profile if none exists yet\\r\\n        return {\\\"user_id\\\": user.id, \\\"baseline_metrics\\\": {}, \\\"last_updated\\\": user.created_at}\\r\\n        \\r\\n    return profile\\r\\n\\r\\n@router.get(\\\"/deviation\\\")\\r\\nasync def get_deviation(\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(get_current_user)\\r\\n):\\r\\n    # This endpoint returns the user\\u0027s current deviation from their baseline.\\r\\n    # In a real app we\\u0027d calculate this on the fly or fetch from a recent cache.\\r\\n    result = await db.execute(select(BehaviorProfile).where(BehaviorProfile.user_id == user.id))\\r\\n    profile = result.scalar_one_or_none()\\r\\n    \\r\\n    if not profile or not profile.baseline_metrics:\\r\\n        return {\\\"deviation_score\\\": 0.0, \\\"status\\\": \\\"no_baseline\\\"}\\r\\n        \\r\\n    # Return a mocked deviation score for visualization\\r\\n    import random\\r\\n    score = random.uniform(0.0, 100.0)\\r\\n    return {\\r\\n        \\\"deviation_score\\\": round(score, 1), \\r\\n        \\\"status\\\": \\\"normal\\\" if score \\u003c 70 else \\\"abnormal\\\"\\r\\n    }\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\routers\\\\profiles_router.py\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\routers\",\"PSChildName\":\"profiles_router.py\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}},{\"path\":\"backend/app/routers/student_router.py\",\"content\":{\"value\":\"from fastapi import APIRouter, Depends, HTTPException\\r\\nfrom sqlalchemy.ext.asyncio import AsyncSession\\r\\nfrom sqlalchemy import select, func, case\\r\\nfrom app.database import get_db\\r\\nfrom app.models import User, Alert, BehaviorLog, RiskScore\\r\\nfrom app.schemas import (\\r\\n    BlockAppRequest, ResolveAlertRequest, AlertResponse,\\r\\n    WellbeingResponse, AppUsageItem, PermissionAuditResponse,\\r\\n    PermissionBreakdown, LeaderboardResponse, TrainingProgressResponse, TrainingModule,\\r\\n)\\r\\nfrom app.deps import get_current_user, require_consent\\r\\nimport random\\r\\n\\r\\nrouter = APIRouter(prefix=\\\"/api\\\", tags=[\\\"student\\\"])\\r\\n\\r\\n\\r\\n@router.post(\\\"/block-app\\\")\\r\\nasync def block_app(\\r\\n    req: BlockAppRequest,\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(require_consent),\\r\\n):\\r\\n    alert = Alert(\\r\\n        user_id=user.id,\\r\\n        alert_type=\\\"app_blocked\\\",\\r\\n        severity=\\\"medium\\\",\\r\\n        message=f\\\"App \\u0027{req.app_name}\\u0027 has been blocked by user\\\",\\r\\n        resolved=True,\\r\\n    )\\r\\n    db.add(alert)\\r\\n    await db.commit()\\r\\n    return {\\\"status\\\": \\\"success\\\", \\\"message\\\": f\\\"App \\u0027{req.app_name}\\u0027 blocked successfully\\\"}\\r\\n\\r\\n\\r\\n@router.post(\\\"/resolve-alert\\\", response_model=AlertResponse)\\r\\nasync def resolve_alert(\\r\\n    req: ResolveAlertRequest,\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(get_current_user),\\r\\n):\\r\\n    result = await db.execute(\\r\\n        select(Alert).where(Alert.id == req.alert_id, Alert.user_id == user.id)\\r\\n    )\\r\\n    alert = result.scalar_one_or_none()\\r\\n    if not alert:\\r\\n        raise HTTPException(status_code=404, detail=\\\"Alert not found\\\")\\r\\n\\r\\n    alert.resolved = True\\r\\n    await db.commit()\\r\\n    await db.refresh(alert)\\r\\n    return alert\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Digital Wellbeing â”€â”€â”€â”€\\r\\n@router.get(\\\"/wellbeing\\\", response_model=WellbeingResponse)\\r\\nasync def get_wellbeing(\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(get_current_user),\\r\\n):\\r\\n    # Aggregate behaviour logs into wellbeing metrics\\r\\n    result = await db.execute(\\r\\n        select(\\r\\n            BehaviorLog.app_name,\\r\\n            func.count(BehaviorLog.id).label(\\\"sessions\\\"),\\r\\n            func.avg(BehaviorLog.network_activity_level).label(\\\"avg_net\\\"),\\r\\n        )\\r\\n        .where(BehaviorLog.user_id == user.id)\\r\\n        .group_by(BehaviorLog.app_name)\\r\\n        .order_by(func.count(BehaviorLog.id).desc())\\r\\n    )\\r\\n    rows = result.all()\\r\\n\\r\\n    total_sessions = sum(r.sessions for r in rows)\\r\\n    # Estimate minutes per session (simulated but derived from real data)\\r\\n    top_apps = [\\r\\n        AppUsageItem(\\r\\n            app_name=r.app_name,\\r\\n            usage_minutes=round(r.sessions * random.uniform(3, 12), 1),\\r\\n            sessions=r.sessions,\\r\\n        )\\r\\n        for r in rows[:8]\\r\\n    ]\\r\\n    total_minutes = sum(a.usage_minutes for a in top_apps)\\r\\n\\r\\n    # Focus score: lower anomaly ratio = higher focus\\r\\n    anomaly_result = await db.execute(\\r\\n        select(func.count(BehaviorLog.id)).where(\\r\\n            BehaviorLog.user_id == user.id, BehaviorLog.anomaly_flag == True\\r\\n        )\\r\\n    )\\r\\n    anomaly_count = anomaly_result.scalar() or 0\\r\\n    focus_score = max(20, 100 - int((anomaly_count / max(total_sessions, 1)) * 100))\\r\\n\\r\\n    # Daily trend from last 7 days (simulated from actual log counts)\\r\\n    daily_trend = []\\r\\n    for i in range(7):\\r\\n        day_label = f\\\"Day {7 - i}\\\"\\r\\n        daily_trend.append({\\r\\n            \\\"day\\\": day_label,\\r\\n            \\\"screen_time\\\": round(random.uniform(2, 6), 1),\\r\\n            \\\"focus\\\": max(30, focus_score + random.randint(-15, 10)),\\r\\n        })\\r\\n\\r\\n    return WellbeingResponse(\\r\\n        screen_time_hours=round(total_minutes / 60, 1),\\r\\n        focus_score=focus_score,\\r\\n        daily_sessions=total_sessions,\\r\\n        top_apps=top_apps,\\r\\n        daily_trend=daily_trend,\\r\\n    )\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Permission Audit â”€â”€â”€â”€\\r\\n@router.get(\\\"/permission-audit\\\", response_model=PermissionAuditResponse)\\r\\nasync def get_permission_audit(\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(get_current_user),\\r\\n):\\r\\n    result = await db.execute(\\r\\n        select(\\r\\n            BehaviorLog.permission_requested,\\r\\n            func.count(BehaviorLog.id).label(\\\"cnt\\\"),\\r\\n        )\\r\\n        .where(BehaviorLog.user_id == user.id, BehaviorLog.permission_requested != \\\"none\\\")\\r\\n        .group_by(BehaviorLog.permission_requested)\\r\\n        .order_by(func.count(BehaviorLog.id).desc())\\r\\n    )\\r\\n    rows = result.all()\\r\\n    total = sum(r.cnt for r in rows) or 1\\r\\n\\r\\n    breakdown = [\\r\\n        PermissionBreakdown(\\r\\n            permission=r.permission_requested,\\r\\n            count=r.cnt,\\r\\n            percentage=round((r.cnt / total) * 100, 1),\\r\\n        )\\r\\n        for r in rows\\r\\n    ]\\r\\n\\r\\n    # Risky apps = apps with high network + anomaly flags\\r\\n    risky_result = await db.execute(\\r\\n        select(BehaviorLog.app_name)\\r\\n        .where(\\r\\n            BehaviorLog.user_id == user.id,\\r\\n            BehaviorLog.anomaly_flag == True,\\r\\n            BehaviorLog.permission_requested != \\\"none\\\",\\r\\n        )\\r\\n        .distinct()\\r\\n    )\\r\\n    risky_apps = [r[0] for r in risky_result.all()]\\r\\n\\r\\n    return PermissionAuditResponse(\\r\\n        total_requests=total,\\r\\n        breakdown=breakdown,\\r\\n        risky_apps=risky_apps,\\r\\n    )\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Peer Leaderboard â”€â”€â”€â”€\\r\\n@router.get(\\\"/leaderboard\\\", response_model=LeaderboardResponse)\\r\\nasync def get_leaderboard(\\r\\n    db: AsyncSession = Depends(get_db),\\r\\n    user: User = Depends(get_current_user),\\r\\n):\\r\\n    # Get all student risk scores\\r\\n    result = await db.execute(\\r\\n        select(RiskScore.user_id, RiskScore.current_score)\\r\\n        .join(User, User.id == RiskScore.user_id)\\r\\n        .where(User.role == \\\"student\\\")\\r\\n        .order_by(RiskScore.current_score.asc())  # lower = better\\r\\n    )\\r\\n    all_scores = result.all()\\r\\n    total = len(all_scores)\\r\\n    scores_list = [s.current_score for s in all_scores]\\r\\n    campus_avg = sum(scores_list) / max(len(scores_list), 1)\\r\\n\\r\\n    # Find user rank (lower score = better rank)\\r\\n    user_score_result = await db.execute(\\r\\n        select(RiskScore.current_score).where(RiskScore.user_id == user.id)\\r\\n    )\\r\\n    user_score = user_score_result.scalar() or 50.0\\r\\n\\r\\n    rank = 1\\r\\n    for s in all_scores:\\r\\n        if s.user_id == user.id:\\r\\n            break\\r\\n        rank += 1\\r\\n\\r\\n    percentile = int(((total - rank) / max(total, 1)) * 100)\\r\\n\\r\\n    # Category breakdown (simulated from real log data)\\r\\n    user_anomaly_result = await db.execute(\\r\\n        select(func.count(BehaviorLog.id)).where(\\r\\n            BehaviorLog.user_id == user.id, BehaviorLog.anomaly_flag == True\\r\\n        )\\r\\n    )\\r\\n    user_anomalies = user_anomaly_result.scalar() or 0\\r\\n\\r\\n    user_categories = {\\r\\n        \\\"network\\\": max(10, 100 - int(user_score * 0.8) + random.randint(-5, 5)),\\r\\n        \\\"permissions\\\": max(10, 100 - int(user_anomalies * 2) + random.randint(-5, 5)),\\r\\n        \\\"apps\\\": max(10, 100 - int(user_score * 0.6) + random.randint(-5, 5)),\\r\\n        \\\"behavior\\\": max(10, 100 - int(user_score * 0.7) + random.randint(-5, 5)),\\r\\n    }\\r\\n    campus_categories = {\\r\\n        \\\"network\\\": max(20, int(100 - campus_avg * 0.8)),\\r\\n        \\\"permissions\\\": max(20, int(100 - campus_avg * 0.5)),\\r\\n        \\\"apps\\\": max(20, int(100 - campus_avg * 0.6)),\\r\\n        \\\"behavior\\\": max(20, int(100 - campus_avg * 0.7)),\\r\\n    }\\r\\n\\r\\n    return LeaderboardResponse(\\r\\n        rank=rank,\\r\\n        total_students=total,\\r\\n        percentile=percentile,\\r\\n        user_score=round(user_score, 1),\\r\\n        campus_average=round(campus_avg, 1),\\r\\n        categories=user_categories,\\r\\n        campus_categories=campus_categories,\\r\\n    )\\r\\n\\r\\n\\r\\n# â”€â”€â”€â”€ Training Progress â”€â”€â”€â”€\\r\\nTRAINING_MODULES = [\\r\\n    {\\\"id\\\": \\\"phishing\\\", \\\"title\\\": \\\"Phishing Detection\\\", \\\"description\\\": \\\"Learn to identify phishing emails, fake links, and social engineering attacks\\\", \\\"difficulty\\\": \\\"beginner\\\", \\\"duration_minutes\\\": 10},\\r\\n    {\\\"id\\\": \\\"passwords\\\", \\\"title\\\": \\\"Password Security\\\", \\\"description\\\": \\\"Best practices for creating and managing secure passwords\\\", \\\"difficulty\\\": \\\"beginner\\\", \\\"duration_minutes\\\": 8},\\r\\n    {\\\"id\\\": \\\"social_eng\\\", \\\"title\\\": \\\"Social Engineering\\\", \\\"description\\\": \\\"Understand manipulation tactics used by attackers\\\", \\\"difficulty\\\": \\\"intermediate\\\", \\\"duration_minutes\\\": 15},\\r\\n    {\\\"id\\\": \\\"wifi_safety\\\", \\\"title\\\": \\\"Public Wi-Fi Safety\\\", \\\"description\\\": \\\"Stay secure on public and shared networks\\\", \\\"difficulty\\\": \\\"beginner\\\", \\\"duration_minutes\\\": 8},\\r\\n    {\\\"id\\\": \\\"app_permissions\\\", \\\"title\\\": \\\"App Permissions\\\", \\\"description\\\": \\\"Understand what permissions apps request and why\\\", \\\"difficulty\\\": \\\"intermediate\\\", \\\"duration_minutes\\\": 12},\\r\\n    {\\\"id\\\": \\\"data_privacy\\\", \\\"title\\\": \\\"Data Privacy\\\", \\\"description\\\": \\\"Protect your personal data online and offline\\\", \\\"difficulty\\\": \\\"advanced\\\", \\\"duration_minutes\\\": 20},\\r\\n]\\r\\n\\r\\n@router.get(\\\"/training-progress\\\", response_model=TrainingProgressResponse)\\r\\nasync def get_training_progress(\\r\\n    user: User = Depends(get_current_user),\\r\\n):\\r\\n    # Simulate progress â€” in production this would be stored in DB\\r\\n    # Use deterministic seed from user id so it\\u0027s consistent\\r\\n    seed = sum(ord(c) for c in user.id)\\r\\n    rng = random.Random(seed)\\r\\n\\r\\n    modules = []\\r\\n    completed = 0\\r\\n    total_score = 0\\r\\n    for m in TRAINING_MODULES:\\r\\n        is_completed = rng.random() \\u003c 0.35\\r\\n        score = rng.randint(70, 100) if is_completed else None\\r\\n        if is_completed:\\r\\n            completed += 1\\r\\n            total_score += score\\r\\n        modules.append(TrainingModule(\\r\\n            id=m[\\\"id\\\"],\\r\\n            title=m[\\\"title\\\"],\\r\\n            description=m[\\\"description\\\"],\\r\\n            difficulty=m[\\\"difficulty\\\"],\\r\\n            duration_minutes=m[\\\"duration_minutes\\\"],\\r\\n            completed=is_completed,\\r\\n            score=score,\\r\\n        ))\\r\\n\\r\\n    return TrainingProgressResponse(\\r\\n        modules=modules,\\r\\n        completed_count=completed,\\r\\n        total_count=len(TRAINING_MODULES),\\r\\n        overall_score=total_score // max(completed, 1),\\r\\n    )\\r\\n\",\"PSPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\routers\\\\student_router.py\",\"PSParentPath\":\"C:\\\\Users\\\\bharg\\\\buildathon\\\\backend\\\\app\\\\routers\",\"PSChildName\":\"student_router.py\",\"PSDrive\":{\"CurrentLocation\":\"Users\\\\bharg\\\\buildathon\",\"Name\":\"C\",\"Provider\":\"Microsoft.PowerShell.Core\\\\FileSystem\",\"Root\":\"C:\\\\\",\"Description\":\"\",\"MaximumSize\":null,\"Credential\":\"System.Management.Automation.PSCredential\",\"DisplayRoot\":null},\"PSProvider\":{\"ImplementingType\":\"Microsoft.PowerShell.Commands.FileSystemProvider\",\"HelpFile\":\"System.Management.Automation.dll-Help.xml\",\"Name\":\"FileSystem\",\"PSSnapIn\":\"Microsoft.PowerShell.Core\",\"ModuleName\":\"Microsoft.PowerShell.Core\",\"Module\":null,\"Description\":\"\",\"Capabilities\":52,\"Home\":\"C:\\\\Users\\\\bharg\",\"Drives\":\"C\"},\"ReadCount\":1}}]\r\n","path":"batch1.json"},{"content":"version: \"3.8\"\r\n\r\nservices:\r\n  # PostgreSQL Database\r\n  postgres:\r\n    image: postgres:16-alpine\r\n    environment:\r\n      POSTGRES_USER: sentinel\r\n      POSTGRES_PASSWORD: sentinel\r\n      POSTGRES_DB: sentinelai\r\n    ports:\r\n      - \"5432:5432\"\r\n    volumes:\r\n      - postgres_data:/var/lib/postgresql/data\r\n    healthcheck:\r\n      test: [ \"CMD-SHELL\", \"pg_isready -U sentinel -d sentinelai\" ]\r\n      interval: 5s\r\n      timeout: 5s\r\n      retries: 5\r\n\r\n  # Redis Cache\r\n  redis:\r\n    image: redis:7-alpine\r\n    ports:\r\n      - \"6379:6379\"\r\n    healthcheck:\r\n      test: [ \"CMD\", \"redis-cli\", \"ping\" ]\r\n      interval: 5s\r\n      timeout: 5s\r\n      retries: 5\r\n\r\n  # FastAPI Backend\r\n  backend:\r\n    build:\r\n      context: ./backend\r\n      dockerfile: Dockerfile\r\n    environment:\r\n      DATABASE_URL: postgresql+asyncpg://sentinel:sentinel@postgres:5432/sentinelai\r\n      DATABASE_URL_SYNC: postgresql://sentinel:sentinel@postgres:5432/sentinelai\r\n      REDIS_URL: redis://redis:6379/0\r\n      REDIS_ENABLED: \"false\"\r\n      SECRET_KEY: ${SECRET_KEY:-super-secret-change-in-production-abc123xyz}\r\n      CORS_ORIGINS: http://localhost:3000,http://localhost,http://localhost:80\r\n      SIMULATOR_ENABLED: \"true\"\r\n      SIMULATOR_INTERVAL_SECONDS: \"30\"\r\n      RATE_LIMIT: \"120/minute\"\r\n    ports:\r\n      - \"8000:8000\"\r\n    depends_on:\r\n      postgres:\r\n        condition: service_healthy\r\n      redis:\r\n        condition: service_healthy\r\n    restart: unless-stopped\r\n\r\n  # Next.js Frontend\r\n  frontend:\r\n    build:\r\n      context: ./frontend\r\n      dockerfile: Dockerfile\r\n    environment:\r\n      NEXT_PUBLIC_API_URL: http://backend:8000\r\n    ports:\r\n      - \"3000:3000\"\r\n    depends_on:\r\n      - backend\r\n    restart: unless-stopped\r\n\r\n  # Nginx Reverse Proxy\r\n  nginx:\r\n    image: nginx:alpine\r\n    ports:\r\n      - \"80:80\"\r\n    volumes:\r\n      - ./nginx.conf:/etc/nginx/conf.d/default.conf\r\n    depends_on:\r\n      - frontend\r\n      - backend\r\n    restart: unless-stopped\r\n\r\nvolumes:\r\n  postgres_data:\r\n","path":"docker-compose.yml"},{"content":"upstream frontend {\r\n    server frontend:3000;\r\n}\r\n\r\nupstream backend {\r\n    server backend:8000;\r\n}\r\n\r\nserver {\r\n    listen 80;\r\n    server_name localhost;\r\n\r\n    # Backend API\r\n    location /api/ {\r\n        proxy_pass http://backend;\r\n        proxy_set_header Host $host;\r\n        proxy_set_header X-Real-IP $remote_addr;\r\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n        proxy_set_header X-Forwarded-Proto $scheme;\r\n        proxy_read_timeout 300s;\r\n        proxy_connect_timeout 75s;\r\n    }\r\n\r\n    # WebSocket\r\n    location /ws/ {\r\n        proxy_pass http://backend;\r\n        proxy_http_version 1.1;\r\n        proxy_set_header Upgrade $http_upgrade;\r\n        proxy_set_header Connection \"upgrade\";\r\n        proxy_set_header Host $host;\r\n        proxy_set_header X-Real-IP $remote_addr;\r\n        proxy_read_timeout 86400;\r\n    }\r\n\r\n    # Backend docs\r\n    location /docs {\r\n        proxy_pass http://backend;\r\n        proxy_set_header Host $host;\r\n    }\r\n\r\n    location /openapi.json {\r\n        proxy_pass http://backend;\r\n        proxy_set_header Host $host;\r\n    }\r\n\r\n    # Frontend\r\n    location / {\r\n        proxy_pass http://frontend;\r\n        proxy_set_header Host $host;\r\n        proxy_set_header X-Real-IP $remote_addr;\r\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n        proxy_set_header X-Forwarded-Proto $scheme;\r\n    }\r\n\r\n    # Next.js HMR (dev mode)\r\n    location /_next/webpack-hmr {\r\n        proxy_pass http://frontend;\r\n        proxy_http_version 1.1;\r\n        proxy_set_header Upgrade $http_upgrade;\r\n        proxy_set_header Connection \"upgrade\";\r\n    }\r\n}\r\n","path":"nginx.conf"},{"content":"# SentinelAI\r\n\r\n\u003e AI-Based Real-Time Behavioral Cybersecurity Platform for Students\r\n\r\nDetect smartphone behavioral anomalies using AI and get real-time security alerts through a premium dashboard.\r\n\r\n## 🏗 Architecture\r\n\r\n| Layer | Technology |\r\n|-------|-----------|\r\n| Frontend | Next.js 14, TypeScript, Tailwind CSS, Framer Motion, Recharts |\r\n| Backend | FastAPI, SQLAlchemy (async), Pydantic |\r\n| Database | PostgreSQL |\r\n| Cache | Redis |\r\n| AI Engine | scikit-learn (Isolation Forest) + rule-based fallback |\r\n| Auth | JWT (access + refresh), bcrypt |\r\n| Real-time | WebSocket |\r\n| Deployment | Docker Compose, Nginx |\r\n\r\n## 🚀 Quick Start\r\n\r\n### Prerequisites\r\n- Docker \u0026 Docker Compose\r\n- OR: Python 3.11+, Node.js 20+, PostgreSQL 16+\r\n\r\n### Option 1: Docker (recommended)\r\n\r\n```bash\r\n# Clone and start\r\ncp .env.example .env\r\ndocker-compose up --build\r\n\r\n# Seed demo data (in another terminal)\r\ndocker-compose exec backend python -m app.seed\r\n```\r\n\r\nApp is available at **http://localhost**\r\n\r\n### Option 2: Local Development\r\n\r\n**Backend:**\r\n```bash\r\ncd backend\r\npython -m venv venv\r\nvenv\\Scripts\\activate       # Windows\r\n# source venv/bin/activate  # Linux/Mac\r\npip install -r requirements.txt\r\n\r\n# Start PostgreSQL and set DATABASE_URL in .env\r\nuvicorn app.main:app --reload --port 8000\r\n\r\n# Seed data\r\npython -m app.seed\r\n```\r\n\r\n**Frontend:**\r\n```bash\r\ncd frontend\r\nnpm install\r\nnpm run dev\r\n```\r\n\r\nFrontend: http://localhost:3000 | Backend: http://localhost:8000 | API Docs: http://localhost:8000/docs\r\n\r\n## 🔑 Demo Credentials\r\n\r\n| Role | Email | Password |\r\n|------|-------|----------|\r\n| Admin | admin@sentinelai.com | admin123 |\r\n| Student | student1@university.edu | student123 |\r\n\r\n## 📡 API Endpoints\r\n\r\n| Method | Path | Description |\r\n|--------|------|-------------|\r\n| POST | /api/register | Create account |\r\n| POST | /api/login | Login (returns JWT) |\r\n| GET | /api/profile | Current user profile |\r\n| POST | /api/consent | Grant monitoring consent |\r\n| POST | /api/logs | Ingest behavior log |\r\n| GET | /api/risk-score | Get risk score |\r\n| GET | /api/alerts | Get alerts |\r\n| GET | /api/logs/recent | Recent behavior logs |\r\n| POST | /api/block-app | Block an app |\r\n| POST | /api/resolve-alert | Resolve alert |\r\n| GET | /api/admin/stats | Admin statistics |\r\n| GET | /api/admin/high-risk-users | High risk users |\r\n| GET | /api/admin/export-report | Export CSV report |\r\n| WS | /ws/{user_id} | Real-time alerts |\r\n\r\n## 🧠 AI Engine\r\n\r\n**Risk Score Formula:**\r\n```\r\nRisk = (Permission anomaly × 0.3) + (Network anomaly × 0.3) +\r\n       (Background process anomaly × 0.2) + (Suspicious domain × 0.2)\r\n```\r\n\r\n- **Primary**: Isolation Forest (scikit-learn) trained on behavioral logs\r\n- **Fallback**: Rule-based scoring when ML fails\r\n- **Recalculation**: Every log ingestion + simulator runs every 30s\r\n\r\n## 📱 Device Simulator\r\n\r\nSince browsers can\u0027t access phone sensors, a built-in simulator:\r\n- Generates realistic behavioral logs\r\n- Introduces controlled anomalies (20-35% chance)\r\n- Runs every 30 seconds for all consented students\r\n- Includes suspicious apps: SuspiciousVPN, CryptoMiner, KeyLogger, UnknownAPK\r\n\r\n## ☁️ Cloud Deployment\r\n\r\nReady for: AWS ECS, Azure Container Apps, Render, Railway\r\n\r\n```bash\r\n# Build production images\r\ndocker-compose -f docker-compose.yml build\r\n\r\n# Push to registry\r\ndocker tag sentinelai-backend your-registry/sentinelai-backend:latest\r\ndocker push your-registry/sentinelai-backend:latest\r\n```\r\n\r\nSet environment variables on your cloud platform using `.env.example` as reference.\r\n\r\n## 📁 Project Structure\r\n\r\n```\r\nbuildathon/\r\n├── backend/\r\n│   ├── app/\r\n│   │   ├── main.py              # FastAPI application\r\n│   │   ├── config.py            # Settings\r\n│   │   ├── database.py          # Async SQLAlchemy\r\n│   │   ├── models.py            # ORM models\r\n│   │   ├── schemas.py           # Pydantic schemas\r\n│   │   ├── auth.py              # JWT + bcrypt\r\n│   │   ├── deps.py              # Dependencies\r\n│   │   ├── ai_engine.py         # ML risk scoring\r\n│   │   ├── simulator.py         # Device agent simulator\r\n│   │   ├── websocket_manager.py # WebSocket manager\r\n│   │   ├── seed.py              # Demo data\r\n│   │   └── routers/\r\n│   │       ├── auth_router.py\r\n│   │       ├── logs_router.py\r\n│   │       ├── student_router.py\r\n│   │       └── admin_router.py\r\n│   ├── requirements.txt\r\n│   └── Dockerfile\r\n├── frontend/\r\n│   ├── src/\r\n│   │   ├── app/\r\n│   │   │   ├── layout.tsx       # Root layout\r\n│   │   │   ├── page.tsx         # Landing page\r\n│   │   │   ├── login/           # Login\r\n│   │   │   ├── register/        # Register\r\n│   │   │   ├── consent/         # Consent flow\r\n│   │   │   ├── dashboard/       # Student dashboard\r\n│   │   │   └── admin/           # Admin dashboard\r\n│   │   └── lib/api.ts           # API client\r\n│   ├── tailwind.config.ts\r\n│   ├── package.json\r\n│   └── Dockerfile\r\n├── docker-compose.yml\r\n├── nginx.conf\r\n├── .env.example\r\n└── README.md\r\n```\r\n","path":"README.md"}]