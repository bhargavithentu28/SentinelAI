[{"path":".gitignore","content":{"value":"# Python\r\n__pycache__/\r\n*.py[cod]\r\n*.egg-info/\r\ndist/\r\nbuild/\r\nvenv/\r\n.env\r\n\r\n# Node\r\nnode_modules/\r\n.next/\r\nout/\r\n\r\n# Database\r\n*.db\r\n*.sqlite3\r\n\r\n# IDE\r\n.vscode/\r\n.idea/\r\n\r\n# OS\r\n.DS_Store\r\nThumbs.db\r\n\r\n# Docker\r\n*.log\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\.gitignore","PSParentPath":"C:\\Users\\bharg\\buildathon","PSChildName":".gitignore","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":".env.example","content":{"value":"# â”€â”€â”€â”€ SentinelAI Environment Variables â”€â”€â”€â”€\r\n\r\n# Backend\r\nDATABASE_URL=postgresql+asyncpg://sentinel:sentinel@localhost:5432/sentinelai\r\nDATABASE_URL_SYNC=postgresql://sentinel:sentinel@localhost:5432/sentinelai\r\nREDIS_URL=redis://localhost:6379/0\r\nREDIS_ENABLED=false\r\nSECRET_KEY=change-this-to-a-random-secret-key-in-production\r\nCORS_ORIGINS=http://localhost:3000,http://localhost\r\nSIMULATOR_ENABLED=true\r\nSIMULATOR_INTERVAL_SECONDS=30\r\nRATE_LIMIT=120/minute\r\n\r\n# Frontend\r\nNEXT_PUBLIC_API_URL=http://localhost:8000\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\.env.example","PSParentPath":"C:\\Users\\bharg\\buildathon","PSChildName":".env.example","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"README.md","content":{"value":"# SentinelAI\r\n\r\n\u003e AI-Based Real-Time Behavioral Cybersecurity Platform for Students\r\n\r\nDetect smartphone behavioral anomalies using AI and get real-time security alerts through a premium dashboard.\r\n\r\n## ðŸ— Architecture\r\n\r\n| Layer | Technology |\r\n|-------|-----------|\r\n| Frontend | Next.js 14, TypeScript, Tailwind CSS, Framer Motion, Recharts |\r\n| Backend | FastAPI, SQLAlchemy (async), Pydantic |\r\n| Database | PostgreSQL |\r\n| Cache | Redis |\r\n| AI Engine | scikit-learn (Isolation Forest) + rule-based fallback |\r\n| Auth | JWT (access + refresh), bcrypt |\r\n| Real-time | WebSocket |\r\n| Deployment | Docker Compose, Nginx |\r\n\r\n## ðŸš€ Quick Start\r\n\r\n### Prerequisites\r\n- Docker \u0026 Docker Compose\r\n- OR: Python 3.11+, Node.js 20+, PostgreSQL 16+\r\n\r\n### Option 1: Docker (recommended)\r\n\r\n```bash\r\n# Clone and start\r\ncp .env.example .env\r\ndocker-compose up --build\r\n\r\n# Seed demo data (in another terminal)\r\ndocker-compose exec backend python -m app.seed\r\n```\r\n\r\nApp is available at **http://localhost**\r\n\r\n### Option 2: Local Development\r\n\r\n**Backend:**\r\n```bash\r\ncd backend\r\npython -m venv venv\r\nvenv\\Scripts\\activate       # Windows\r\n# source venv/bin/activate  # Linux/Mac\r\npip install -r requirements.txt\r\n\r\n# Start PostgreSQL and set DATABASE_URL in .env\r\nuvicorn app.main:app --reload --port 8000\r\n\r\n# Seed data\r\npython -m app.seed\r\n```\r\n\r\n**Frontend:**\r\n```bash\r\ncd frontend\r\nnpm install\r\nnpm run dev\r\n```\r\n\r\nFrontend: http://localhost:3000 | Backend: http://localhost:8000 | API Docs: http://localhost:8000/docs\r\n\r\n## ðŸ”‘ Demo Credentials\r\n\r\n| Role | Email | Password |\r\n|------|-------|----------|\r\n| Admin | admin@sentinelai.com | admin123 |\r\n| Student | student1@university.edu | student123 |\r\n\r\n## ðŸ“¡ API Endpoints\r\n\r\n| Method | Path | Description |\r\n|--------|------|-------------|\r\n| POST | /api/register | Create account |\r\n| POST | /api/login | Login (returns JWT) |\r\n| GET | /api/profile | Current user profile |\r\n| POST | /api/consent | Grant monitoring consent |\r\n| POST | /api/logs | Ingest behavior log |\r\n| GET | /api/risk-score | Get risk score |\r\n| GET | /api/alerts | Get alerts |\r\n| GET | /api/logs/recent | Recent behavior logs |\r\n| POST | /api/block-app | Block an app |\r\n| POST | /api/resolve-alert | Resolve alert |\r\n| GET | /api/admin/stats | Admin statistics |\r\n| GET | /api/admin/high-risk-users | High risk users |\r\n| GET | /api/admin/export-report | Export CSV report |\r\n| WS | /ws/{user_id} | Real-time alerts |\r\n\r\n## ðŸ§  AI Engine\r\n\r\n**Risk Score Formula:**\r\n```\r\nRisk = (Permission anomaly Ã— 0.3) + (Network anomaly Ã— 0.3) +\r\n       (Background process anomaly Ã— 0.2) + (Suspicious domain Ã— 0.2)\r\n```\r\n\r\n- **Primary**: Isolation Forest (scikit-learn) trained on behavioral logs\r\n- **Fallback**: Rule-based scoring when ML fails\r\n- **Recalculation**: Every log ingestion + simulator runs every 30s\r\n\r\n## ðŸ“± Device Simulator\r\n\r\nSince browsers can\u0027t access phone sensors, a built-in simulator:\r\n- Generates realistic behavioral logs\r\n- Introduces controlled anomalies (20-35% chance)\r\n- Runs every 30 seconds for all consented students\r\n- Includes suspicious apps: SuspiciousVPN, CryptoMiner, KeyLogger, UnknownAPK\r\n\r\n## â˜ï¸ Cloud Deployment\r\n\r\nReady for: AWS ECS, Azure Container Apps, Render, Railway\r\n\r\n```bash\r\n# Build production images\r\ndocker-compose -f docker-compose.yml build\r\n\r\n# Push to registry\r\ndocker tag sentinelai-backend your-registry/sentinelai-backend:latest\r\ndocker push your-registry/sentinelai-backend:latest\r\n```\r\n\r\nSet environment variables on your cloud platform using `.env.example` as reference.\r\n\r\n## ðŸ“ Project Structure\r\n\r\n```\r\nbuildathon/\r\nâ”œâ”€â”€ backend/\r\nâ”‚   â”œâ”€â”€ app/\r\nâ”‚   â”‚   â”œâ”€â”€ main.py              # FastAPI application\r\nâ”‚   â”‚   â”œâ”€â”€ config.py            # Settings\r\nâ”‚   â”‚   â”œâ”€â”€ database.py          # Async SQLAlchemy\r\nâ”‚   â”‚   â”œâ”€â”€ models.py            # ORM models\r\nâ”‚   â”‚   â”œâ”€â”€ schemas.py           # Pydantic schemas\r\nâ”‚   â”‚   â”œâ”€â”€ auth.py              # JWT + bcrypt\r\nâ”‚   â”‚   â”œâ”€â”€ deps.py              # Dependencies\r\nâ”‚   â”‚   â”œâ”€â”€ ai_engine.py         # ML risk scoring\r\nâ”‚   â”‚   â”œâ”€â”€ simulator.py         # Device agent simulator\r\nâ”‚   â”‚   â”œâ”€â”€ websocket_manager.py # WebSocket manager\r\nâ”‚   â”‚   â”œâ”€â”€ seed.py              # Demo data\r\nâ”‚   â”‚   â””â”€â”€ routers/\r\nâ”‚   â”‚       â”œâ”€â”€ auth_router.py\r\nâ”‚   â”‚       â”œâ”€â”€ logs_router.py\r\nâ”‚   â”‚       â”œâ”€â”€ student_router.py\r\nâ”‚   â”‚       â””â”€â”€ admin_router.py\r\nâ”‚   â”œâ”€â”€ requirements.txt\r\nâ”‚   â””â”€â”€ Dockerfile\r\nâ”œâ”€â”€ frontend/\r\nâ”‚   â”œâ”€â”€ src/\r\nâ”‚   â”‚   â”œâ”€â”€ app/\r\nâ”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx       # Root layout\r\nâ”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx         # Landing page\r\nâ”‚   â”‚   â”‚   â”œâ”€â”€ login/           # Login\r\nâ”‚   â”‚   â”‚   â”œâ”€â”€ register/        # Register\r\nâ”‚   â”‚   â”‚   â”œâ”€â”€ consent/         # Consent flow\r\nâ”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/       # Student dashboard\r\nâ”‚   â”‚   â”‚   â””â”€â”€ admin/           # Admin dashboard\r\nâ”‚   â”‚   â””â”€â”€ lib/api.ts           # API client\r\nâ”‚   â”œâ”€â”€ tailwind.config.ts\r\nâ”‚   â”œâ”€â”€ package.json\r\nâ”‚   â””â”€â”€ Dockerfile\r\nâ”œâ”€â”€ docker-compose.yml\r\nâ”œâ”€â”€ nginx.conf\r\nâ”œâ”€â”€ .env.example\r\nâ””â”€â”€ README.md\r\n```\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\README.md","PSParentPath":"C:\\Users\\bharg\\buildathon","PSChildName":"README.md","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"docker-compose.yml","content":{"value":"version: \"3.8\"\r\n\r\nservices:\r\n  # PostgreSQL Database\r\n  postgres:\r\n    image: postgres:16-alpine\r\n    environment:\r\n      POSTGRES_USER: sentinel\r\n      POSTGRES_PASSWORD: sentinel\r\n      POSTGRES_DB: sentinelai\r\n    ports:\r\n      - \"5432:5432\"\r\n    volumes:\r\n      - postgres_data:/var/lib/postgresql/data\r\n    healthcheck:\r\n      test: [ \"CMD-SHELL\", \"pg_isready -U sentinel -d sentinelai\" ]\r\n      interval: 5s\r\n      timeout: 5s\r\n      retries: 5\r\n\r\n  # Redis Cache\r\n  redis:\r\n    image: redis:7-alpine\r\n    ports:\r\n      - \"6379:6379\"\r\n    healthcheck:\r\n      test: [ \"CMD\", \"redis-cli\", \"ping\" ]\r\n      interval: 5s\r\n      timeout: 5s\r\n      retries: 5\r\n\r\n  # FastAPI Backend\r\n  backend:\r\n    build:\r\n      context: ./backend\r\n      dockerfile: Dockerfile\r\n    environment:\r\n      DATABASE_URL: postgresql+asyncpg://sentinel:sentinel@postgres:5432/sentinelai\r\n      DATABASE_URL_SYNC: postgresql://sentinel:sentinel@postgres:5432/sentinelai\r\n      REDIS_URL: redis://redis:6379/0\r\n      REDIS_ENABLED: \"false\"\r\n      SECRET_KEY: ${SECRET_KEY:-super-secret-change-in-production-abc123xyz}\r\n      CORS_ORIGINS: http://localhost:3000,http://localhost,http://localhost:80\r\n      SIMULATOR_ENABLED: \"true\"\r\n      SIMULATOR_INTERVAL_SECONDS: \"30\"\r\n      RATE_LIMIT: \"120/minute\"\r\n    ports:\r\n      - \"8000:8000\"\r\n    depends_on:\r\n      postgres:\r\n        condition: service_healthy\r\n      redis:\r\n        condition: service_healthy\r\n    restart: unless-stopped\r\n\r\n  # Next.js Frontend\r\n  frontend:\r\n    build:\r\n      context: ./frontend\r\n      dockerfile: Dockerfile\r\n    environment:\r\n      NEXT_PUBLIC_API_URL: http://backend:8000\r\n    ports:\r\n      - \"3000:3000\"\r\n    depends_on:\r\n      - backend\r\n    restart: unless-stopped\r\n\r\n  # Nginx Reverse Proxy\r\n  nginx:\r\n    image: nginx:alpine\r\n    ports:\r\n      - \"80:80\"\r\n    volumes:\r\n      - ./nginx.conf:/etc/nginx/conf.d/default.conf\r\n    depends_on:\r\n      - frontend\r\n      - backend\r\n    restart: unless-stopped\r\n\r\nvolumes:\r\n  postgres_data:\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\docker-compose.yml","PSParentPath":"C:\\Users\\bharg\\buildathon","PSChildName":"docker-compose.yml","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"nginx.conf","content":{"value":"upstream frontend {\r\n    server frontend:3000;\r\n}\r\n\r\nupstream backend {\r\n    server backend:8000;\r\n}\r\n\r\nserver {\r\n    listen 80;\r\n    server_name localhost;\r\n\r\n    # Backend API\r\n    location /api/ {\r\n        proxy_pass http://backend;\r\n        proxy_set_header Host $host;\r\n        proxy_set_header X-Real-IP $remote_addr;\r\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n        proxy_set_header X-Forwarded-Proto $scheme;\r\n        proxy_read_timeout 300s;\r\n        proxy_connect_timeout 75s;\r\n    }\r\n\r\n    # WebSocket\r\n    location /ws/ {\r\n        proxy_pass http://backend;\r\n        proxy_http_version 1.1;\r\n        proxy_set_header Upgrade $http_upgrade;\r\n        proxy_set_header Connection \"upgrade\";\r\n        proxy_set_header Host $host;\r\n        proxy_set_header X-Real-IP $remote_addr;\r\n        proxy_read_timeout 86400;\r\n    }\r\n\r\n    # Backend docs\r\n    location /docs {\r\n        proxy_pass http://backend;\r\n        proxy_set_header Host $host;\r\n    }\r\n\r\n    location /openapi.json {\r\n        proxy_pass http://backend;\r\n        proxy_set_header Host $host;\r\n    }\r\n\r\n    # Frontend\r\n    location / {\r\n        proxy_pass http://frontend;\r\n        proxy_set_header Host $host;\r\n        proxy_set_header X-Real-IP $remote_addr;\r\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n        proxy_set_header X-Forwarded-Proto $scheme;\r\n    }\r\n\r\n    # Next.js HMR (dev mode)\r\n    location /_next/webpack-hmr {\r\n        proxy_pass http://frontend;\r\n        proxy_http_version 1.1;\r\n        proxy_set_header Upgrade $http_upgrade;\r\n        proxy_set_header Connection \"upgrade\";\r\n    }\r\n}\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\nginx.conf","PSParentPath":"C:\\Users\\bharg\\buildathon","PSChildName":"nginx.conf","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/Dockerfile","content":{"value":"FROM python:3.11-slim\r\n\r\nWORKDIR /app\r\n\r\n# Install system dependencies\r\nRUN apt-get update \u0026\u0026 apt-get install -y --no-install-recommends \\\r\n    build-essential \\\r\n    \u0026\u0026 rm -rf /var/lib/apt/lists/*\r\n\r\n# Install Python dependencies\r\nCOPY requirements.txt .\r\nRUN pip install --no-cache-dir -r requirements.txt\r\n\r\n# Copy application code\r\nCOPY . .\r\n\r\n# Expose port\r\nEXPOSE 8000\r\n\r\n# Run with uvicorn\r\nCMD [\"uvicorn\", \"app.main:app\", \"--host\", \"0.0.0.0\", \"--port\", \"8000\", \"--workers\", \"4\"]\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\Dockerfile","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend","PSChildName":"Dockerfile","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/requirements.txt","content":{"value":"fastapi\r\nuvicorn[standard]\r\nsqlalchemy[asyncio]\r\naiosqlite\r\npasslib[bcrypt]\r\npython-jose[cryptography]\r\npydantic-settings\r\npydantic[email]\r\npython-multipart\r\nslowapi\r\nasyncpg\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\requirements.txt","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend","PSChildName":"requirements.txt","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/app/__init__.py","content":""},{"path":"backend/app/ai_engine.py","content":{"value":"import logging\r\nfrom typing import Optional, Dict, Any, List\r\n\r\nlogger = logging.getLogger(__name__)\r\n\r\n# Try to import scikit-learn; fall back to rule-based if unavailable\r\ntry:\r\n    import numpy as np\r\n    HAS_NUMPY = True\r\nexcept ImportError:\r\n    HAS_NUMPY = False\r\n\r\ntry:\r\n    from sklearn.ensemble import IsolationForest\r\n    HAS_SKLEARN = True\r\nexcept ImportError:\r\n    HAS_SKLEARN = False\r\n    logger.info(\"scikit-learn not available, using rule-based scoring only\")\r\n\r\n_model = None\r\n_is_fitted = False\r\n\r\n\r\ndef extract_features(logs: list[dict]) -\u003e list[list[float]]:\r\n    \"\"\"Extract features from a batch of behavior logs.\"\"\"\r\n    features = []\r\n    for log in logs:\r\n        features.append([\r\n            1.0 if log.get(\"permission_requested\", \"none\") != \"none\" else 0.0,\r\n            float(log.get(\"network_activity_level\", 0.0)),\r\n            1.0 if log.get(\"background_process_flag\", False) else 0.0,\r\n            1.0 if log.get(\"anomaly_flag\", False) else 0.0,\r\n        ])\r\n    return features\r\n\r\n\r\ndef compute_baseline(logs: list[dict]) -\u003e Dict[str, float]:\r\n    \"\"\"Compute an average baseline from historical logs for a user.\"\"\"\r\n    if not logs:\r\n        return {\"avg_permission_usage\": 0.0, \"avg_network_activity\": 0.0, \"avg_background_process_rate\": 0.0}\r\n\r\n    n = max(len(logs), 1)\r\n    perm_count = sum(1 for l in logs if l.get(\"permission_requested\", \"none\") != \"none\")\r\n    net_sum = sum(float(l.get(\"network_activity_level\", 0.0)) for l in logs)\r\n    bg_count = sum(1 for l in logs if l.get(\"background_process_flag\", False))\r\n\r\n    return {\r\n        \"avg_permission_usage\": perm_count / n,\r\n        \"avg_network_activity\": net_sum / n,\r\n        \"avg_background_process_rate\": bg_count / n\r\n    }\r\n\r\n\r\ndef calculate_risk_score_ml(logs: list[dict], baseline: Optional[Dict[str, float]] = None) -\u003e float:\r\n    \"\"\"Use Isolation Forest if available, adjusting via baseline deviation. Returns 0-100.\"\"\"\r\n    global _model, _is_fitted\r\n\r\n    if not HAS_SKLEARN or not HAS_NUMPY or len(logs) \u003c 5:\r\n        return calculate_risk_score_rules(logs, baseline)\r\n\r\n    import numpy as np\r\n    features = np.array(extract_features(logs))\r\n    if features.shape[0] == 0:\r\n        return 0.0\r\n\r\n    try:\r\n        if _model is None:\r\n            _model = IsolationForest(\r\n                n_estimators=100, contamination=0.15, random_state=42, n_jobs=-1\r\n            )\r\n\r\n        if not _is_fitted:\r\n            _model.fit(features)\r\n            _is_fitted = True\r\n\r\n        scores = _model.score_samples(features)\r\n        avg_score = float(np.mean(scores))\r\n        \r\n        # Base risk from Isolation Forest\r\n        risk = max(0, min(100, (0.5 - avg_score) * 100))\r\n        \r\n        # Adjust based on baseline deviation if available\r\n        if baseline:\r\n            # Simple Z-score like heuristic for demo purposes\r\n            recent_perm = sum(1 for l in logs if l.get(\"permission_requested\", \"none\") != \"none\") / len(logs)\r\n            recent_net = sum(float(l.get(\"network_activity_level\", 0.0)) for l in logs) / len(logs)\r\n            \r\n            perm_diff = max(0, recent_perm - baseline.get(\"avg_permission_usage\", 0.0))\r\n            net_diff = max(0, recent_net - baseline.get(\"avg_network_activity\", 0.0))\r\n            \r\n            # Add up to 20 points for deviation\r\n            deviation_penalty = (perm_diff * 10) + (net_diff / 10)\r\n            risk = min(100, risk + deviation_penalty)\r\n            \r\n        return round(risk, 1)\r\n    except Exception as e:\r\n        logger.warning(f\"ML scoring failed, falling back to rules: {e}\")\r\n        return calculate_risk_score_rules(logs, baseline)\r\n\r\n\r\ndef calculate_risk_score_rules(logs: list[dict], baseline: Optional[Dict[str, float]] = None) -\u003e float:\r\n    \"\"\"Rule-based risk scoring with optional baseline deviation penalty. Returns 0-100.\"\"\"\r\n    if not logs:\r\n        return 0.0\r\n\r\n    n = len(logs)\r\n\r\n    # Permission anomaly\r\n    perm_count = sum(1 for l in logs if l.get(\"permission_requested\", \"none\") != \"none\")\r\n    perm_score = min(100, (perm_count / max(n, 1)) * 100)\r\n\r\n    # Network anomaly\r\n    net_levels = [float(l.get(\"network_activity_level\", 0.0)) for l in logs]\r\n    net_avg = sum(net_levels) / len(net_levels) if net_levels else 0.0\r\n    net_score = min(100, net_avg)\r\n\r\n    # Background process anomaly\r\n    bg_count = sum(1 for l in logs if l.get(\"background_process_flag\", False))\r\n    bg_score = min(100, (bg_count / max(n, 1)) * 100)\r\n\r\n    # Suspicious domain / anomaly flag\r\n    anomaly_count = sum(1 for l in logs if l.get(\"anomaly_flag\", False))\r\n    domain_score = min(100, (anomaly_count / max(n, 1)) * 100)\r\n\r\n    # Weighted formula\r\n    risk = (\r\n        perm_score * 0.3 +\r\n        net_score * 0.3 +\r\n        bg_score * 0.2 +\r\n        domain_score * 0.2\r\n    )\r\n    \r\n    # Apply baseline penalty\r\n    if baseline:\r\n        recent_perm = perm_count / max(n, 1)\r\n        recent_net = net_avg\r\n        perm_diff = max(0, recent_perm - baseline.get(\"avg_permission_usage\", 0.0))\r\n        net_diff = max(0, recent_net - baseline.get(\"avg_network_activity\", 0.0))\r\n        deviation_penalty = (perm_diff * 10) + (net_diff / 5)\r\n        risk = min(100, risk + deviation_penalty)\r\n\r\n    return round(max(0, min(100, risk)), 1)\r\n\r\n\r\ndef get_risk_level(score: float) -\u003e str:\r\n    if score \u003c= 40:\r\n        return \"low\"\r\n    elif score \u003c= 70:\r\n        return \"medium\"\r\n    else:\r\n        return \"high\"\r\n\r\n\r\ndef generate_explanation(logs: list[dict], risk_score: float) -\u003e str:\r\n    \"\"\"Generate a natural language explanation for why the risk score is high.\"\"\"\r\n    if not logs:\r\n        return \"No recent activity logs available to explain.\"\r\n        \r\n    explanations = []\r\n    \r\n    n = len(logs)\r\n    perm_count = sum(1 for l in logs if l.get(\"permission_requested\", \"none\") != \"none\")\r\n    net_avg = sum(float(l.get(\"network_activity_level\", 0.0)) for l in logs) / n\r\n    bg_count = sum(1 for l in logs if l.get(\"background_process_flag\", False))\r\n    anomaly_count = sum(1 for l in logs if l.get(\"anomaly_flag\", False))\r\n    \r\n    if anomaly_count \u003e 0:\r\n        explanations.append(f\"Detected {anomaly_count} known suspicious activities or domains.\")\r\n    \r\n    if perm_count \u003e (n * 0.5):\r\n        explanations.append(\"Unusually high rate of sensitive permission requests.\")\r\n        \r\n    if net_avg \u003e 60:\r\n        explanations.append(f\"Heavy network utilization detected (avg {net_avg:.1f}%).\")\r\n        \r\n    if bg_count \u003e (n * 0.4):\r\n        explanations.append(\"Excessive background processes running stealthily.\")\r\n        \r\n    if not explanations:\r\n        if risk_score \u003e 70:\r\n            return \"Risk increased due to aggregate subtle deviations from baseline behavior.\"\r\n        return \"Activity appears normal.\"\r\n        \r\n    return \" \".join(explanations)\r\n\r\ndef generate_recommendation(severity: str) -\u003e str:\r\n    \"\"\"Generate actionable advice based on severity.\"\"\"\r\n    if severity == \"critical\":\r\n        return \"Immediate action required: Revoke network access for the compromised app, change passwords, and consider factory resetting the device if anomalous behavior persists.\"\r\n    elif severity == \"high\":\r\n        return \"Review the app\u0027s requested permissions immediately and consider uninstalling it. Run a malware scan.\"\r\n    else:\r\n        return \"Monitor the app\u0027s activity. Ensure it only has access to necessary permissions.\"\r\n\r\n\r\ndef calculate_risk(logs: list[dict], baseline: Optional[Dict[str, float]] = None) -\u003e dict:\r\n    \"\"\"Main entry point: calculate risk score, level, explanation, and recommendation.\"\"\"\r\n    try:\r\n        score = calculate_risk_score_ml(logs, baseline)\r\n    except Exception:\r\n        score = calculate_risk_score_rules(logs, baseline)\r\n\r\n    level = get_risk_level(score)\r\n    severity = \"critical\" if score \u003e= 85 else \"high\" if score \u003e 70 else level\r\n    \r\n    explanation = generate_explanation(logs, score)\r\n    recommendation = generate_recommendation(severity)\r\n    \r\n    return {\r\n        \"score\": score, \r\n        \"level\": level, \r\n        \"explanation\": explanation,\r\n        \"recommendation\": recommendation,\r\n        \"severity\": severity\r\n    }\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\ai_engine.py","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend\\app","PSChildName":"ai_engine.py","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/app/auth.py","content":{"value":"from datetime import datetime, timedelta, timezone\r\nfrom passlib.context import CryptContext\r\nfrom jose import JWTError, jwt\r\nfrom app.config import get_settings\r\n\r\nsettings = get_settings()\r\npwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")\r\n\r\n\r\ndef hash_password(password: str) -\u003e str:\r\n    return pwd_context.hash(password)\r\n\r\n\r\ndef verify_password(plain: str, hashed: str) -\u003e bool:\r\n    return pwd_context.verify(plain, hashed)\r\n\r\n\r\ndef create_access_token(data: dict) -\u003e str:\r\n    to_encode = data.copy()\r\n    expire = datetime.now(timezone.utc) + timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)\r\n    to_encode.update({\"exp\": expire, \"type\": \"access\"})\r\n    return jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)\r\n\r\n\r\ndef create_refresh_token(data: dict) -\u003e str:\r\n    to_encode = data.copy()\r\n    expire = datetime.now(timezone.utc) + timedelta(days=settings.REFRESH_TOKEN_EXPIRE_DAYS)\r\n    to_encode.update({\"exp\": expire, \"type\": \"refresh\"})\r\n    return jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)\r\n\r\n\r\ndef decode_token(token: str) -\u003e dict | None:\r\n    try:\r\n        payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])\r\n        return payload\r\n    except JWTError:\r\n        return None\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\auth.py","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend\\app","PSChildName":"auth.py","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/app/config.py","content":{"value":"from pydantic_settings import BaseSettings\r\nfrom functools import lru_cache\r\nimport os\r\n\r\n\r\nclass Settings(BaseSettings):\r\n    APP_NAME: str = \"SentinelAI\"\r\n    DEBUG: bool = False\r\n\r\n    # Database â€” defaults to SQLite for easy local dev\r\n    DATABASE_URL: str = \"sqlite+aiosqlite:///./sentinelai.db\"\r\n\r\n    # Redis\r\n    REDIS_URL: str = \"redis://localhost:6379/0\"\r\n    REDIS_ENABLED: bool = False\r\n\r\n    # JWT\r\n    SECRET_KEY: str = \"super-secret-change-in-production-abc123xyz\"\r\n    ALGORITHM: str = \"HS256\"\r\n    ACCESS_TOKEN_EXPIRE_MINUTES: int = 30\r\n    REFRESH_TOKEN_EXPIRE_DAYS: int = 7\r\n\r\n    # CORS\r\n    CORS_ORIGINS: str = \"http://localhost:3000,http://localhost:3001,http://localhost:80,http://localhost\"\r\n\r\n    # Simulator\r\n    SIMULATOR_ENABLED: bool = True\r\n    SIMULATOR_INTERVAL_SECONDS: int = 30\r\n\r\n    # Rate limiting\r\n    RATE_LIMIT: str = \"60/minute\"\r\n\r\n    class Config:\r\n        env_file = \".env\"\r\n        extra = \"ignore\"\r\n\r\n\r\n@lru_cache()\r\ndef get_settings() -\u003e Settings:\r\n    return Settings()\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\config.py","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend\\app","PSChildName":"config.py","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/app/database.py","content":{"value":"from sqlalchemy.ext.asyncio import create_async_engine, AsyncSession, async_sessionmaker\r\nfrom sqlalchemy.orm import DeclarativeBase\r\nfrom app.config import get_settings\r\n\r\nsettings = get_settings()\r\n\r\n# SQLite needs connect_args for async; PostgreSQL doesn\u0027t\r\nconnect_args = {}\r\nif settings.DATABASE_URL.startswith(\"sqlite\"):\r\n    connect_args = {\"check_same_thread\": False}\r\n\r\nengine = create_async_engine(\r\n    settings.DATABASE_URL,\r\n    echo=settings.DEBUG,\r\n    connect_args=connect_args,\r\n)\r\n\r\nasync_session = async_sessionmaker(engine, class_=AsyncSession, expire_on_commit=False)\r\n\r\n\r\nclass Base(DeclarativeBase):\r\n    pass\r\n\r\n\r\nasync def get_db():\r\n    async with async_session() as session:\r\n        try:\r\n            yield session\r\n        finally:\r\n            await session.close()\r\n\r\n\r\nasync def create_tables():\r\n    async with engine.begin() as conn:\r\n        await conn.run_sync(Base.metadata.create_all)\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\database.py","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend\\app","PSChildName":"database.py","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/app/deps.py","content":{"value":"from fastapi import Depends, HTTPException, status\r\nfrom fastapi.security import HTTPBearer, HTTPAuthorizationCredentials\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select\r\nfrom app.database import get_db\r\nfrom app.auth import decode_token\r\nfrom app.models import User\r\nfrom typing import List\r\n\r\nsecurity = HTTPBearer()\r\n\r\nasync def get_current_user(\r\n    credentials: HTTPAuthorizationCredentials = Depends(security),\r\n    db: AsyncSession = Depends(get_db),\r\n) -\u003e User:\r\n    token = credentials.credentials\r\n    payload = decode_token(token)\r\n    if payload is None:\r\n        raise HTTPException(status_code=status.HTTP_401_UNAUTHORIZED, detail=\"Invalid or expired token\")\r\n\r\n    if payload.get(\"type\") != \"access\":\r\n        raise HTTPException(status_code=status.HTTP_401_UNAUTHORIZED, detail=\"Invalid token type\")\r\n\r\n    user_id = payload.get(\"sub\")\r\n    if user_id is None:\r\n        raise HTTPException(status_code=status.HTTP_401_UNAUTHORIZED, detail=\"Invalid token payload\")\r\n\r\n    result = await db.execute(select(User).where(User.id == user_id))\r\n    user = result.scalar_one_or_none()\r\n    if user is None:\r\n        raise HTTPException(status_code=status.HTTP_401_UNAUTHORIZED, detail=\"User not found\")\r\n\r\n    return user\r\n\r\ndef require_roles(allowed_roles: List[str]):\r\n    async def role_checker(user: User = Depends(get_current_user)) -\u003e User:\r\n        if user.role not in allowed_roles:\r\n            raise HTTPException(\r\n                status_code=status.HTTP_403_FORBIDDEN, \r\n                detail=f\"Operation not permitted. Requires one of: {\u0027, \u0027.join(allowed_roles)}\"\r\n            )\r\n        return user\r\n    return role_checker\r\n\r\nasync def require_admin(user: User = Depends(get_current_user)) -\u003e User:\r\n    if user.role != \"admin\":\r\n        raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail=\"Admin access required\")\r\n    return user\r\n\r\nasync def require_consent(user: User = Depends(get_current_user)) -\u003e User:\r\n    if not user.consent_given:\r\n        raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail=\"Consent required before accessing this resource\")\r\n    return user\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\deps.py","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend\\app","PSChildName":"deps.py","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/app/main.py","content":{"value":"import asyncio\r\nimport logging\r\nimport traceback\r\nfrom contextlib import asynccontextmanager\r\nfrom fastapi import FastAPI, WebSocket, WebSocketDisconnect, Request\r\nfrom fastapi.responses import JSONResponse\r\nfrom fastapi.middleware.cors import CORSMiddleware\r\nfrom slowapi import Limiter, _rate_limit_exceeded_handler\r\nfrom slowapi.util import get_remote_address\r\nfrom slowapi.errors import RateLimitExceeded\r\n\r\nfrom app.config import get_settings\r\nfrom app.database import create_tables\r\nfrom app.websocket_manager import manager\r\nfrom app.routers import (\r\n    auth_router, logs_router, student_router, admin_router,\r\n    devices_router, profiles_router, incidents_router, privacy_router,\r\n    escalate_router, anomalies_router\r\n)\r\nsettings = get_settings()\r\nlogging.basicConfig(level=logging.INFO)\r\nlogger = logging.getLogger(__name__)\r\n\r\nlimiter = Limiter(key_func=get_remote_address, default_limits=[settings.RATE_LIMIT])\r\n\r\nsimulator_task = None\r\n\r\n\r\n@asynccontextmanager\r\nasync def lifespan(app: FastAPI):\r\n    global simulator_task\r\n    logger.info(\"SentinelAI starting up...\")\r\n    await create_tables()\r\n    logger.info(\"Database tables created\")\r\n\r\n    # Start device simulator\r\n    if settings.SIMULATOR_ENABLED:\r\n        from app.simulator import run_simulator\r\n        simulator_task = asyncio.create_task(\r\n            run_simulator(settings.SIMULATOR_INTERVAL_SECONDS)\r\n        )\r\n        logger.info(\"Device simulator started\")\r\n\r\n    yield\r\n\r\n    # Shutdown\r\n    if simulator_task:\r\n        simulator_task.cancel()\r\n        try:\r\n            await simulator_task\r\n        except asyncio.CancelledError:\r\n            pass\r\n    logger.info(\"SentinelAI shutdown complete\")\r\n\r\n\r\napp = FastAPI(\r\n    title=\"SentinelAI API\",\r\n    description=\"AI-Based Real-Time Behavioral Cybersecurity Platform\",\r\n    version=\"1.0.0\",\r\n    lifespan=lifespan,\r\n)\r\n\r\n# Rate limiting\r\napp.state.limiter = limiter\r\napp.add_exception_handler(RateLimitExceeded, _rate_limit_exceeded_handler)\r\n\r\n\r\n@app.exception_handler(Exception)\r\nasync def global_exception_handler(request: Request, exc: Exception):\r\n    logger.error(f\"Unhandled exception on {request.method} {request.url}: {exc}\")\r\n    logger.error(traceback.format_exc())\r\n    return JSONResponse(status_code=500, content={\"detail\": str(exc)})\r\n\r\n# CORS\r\napp.add_middleware(\r\n    CORSMiddleware,\r\n    allow_origins=settings.CORS_ORIGINS.split(\",\"),\r\n    allow_credentials=True,\r\n    allow_methods=[\"*\"],\r\n    allow_headers=[\"*\"],\r\n)\r\n\r\n# Mount routers\r\napp.include_router(auth_router.router)\r\napp.include_router(logs_router.router)\r\napp.include_router(student_router.router)\r\napp.include_router(admin_router.router)\r\napp.include_router(devices_router.router)\r\napp.include_router(profiles_router.router)\r\napp.include_router(incidents_router.router)\r\napp.include_router(privacy_router.router)\r\napp.include_router(escalate_router.router)\r\napp.include_router(anomalies_router.router)\r\n\r\n\r\n@app.get(\"/api/health\")\r\nasync def health():\r\n    return {\r\n        \"status\": \"healthy\",\r\n        \"app\": settings.APP_NAME,\r\n        \"websocket_connections\": manager.connected_count,\r\n    }\r\n\r\n\r\n@app.websocket(\"/ws/{user_id}\")\r\nasync def websocket_endpoint(websocket: WebSocket, user_id: str):\r\n    await manager.connect(websocket, user_id)\r\n    try:\r\n        while True:\r\n            data = await websocket.receive_text()\r\n            # Keep-alive / echo\r\n            if data == \"ping\":\r\n                await websocket.send_text(\"pong\")\r\n    except WebSocketDisconnect:\r\n        manager.disconnect(websocket, user_id)\r\n    except Exception:\r\n        manager.disconnect(websocket, user_id)\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\main.py","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend\\app","PSChildName":"main.py","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/app/models.py","content":{"value":"import uuid\r\nfrom datetime import datetime\r\nfrom sqlalchemy import (\r\n    Column, String, Boolean, Float, DateTime, ForeignKey, Text, Integer, JSON\r\n)\r\nfrom sqlalchemy.orm import relationship\r\nfrom app.database import Base\r\n\r\n\r\nclass User(Base):\r\n    __tablename__ = \"users\"\r\n\r\n    id = Column(String(36), primary_key=True, default=lambda: str(uuid.uuid4()))\r\n    name = Column(String(100), nullable=False)\r\n    email = Column(String(255), unique=True, nullable=False, index=True)\r\n    college = Column(String(255), nullable=False)\r\n    role = Column(String(20), default=\"student\", nullable=False)\r\n    hashed_password = Column(String(255), nullable=False)\r\n    consent_given = Column(Boolean, default=False)\r\n    created_at = Column(DateTime, default=datetime.utcnow)\r\n\r\n    risk_scores = relationship(\"RiskScore\", back_populates=\"user\", cascade=\"all, delete-orphan\")\r\n    alerts = relationship(\"Alert\", back_populates=\"user\", cascade=\"all, delete-orphan\")\r\n    behavior_logs = relationship(\"BehaviorLog\", back_populates=\"user\", cascade=\"all, delete-orphan\")\r\n    devices = relationship(\"Device\", back_populates=\"user\", cascade=\"all, delete-orphan\")\r\n    profile = relationship(\"BehaviorProfile\", back_populates=\"user\", uselist=False, cascade=\"all, delete-orphan\")\r\n    incidents = relationship(\"Incident\", back_populates=\"user\", cascade=\"all, delete-orphan\")\r\n    data_access_logs = relationship(\"DataAccessLog\", back_populates=\"user\", cascade=\"all, delete-orphan\")\r\n\r\n\r\nclass Device(Base):\r\n    __tablename__ = \"devices\"\r\n    id = Column(String(36), primary_key=True, default=lambda: str(uuid.uuid4()))\r\n    user_id = Column(String(36), ForeignKey(\"users.id\", ondelete=\"CASCADE\"), nullable=False, index=True)\r\n    device_name = Column(String(255), nullable=False)\r\n    device_type = Column(String(100), nullable=False)\r\n    last_active = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\r\n    risk_score = Column(Float, default=0.0)\r\n    \r\n    user = relationship(\"User\", back_populates=\"devices\")\r\n    behavior_logs = relationship(\"BehaviorLog\", back_populates=\"device\", cascade=\"all, delete-orphan\")\r\n\r\n\r\nclass BehaviorProfile(Base):\r\n    __tablename__ = \"behavior_profiles\"\r\n    user_id = Column(String(36), ForeignKey(\"users.id\", ondelete=\"CASCADE\"), primary_key=True)\r\n    baseline_metrics = Column(JSON, default={})\r\n    last_updated = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\r\n\r\n    user = relationship(\"User\", back_populates=\"profile\")\r\n\r\n\r\nclass RiskScore(Base):\r\n    __tablename__ = \"risk_scores\"\r\n\r\n    id = Column(Integer, primary_key=True, autoincrement=True)\r\n    user_id = Column(String(36), ForeignKey(\"users.id\", ondelete=\"CASCADE\"), nullable=False, index=True)\r\n    current_score = Column(Float, default=0.0)\r\n    risk_level = Column(String(20), default=\"low\")\r\n    last_updated = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\r\n\r\n    user = relationship(\"User\", back_populates=\"risk_scores\")\r\n\r\n\r\nclass Alert(Base):\r\n    __tablename__ = \"alerts\"\r\n\r\n    id = Column(Integer, primary_key=True, autoincrement=True)\r\n    user_id = Column(String(36), ForeignKey(\"users.id\", ondelete=\"CASCADE\"), nullable=False, index=True)\r\n    alert_type = Column(String(100), nullable=False)\r\n    severity = Column(String(20), nullable=False)\r\n    message = Column(Text, nullable=False)\r\n    explanation_text = Column(Text, nullable=True)\r\n    recommendation = Column(Text, nullable=True)\r\n    confidence_score = Column(Float, default=1.0)\r\n    created_at = Column(DateTime, default=datetime.utcnow)\r\n    resolved = Column(Boolean, default=False)\r\n\r\n    user = relationship(\"User\", back_populates=\"alerts\")\r\n    incidents = relationship(\"Incident\", back_populates=\"alert\", cascade=\"all, delete-orphan\")\r\n\r\n\r\nclass Incident(Base):\r\n    __tablename__ = \"incidents\"\r\n    id = Column(Integer, primary_key=True, autoincrement=True)\r\n    alert_id = Column(Integer, ForeignKey(\"alerts.id\", ondelete=\"CASCADE\"), nullable=False, index=True)\r\n    user_id = Column(String(36), ForeignKey(\"users.id\", ondelete=\"CASCADE\"), nullable=False, index=True)\r\n    report_type = Column(String(100), nullable=False) # e.g., \"false_positive\"\r\n    description = Column(Text, nullable=True)\r\n    status = Column(String(50), default=\"open\") # open, reviewed, resolved\r\n    created_at = Column(DateTime, default=datetime.utcnow)\r\n    \r\n    alert = relationship(\"Alert\", back_populates=\"incidents\")\r\n    user = relationship(\"User\", back_populates=\"incidents\")\r\n\r\n\r\nclass DataAccessLog(Base):\r\n    __tablename__ = \"data_access_logs\"\r\n    id = Column(Integer, primary_key=True, autoincrement=True)\r\n    user_id = Column(String(36), ForeignKey(\"users.id\", ondelete=\"CASCADE\"), nullable=False, index=True)\r\n    data_type = Column(String(100), nullable=False)\r\n    purpose = Column(String(255), nullable=False)\r\n    timestamp = Column(DateTime, default=datetime.utcnow)\r\n    \r\n    user = relationship(\"User\", back_populates=\"data_access_logs\")\r\n\r\n\r\nclass IntegrationConfig(Base):\r\n    __tablename__ = \"integration_configs\"\r\n    id = Column(Integer, primary_key=True, autoincrement=True)\r\n    integration_type = Column(String(100), nullable=False) # e.g. \"webhook\", \"email\"\r\n    endpoint = Column(String(255), nullable=False)\r\n    status = Column(String(50), default=\"active\") # active, inactive\r\n\r\n\r\nclass BehaviorLog(Base):\r\n    __tablename__ = \"behavior_logs\"\r\n\r\n    id = Column(Integer, primary_key=True, autoincrement=True)\r\n    user_id = Column(String(36), ForeignKey(\"users.id\", ondelete=\"CASCADE\"), nullable=False, index=True)\r\n    device_id = Column(String(36), ForeignKey(\"devices.id\", ondelete=\"CASCADE\"), nullable=True, index=True)\r\n    timestamp = Column(DateTime, default=datetime.utcnow)\r\n    app_name = Column(String(255))\r\n    permission_requested = Column(String(255))\r\n    network_activity_level = Column(Float, default=0.0)\r\n    background_process_flag = Column(Boolean, default=False)\r\n    anomaly_flag = Column(Boolean, default=False)\r\n    anomaly_type = Column(String(100), nullable=True)\r\n    severity = Column(String(20), nullable=True)\r\n    anomaly_score = Column(Float, nullable=True)\r\n    log_data = Column(JSON, default={})\r\n    \r\n    user = relationship(\"User\", back_populates=\"behavior_logs\")\r\n    device = relationship(\"Device\", back_populates=\"behavior_logs\")\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\models.py","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend\\app","PSChildName":"models.py","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/app/schemas.py","content":{"value":"from pydantic import BaseModel, EmailStr, Field\r\nfrom typing import Optional, List, Dict, Any\r\nfrom datetime import datetime\r\nfrom enum import Enum\r\n\r\n\r\n# â”€â”€â”€â”€ Enums â”€â”€â”€â”€\r\nclass RoleEnum(str, Enum):\r\n    student = \"student\"\r\n    parent = \"parent\"\r\n    admin = \"admin\"\r\n\r\nclass RiskLevelEnum(str, Enum):\r\n    low = \"low\"\r\n    medium = \"medium\"\r\n    high = \"high\"\r\n\r\nclass ReportTypeEnum(str, Enum):\r\n    false_positive = \"false_positive\"\r\n    other = \"other\"\r\n\r\n\r\n# â”€â”€â”€â”€ Auth Schemas â”€â”€â”€â”€\r\nclass RegisterRequest(BaseModel):\r\n    name: str = Field(..., min_length=2, max_length=100)\r\n    email: EmailStr\r\n    college: str = Field(..., min_length=2, max_length=255)\r\n    password: str = Field(..., min_length=6, max_length=128)\r\n    role: RoleEnum = RoleEnum.student\r\n\r\n\r\nclass LoginRequest(BaseModel):\r\n    email: EmailStr\r\n    password: str\r\n\r\n\r\nclass UserResponse(BaseModel):\r\n    id: str\r\n    name: str\r\n    email: str\r\n    college: str\r\n    role: str\r\n    consent_given: bool\r\n    created_at: datetime\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n\r\nclass TokenResponse(BaseModel):\r\n    access_token: str\r\n    refresh_token: str\r\n    token_type: str = \"bearer\"\r\n    user: UserResponse\r\n\r\n\r\n# â”€â”€â”€â”€ Consent â”€â”€â”€â”€\r\nclass ConsentRequest(BaseModel):\r\n    accept_terms: bool\r\n    enable_monitoring: bool\r\n\r\n\r\n# â”€â”€â”€â”€ Devices â”€â”€â”€â”€\r\nclass RegisterDeviceRequest(BaseModel):\r\n    device_name: str = Field(..., max_length=255)\r\n    device_type: str = Field(..., max_length=100)\r\n\r\nclass DeviceResponse(BaseModel):\r\n    id: str\r\n    user_id: str\r\n    device_name: str\r\n    device_type: str\r\n    last_active: datetime\r\n    risk_score: float\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n\r\n# â”€â”€â”€â”€ Behavior Profiles â”€â”€â”€â”€\r\nclass BehaviorProfileResponse(BaseModel):\r\n    user_id: str\r\n    baseline_metrics: Dict[str, Any]\r\n    last_updated: datetime\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n\r\n# â”€â”€â”€â”€ Behavior Logs â”€â”€â”€â”€\r\nclass LogIngestRequest(BaseModel):\r\n    app_name: str = Field(..., max_length=255)\r\n    device_id: Optional[str] = None\r\n    permission_requested: str = Field(default=\"none\", max_length=255)\r\n    network_activity_level: float = Field(default=0.0, ge=0.0, le=100.0)\r\n    background_process_flag: bool = False\r\n    anomaly_flag: bool = False\r\n    extra_data: Optional[dict] = None\r\n\r\n\r\nclass LogResponse(BaseModel):\r\n    id: int\r\n    user_id: str\r\n    device_id: Optional[str]\r\n    timestamp: datetime\r\n    app_name: str\r\n    permission_requested: Optional[str]\r\n    network_activity_level: float\r\n    background_process_flag: bool\r\n    anomaly_flag: bool\r\n    anomaly_type: Optional[str]\r\n    severity: Optional[str]\r\n    anomaly_score: Optional[float]\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n\r\n# â”€â”€â”€â”€ Risk Score â”€â”€â”€â”€\r\nclass RiskScoreResponse(BaseModel):\r\n    current_score: float\r\n    risk_level: str\r\n    last_updated: Optional[datetime]\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n\r\n# â”€â”€â”€â”€ Alerts â”€â”€â”€â”€\r\nclass AlertResponse(BaseModel):\r\n    id: int\r\n    user_id: str\r\n    alert_type: str\r\n    severity: str\r\n    message: str\r\n    explanation_text: Optional[str]\r\n    recommendation: Optional[str]\r\n    confidence_score: float\r\n    created_at: datetime\r\n    resolved: bool\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n\r\nclass ResolveAlertRequest(BaseModel):\r\n    alert_id: int\r\n\r\n\r\nclass BlockAppRequest(BaseModel):\r\n    app_name: str\r\n\r\n\r\n# â”€â”€â”€â”€ Incidents â”€â”€â”€â”€\r\nclass ReportIncidentRequest(BaseModel):\r\n    alert_id: int\r\n    report_type: ReportTypeEnum = ReportTypeEnum.false_positive\r\n    description: Optional[str] = None\r\n\r\nclass IncidentResponse(BaseModel):\r\n    id: int\r\n    alert_id: int\r\n    user_id: str\r\n    report_type: str\r\n    description: Optional[str]\r\n    status: str\r\n    created_at: datetime\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n\r\n# â”€â”€â”€â”€ Privacy (DataAccessLogs) â”€â”€â”€â”€\r\nclass DataAccessLogResponse(BaseModel):\r\n    id: int\r\n    user_id: str\r\n    data_type: str\r\n    purpose: str\r\n    timestamp: datetime\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n\r\n# â”€â”€â”€â”€ Admin â”€â”€â”€â”€\r\nclass AdminStatsResponse(BaseModel):\r\n    total_users: int\r\n    total_students: int\r\n    total_admins: int\r\n    high_risk_count: int\r\n    medium_risk_count: int\r\n    low_risk_count: int\r\n    total_alerts: int\r\n    unresolved_alerts: int\r\n    risk_distribution: dict\r\n\r\n\r\nclass HighRiskUserResponse(BaseModel):\r\n    id: str\r\n    name: str\r\n    email: str\r\n    college: str\r\n    current_score: float\r\n    risk_level: str\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n# â”€â”€â”€â”€ Integration â”€â”€â”€â”€\r\nclass EscalateRequest(BaseModel):\r\n    user_id: str\r\n    reason: str\r\n\r\n# â”€â”€â”€â”€ Analytics â”€â”€â”€â”€\r\nclass TimelinePoint(BaseModel):\r\n    timestamp: str\r\n    risk_score: float\r\n\r\nclass HeatmapPoint(BaseModel):\r\n    hour: int\r\n    frequency: int\r\n\r\n\r\n# â”€â”€â”€â”€ WebSocket â”€â”€â”€â”€\r\nclass WSAlertMessage(BaseModel):\r\n    type: str = \"alert\"\r\n    alert_id: int\r\n    alert_type: str\r\n    severity: str\r\n    message: str\r\n    recommendation: Optional[str]\r\n    timestamp: str\r\n\r\n\r\n# â”€â”€â”€â”€ Wellbeing â”€â”€â”€â”€\r\nclass AppUsageItem(BaseModel):\r\n    app_name: str\r\n    usage_minutes: float\r\n    sessions: int\r\n\r\nclass WellbeingResponse(BaseModel):\r\n    screen_time_hours: float\r\n    focus_score: int\r\n    daily_sessions: int\r\n    top_apps: list[AppUsageItem]\r\n    daily_trend: list[dict]\r\n\r\n\r\n# â”€â”€â”€â”€ Permission Audit â”€â”€â”€â”€\r\nclass PermissionBreakdown(BaseModel):\r\n    permission: str\r\n    count: int\r\n    percentage: float\r\n\r\nclass PermissionAuditResponse(BaseModel):\r\n    total_requests: int\r\n    breakdown: list[PermissionBreakdown]\r\n    risky_apps: list[str]\r\n\r\n\r\n# â”€â”€â”€â”€ Leaderboard â”€â”€â”€â”€\r\nclass LeaderboardResponse(BaseModel):\r\n    rank: int\r\n    total_students: int\r\n    percentile: int\r\n    user_score: float\r\n    campus_average: float\r\n    categories: dict  # { \"network\": x, \"permissions\": x, \"apps\": x, \"behavior\": x }\r\n    campus_categories: dict\r\n\r\n\r\n# â”€â”€â”€â”€ Training â”€â”€â”€â”€\r\nclass TrainingModule(BaseModel):\r\n    id: str\r\n    title: str\r\n    description: str\r\n    difficulty: str\r\n    duration_minutes: int\r\n    completed: bool\r\n    score: Optional[int] = None\r\n\r\nclass TrainingProgressResponse(BaseModel):\r\n    modules: list[TrainingModule]\r\n    completed_count: int\r\n    total_count: int\r\n    overall_score: int\r\n\r\n\r\n# â”€â”€â”€â”€ Admin: Activity Feed â”€â”€â”€â”€\r\nclass ActivityFeedItem(BaseModel):\r\n    id: int\r\n    student_name: str\r\n    student_email: str\r\n    alert_type: str\r\n    severity: str\r\n    message: str\r\n    created_at: datetime\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n\r\n# â”€â”€â”€â”€ Admin: Trends â”€â”€â”€â”€\r\nclass TrendPoint(BaseModel):\r\n    date: str\r\n    avg_risk_score: float\r\n    alert_count: int\r\n    anomaly_count: int\r\n\r\n\r\n# â”€â”€â”€â”€ Admin: College Breakdown â”€â”€â”€â”€\r\nclass CollegeBreakdownItem(BaseModel):\r\n    college: str\r\n    total_students: int\r\n    high_risk: int\r\n    medium_risk: int\r\n    low_risk: int\r\n    avg_score: float\r\n\r\n\r\n# â”€â”€â”€â”€ Admin: All Users â”€â”€â”€â”€\r\nclass UserListItem(BaseModel):\r\n    id: str\r\n    name: str\r\n    email: str\r\n    college: str\r\n    role: str\r\n    consent_given: bool\r\n    risk_score: Optional[float] = None\r\n    risk_level: Optional[str] = None\r\n    alert_count: int = 0\r\n    created_at: datetime\r\n\r\n    class Config:\r\n        from_attributes = True\r\n\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\schemas.py","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend\\app","PSChildName":"schemas.py","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/app/seed.py","content":{"value":"\"\"\"Seed data script: creates demo admin + student users with sample data.\"\"\"\r\nimport asyncio\r\nfrom datetime import datetime, timezone, timedelta\r\nimport random\r\nfrom app.database import engine, async_session, Base\r\nfrom app.models import User, RiskScore, Alert, BehaviorLog\r\nfrom app.auth import hash_password\r\n\r\n\r\nasync def seed():\r\n    async with engine.begin() as conn:\r\n        await conn.run_sync(Base.metadata.create_all)\r\n\r\n    async with async_session() as db:\r\n        from sqlalchemy import select, func\r\n        count = await db.execute(select(func.count(User.id)))\r\n        if (count.scalar() or 0) \u003e 0:\r\n            print(\"Database already has data. Skipping seed.\")\r\n            return\r\n\r\n        # Create admin\r\n        admin = User(\r\n            name=\"Admin User\",\r\n            email=\"admin@sentinelai.com\",\r\n            college=\"SentinelAI HQ\",\r\n            role=\"admin\",\r\n            hashed_password=hash_password(\"admin123\"),\r\n            consent_given=True,\r\n        )\r\n        db.add(admin)\r\n\r\n        # Create demo students\r\n        students = []\r\n        for i in range(5):\r\n            student = User(\r\n                name=f\"Student {i+1}\",\r\n                email=f\"student{i+1}@university.edu\",\r\n                college=\"Demo University\",\r\n                role=\"student\",\r\n                hashed_password=hash_password(\"student123\"),\r\n                consent_given=True,\r\n            )\r\n            db.add(student)\r\n            students.append(student)\r\n\r\n        await db.flush()\r\n\r\n        apps = [\"WhatsApp\", \"Instagram\", \"Chrome\", \"TikTok\", \"YouTube\",\r\n                \"SuspiciousVPN\", \"UnknownAPK\", \"CryptoMiner\"]\r\n\r\n        for student in students:\r\n            score = round(random.uniform(10, 90), 1)\r\n            level = \"low\" if score \u003c= 40 else (\"medium\" if score \u003c= 70 else \"high\")\r\n            rs = RiskScore(user_id=student.id, current_score=score, risk_level=level)\r\n            db.add(rs)\r\n\r\n            for j in range(20):\r\n                is_anomaly = random.random() \u003c 0.25\r\n                log = BehaviorLog(\r\n                    user_id=student.id,\r\n                    timestamp=datetime.now(timezone.utc) - timedelta(hours=random.randint(0, 48)),\r\n                    app_name=random.choice(apps),\r\n                    permission_requested=random.choice([\"none\", \"camera\", \"location\", \"storage\"]),\r\n                    network_activity_level=round(random.uniform(50, 95) if is_anomaly else random.uniform(5, 35), 1),\r\n                    background_process_flag=is_anomaly,\r\n                    anomaly_flag=is_anomaly,\r\n                )\r\n                db.add(log)\r\n\r\n            if score \u003e 70:\r\n                for k in range(3):\r\n                    alert = Alert(\r\n                        user_id=student.id,\r\n                        alert_type=\"high_risk_behavior\",\r\n                        severity=random.choice([\"high\", \"critical\"]),\r\n                        message=\"Suspicious activity detected: elevated network usage and background processes\",\r\n                        created_at=datetime.now(timezone.utc) - timedelta(hours=random.randint(0, 24)),\r\n                        resolved=random.choice([True, False]),\r\n                    )\r\n                    db.add(alert)\r\n\r\n        db.add(RiskScore(user_id=admin.id, current_score=0.0, risk_level=\"low\"))\r\n\r\n        await db.commit()\r\n        print(\"Seed data created successfully!\")\r\n        print(\"  Admin: admin@sentinelai.com / admin123\")\r\n        print(\"  Students: student1@university.edu ... student5@university.edu / student123\")\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    asyncio.run(seed())\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\seed.py","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend\\app","PSChildName":"seed.py","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/app/simulator.py","content":{"value":"import random\r\nimport asyncio\r\nimport logging\r\nfrom datetime import datetime, timezone\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom app.database import async_session\r\nfrom app.models import User, BehaviorLog, RiskScore, Alert, Device, BehaviorProfile, DataAccessLog\r\nfrom app.ai_engine import calculate_risk\r\nfrom app.websocket_manager import manager\r\nfrom sqlalchemy import select\r\n\r\nlogger = logging.getLogger(__name__)\r\n\r\nAPPS = [\r\n    \"WhatsApp\", \"Instagram\", \"Chrome\", \"TikTok\", \"Snapchat\",\r\n    \"YouTube\", \"Telegram\", \"Facebook\", \"Calculator\", \"Camera\",\r\n    \"Files\", \"Settings\", \"Maps\", \"Gmail\", \"Slack\",\r\n    \"SuspiciousVPN\", \"UnknownAPK\", \"CryptoMiner\", \"KeyLogger\",\r\n]\r\n\r\nPERMISSIONS = [\r\n    \"none\", \"camera\", \"microphone\", \"location\", \"contacts\",\r\n    \"storage\", \"sms\", \"phone\", \"accessibility\", \"overlay\",\r\n]\r\n\r\nSUSPICIOUS_APPS = {\"SuspiciousVPN\", \"UnknownAPK\", \"CryptoMiner\", \"KeyLogger\"}\r\n\r\n\r\ndef generate_log(anomaly_chance: float = 0.2) -\u003e dict:\r\n    is_anomaly = random.random() \u003c anomaly_chance\r\n    app = random.choice(list(SUSPICIOUS_APPS)) if is_anomaly else random.choice(APPS[:15])\r\n\r\n    return {\r\n        \"app_name\": app,\r\n        \"permission_requested\": random.choice(PERMISSIONS[1:]) if is_anomaly or random.random() \u003c 0.3 else \"none\",\r\n        \"network_activity_level\": round(random.uniform(60, 100), 1) if is_anomaly else round(random.uniform(0, 40), 1),\r\n        \"background_process_flag\": is_anomaly or random.random() \u003c 0.1,\r\n        \"anomaly_flag\": is_anomaly,\r\n    }\r\n\r\n\r\nasync def simulate_for_device(db: AsyncSession, user_id: str, device_id: str, anomaly_chance: float = 0.2):\r\n    log_data = generate_log(anomaly_chance)\r\n\r\n    log_entry = BehaviorLog(\r\n        user_id=user_id,\r\n        device_id=device_id,\r\n        app_name=log_data[\"app_name\"],\r\n        permission_requested=log_data[\"permission_requested\"],\r\n        network_activity_level=log_data[\"network_activity_level\"],\r\n        background_process_flag=log_data[\"background_process_flag\"],\r\n        anomaly_flag=log_data[\"anomaly_flag\"],\r\n        log_data=log_data,\r\n    )\r\n    db.add(log_entry)\r\n    await db.flush()\r\n\r\n    # Privacy Transparency: Log data access for simulator AI check\r\n    db.add(DataAccessLog(\r\n        user_id=user_id, \r\n        data_type=\"Device Telemetry\", \r\n        purpose=\"Automated Background Anomaly Detection\"\r\n    ))\r\n\r\n    # Fetch User Baseline\r\n    bp_result = await db.execute(select(BehaviorProfile).where(BehaviorProfile.user_id == user_id))\r\n    profile = bp_result.scalar_one_or_none()\r\n    baseline = profile.baseline_metrics if profile else None\r\n\r\n    # Get recent logs\r\n    result = await db.execute(\r\n        select(BehaviorLog)\r\n        .where(BehaviorLog.user_id == user_id)\r\n        .order_by(BehaviorLog.timestamp.desc())\r\n        .limit(50)\r\n    )\r\n    recent_logs = result.scalars().all()\r\n    logs_dicts = [\r\n        {\r\n            \"permission_requested\": l.permission_requested,\r\n            \"network_activity_level\": l.network_activity_level,\r\n            \"background_process_flag\": l.background_process_flag,\r\n            \"anomaly_flag\": l.anomaly_flag,\r\n        }\r\n        for l in recent_logs\r\n    ]\r\n\r\n    risk = calculate_risk(logs_dicts, baseline=baseline)\r\n    score = risk[\"score\"]\r\n    level = risk[\"level\"]\r\n    explanation = risk.get(\"explanation\", \"\")\r\n    recommendation = risk.get(\"recommendation\", \"\")\r\n    severity = risk.get(\"severity\", \"high\")\r\n\r\n    rs_result = await db.execute(\r\n        select(RiskScore).where(RiskScore.user_id == user_id)\r\n    )\r\n    risk_score = rs_result.scalar_one_or_none()\r\n    if risk_score:\r\n        risk_score.current_score = score\r\n        risk_score.risk_level = level\r\n        risk_score.last_updated = datetime.now(timezone.utc)\r\n    else:\r\n        risk_score = RiskScore(user_id=user_id, current_score=score, risk_level=level)\r\n        db.add(risk_score)\r\n\r\n    if score \u003e 70:\r\n        alert = Alert(\r\n            user_id=user_id,\r\n            alert_type=\"high_risk_behavior\",\r\n            severity=severity,\r\n            message=f\"Risk score {score}: suspicious activity from {log_data[\u0027app_name\u0027]}\",\r\n            explanation_text=explanation or f\"Anomalous app behavior in {log_data[\u0027app_name\u0027]}\",\r\n            recommendation=recommendation or \"Review device activity.\",\r\n            confidence_score=0.9\r\n        )\r\n        db.add(alert)\r\n        await db.flush()\r\n\r\n        await manager.send_to_user(str(user_id), {\r\n            \"type\": \"alert\",\r\n            \"alert_id\": alert.id,\r\n            \"alert_type\": alert.alert_type,\r\n            \"severity\": alert.severity,\r\n            \"message\": alert.message,\r\n            \"recommendation\": alert.recommendation,\r\n            \"timestamp\": datetime.now(timezone.utc).isoformat(),\r\n            \"risk_score\": score,\r\n        })\r\n\r\n    await db.commit()\r\n\r\n\r\nasync def run_simulator(interval: int = 30):\r\n    logger.info(f\"Device simulator started (interval={interval}s)\")\r\n    while True:\r\n        try:\r\n            async with async_session() as db:\r\n                result = await db.execute(\r\n                    select(User).where(\r\n                        User.role == \"student\",\r\n                        User.consent_given == True,\r\n                    )\r\n                )\r\n                students = result.scalars().all()\r\n\r\n                devices_simulated = 0\r\n                for student in students:\r\n                    anomaly_chance = random.uniform(0.1, 0.35)\r\n                    \r\n                    # Fetch devices\r\n                    dev_res = await db.execute(select(Device).where(Device.user_id == student.id))\r\n                    devices = dev_res.scalars().all()\r\n                    \r\n                    if not devices:\r\n                        # Auto register default device if none exist\r\n                        main_device = Device(user_id=student.id, device_name=\"Main Phone\", device_type=\"smartphone\")\r\n                        db.add(main_device)\r\n                        await db.commit()\r\n                        await db.refresh(main_device)\r\n                        devices = [main_device]\r\n                        \r\n                    for d in devices:\r\n                        await simulate_for_device(db, student.id, d.id, anomaly_chance)\r\n                        devices_simulated += 1\r\n\r\n                if devices_simulated \u003e 0:\r\n                    logger.info(f\"Simulated logs for {devices_simulated} devices across {len(students)} students\")\r\n\r\n        except Exception as e:\r\n            logger.error(f\"Simulator error: {e}\")\r\n\r\n        await asyncio.sleep(interval)\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\simulator.py","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend\\app","PSChildName":"simulator.py","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/app/websocket_manager.py","content":{"value":"from fastapi import WebSocket\r\nfrom typing import Dict, List\r\nimport json\r\nimport logging\r\n\r\nlogger = logging.getLogger(__name__)\r\n\r\n\r\nclass ConnectionManager:\r\n    \"\"\"Manages WebSocket connections per user for real-time alerts.\"\"\"\r\n\r\n    def __init__(self):\r\n        self.active_connections: Dict[str, List[WebSocket]] = {}\r\n\r\n    async def connect(self, websocket: WebSocket, user_id: str):\r\n        await websocket.accept()\r\n        if user_id not in self.active_connections:\r\n            self.active_connections[user_id] = []\r\n        self.active_connections[user_id].append(websocket)\r\n        logger.info(f\"WebSocket connected for user {user_id}\")\r\n\r\n    def disconnect(self, websocket: WebSocket, user_id: str):\r\n        if user_id in self.active_connections:\r\n            self.active_connections[user_id] = [\r\n                ws for ws in self.active_connections[user_id] if ws != websocket\r\n            ]\r\n            if not self.active_connections[user_id]:\r\n                del self.active_connections[user_id]\r\n        logger.info(f\"WebSocket disconnected for user {user_id}\")\r\n\r\n    async def send_to_user(self, user_id: str, message: dict):\r\n        if user_id in self.active_connections:\r\n            dead = []\r\n            for ws in self.active_connections[user_id]:\r\n                try:\r\n                    await ws.send_text(json.dumps(message))\r\n                except Exception:\r\n                    dead.append(ws)\r\n            for ws in dead:\r\n                self.active_connections[user_id].remove(ws)\r\n\r\n    async def broadcast(self, message: dict):\r\n        for user_id in list(self.active_connections.keys()):\r\n            await self.send_to_user(user_id, message)\r\n\r\n    @property\r\n    def connected_count(self) -\u003e int:\r\n        return sum(len(conns) for conns in self.active_connections.values())\r\n\r\n\r\nmanager = ConnectionManager()\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\websocket_manager.py","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend\\app","PSChildName":"websocket_manager.py","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/app/routers/__init__.py","content":""},{"path":"backend/app/routers/admin_router.py","content":{"value":"from fastapi import APIRouter, Depends, Query\r\nfrom fastapi.responses import StreamingResponse\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select, func, case, and_\r\nfrom sqlalchemy.orm import selectinload\r\nfrom typing import List\r\nfrom datetime import datetime, timezone, timedelta\r\nimport csv\r\nimport io\r\n\r\nfrom app.database import get_db\r\nfrom app.models import User, RiskScore, Alert, BehaviorLog\r\nfrom app.schemas import (\r\n    AdminStatsResponse, HighRiskUserResponse,\r\n    ActivityFeedItem, TrendPoint, CollegeBreakdownItem, UserListItem,\r\n)\r\nfrom app.deps import require_admin\r\n\r\nrouter = APIRouter(prefix=\"/api/admin\", tags=[\"admin\"])\r\n\r\n\r\n@router.get(\"/stats\", response_model=AdminStatsResponse)\r\nasync def get_stats(\r\n    db: AsyncSession = Depends(get_db),\r\n    admin: User = Depends(require_admin),\r\n):\r\n    total_result = await db.execute(select(func.count(User.id)))\r\n    total_users = total_result.scalar() or 0\r\n\r\n    students_result = await db.execute(\r\n        select(func.count(User.id)).where(User.role == \"student\")\r\n    )\r\n    total_students = students_result.scalar() or 0\r\n\r\n    admins_result = await db.execute(\r\n        select(func.count(User.id)).where(User.role == \"admin\")\r\n    )\r\n    total_admins = admins_result.scalar() or 0\r\n\r\n    high_result = await db.execute(\r\n        select(func.count(RiskScore.id)).where(RiskScore.risk_level == \"high\")\r\n    )\r\n    high_risk = high_result.scalar() or 0\r\n\r\n    medium_result = await db.execute(\r\n        select(func.count(RiskScore.id)).where(RiskScore.risk_level == \"medium\")\r\n    )\r\n    medium_risk = medium_result.scalar() or 0\r\n\r\n    low_result = await db.execute(\r\n        select(func.count(RiskScore.id)).where(RiskScore.risk_level == \"low\")\r\n    )\r\n    low_risk = low_result.scalar() or 0\r\n\r\n    alerts_result = await db.execute(select(func.count(Alert.id)))\r\n    total_alerts = alerts_result.scalar() or 0\r\n\r\n    unresolved_result = await db.execute(\r\n        select(func.count(Alert.id)).where(Alert.resolved == False)\r\n    )\r\n    unresolved_alerts = unresolved_result.scalar() or 0\r\n\r\n    return AdminStatsResponse(\r\n        total_users=total_users,\r\n        total_students=total_students,\r\n        total_admins=total_admins,\r\n        high_risk_count=high_risk,\r\n        medium_risk_count=medium_risk,\r\n        low_risk_count=low_risk,\r\n        total_alerts=total_alerts,\r\n        unresolved_alerts=unresolved_alerts,\r\n        risk_distribution={\"high\": high_risk, \"medium\": medium_risk, \"low\": low_risk},\r\n    )\r\n\r\n\r\n@router.get(\"/high-risk-users\", response_model=List[HighRiskUserResponse])\r\nasync def get_high_risk_users(\r\n    db: AsyncSession = Depends(get_db),\r\n    admin: User = Depends(require_admin),\r\n):\r\n    result = await db.execute(\r\n        select(User, RiskScore)\r\n        .join(RiskScore, User.id == RiskScore.user_id)\r\n        .where(RiskScore.current_score \u003e 70)\r\n        .order_by(RiskScore.current_score.desc())\r\n    )\r\n    rows = result.all()\r\n    return [\r\n        HighRiskUserResponse(\r\n            id=user.id,\r\n            name=user.name,\r\n            email=user.email,\r\n            college=user.college,\r\n            current_score=risk.current_score,\r\n            risk_level=risk.risk_level,\r\n        )\r\n        for user, risk in rows\r\n    ]\r\n\r\n\r\n@router.get(\"/export-report\")\r\nasync def export_report(\r\n    db: AsyncSession = Depends(get_db),\r\n    admin: User = Depends(require_admin),\r\n):\r\n    result = await db.execute(\r\n        select(User, RiskScore)\r\n        .join(RiskScore, User.id == RiskScore.user_id)\r\n        .order_by(RiskScore.current_score.desc())\r\n    )\r\n    rows = result.all()\r\n\r\n    output = io.StringIO()\r\n    writer = csv.writer(output)\r\n    writer.writerow([\"Name\", \"Email\", \"College\", \"Role\", \"Risk Score\", \"Risk Level\"])\r\n    for user, risk in rows:\r\n        writer.writerow([\r\n            user.name, user.email, user.college, user.role,\r\n            risk.current_score, risk.risk_level,\r\n        ])\r\n\r\n    output.seek(0)\r\n    return StreamingResponse(\r\n        iter([output.getvalue()]),\r\n        media_type=\"text/csv\",\r\n        headers={\"Content-Disposition\": \"attachment; filename=sentinel_report.csv\"},\r\n    )\r\n\r\n\r\n# â”€â”€â”€â”€ Activity Feed â”€â”€â”€â”€\r\n@router.get(\"/activity-feed\", response_model=List[ActivityFeedItem])\r\nasync def get_activity_feed(\r\n    db: AsyncSession = Depends(get_db),\r\n    admin: User = Depends(require_admin),\r\n    limit: int = Query(50, le=100),\r\n):\r\n    result = await db.execute(\r\n        select(Alert, User.name, User.email)\r\n        .join(User, User.id == Alert.user_id)\r\n        .order_by(Alert.created_at.desc())\r\n        .limit(limit)\r\n    )\r\n    rows = result.all()\r\n    return [\r\n        ActivityFeedItem(\r\n            id=alert.id,\r\n            student_name=name,\r\n            student_email=email,\r\n            alert_type=alert.alert_type,\r\n            severity=alert.severity,\r\n            message=alert.message,\r\n            created_at=alert.created_at,\r\n        )\r\n        for alert, name, email in rows\r\n    ]\r\n\r\n\r\n# â”€â”€â”€â”€ Trend Analytics â”€â”€â”€â”€\r\n@router.get(\"/trends\", response_model=List[TrendPoint])\r\nasync def get_trends(\r\n    db: AsyncSession = Depends(get_db),\r\n    admin: User = Depends(require_admin),\r\n    days: int = Query(14, le=30),\r\n):\r\n    trends = []\r\n    now = datetime.now(timezone.utc)\r\n\r\n    for i in range(days, 0, -1):\r\n        day_start = (now - timedelta(days=i)).replace(hour=0, minute=0, second=0, microsecond=0)\r\n        day_end = day_start + timedelta(days=1)\r\n\r\n        # Average risk score across all students\r\n        score_result = await db.execute(\r\n            select(func.avg(RiskScore.current_score))\r\n        )\r\n        avg_score = score_result.scalar() or 0\r\n\r\n        # Alerts created that day\r\n        alert_result = await db.execute(\r\n            select(func.count(Alert.id)).where(\r\n                and_(Alert.created_at \u003e= day_start, Alert.created_at \u003c day_end)\r\n            )\r\n        )\r\n        alert_count = alert_result.scalar() or 0\r\n\r\n        # Anomalies that day\r\n        anomaly_result = await db.execute(\r\n            select(func.count(BehaviorLog.id)).where(\r\n                and_(\r\n                    BehaviorLog.timestamp \u003e= day_start,\r\n                    BehaviorLog.timestamp \u003c day_end,\r\n                    BehaviorLog.anomaly_flag == True,\r\n                )\r\n            )\r\n        )\r\n        anomaly_count = anomaly_result.scalar() or 0\r\n\r\n        trends.append(TrendPoint(\r\n            date=day_start.strftime(\"%b %d\"),\r\n            avg_risk_score=round(float(avg_score), 1),\r\n            alert_count=alert_count,\r\n            anomaly_count=anomaly_count,\r\n        ))\r\n\r\n    return trends\r\n\r\n\r\n# â”€â”€â”€â”€ College Breakdown â”€â”€â”€â”€\r\n@router.get(\"/college-breakdown\", response_model=List[CollegeBreakdownItem])\r\nasync def get_college_breakdown(\r\n    db: AsyncSession = Depends(get_db),\r\n    admin: User = Depends(require_admin),\r\n):\r\n    # Get all students with their risk scores grouped by college\r\n    result = await db.execute(\r\n        select(\r\n            User.college,\r\n            func.count(User.id).label(\"total\"),\r\n            func.sum(case((RiskScore.risk_level == \"high\", 1), else_=0)).label(\"high\"),\r\n            func.sum(case((RiskScore.risk_level == \"medium\", 1), else_=0)).label(\"medium\"),\r\n            func.sum(case((RiskScore.risk_level == \"low\", 1), else_=0)).label(\"low\"),\r\n            func.avg(RiskScore.current_score).label(\"avg_score\"),\r\n        )\r\n        .join(RiskScore, User.id == RiskScore.user_id)\r\n        .where(User.role == \"student\")\r\n        .group_by(User.college)\r\n        .order_by(func.avg(RiskScore.current_score).desc())\r\n    )\r\n    rows = result.all()\r\n    return [\r\n        CollegeBreakdownItem(\r\n            college=r.college,\r\n            total_students=r.total,\r\n            high_risk=r.high or 0,\r\n            medium_risk=r.medium or 0,\r\n            low_risk=r.low or 0,\r\n            avg_score=round(float(r.avg_score or 0), 1),\r\n        )\r\n        for r in rows\r\n    ]\r\n\r\n\r\n# â”€â”€â”€â”€ All Users â”€â”€â”€â”€\r\n@router.get(\"/all-users\", response_model=List[UserListItem])\r\nasync def get_all_users(\r\n    db: AsyncSession = Depends(get_db),\r\n    admin: User = Depends(require_admin),\r\n    search: str = Query(\"\", description=\"Search by name or email\"),\r\n    role_filter: str = Query(\"all\", description=\"Filter by role\"),\r\n):\r\n    query = (\r\n        select(User, RiskScore.current_score, RiskScore.risk_level)\r\n        .outerjoin(RiskScore, User.id == RiskScore.user_id)\r\n    )\r\n\r\n    if search:\r\n        query = query.where(\r\n            User.name.ilike(f\"%{search}%\") | User.email.ilike(f\"%{search}%\")\r\n        )\r\n    if role_filter != \"all\":\r\n        query = query.where(User.role == role_filter)\r\n\r\n    query = query.order_by(User.created_at.desc())\r\n    result = await db.execute(query)\r\n    rows = result.all()\r\n\r\n    items = []\r\n    for user, score, level in rows:\r\n        # Count alerts for user\r\n        alert_result = await db.execute(\r\n            select(func.count(Alert.id)).where(Alert.user_id == user.id)\r\n        )\r\n        alert_count = alert_result.scalar() or 0\r\n\r\n        items.append(UserListItem(\r\n            id=user.id,\r\n            name=user.name,\r\n            email=user.email,\r\n            college=user.college,\r\n            role=user.role,\r\n            consent_given=user.consent_given,\r\n            risk_score=round(float(score), 1) if score else None,\r\n            risk_level=level,\r\n            alert_count=alert_count,\r\n            created_at=user.created_at,\r\n        ))\r\n\r\n    return items\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\routers\\admin_router.py","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\routers","PSChildName":"admin_router.py","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/app/routers/anomalies_router.py","content":{"value":"from fastapi import APIRouter, Depends, HTTPException\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select, func\r\nfrom typing import List\r\nfrom datetime import datetime, timedelta, timezone\r\nfrom app.database import get_db\r\nfrom app.models import BehaviorLog, User\r\nfrom app.schemas import TimelinePoint, HeatmapPoint\r\nfrom app.deps import get_current_user\r\nimport random\r\n\r\nrouter = APIRouter(prefix=\"/api/anomalies\", tags=[\"anomalies\"])\r\n\r\n@router.get(\"/timeline\", response_model=List[TimelinePoint])\r\nasync def get_anomaly_timeline(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    # For a real implementation, we\u0027d group logs by hour/minute and average the score.\r\n    # Since sqlite/asyncpg date math varies, we\u0027ll fetch the last 24 hours of logs\r\n    # and organize them in python, or simply mock a timeline if few logs exist.\r\n    \r\n    time_limit = datetime.utcnow() - timedelta(hours=24)\r\n    result = await db.execute(\r\n        select(BehaviorLog.timestamp, BehaviorLog.anomaly_score)\r\n        .where(BehaviorLog.user_id == user.id, BehaviorLog.timestamp \u003e= time_limit)\r\n        .order_by(BehaviorLog.timestamp.asc())\r\n    )\r\n    \r\n    logs = result.all()\r\n    \r\n    if len(logs) \u003c 10:\r\n        # Generate stable mock data for the demo if insufficient logs\r\n        base_time = datetime.utcnow() - timedelta(hours=12)\r\n        mock_timeline = []\r\n        for i in range(12):\r\n            point_time = base_time + timedelta(hours=i)\r\n            mock_timeline.append(TimelinePoint(\r\n                timestamp=point_time.strftime(\"%H:%M\"),\r\n                risk_score=random.uniform(10.0, 45.0) if i != 8 else random.uniform(80.0, 95.0) # spike at hour 8\r\n            ))\r\n        return mock_timeline\r\n        \r\n    # Group by hour\r\n    grouped = {}\r\n    for timestamp, score in logs:\r\n        hour_key = timestamp.strftime(\"%H:00\")\r\n        if hour_key not in grouped:\r\n            grouped[hour_key] = []\r\n        grouped[hour_key].append(score or 0.0)\r\n        \r\n    timeline = []\r\n    for hour, scores in grouped.items():\r\n        avg_score = sum(scores) / len(scores)\r\n        timeline.append(TimelinePoint(timestamp=hour, risk_score=round(avg_score, 1)))\r\n        \r\n    return timeline\r\n\r\n@router.get(\"/heatmap\", response_model=List[HeatmapPoint])\r\nasync def get_anomaly_heatmap(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    # Heatmap of hour of day vs frequency of high-risk anomalies\r\n    # Returning a simulated heatmap pattern for the dashboard\r\n    \r\n    heatmap = []\r\n    # 24 hours\r\n    for h in range(24):\r\n        # Higher frequency during night hours (simulated anomaly pattern)\r\n        if 1 \u003c= h \u003c= 4:\r\n            freq = random.randint(5, 15)\r\n        elif 9 \u003c= h \u003c= 17:\r\n            freq = random.randint(0, 3)\r\n        else:\r\n            freq = random.randint(0, 5)\r\n            \r\n        heatmap.append(HeatmapPoint(hour=h, frequency=freq))\r\n        \r\n    return heatmap\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\routers\\anomalies_router.py","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\routers","PSChildName":"anomalies_router.py","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/app/routers/auth_router.py","content":{"value":"from fastapi import APIRouter, Depends, HTTPException, status\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select\r\nfrom app.database import get_db\r\nfrom app.models import User, RiskScore\r\nfrom app.schemas import (\r\n    RegisterRequest, LoginRequest, TokenResponse, UserResponse, ConsentRequest\r\n)\r\nfrom app.auth import hash_password, verify_password, create_access_token, create_refresh_token\r\nfrom app.deps import get_current_user\r\n\r\nrouter = APIRouter(prefix=\"/api\", tags=[\"auth\"])\r\n\r\n\r\n@router.post(\"/register\", response_model=UserResponse, status_code=status.HTTP_201_CREATED)\r\nasync def register(req: RegisterRequest, db: AsyncSession = Depends(get_db)):\r\n    result = await db.execute(select(User).where(User.email == req.email))\r\n    if result.scalar_one_or_none():\r\n        raise HTTPException(status_code=400, detail=\"Email already registered\")\r\n\r\n    user = User(\r\n        name=req.name,\r\n        email=req.email,\r\n        college=req.college,\r\n        role=req.role.value,\r\n        hashed_password=hash_password(req.password),\r\n    )\r\n    db.add(user)\r\n    await db.flush()\r\n\r\n    risk_score = RiskScore(user_id=user.id, current_score=0.0, risk_level=\"low\")\r\n    db.add(risk_score)\r\n    await db.commit()\r\n    await db.refresh(user)\r\n    return user\r\n\r\n\r\n@router.post(\"/login\", response_model=TokenResponse)\r\nasync def login(req: LoginRequest, db: AsyncSession = Depends(get_db)):\r\n    result = await db.execute(select(User).where(User.email == req.email))\r\n    user = result.scalar_one_or_none()\r\n    if not user or not verify_password(req.password, user.hashed_password):\r\n        raise HTTPException(status_code=401, detail=\"Invalid email or password\")\r\n\r\n    access_token = create_access_token({\"sub\": str(user.id), \"role\": user.role})\r\n    refresh_token = create_refresh_token({\"sub\": str(user.id)})\r\n\r\n    return TokenResponse(\r\n        access_token=access_token,\r\n        refresh_token=refresh_token,\r\n        user=UserResponse.model_validate(user),\r\n    )\r\n\r\n\r\n@router.get(\"/profile\", response_model=UserResponse)\r\nasync def get_profile(user: User = Depends(get_current_user)):\r\n    return user\r\n\r\n\r\n@router.post(\"/consent\", response_model=UserResponse)\r\nasync def give_consent(\r\n    req: ConsentRequest,\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user),\r\n):\r\n    if not req.accept_terms or not req.enable_monitoring:\r\n        raise HTTPException(status_code=400, detail=\"You must accept terms and enable monitoring\")\r\n\r\n    user.consent_given = True\r\n    await db.commit()\r\n    await db.refresh(user)\r\n    return user\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\routers\\auth_router.py","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\routers","PSChildName":"auth_router.py","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/app/routers/devices_router.py","content":{"value":"from fastapi import APIRouter, Depends, HTTPException, status\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select\r\nfrom typing import List\r\nfrom app.database import get_db\r\nfrom app.models import Device, User\r\nfrom app.schemas import RegisterDeviceRequest, DeviceResponse\r\nfrom app.deps import get_current_user\r\n\r\nrouter = APIRouter(prefix=\"/api/devices\", tags=[\"devices\"])\r\n\r\n@router.post(\"/register\", response_model=DeviceResponse, status_code=status.HTTP_201_CREATED)\r\nasync def register_device(\r\n    req: RegisterDeviceRequest, \r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    device = Device(\r\n        user_id=user.id,\r\n        device_name=req.device_name,\r\n        device_type=req.device_type,\r\n        risk_score=0.0\r\n    )\r\n    db.add(device)\r\n    await db.commit()\r\n    await db.refresh(device)\r\n    return device\r\n\r\n@router.get(\"\", response_model=List[DeviceResponse])\r\nasync def get_devices(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    result = await db.execute(select(Device).where(Device.user_id == user.id))\r\n    devices = result.scalars().all()\r\n    return devices\r\n\r\n@router.get(\"/{device_id}/risk\", response_model=float)\r\nasync def get_device_risk(\r\n    device_id: str,\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    result = await db.execute(\r\n        select(Device).where(Device.id == device_id, Device.user_id == user.id)\r\n    )\r\n    device = result.scalar_one_or_none()\r\n    if not device:\r\n        raise HTTPException(status_code=404, detail=\"Device not found\")\r\n    \r\n    return device.risk_score\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\routers\\devices_router.py","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\routers","PSChildName":"devices_router.py","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/app/routers/escalate_router.py","content":{"value":"from fastapi import APIRouter, Depends, HTTPException, status\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select\r\nfrom app.database import get_db\r\nfrom app.models import User, IntegrationConfig\r\nfrom app.schemas import EscalateRequest\r\nfrom app.deps import get_current_user\r\n\r\nrouter = APIRouter(prefix=\"/api/escalate\", tags=[\"escalate\"])\r\n\r\n@router.post(\"\", status_code=status.HTTP_200_OK)\r\nasync def escalate_incident(\r\n    req: EscalateRequest, \r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    # Retrieve active integration hooks for the campus IT center\r\n    result = await db.execute(select(IntegrationConfig).where(IntegrationConfig.status == \"active\"))\r\n    configs = result.scalars().all()\r\n    \r\n    if not configs:\r\n        # In a real app we\u0027d just log this. For the demo, we return a success response \r\n        # acknowledging the simulated escalation to Campus IT.\r\n        return {\r\n            \"status\": \"success\", \r\n            \"message\": f\"Escalated high-risk alert for user {req.user_id} to Campus IT.\",\r\n            \"hooks_triggered\": 0\r\n        }\r\n        \r\n    return {\r\n        \"status\": \"success\", \r\n        \"message\": f\"Escalated high-risk alert for user {req.user_id} to Campus IT.\",\r\n        \"hooks_triggered\": len(configs)\r\n    }\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\routers\\escalate_router.py","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\routers","PSChildName":"escalate_router.py","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/app/routers/incidents_router.py","content":{"value":"from fastapi import APIRouter, Depends, HTTPException, status\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select, update\r\nfrom typing import List\r\nfrom app.database import get_db\r\nfrom app.models import Incident, User, Alert\r\nfrom app.schemas import ReportIncidentRequest, IncidentResponse\r\nfrom app.deps import get_current_user\r\n\r\nrouter = APIRouter(prefix=\"/api/incidents\", tags=[\"incidents\"])\r\n\r\n@router.post(\"/report\", response_model=IncidentResponse, status_code=status.HTTP_201_CREATED)\r\nasync def report_incident(\r\n    req: ReportIncidentRequest, \r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    # Verify the alert exists and belongs to the user\r\n    result = await db.execute(select(Alert).where(Alert.id == req.alert_id, Alert.user_id == user.id))\r\n    alert = result.scalar_one_or_none()\r\n    \r\n    if not alert:\r\n        raise HTTPException(status_code=404, detail=\"Alert not found\")\r\n        \r\n    incident = Incident(\r\n        alert_id=req.alert_id,\r\n        user_id=user.id,\r\n        report_type=req.report_type.value,\r\n        description=req.description,\r\n        status=\"open\"\r\n    )\r\n    db.add(incident)\r\n    \r\n    # Optionally mark the alert as resolved since they reported it as false positive\r\n    alert.resolved = True\r\n    \r\n    await db.commit()\r\n    await db.refresh(incident)\r\n    return incident\r\n\r\n@router.get(\"\", response_model=List[IncidentResponse])\r\nasync def get_incidents(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    if user.role == \"admin\":\r\n        result = await db.execute(select(Incident).order_by(Incident.created_at.desc()))\r\n    else:\r\n        result = await db.execute(select(Incident).where(Incident.user_id == user.id).order_by(Incident.created_at.desc()))\r\n        \r\n    return result.scalars().all()\r\n\r\n@router.patch(\"/{incident_id}/status\", response_model=IncidentResponse)\r\nasync def update_incident_status(\r\n    incident_id: int,\r\n    status: str,\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    # Only admins can update status typically, but allowing for demo purposes\r\n    if user.role != \"admin\" and status != \"resolved\":\r\n        raise HTTPException(status_code=403, detail=\"Not authorized to change status to anything but resolved\")\r\n        \r\n    result = await db.execute(select(Incident).where(Incident.id == incident_id))\r\n    incident = result.scalar_one_or_none()\r\n    \r\n    if not incident:\r\n        raise HTTPException(status_code=404, detail=\"Incident not found\")\r\n        \r\n    # Security: Ensure users can only update their own incidents if they aren\u0027t admin\r\n    if user.role != \"admin\" and incident.user_id != user.id:\r\n        raise HTTPException(status_code=403, detail=\"Not authorized\")\r\n        \r\n    incident.status = status\r\n    await db.commit()\r\n    await db.refresh(incident)\r\n    return incident\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\routers\\incidents_router.py","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\routers","PSChildName":"incidents_router.py","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/app/routers/logs_router.py","content":{"value":"from fastapi import APIRouter, Depends, HTTPException\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select\r\nfrom datetime import datetime, timezone\r\nfrom typing import List\r\nfrom app.database import get_db\r\nfrom app.models import User, BehaviorLog, RiskScore, Alert, BehaviorProfile, DataAccessLog\r\nfrom app.schemas import LogIngestRequest, LogResponse, RiskScoreResponse, AlertResponse\r\nfrom app.deps import get_current_user, require_consent\r\nfrom app.ai_engine import calculate_risk\r\nfrom app.websocket_manager import manager\r\n\r\nrouter = APIRouter(prefix=\"/api\", tags=[\"logs\"])\r\n\r\n\r\n@router.post(\"/logs\", response_model=LogResponse)\r\nasync def ingest_log(\r\n    req: LogIngestRequest,\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(require_consent),\r\n):\r\n    log_entry = BehaviorLog(\r\n        user_id=user.id,\r\n        device_id=req.device_id,\r\n        app_name=req.app_name,\r\n        permission_requested=req.permission_requested,\r\n        network_activity_level=req.network_activity_level,\r\n        background_process_flag=req.background_process_flag,\r\n        anomaly_flag=req.anomaly_flag,\r\n        log_data=req.extra_data or {},\r\n    )\r\n    db.add(log_entry)\r\n    await db.flush()\r\n\r\n    # Recalculate risk score\r\n    result = await db.execute(\r\n        select(BehaviorLog)\r\n        .where(BehaviorLog.user_id == user.id)\r\n        .order_by(BehaviorLog.timestamp.desc())\r\n        .limit(50)\r\n    )\r\n    recent = result.scalars().all()\r\n    logs_data = [\r\n        {\r\n            \"permission_requested\": l.permission_requested,\r\n            \"network_activity_level\": l.network_activity_level,\r\n            \"background_process_flag\": l.background_process_flag,\r\n            \"anomaly_flag\": l.anomaly_flag,\r\n        }\r\n        for l in recent\r\n    ]\r\n\r\n    # Privacy Transparency: Log data access for AI calculation\r\n    db.add(DataAccessLog(\r\n        user_id=user.id, \r\n        data_type=\"Behavioral History\", \r\n        purpose=\"AI Risk Score Calculation and Deviation Check\"\r\n    ))\r\n\r\n    # Fetch User Baseline\r\n    bp_result = await db.execute(select(BehaviorProfile).where(BehaviorProfile.user_id == user.id))\r\n    profile = bp_result.scalar_one_or_none()\r\n    baseline = profile.baseline_metrics if profile else None\r\n\r\n    # Calculate Risk using personalized baseline logic\r\n    risk = calculate_risk(logs_data, baseline=baseline)\r\n\r\n    # Update risk score\r\n    rs_result = await db.execute(select(RiskScore).where(RiskScore.user_id == user.id))\r\n    risk_score = rs_result.scalar_one_or_none()\r\n    if risk_score:\r\n        risk_score.current_score = risk[\"score\"]\r\n        risk_score.risk_level = risk[\"level\"]\r\n        risk_score.last_updated = datetime.now(timezone.utc)\r\n    else:\r\n        risk_score = RiskScore(\r\n            user_id=user.id, current_score=risk[\"score\"], risk_level=risk[\"level\"]\r\n        )\r\n        db.add(risk_score)\r\n\r\n    # Alert if high risk\r\n    if risk[\"score\"] \u003e 70:\r\n        alert = Alert(\r\n            user_id=user.id,\r\n            alert_type=\"high_risk_behavior\",\r\n            severity=risk.get(\"severity\", \"high\"),\r\n            message=f\"Risk score {risk[\u0027score\u0027]}: suspicious activity from {req.app_name}\",\r\n            explanation_text=risk.get(\"explanation\", f\"High risk score detected from excessive permissions or background activity in {req.app_name}.\"),\r\n            recommendation=risk.get(\"recommendation\", \"Review the app\u0027s requested permissions and consider blocking or uninstalling it.\"),\r\n            confidence_score=0.95\r\n        )\r\n        db.add(alert)\r\n        await db.flush()\r\n\r\n        await manager.send_to_user(str(user.id), {\r\n            \"type\": \"alert\",\r\n            \"alert_id\": alert.id,\r\n            \"alert_type\": alert.alert_type,\r\n            \"severity\": alert.severity,\r\n            \"message\": alert.message,\r\n            \"recommendation\": alert.recommendation,\r\n            \"timestamp\": datetime.now(timezone.utc).isoformat(),\r\n            \"risk_score\": risk[\"score\"],\r\n        })\r\n\r\n    await db.commit()\r\n    await db.refresh(log_entry)\r\n    return log_entry\r\n\r\n\r\n@router.get(\"/risk-score\", response_model=RiskScoreResponse)\r\nasync def get_risk_score(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user),\r\n):\r\n    result = await db.execute(select(RiskScore).where(RiskScore.user_id == user.id))\r\n    risk_score = result.scalar_one_or_none()\r\n    if not risk_score:\r\n        return RiskScoreResponse(current_score=0.0, risk_level=\"low\", last_updated=None)\r\n    return risk_score\r\n\r\n\r\n@router.get(\"/alerts\", response_model=List[AlertResponse])\r\nasync def get_alerts(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user),\r\n):\r\n    result = await db.execute(\r\n        select(Alert)\r\n        .where(Alert.user_id == user.id)\r\n        .order_by(Alert.created_at.desc())\r\n        .limit(50)\r\n    )\r\n    return result.scalars().all()\r\n\r\n\r\n@router.get(\"/logs/recent\", response_model=List[LogResponse])\r\nasync def get_recent_logs(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(require_consent),\r\n):\r\n    result = await db.execute(\r\n        select(BehaviorLog)\r\n        .where(BehaviorLog.user_id == user.id)\r\n        .order_by(BehaviorLog.timestamp.desc())\r\n        .limit(30)\r\n    )\r\n    return result.scalars().all()\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\routers\\logs_router.py","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\routers","PSChildName":"logs_router.py","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/app/routers/privacy_router.py","content":{"value":"from fastapi import APIRouter, Depends, HTTPException\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select\r\nfrom typing import List\r\nfrom app.database import get_db\r\nfrom app.models import DataAccessLog, User, Alert\r\nfrom app.schemas import DataAccessLogResponse\r\nfrom app.deps import get_current_user\r\n\r\nrouter = APIRouter(prefix=\"/api/privacy\", tags=[\"privacy\"])\r\n\r\n@router.get(\"/data-access\", response_model=List[DataAccessLogResponse])\r\nasync def get_data_access_logs(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    # Retrieve the audit trail of what data the system accessed for this user\r\n    result = await db.execute(select(DataAccessLog).where(DataAccessLog.user_id == user.id).order_by(DataAccessLog.timestamp.desc()))\r\n    return result.scalars().all()\r\n\r\n@router.get(\"/explanation/{alert_id}\")\r\nasync def get_alert_explanation(\r\n    alert_id: int,\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    # Explainability Engine Endpoint: Explains an alert in natural language\r\n    result = await db.execute(select(Alert).where(Alert.id == alert_id, Alert.user_id == user.id))\r\n    alert = result.scalar_one_or_none()\r\n    \r\n    if not alert:\r\n        raise HTTPException(status_code=404, detail=\"Alert not found\")\r\n        \r\n    return {\r\n        \"alert_id\": alert.id,\r\n        \"explanation\": alert.explanation_text or \"No detailed explanation available for this alert.\",\r\n        \"recommendation\": alert.recommendation or \"Review the activity manually.\",\r\n        \"confidence_score\": alert.confidence_score\r\n    }\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\routers\\privacy_router.py","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\routers","PSChildName":"privacy_router.py","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/app/routers/profiles_router.py","content":{"value":"from fastapi import APIRouter, Depends, HTTPException\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select\r\nfrom app.database import get_db\r\nfrom app.models import User, BehaviorProfile\r\nfrom app.schemas import BehaviorProfileResponse\r\nfrom app.deps import get_current_user\r\n\r\nrouter = APIRouter(prefix=\"/api/profile\", tags=[\"profile\"])\r\n\r\n@router.get(\"/baseline\", response_model=BehaviorProfileResponse)\r\nasync def get_baseline(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    result = await db.execute(select(BehaviorProfile).where(BehaviorProfile.user_id == user.id))\r\n    profile = result.scalar_one_or_none()\r\n    \r\n    if not profile:\r\n        # Return an empty/default profile if none exists yet\r\n        return {\"user_id\": user.id, \"baseline_metrics\": {}, \"last_updated\": user.created_at}\r\n        \r\n    return profile\r\n\r\n@router.get(\"/deviation\")\r\nasync def get_deviation(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user)\r\n):\r\n    # This endpoint returns the user\u0027s current deviation from their baseline.\r\n    # In a real app we\u0027d calculate this on the fly or fetch from a recent cache.\r\n    result = await db.execute(select(BehaviorProfile).where(BehaviorProfile.user_id == user.id))\r\n    profile = result.scalar_one_or_none()\r\n    \r\n    if not profile or not profile.baseline_metrics:\r\n        return {\"deviation_score\": 0.0, \"status\": \"no_baseline\"}\r\n        \r\n    # Return a mocked deviation score for visualization\r\n    import random\r\n    score = random.uniform(0.0, 100.0)\r\n    return {\r\n        \"deviation_score\": round(score, 1), \r\n        \"status\": \"normal\" if score \u003c 70 else \"abnormal\"\r\n    }\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\routers\\profiles_router.py","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\routers","PSChildName":"profiles_router.py","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}},{"path":"backend/app/routers/student_router.py","content":{"value":"from fastapi import APIRouter, Depends, HTTPException\r\nfrom sqlalchemy.ext.asyncio import AsyncSession\r\nfrom sqlalchemy import select, func, case\r\nfrom app.database import get_db\r\nfrom app.models import User, Alert, BehaviorLog, RiskScore\r\nfrom app.schemas import (\r\n    BlockAppRequest, ResolveAlertRequest, AlertResponse,\r\n    WellbeingResponse, AppUsageItem, PermissionAuditResponse,\r\n    PermissionBreakdown, LeaderboardResponse, TrainingProgressResponse, TrainingModule,\r\n)\r\nfrom app.deps import get_current_user, require_consent\r\nimport random\r\n\r\nrouter = APIRouter(prefix=\"/api\", tags=[\"student\"])\r\n\r\n\r\n@router.post(\"/block-app\")\r\nasync def block_app(\r\n    req: BlockAppRequest,\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(require_consent),\r\n):\r\n    alert = Alert(\r\n        user_id=user.id,\r\n        alert_type=\"app_blocked\",\r\n        severity=\"medium\",\r\n        message=f\"App \u0027{req.app_name}\u0027 has been blocked by user\",\r\n        resolved=True,\r\n    )\r\n    db.add(alert)\r\n    await db.commit()\r\n    return {\"status\": \"success\", \"message\": f\"App \u0027{req.app_name}\u0027 blocked successfully\"}\r\n\r\n\r\n@router.post(\"/resolve-alert\", response_model=AlertResponse)\r\nasync def resolve_alert(\r\n    req: ResolveAlertRequest,\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user),\r\n):\r\n    result = await db.execute(\r\n        select(Alert).where(Alert.id == req.alert_id, Alert.user_id == user.id)\r\n    )\r\n    alert = result.scalar_one_or_none()\r\n    if not alert:\r\n        raise HTTPException(status_code=404, detail=\"Alert not found\")\r\n\r\n    alert.resolved = True\r\n    await db.commit()\r\n    await db.refresh(alert)\r\n    return alert\r\n\r\n\r\n# â”€â”€â”€â”€ Digital Wellbeing â”€â”€â”€â”€\r\n@router.get(\"/wellbeing\", response_model=WellbeingResponse)\r\nasync def get_wellbeing(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user),\r\n):\r\n    # Aggregate behaviour logs into wellbeing metrics\r\n    result = await db.execute(\r\n        select(\r\n            BehaviorLog.app_name,\r\n            func.count(BehaviorLog.id).label(\"sessions\"),\r\n            func.avg(BehaviorLog.network_activity_level).label(\"avg_net\"),\r\n        )\r\n        .where(BehaviorLog.user_id == user.id)\r\n        .group_by(BehaviorLog.app_name)\r\n        .order_by(func.count(BehaviorLog.id).desc())\r\n    )\r\n    rows = result.all()\r\n\r\n    total_sessions = sum(r.sessions for r in rows)\r\n    # Estimate minutes per session (simulated but derived from real data)\r\n    top_apps = [\r\n        AppUsageItem(\r\n            app_name=r.app_name,\r\n            usage_minutes=round(r.sessions * random.uniform(3, 12), 1),\r\n            sessions=r.sessions,\r\n        )\r\n        for r in rows[:8]\r\n    ]\r\n    total_minutes = sum(a.usage_minutes for a in top_apps)\r\n\r\n    # Focus score: lower anomaly ratio = higher focus\r\n    anomaly_result = await db.execute(\r\n        select(func.count(BehaviorLog.id)).where(\r\n            BehaviorLog.user_id == user.id, BehaviorLog.anomaly_flag == True\r\n        )\r\n    )\r\n    anomaly_count = anomaly_result.scalar() or 0\r\n    focus_score = max(20, 100 - int((anomaly_count / max(total_sessions, 1)) * 100))\r\n\r\n    # Daily trend from last 7 days (simulated from actual log counts)\r\n    daily_trend = []\r\n    for i in range(7):\r\n        day_label = f\"Day {7 - i}\"\r\n        daily_trend.append({\r\n            \"day\": day_label,\r\n            \"screen_time\": round(random.uniform(2, 6), 1),\r\n            \"focus\": max(30, focus_score + random.randint(-15, 10)),\r\n        })\r\n\r\n    return WellbeingResponse(\r\n        screen_time_hours=round(total_minutes / 60, 1),\r\n        focus_score=focus_score,\r\n        daily_sessions=total_sessions,\r\n        top_apps=top_apps,\r\n        daily_trend=daily_trend,\r\n    )\r\n\r\n\r\n# â”€â”€â”€â”€ Permission Audit â”€â”€â”€â”€\r\n@router.get(\"/permission-audit\", response_model=PermissionAuditResponse)\r\nasync def get_permission_audit(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user),\r\n):\r\n    result = await db.execute(\r\n        select(\r\n            BehaviorLog.permission_requested,\r\n            func.count(BehaviorLog.id).label(\"cnt\"),\r\n        )\r\n        .where(BehaviorLog.user_id == user.id, BehaviorLog.permission_requested != \"none\")\r\n        .group_by(BehaviorLog.permission_requested)\r\n        .order_by(func.count(BehaviorLog.id).desc())\r\n    )\r\n    rows = result.all()\r\n    total = sum(r.cnt for r in rows) or 1\r\n\r\n    breakdown = [\r\n        PermissionBreakdown(\r\n            permission=r.permission_requested,\r\n            count=r.cnt,\r\n            percentage=round((r.cnt / total) * 100, 1),\r\n        )\r\n        for r in rows\r\n    ]\r\n\r\n    # Risky apps = apps with high network + anomaly flags\r\n    risky_result = await db.execute(\r\n        select(BehaviorLog.app_name)\r\n        .where(\r\n            BehaviorLog.user_id == user.id,\r\n            BehaviorLog.anomaly_flag == True,\r\n            BehaviorLog.permission_requested != \"none\",\r\n        )\r\n        .distinct()\r\n    )\r\n    risky_apps = [r[0] for r in risky_result.all()]\r\n\r\n    return PermissionAuditResponse(\r\n        total_requests=total,\r\n        breakdown=breakdown,\r\n        risky_apps=risky_apps,\r\n    )\r\n\r\n\r\n# â”€â”€â”€â”€ Peer Leaderboard â”€â”€â”€â”€\r\n@router.get(\"/leaderboard\", response_model=LeaderboardResponse)\r\nasync def get_leaderboard(\r\n    db: AsyncSession = Depends(get_db),\r\n    user: User = Depends(get_current_user),\r\n):\r\n    # Get all student risk scores\r\n    result = await db.execute(\r\n        select(RiskScore.user_id, RiskScore.current_score)\r\n        .join(User, User.id == RiskScore.user_id)\r\n        .where(User.role == \"student\")\r\n        .order_by(RiskScore.current_score.asc())  # lower = better\r\n    )\r\n    all_scores = result.all()\r\n    total = len(all_scores)\r\n    scores_list = [s.current_score for s in all_scores]\r\n    campus_avg = sum(scores_list) / max(len(scores_list), 1)\r\n\r\n    # Find user rank (lower score = better rank)\r\n    user_score_result = await db.execute(\r\n        select(RiskScore.current_score).where(RiskScore.user_id == user.id)\r\n    )\r\n    user_score = user_score_result.scalar() or 50.0\r\n\r\n    rank = 1\r\n    for s in all_scores:\r\n        if s.user_id == user.id:\r\n            break\r\n        rank += 1\r\n\r\n    percentile = int(((total - rank) / max(total, 1)) * 100)\r\n\r\n    # Category breakdown (simulated from real log data)\r\n    user_anomaly_result = await db.execute(\r\n        select(func.count(BehaviorLog.id)).where(\r\n            BehaviorLog.user_id == user.id, BehaviorLog.anomaly_flag == True\r\n        )\r\n    )\r\n    user_anomalies = user_anomaly_result.scalar() or 0\r\n\r\n    user_categories = {\r\n        \"network\": max(10, 100 - int(user_score * 0.8) + random.randint(-5, 5)),\r\n        \"permissions\": max(10, 100 - int(user_anomalies * 2) + random.randint(-5, 5)),\r\n        \"apps\": max(10, 100 - int(user_score * 0.6) + random.randint(-5, 5)),\r\n        \"behavior\": max(10, 100 - int(user_score * 0.7) + random.randint(-5, 5)),\r\n    }\r\n    campus_categories = {\r\n        \"network\": max(20, int(100 - campus_avg * 0.8)),\r\n        \"permissions\": max(20, int(100 - campus_avg * 0.5)),\r\n        \"apps\": max(20, int(100 - campus_avg * 0.6)),\r\n        \"behavior\": max(20, int(100 - campus_avg * 0.7)),\r\n    }\r\n\r\n    return LeaderboardResponse(\r\n        rank=rank,\r\n        total_students=total,\r\n        percentile=percentile,\r\n        user_score=round(user_score, 1),\r\n        campus_average=round(campus_avg, 1),\r\n        categories=user_categories,\r\n        campus_categories=campus_categories,\r\n    )\r\n\r\n\r\n# â”€â”€â”€â”€ Training Progress â”€â”€â”€â”€\r\nTRAINING_MODULES = [\r\n    {\"id\": \"phishing\", \"title\": \"Phishing Detection\", \"description\": \"Learn to identify phishing emails, fake links, and social engineering attacks\", \"difficulty\": \"beginner\", \"duration_minutes\": 10},\r\n    {\"id\": \"passwords\", \"title\": \"Password Security\", \"description\": \"Best practices for creating and managing secure passwords\", \"difficulty\": \"beginner\", \"duration_minutes\": 8},\r\n    {\"id\": \"social_eng\", \"title\": \"Social Engineering\", \"description\": \"Understand manipulation tactics used by attackers\", \"difficulty\": \"intermediate\", \"duration_minutes\": 15},\r\n    {\"id\": \"wifi_safety\", \"title\": \"Public Wi-Fi Safety\", \"description\": \"Stay secure on public and shared networks\", \"difficulty\": \"beginner\", \"duration_minutes\": 8},\r\n    {\"id\": \"app_permissions\", \"title\": \"App Permissions\", \"description\": \"Understand what permissions apps request and why\", \"difficulty\": \"intermediate\", \"duration_minutes\": 12},\r\n    {\"id\": \"data_privacy\", \"title\": \"Data Privacy\", \"description\": \"Protect your personal data online and offline\", \"difficulty\": \"advanced\", \"duration_minutes\": 20},\r\n]\r\n\r\n@router.get(\"/training-progress\", response_model=TrainingProgressResponse)\r\nasync def get_training_progress(\r\n    user: User = Depends(get_current_user),\r\n):\r\n    # Simulate progress â€” in production this would be stored in DB\r\n    # Use deterministic seed from user id so it\u0027s consistent\r\n    seed = sum(ord(c) for c in user.id)\r\n    rng = random.Random(seed)\r\n\r\n    modules = []\r\n    completed = 0\r\n    total_score = 0\r\n    for m in TRAINING_MODULES:\r\n        is_completed = rng.random() \u003c 0.35\r\n        score = rng.randint(70, 100) if is_completed else None\r\n        if is_completed:\r\n            completed += 1\r\n            total_score += score\r\n        modules.append(TrainingModule(\r\n            id=m[\"id\"],\r\n            title=m[\"title\"],\r\n            description=m[\"description\"],\r\n            difficulty=m[\"difficulty\"],\r\n            duration_minutes=m[\"duration_minutes\"],\r\n            completed=is_completed,\r\n            score=score,\r\n        ))\r\n\r\n    return TrainingProgressResponse(\r\n        modules=modules,\r\n        completed_count=completed,\r\n        total_count=len(TRAINING_MODULES),\r\n        overall_score=total_score // max(completed, 1),\r\n    )\r\n","PSPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\routers\\student_router.py","PSParentPath":"C:\\Users\\bharg\\buildathon\\backend\\app\\routers","PSChildName":"student_router.py","PSDrive":{"CurrentLocation":"Users\\bharg\\buildathon","Name":"C","Provider":"Microsoft.PowerShell.Core\\FileSystem","Root":"C:\\","Description":"","MaximumSize":null,"Credential":"System.Management.Automation.PSCredential","DisplayRoot":null},"PSProvider":{"ImplementingType":"Microsoft.PowerShell.Commands.FileSystemProvider","HelpFile":"System.Management.Automation.dll-Help.xml","Name":"FileSystem","PSSnapIn":"Microsoft.PowerShell.Core","ModuleName":"Microsoft.PowerShell.Core","Module":null,"Description":"","Capabilities":52,"Home":"C:\\Users\\bharg","Drives":"C"},"ReadCount":1}}]
